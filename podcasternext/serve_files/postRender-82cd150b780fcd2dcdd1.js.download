(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{"+mXA":function(e,t,a){"use strict";a.r(t);a("ioFf"),a("rGqo");var n=a("q1tI"),r=a.n(n),i=a("wldR"),s=a("2pqd"),o=a("ikHm"),l=a("mF3+"),c=a("J9+s"),d=a("Sb6f"),u=a("LEzx");class p extends u.a{getInitialState(){return{starRating:void 0,step:"rate"}}}var m=p,h=a("LvDl"),g=a.n(h),f=a("NOLh"),b=a("yNyh"),y=a("vl8/"),S=a("gp1y"),v=a("Rd/G");function E(e,t,a){if(a){const{templateId:n}=a;return e.some(e=>e.milestone===t&&e.template_id===n)}return e.some(e=>e.milestone===t)}var M=a("Ng05"),C=a("5Nka"),w=a("bkwR"),O=a("QcDD"),k=a("VyA+"),P=a("MeYt"),T=a("Cycz"),D=a("Oy36"),I=a("gyLq"),F=a("d933");function j(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}function x(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function B(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?x(Object(a),!0).forEach((function(t){A(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):x(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function A(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const R=Object(c.defineMessages)({additionalFeedbackPlaceholder:{id:"csatPopup.additionalFeedback.placeholder",defaultMessage:"Tell us more..."}});class L extends i.a{constructor(){super(...arguments),this.storeTypes={csatPopupStore:m},this.renderCancel=()=>r.a.createElement(P.a,{onClick:this.handleCancel,style:this.getCancelStyle(),hoveredStyle:{background:this.theme.buttonPressedBackground}},l.a.closeSmall({width:14,fill:this.theme.mediumTextColor})),this.renderStep=()=>{const{step:e}=this.stores.csatPopupStore.state,{currentSpaceStore:t}=O.default.state;let a;if(t){const e=t.getValue();e&&e.initial_use_cases&&(a=g.a.sample(e.initial_use_cases))}return r.a.createElement(r.a.Fragment,null,r.a.createElement(f.a,{isVisible:"rate"===e,enterAnimationStyle:{opacity:1},exitAnimationStyle:{opacity:0,translateY:-120},render:()=>r.a.createElement("div",{style:{paddingBottom:40}},this.renderIcon(),this.renderFeedbackPrompt(a))}),r.a.createElement(f.a,{isVisible:"rate"===e||"send"===e,enterAnimationStyle:{opacity:1},exitAnimationStyle:{opacity:0},render:()=>r.a.createElement("div",{style:this.getSlideContainerStyle()},this.renderStars(a),this.renderInput(),this.renderSendButton())}),r.a.createElement(f.a,{isVisible:"thanks"===e,animationStyle:this.getAnimationStyle("thanks"===e),enterAnimationStyle:this.getEnterExitAnimationStyle(),exitAnimationStyle:this.getEnterExitAnimationStyle(),render:this.renderThanks}))},this.renderThanks=()=>r.a.createElement("div",null,r.a.createElement("img",{style:{width:165,height:80},src:C.a.images.feedbackThankYouPng}),r.a.createElement("div",{style:this.getThanksHeaderStyle()},r.a.createElement(c.FormattedMessage,{defaultMessage:"Thanks for your feedback!",id:"csatPopup.thanks.header"})),r.a.createElement("div",{style:this.getThanksDescriptionStyle()},r.a.createElement(c.FormattedMessage,{defaultMessage:"Your feedback will help us make Notion better.",id:"csatPopup.thanks.description"}))),this.renderIcon=()=>{const{currentBlockStore:e}=O.default.state;if(e){const t=e.getIcon();if(t)return r.a.createElement(I.a,{justifyContent:"center",alignItems:"center"},r.a.createElement(D.a,{icon:t,isEmptyPage:!1,size:32,disabled:!0}))}return r.a.createElement(I.a,{justifyContent:"center",alignItems:"center"},l.a.notionLogo({width:32,height:32}))},this.renderFeedbackPrompt=e=>{switch(e){case"doc_notes":return r.a.createElement("div",{style:this.getFeedbackPromptStyle(),key:"feedback-prompt"},r.a.createElement(c.FormattedMessage,{defaultMessage:"How satisfied are you with using Notion for notes & docs?",id:"csatPopup.feedbackPrompt.docNotesLabel"}));case"project_management":return r.a.createElement("div",{style:this.getFeedbackPromptStyle(),key:"feedback-prompt"},r.a.createElement(c.FormattedMessage,{defaultMessage:"How satisfied are you with managing projects and tasks in Notion?",id:"csatPopup.feedbackPrompt.projManagementLabel"}));case"wiki":return r.a.createElement("div",{style:this.getFeedbackPromptStyle(),key:"feedback-prompt"},r.a.createElement(c.FormattedMessage,{defaultMessage:"How satisfied are you with using Notion for team wikis?",id:"csatPopup.feedbackPrompt.wikiLabel"}));default:return this.shouldRenderAsNPS(e)?r.a.createElement("div",{style:this.getFeedbackPromptStyle(),key:"feedback-prompt"},r.a.createElement(c.FormattedMessage,{defaultMessage:"How likely are you to recommend Notion to a friend?",id:"csatPopup.feedbackPrompt.enterpriseDefaultLabel"})):r.a.createElement("div",{style:this.getFeedbackPromptStyle(),key:"feedback-prompt"},r.a.createElement(c.FormattedMessage,{defaultMessage:"How satisfied are you with using Notion? ",id:"csatPopup.feedbackPrompt.defaultlabel"}))}},this.renderInput=()=>{const{step:e,additionalFeedback:t}=this.stores.csatPopupStore.state;return r.a.createElement(k.a,{capture:!0,onBackspace:g.a.identity,onLeft:g.a.identity,onRight:g.a.identity,onSelectAll:g.a.identity,onRedo:g.a.identity,onUndo:g.a.identity,onCut:g.a.identity,onCopy:g.a.identity,onPaste:g.a.identity,onKeypress:g.a.identity,onDelete:g.a.identity,onTab:g.a.identity},r.a.createElement(b.b,{textarea:!0,style:this.getInputContainerStyle(),focus:"send"===e,value:t,placeholder:y.default.formatMessage(R.additionalFeedbackPlaceholder),onChange:e=>{this.stores.csatPopupStore.setState(B({},this.stores.csatPopupStore.state,{additionalFeedback:e.target.value}))}}))},this.renderSendButton=()=>r.a.createElement(M.a,{isLarge:!0,style:this.getButtonStyle(),onClick:this.handleSend},r.a.createElement(c.FormattedMessage,{id:"csatPopup.sendButton.label",defaultMessage:"Send"})),this.renderStars=e=>{const{starRating:t,step:a}=this.stores.csatPopupStore.state,n=e=>{let{rating:n}=e;return r.a.createElement("div",{style:this.getStarStyle(),onMouseEnter:()=>{"rate"===a&&this.stores.csatPopupStore.setState(B({},this.stores.csatPopupStore.state,{starRating:n}))},onClick:()=>{this.stores.csatPopupStore.setState({starRating:n,step:"send"})}},l.a.star({width:18,fill:this.theme.mediumIconColor,position:"absolute",opacity:t&&t>=n?0:1}),l.a.starFilled({width:18,fill:"#F6C050",position:"absolute",opacity:t&&t>=n?1:0}))};return r.a.createElement("div",{onMouseLeave:()=>{g.a.delay(()=>{"rate"===this.stores.csatPopupStore.state.step&&this.stores.csatPopupStore.setState(B({},this.stores.csatPopupStore.state,{starRating:void 0}))},500)},style:this.getStarsContainerStyle()},r.a.createElement("div",{style:this.getStarsStyle()},r.a.createElement(n,{rating:1}),r.a.createElement(n,{rating:2}),r.a.createElement(n,{rating:3}),r.a.createElement(n,{rating:4}),r.a.createElement(n,{rating:5})),r.a.createElement("div",{style:this.getStarLabelStyle()},r.a.createElement(()=>{const a=this.shouldRenderAsNPS(e);switch(t){case 1:return a?r.a.createElement(c.FormattedMessage,{defaultMessage:"Very unlikely",id:"csatPopup.stars.1StarLabelNps"}):r.a.createElement(c.FormattedMessage,{defaultMessage:"Very dissatisfied",id:"csatPopup.stars.1StarLabel"});case 2:return a?r.a.createElement(c.FormattedMessage,{defaultMessage:"Somewhat unlikely",id:"csatPopup.stars.2StarLabelNps"}):r.a.createElement(c.FormattedMessage,{defaultMessage:"Somewhat dissatisfied",id:"csatPopup.stars.2StarLabel"});case 3:return a?r.a.createElement(c.FormattedMessage,{defaultMessage:"Not likely nor unlikely",id:"csatPopup.stars.3StarLabelNps"}):r.a.createElement(c.FormattedMessage,{defaultMessage:"Not dissatisfied nor satisfied",id:"csatPopup.stars.3StarLabel"});case 4:return a?r.a.createElement(c.FormattedMessage,{defaultMessage:"Somewhat likely",id:"csatPopup.stars.4StarLabelNps"}):r.a.createElement(c.FormattedMessage,{defaultMessage:"Somewhat satisfied",id:"csatPopup.stars.4StarLabel"});case 5:return a?r.a.createElement(c.FormattedMessage,{defaultMessage:"Very likely",id:"csatPopup.stars.5StarLabelNps"}):r.a.createElement(c.FormattedMessage,{defaultMessage:"Very satisfied",id:"csatPopup.stars.5StarLabel"});default:return r.a.createElement(c.FormattedMessage,{defaultMessage:"Select an option",id:"csatPopup.stars.notSpecifiedLabel"})}},null)))},this.handleCancel=async()=>{const{state:e}=s.a;if(!e.open)return;const{open:t}=e,a=j(e,["open"]);if(t&&"trigger"===a.type){const{currentSpaceStore:e}=O.default.state;if(!e)return;await w.submitCsatFeedback(this.environment,B({spaceId:e.id,rating:void 0,additionalFeedback:void 0,templateId:void 0},a,{useCase:"legacy"===a.useCase?void 0:a.useCase}))}s.a.setState(B({},s.a,{open:!1}))},this.handleSend=async()=>{const{additionalFeedback:e,starRating:t}=this.stores.csatPopupStore.state,{currentSpaceStore:a}=O.default.state;if(!a||!t)return;const{state:n}=s.a;if(!n.open)return;const{open:r}=n,i=j(n,["open"]),o="passive"===i.type?await w.submitCsatFeedback(this.environment,{spaceId:a.id,rating:t,additionalFeedback:e,type:i.type,milestone:void 0,templateId:void 0}):await w.submitCsatFeedback(this.environment,B({spaceId:a.id,rating:t,additionalFeedback:e,templateId:void 0},i,{useCase:"legacy"===i.useCase?void 0:i.useCase}));if("success"!==o.type)throw o.error;this.stores.csatPopupStore.setState(B({},this.stores.csatPopupStore.state,{step:"thanks"})),g.a.delay(()=>{s.a.setState(B({},s.a,{open:!1})),g.a.delay(()=>{this.stores.csatPopupStore.reset()},1e3)},2e3)},this.flexCenteredStyle={display:"flex",alignItems:"center",flexDirection:"column"}}willMount(){const{userSettingsStore:e,blockStore:t,spaceStore:a}=this.props;if(e&&t&&a){const n=this.environment;if("CsatMilestoneStore"in n){const r=F.a.withListenerIgnored(()=>function(e,t){const{userSettingsStore:a,blockStore:n,spaceStore:r}=t,i=a.getSettings(),{signup_time:s}=i,{CsatMilestoneStore:o}=e,{data:l}=o.state,c=e=>Math.floor((Date.now()-e)/864e5),d=r.getValue();if(!d||!l)return;const{milestones:u}=l;if(!u)return;if(Math.max(...u.map(e=>e.created_time))>Date.now()-24192e5)return;if(s){const e=c(s),t=g.a.sample(d.initial_use_cases)||"legacy";if(e>=180){if(!E(u,S.b))return{milestone:S.b,useCase:t}}else if(e>=90){if(!E(u,S.e))return{milestone:S.e,useCase:t}}else if(e>=28){if(!E(u,S.c))return{milestone:S.c,useCase:t}}else if(e>=7&&!E(u,S.d))return{milestone:S.d,useCase:t}}const p=n.getValue();return p&&p.copied_from&&Object(v.k)(p.copied_from)&&c(p.created_time)>=7&&!E(u,S.a,{templateId:p.copied_from})?{milestone:S.a,useCase:"legacy",templateId:p.copied_from}:void 0}(n,{userSettingsStore:e,blockStore:t,spaceStore:a}));if(r){const{milestone:e,useCase:t,templateId:a}=r;g.a.delay(()=>{s.a.setState({open:!0,milestone:e,type:"trigger",useCase:t,templateId:a})},2e3)}}}}renderComponent(){const{device:e}=this.environment;if(e.isMobile)return;const{currentSpaceStore:t}=O.default.state;return t&&t.canRead()?r.a.createElement(f.a,{isVisible:s.a.state.open,animationStyle:this.getAnimationStyle(s.a.state.open),enterAnimationStyle:this.getEnterExitAnimationStyle(),exitAnimationStyle:this.getEnterExitAnimationStyle(),springConfig:this.getSpringConfig(),render:()=>r.a.createElement("div",{style:this.getContainerStyle()},this.renderCancel(),r.a.createElement("div",{style:this.getInnerContainerStyle()},this.renderStep()))}):void 0}shouldRenderAsNPS(e){const t=T.i(this.environment),{state:a}=s.a,n=a.open&&"trigger"===a.type;return"enterprise"===t&&!e&&n}getSpringConfig(){return{scale:{stiffness:58,damping:4.3}}}getAnimationStyle(e){return{opacity:e?1:0,scale:e?1:.96}}getEnterExitAnimationStyle(){return{opacity:0,scale:.96}}getThanksHeaderStyle(){return{color:this.theme.regularTextColor,fontWeight:d.a.fontWeight.semibold,fontSize:14}}getThanksDescriptionStyle(){return{color:this.theme.mediumTextColor,fontSize:12}}getButtonStyle(){return{width:"calc(100% - 30px)"}}getInputContainerStyle(){const{step:e}=this.stores.csatPopupStore.state;return{width:"calc(100% - 30px)",display:"block",background:this.theme.popoverBackground,height:80,marginTop:10,marginBottom:10,opacity:"rate"===e?0:1}}getStarLabelStyle(){return{fontSize:12,color:this.theme.mediumTextColor,paddingTop:4}}getFeedbackPromptStyle(){return{paddingTop:12,paddingBottom:12,color:this.theme.regularTextColor,fontWeight:d.a.fontWeight.semibold,fontSize:14,lineHeight:1.4,width:188}}getStarStyle(){return{display:"inline-flex",position:"relative",width:20,height:20,marginRight:3}}getSlideContainerStyle(){const{step:e}=this.stores.csatPopupStore.state;return B({},this.flexCenteredStyle,{position:"absolute",transition:"transform 200ms ease",width:240,transform:"rate"===e?"translateY(120px)":"translateY(0px)"})}getStarsContainerStyle(){return B({width:"100%"},this.flexCenteredStyle)}getStarsStyle(){return{display:"flex",cursor:"pointer"}}getContainerStyle(){const{device:e}=this.environment;return{background:this.theme.popoverBackground,borderRadius:5,boxShadow:this.theme.mediumBoxShadow,position:"absolute",bottom:65+e.scrollbarWidth,right:16+e.scrollbarWidth,zIndex:o.g}}getInnerContainerStyle(){return B({},this.flexCenteredStyle,{width:240,height:195,overflow:"hidden",position:"relative",padding:12,cursor:"default",textAlign:"center",justifyContent:"center"})}getCancelStyle(){return{position:"absolute",top:"10px",right:"10px",background:this.theme.buttonHoveredBackground,borderRadius:"100%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",zIndex:10}}}t.default=Object(c.injectIntl)(L)},"3eY8":function(e,t,a){"use strict";a.d(t,"a",(function(){return f}));var n=a("bkwR"),r=a("VkkH"),i=a("S26v"),s=a("tP7q"),o=a("A9TN"),l=a("Wnyi"),c=a("hvW1"),d=a("VBxf"),u=a("y6Dp"),p=a("miBo"),m=a("RqMp"),h=a("J9+s");const g=Object(h.defineMessages)({authenticatingWithAsana:{id:"asanaActions.authenticatingWithAsana.loadingMessage",defaultMessage:"Authenticating with Asana…"},titleMessage:{defaultMessage:"Asana login",id:"asanaActions.loginWithAsanaPopupModal.title"}});async function f(e){const{environment:t,requestStore:a}=e,h=Object(l.b)(t);let f=Object(s.c)(o.default.baseURL,{authType:h,userId:t.currentUser.id});f=h.redirectToAuth?f:await Object(l.c)(t,f);const b=await r.a(t,{width:580,height:800,url:f,titleMessage:g.titleMessage});if(!b)return;const y=i.e(b);if(!y.query.code||!y.query.state)return;c.b({message:g.authenticatingWithAsana});const S=await n.authWithAsana(t,{code:y.query.code,encryptedState:y.query.state});"failed"===S.type?(console.error(S.error),d.showError(S),c.a()):(u.p(t,{name:"asana"}),await a.refresh(),p.a.setState({open:!0}),m.a.setState({open:!0}),c.a())}},"64mo":function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a("q1tI"),r=a.n(n),i=a("wldR"),s=a("wXH4"),o=a("/6eU");class l extends i.a{renderComponent(){const{render:e}=this.props,{device:t}=this.environment,a=this.props.modalStore.state;return t.isMobile?r.a.createElement(s.c,{open:a.open,popupType:s.c.PopupType.SlideUp,origin:this.props.origin,onDismiss:this.props.onDismiss,render:e}):r.a.createElement(o.a,{open:a.open,preventHideChildrenWhileOpening:!0,render:e,onDismiss:this.props.onDismiss})}}},"7ObC":function(e,t,a){"use strict";a.r(t);var n=a("q1tI"),r=a.n(n),i=a("Nxch"),s=a("wldR"),o=a("wXH4"),l=a("J9+s"),c=a("ZmWw"),d=(a("ioFf"),a("rGqo"),a("MBf9")),u=a("5w/s"),p=a("2Y+N"),m=a("g8hj"),h=a("njgS"),g=a("htWf"),f=a("gbGO"),b=a("ZQ9l"),y=a("j3Jm"),S=a("GZ8e"),v=a("fU6e"),E=a("IdIf"),M=a("mF3+"),C=a("Fco/"),w=a("0CAA"),O=a("nPEg"),k=a("Oy36"),P=a("OxuQ"),T=a("hU3F"),D=a("QkuB"),I=a("g4rC");class F extends s.a{constructor(){super(...arguments),this.storeTypes={hovered:T.a.of(!1),buttonPopupStore:T.a.of(new I.a)}}renderComponent(){const{schema:e,property:t,format:a}=this.props,n=e[t];if(!n)return;const s=this.getPropertyVisibility(n);return r.a.createElement(D.b,{onMouseEnter:()=>this.stores.hovered.set(!0),onMouseLeave:()=>this.stores.hovered.set(!1),focused:this.stores.hovered.get(),key:t,showDragHandle:!this.environment.device.isMobile,showExtensionArrow:!1,propertySchema:n,format:D.b.DisplayFormat.Name,dontShrinkRight:!0,ignoreLocalHoverState:!0,locked:this.props.locked,onClick:()=>{if(!this.props.locked){const e=this.stores.buttonPopupStore.get();e.setState({open:!e.state.open})}},right:r.a.createElement(v.a,{buttonPopupStore:this.stores.buttonPopupStore.get(),visibility:s,locked:this.props.locked,onSelect:e=>{i.e({environment:this.environment,property:t,visibility:e,format:a,store:this.props.store})},onClose:()=>this.stores.hovered.set(!1),type:"property",propertySchema:n})})}getPropertyVisibility(e){const{visibility:t}=this.props;switch(t){case"hide_if_empty":return g.d({propertySchema:e})?"hide_if_empty":"show";default:return t}}}var j=F,x=a("Sb6f"),B=a("d9nj"),A=a("Cf1b"),R=a("IdSf"),L=a("/YYm");function U(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function _(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?U(Object(a),!0).forEach((function(t){W(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):U(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function W(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class N extends s.a{constructor(){super(...arguments),this.storeTypes={lockStore:A.a},this.handleDraggableDrop=e=>{const t=this.getCollectionPageProperties();if(t){const a=e.map(e=>t.find(t=>t.property===e));i.c({environment:this.environment,properties:a,store:this.props.store})}},this.handleToggleLockClick=()=>{const e=g.a();if(!e)return!1;const t=e.getParentBlockStore();t&&(d.createAndCommit(this.environment,e=>{u.e({environment:this.environment,store:t,isLocked:!g.b(),transaction:e})}),this.stores.lockStore.setState({justUnlocked:!this.stores.lockStore.state.justUnlocked}))}}renderComponent(){const{device:e}=this.environment;let t;t=e.isMobile?{menuType:f.b.MenuType.Modal,right:r.a.createElement(O.DoneMenuText,null),onClickRight:i.a,title:this.props.intl.formatMessage({id:"customizePageMenu.mobileHeader.label",defaultMessage:"Customize page"})}:{menuType:f.b.MenuType.Popup,minWidth:400};const a=this.getNormalizedFormat();return r.a.createElement(f.b,Object.assign({},t,{header:this.renderHeader()}),(this.props.locked||this.stores.lockStore.state.justUnlocked)&&this.renderLockControls(),this.renderPageSectionsSectionMenuItem(a),this.renderPropertiesSectionMenuItem(a))}renderLockControls(){return r.a.createElement("div",{style:{fontSize:12,display:"flex",justifyContent:"center",alignItems:"center",borderTop:"1px solid ".concat(this.theme.regularDividerColor),borderBottom:"1px solid ".concat(this.theme.regularDividerColor),background:this.theme.sidebarBackground,color:this.theme.mediumTextColor,paddingTop:6,paddingBottom:6}},r.a.createElement("span",{style:{display:"inline-block",verticalAlign:"middle",paddingRight:6}},this.stores.lockStore.state.justUnlocked?M.a.unlocked({height:12,width:12,fill:this.theme.mediumIconColor}):M.a.locked({height:12,width:12,fill:this.theme.mediumIconColor})),this.stores.lockStore.state.justUnlocked?r.a.createElement(l.FormattedMessage,{id:"customizePageMenu.unlocked.header",defaultMessage:"Settings unlocked on parent database."}):r.a.createElement(l.FormattedMessage,{id:"customizePageMenu.locked.header",defaultMessage:"Settings locked on parent database."}),r.a.createElement(B.a,{style:{fontSize:12,color:this.theme.mediumTextColor,fontWeight:x.a.fontWeight.semibold,marginLeft:2,paddingLeft:4,paddingRight:4,height:20},onClick:this.handleToggleLockClick},this.stores.lockStore.state.justUnlocked?r.a.createElement(l.FormattedMessage,{id:"customizePageMenu.lock.label",defaultMessage:"Re-lock"}):r.a.createElement(l.FormattedMessage,{id:"customizePageMenu.unlock.label",defaultMessage:"Unlock"})))}renderPropertiesSectionMenuItem(e){const t=this.getSchema();if(!t||"page"===this.props.type)return;const a=this.getPageCustomization(e);if(!a)return;const{propertyVisibility:n}=a;if(!n)return;const i=n.reduce((e,t)=>(e[t.property]=t.visibility,e),{});return r.a.createElement(p.a,{style:{opacity:this.props.locked?.5:1},isTitleUppercase:!0,title:r.a.createElement(l.FormattedMessage,{id:"customizePageMenu.propertiesSection.header",defaultMessage:"Properties"})},r.a.createElement(m.b,{direction:m.a.Vertical,keys:this.getCollectionPageProperties().map(e=>e.property),renderKey:a=>{if("collection"===this.props.type)return r.a.createElement(j,{schema:t,visibility:i[a],property:a,format:e,store:this.props.store,locked:this.props.locked})},onDrop:this.handleDraggableDrop}))}renderPageSectionsSectionMenuItem(e){const t=this.getPageCustomization(e);if(!t)return;const{pageSectionVisibility:a}=t;return a?r.a.createElement(p.a,{style:{opacity:this.props.locked?.5:1},title:r.a.createElement(l.FormattedMessage,{id:"customizePageMenu.sectionsSection.header",defaultMessage:"Sections"}),isTitleUppercase:!0,topBorder:!this.props.locked&&!this.stores.lockStore.state.justUnlocked},r.a.createElement(b.a,{title:r.a.createElement(l.FormattedMessage,{id:"customizePageMenu.pageSections.backlinksTitle",defaultMessage:"Backlinks"}),icon:M.a.alias({height:16,width:16,transform:"rotate(180deg)"}),right:r.a.createElement(v.a,{visibility:a.backlinks,locked:this.props.locked,onSelect:t=>{i.d({environment:this.environment,pageSection:"backlinks",visibility:t,store:this.props.store,format:e})},type:"page"})}),r.a.createElement(b.a,{title:r.a.createElement(l.FormattedMessage,{id:"customizePageMenu.pageSections.commentsTitle",defaultMessage:"Page comments"}),icon:M.a.speechBubbleThick({height:16,width:16}),right:r.a.createElement(v.a,{visibility:a.comments,visibilityLevels:["section_show","section_hide"],locked:this.props.locked,onSelect:t=>{i.d({environment:this.environment,pageSection:"comments",visibility:t,store:this.props.store,format:e})},type:"page"})})):void 0}renderHeader(){if(this.environment.device.isMobile)return;const{store:e}=this.props;if(e){const t=e.getIcon(),a="collection"===this.props.type?this.props.store.getParentBlockStore():void 0,n=t&&r.a.createElement(k.a,{icon:t,isEmptyPage:!1,size:14,disabled:!0,style:{display:"inline-flex",marginRight:2}}),s=r.a.createElement(P.a,{store:e,style:{display:"inline"}}),o=r.a.createElement(S.a,{prefix:r.a.createElement(l.FormattedMessage,{id:"customizePageMenu.header.label",defaultMessage:"Page view for "}),viewName:a?r.a.createElement(r.a.Fragment,null,r.a.createElement(R.a,{onClick:i.a,href:Object(L.a)({store:a,fullyQualified:!1}),inline:!0},n,s)):r.a.createElement(r.a.Fragment,null,n,s)});return r.a.createElement(b.a,{style:_({},y.d.headingStyle),title:o,right:r.a.createElement(C.a,{helpButtonContext:"collection_properties_menu",href:Object(w.a)("guides.databaseProperties")})})}}getSchema(){if("collection"!==this.props.type)return this.props.store.getSchema();{const e=this.props.store.getValue();if(e)return h.e(e.schema)}}getNormalizedFormat(){const e=this.props.store.getFormat(),t=this.getSchema();return t?E.i(e,t,void 0,[],E.a.Collection):{}}getCollectionPageProperties(){if("collection"!==this.props.type)return[];return this.getNormalizedFormat().collection_page_properties||[]}getPageCustomization(e){return{propertyVisibility:e.property_visibility,pageSectionVisibility:e.page_section_visibility}}}var q=N,V=a("szb2"),z=a("QcDD");class H extends s.a{constructor(){super(...arguments),this.renderModal=()=>{if(!c.a.state.isOpen)return;const e=g.a(),{currentBlockStore:t}=z.default.state,a=V.c.state.open&&V.c.state.target||t;return e?r.a.createElement(q,{store:e,type:"collection",intl:this.props.intl,locked:g.b()}):a?r.a.createElement(q,{store:a,type:"page",intl:this.props.intl,locked:!1}):void 0}}renderComponent(){const{device:e}=this.environment,t=c.a.state;return r.a.createElement(o.c,{popupType:e.isMobile?o.c.PopupType.SlideUp:o.c.PopupType.Popup,alignmentToOrigin:o.c.Alignment.Center,open:t.isOpen,render:this.renderModal,originRect:t.isOpen?t.rect:void 0,onDismiss:()=>i.a()})}}t.default=Object(l.injectIntl)(H)},"8evV":function(e,t,a){"use strict";a.r(t);a("ioFf"),a("rGqo");var n=a("q1tI"),r=a.n(n),i=a("wldR"),s=a("CZQ9"),o=a("J9+s"),l=a("64mo"),c=a("vJXr"),d=a("IULH"),u=a("Sb6f"),p=a("ovYF"),m=a("oYg8"),h=a("bkwR"),g=a("HTHG"),f=a("q4wu"),b=a("WgIs"),y=a("gbGO"),S=a("2Y+N"),v=a("T4gQ"),E=a("mF3+"),M=a("VBxf");const C=Object(o.defineMessages)({phishing_or_spam:{id:"reportPage.reportReasons.phishing_or_spam",defaultMessage:"Phishing or spam"},inappropriate_content:{id:"reportPage.reportReasons.inappropriate_content",defaultMessage:"Inappropriate content"}});var w=a("vl8/"),O=a("zmp8"),k=a("sSHh"),P=a("0CAA"),T=a("yNyh"),D=a("ZQ9l"),I=a("Z1H8");function F(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}function j(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function x(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?j(Object(a),!0).forEach((function(t){B(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):j(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function B(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const A=Object(o.defineMessages)({additionalInformationPlaceholder:{id:"reportPage.additionalInformation.placeholder",defaultMessage:"Add additional information (optional)"}});class R extends i.a{constructor(e){super(e),this.handleCancel=()=>{Object(p.a)()},this.renderContent=()=>{const{device:e}=this.environment;if(!c.a.state.online)return this.renderOffline();const t=s.a.state;return t.open?e.isMobile?this.renderMobileModal(t):this.renderDesktopModal(t):void 0},this.onSubmit=async()=>{const e=this.environment,t=s.a.getState();if(!t.open)return;const{additionalInformation:a,reason:n}=t,i=Object(g.c)();if(!n||!i)return void M.showErrorMessage(r.a.createElement(o.FormattedMessage,{defaultMessage:"Something went wrong.",id:"reportPageModal.somethingWentWrong.label"}));const l=await(c=Object(f.a)(),Object(h.reportPage)(e,{reason:n,pageId:i,intercomVisitorId:c,additionalInformation:a}));var c;"failed"===l.type?M.showError(l):(s.a.setState({open:!1}),M.showMessage({message:r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},E.a.thanksShield({width:40}),r.a.createElement("div",{style:{paddingTop:12,paddingBottom:8,fontSize:"large",textAlign:"center"}},r.a.createElement(o.FormattedMessage,{id:"reportPageModal.thanksForReporting",defaultMessage:"Thanks for reporting this page, our team will take a look."}))))}))},this.modalTitleStyle={fontSize:16,marginBottom:12,fontWeight:u.a.fontWeight.medium}}renderComponent(){return r.a.createElement(l.a,{onDismiss:this.handleCancel,render:this.renderContent,requireOnline:!0,modalStore:s.a})}renderOptionButtons(e){const{reason:t}=e;return r.a.createElement(r.a.Fragment,null,r.a.createElement(m.a,{key:"phishing_or_spam",title:r.a.createElement(o.FormattedMessage,{id:"reportPageModal.reportReasons.phishing_or_spam",defaultMessage:"Phishing or spam"}),isSelected:"phishing_or_spam"===t,onClick:()=>s.a.setState(x({},e,{reason:"phishing_or_spam"}))}),r.a.createElement(m.a,{key:"inappropriate_content",title:w.default.formatMessage(C.inappropriate_content),isSelected:"inappropriate_content"===t,onClick:()=>s.a.setState(x({},e,{reason:"inappropriate_content"}))}))}renderMobileModal(e){if(!e.open)return;const{reason:t}=e,a={menuType:y.a.Modal,title:r.a.createElement(o.FormattedMessage,{id:"reportPageModal.mobile.title",defaultMessage:"Report page"}),right:r.a.createElement(o.FormattedMessage,{id:"reportPageModal.closeButton.label",defaultMessage:"Close"}),onClickRight:this.handleCancel};return r.a.createElement(y.b,Object.assign({},a),r.a.createElement(b.a,{key:"main list",type:b.a.Type.Vertical,initialFocus:void 0,sections:[{key:"help",render:e=>{let{children:t}=e,a=F(e,["children"]);return r.a.createElement(S.a,Object.assign({},a),t)},items:[{key:"help",render:()=>r.a.createElement(D.a,{title:r.a.createElement(k.a,{title:r.a.createElement(o.FormattedMessage,{id:"reportPage.helpButton.caption",defaultMessage:"Notion's content policy"}),href:Object(P.a)("contentPolicy"),analyticsFrom:"report_page"}),right:r.a.createElement(r.a.Fragment,null),onClick:()=>{}}),action:()=>{}}]},{key:"reportOptions",render:e=>{let{children:t}=e,a=F(e,["children"]);return r.a.createElement(S.a,Object.assign({},a),t)},items:[{key:"options",render:()=>this.renderOptionButtons(e),action:()=>{}},{key:"additionalInfo",render:()=>t&&r.a.createElement(T.b,{textarea:!0,style:this.getTextAreaStyle(),focus:!1,value:e.additionalInformation,placeholder:w.default.formatMessage(A.additionalInformationPlaceholder),onChange:t=>{s.a.setState(x({},e,{additionalInformation:t.target.value}))}}),action:()=>{}}]},{key:"actions",render:e=>{let{children:t}=e,a=F(e,["children"]);return r.a.createElement(S.a,Object.assign({isSubmitButton:!0},a),t)},items:[{key:"submit",render:e=>{const{onClick:t}=e,a=F(e,["onClick"]);return r.a.createElement(v.a,Object.assign({},a,{disabled:!this.canSubmit(),title:r.a.createElement("div",{style:{color:O.f.red}},r.a.createElement(o.FormattedMessage,{id:"reportPageModal.reportButton.label",defaultMessage:"Report"})),onClick:t||this.onSubmit}))},action:this.onSubmit}]}]}))}canSubmit(){const{state:e}=s.a;if(e.open){const{reason:t}=e;return void 0!==t}return!1}renderDesktopModal(e){if(!e.open)return;const{reason:t}=e;return r.a.createElement(I.a,{capture:!0,allowUndo:!0,allowEsc:!0,allowTabUntab:!1,render:()=>r.a.createElement("div",{style:this.getModalWrapStyle()},r.a.createElement("div",{style:this.modalTitleStyle},r.a.createElement(o.FormattedMessage,{id:"reportPageModal.title",defaultMessage:"Why are you reporting this page?"})),r.a.createElement("div",{style:{paddingBottom:12}},r.a.createElement(k.a,{title:r.a.createElement(o.FormattedMessage,{id:"reportPage.helpButton.caption",defaultMessage:"Notion's content policy"}),href:Object(P.a)("contentPolicy"),analyticsFrom:"report_page"})),r.a.createElement("div",null,this.renderOptionButtons(e)),t&&r.a.createElement(T.b,{textarea:!0,style:this.getTextAreaStyle(),focus:Boolean(e.reason),value:e.additionalInformation,placeholder:w.default.formatMessage(A.additionalInformationPlaceholder),onChange:t=>{s.a.setState(x({},e,{additionalInformation:t.target.value}))}}),r.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:18}},r.a.createElement(d.a,{isLarge:!0,onClick:this.handleCancel,style:{marginRight:12}},r.a.createElement(o.FormattedMessage,{id:"reportPageModal.cancelButton.label",defaultMessage:"Cancel"})),r.a.createElement(d.a,{isRed:!0,isLarge:!0,onClick:this.onSubmit,disabled:!this.canSubmit(),disabledFeedback:!0},r.a.createElement(o.FormattedMessage,{id:"reportPageModal.reportButton.label",defaultMessage:"Report"}))))})}renderOffline(){return r.a.createElement("div",{style:this.getOfflineStyle()},r.a.createElement(o.FormattedMessage,{defaultMessage:"Please go online to make a report.",id:"reportPageModal.offlineMessage.description"}))}getModalWrapStyle(){return{width:360,padding:24,fontSize:14}}getOfflineStyle(){return x({},this.getModalWrapStyle(),{color:this.theme.mediumTextColor})}getTextAreaStyle(){const{device:e}=this.environment;return{width:"100%",background:this.theme.popoverBackground,display:"block",padding:e.isMobile?16:"10px 12px",height:e.isMobile?150:130,marginTop:17,marginBottom:17,fontSize:e.isMobile?16:14}}}t.default=R},"9f/M":function(e,t,a){"use strict";a.d(t,"a",(function(){return f}));var n=a("bkwR"),r=a("VkkH"),i=a("S26v"),s=a("tP7q"),o=a("A9TN"),l=a("Wnyi"),c=a("hvW1"),d=a("VBxf"),u=a("y6Dp"),p=a("VcB+"),m=a("RqMp"),h=a("J9+s");const g=Object(h.defineMessages)({authenticatingWithTrello:{id:"trelloActions.authenticatingWithTrello.loadingMessage",defaultMessage:"Authenticating with Trello…"},titleMessage:{defaultMessage:"Trello login",id:"trelloActions.loginPopupModal.title"}});async function f(e){const{environment:t,requestStore:a}=e,h=Object(l.b)(t);let f=Object(s.j)(o.default.baseURL,{authType:h,userId:t.currentUser.id});f=h.redirectToAuth?f:await Object(l.c)(t,f);const b=await r.a(t,{width:580,height:700,url:f,titleMessage:g.titleMessage});if(!b)return;const y=i.e(b),S=y.query.oauth_token,v=y.query.oauth_verifier;if(!S||!v)return;c.b({message:g.authenticatingWithTrello});const E=await n.authWithTrello(t,{requestToken:S,verifier:v});"failed"===E.type?(console.error(E.error),d.showError(E),c.a()):(u.p(t,{name:"trello"}),await a.refresh(),p.a.setState({open:!0}),m.a.setState({open:!0}),c.a())}},AXyr:function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return l}));a("ioFf"),a("rGqo");var n=a("yjqD"),r=a("QmC8");function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const o=function(e){const t=n.c();return r.a.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){s(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e,{open:!0,onComplete:t.resolve,inputValue:""})),t.promise},l=function(e){const t=r.a.state;t.open&&(t.onComplete(e.didConfirm),r.a.reset())}},B0TY:function(e,t,a){"use strict";a.r(t);var n=a("q1tI"),r=a.n(n),i=a("wldR"),s=a("QcDD"),o=a("RqMp"),l=(a("ioFf"),a("rGqo"),a("prF1")),c=a("lCCU"),d=a("SR/M"),u=a("i3uR"),p=a("vJXr"),m=a("MeYt"),h=a("zmp8"),g=a("Sb6f");function f(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function b(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?f(Object(a),!0).forEach((function(t){y(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):f(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function y(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class S extends i.a{renderComponent(){const{title:e,actionButton:t,onClick:a}=this.props;return r.a.createElement(m.a,{onClick:a,style:this.getButtonStyle()},this.renderIcon(),r.a.createElement("div",{style:{minWidth:0,width:"100%"}},r.a.createElement("div",{style:{display:"flex"}},r.a.createElement("div",{style:S.titleStyle},e),r.a.createElement("div",{style:{marginLeft:"auto"}},t)),this.renderCaption()))}renderIcon(){const{icon:e,logo:t}=this.props;return t?r.a.createElement("img",{style:S.imageIconStyle,src:t}):e?r.a.createElement("div",{style:this.getIconWrapStyle()},e(this.getIconStyle())):void 0}renderCaption(){const{caption:e}=this.props;if(e)return r.a.createElement("div",{style:this.getCaptionStyle()},e)}getButtonStyle(){return{display:"flex",alignItems:this.props.caption?"flex-start":"center",padding:10,paddingRight:8,borderRadius:3,marginBottom:12,cursor:"pointer",boxShadow:this.theme.lightBoxShadow,transition:"background 200ms ease-out",background:this.theme.contentBackground}}getIconWrapStyle(){return{display:"flex",alignItems:"center",justifyContent:"center",width:S.iconSize,height:S.iconSize,borderRadius:3,marginRight:8,color:this.theme.mediumTextColor,background:this.theme.sidebarBackground}}getIconStyle(){return{flexShrink:0,width:S.iconSize,height:S.iconSize}}getCaptionStyle(){return b({fontSize:12,color:this.theme.mediumTextColor,wordBreak:"keep-all"},!this.props.shouldWrapCaption&&b({},g.a.textOverflowStyle))}}S.iconSize=28,S.imageIconStyle={flexShrink:0,width:S.iconSize,height:S.iconSize,borderRadius:3,marginRight:10,background:h.f.white},S.titleStyle={fontSize:16,fontWeight:g.a.fontWeight.medium};var v=S,E=a("wlCD"),M=a("gbGO"),C=a("WgIs"),w=a("Pl3d"),O=a("CSYU"),k=a("2Y+N"),P=a("LeVO"),T=a("wXH4"),D=a("y6Dp"),I=(a("Vd3H"),a("rE2o"),a("mKX5")),F=a("yjqD"),j=a("wpmu"),x=a("bkwR"),B=a("N34Z"),A=a("MBf9"),R=a("p+Y9"),L=a("sdlW"),U=a("hvW1"),_=a("VBxf"),W=a("jZoB"),N=a("miBo"),q=a("VcB+"),V=a("LvDl"),z=a.n(V),H=a("HRSx"),G=a("udrG"),Q=a("cw0H"),Y=a("J9+s"),Z=a("vl8/");const X=["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.wordprocessingml.template","application/vnd.ms-word.document.macroEnabled.12","application/vnd.ms-word.template.macroEnabled.12"],K=["text/plain",".md",".mdown",".markdown",".mkdn",".mkd",".Rmd",".md.txt"],J={markdown:K,csv:["text/plain",".csv"],html:["text/html"],docx:X,gdocs:X,dropbox:X,quip:["text/html",K],workflowy:["text/plain"],confluence:["application/zip"]};var $=a("zzAG");function ee(e){var t;if("undefined"!=typeof Symbol){if(Symbol.asyncIterator&&null!=(t=e[Symbol.asyncIterator]))return t.call(e);if(Symbol.iterator&&null!=(t=e[Symbol.iterator]))return t.call(e)}throw new TypeError("Object is not async iterable")}const te=Object(Y.defineMessages)({uploadingOneFile:{id:"importActions.uploadingOneFile.loadingMessage",defaultMessage:"Uploading… ({percentComplete}%)"},uploadingMultipleFilesNotStarted:{id:"importActions.uploadingMultipleFilesNotStarted.loadingMessage",defaultMessage:"Uploaded 0 of {totalNumberOfFiles}"},uploadingMultipleFilesInProgress:{id:"importActions.uploadingMultipleFilesInProgress.loadingMessage",defaultMessage:"Uploaded {numberOfUploadedFiles} of {totalNumberOfFiles}"},uploadingMultipleFilesComplete:{id:"importActions.uploadingMultipleFilesComplete.loadingMessage",defaultMessage:"Uploaded {totalNumberOfFiles} of {totalNumberOfFiles}"},importingOneFile:{id:"importActions.importingOneFile.loadingMessage",defaultMessage:"Importing…"},importingMultipleFilesNotStarted:{id:"importActions.importingMultipleFilesNotStarted.loadingMessage",defaultMessage:"Imported 0 of {totalNumberOfFiles}"},importingMultipleFilesInProgress:{id:"importActions.importingMultipleFilesInProgress.loadingMessage",defaultMessage:"Imported {numberOfImportedFiles} of {totalNumberOfFiles}"},importingMultipleFilesComplete:{id:"importActions.importingMultipleFilesComplete.loadingMessage",defaultMessage:"Imported {totalNumberOfFiles} of {totalNumberOfFiles}"},importingFromTrelloMessage:{id:"importActions.importingFromTrello.loadingMessage",defaultMessage:"{importingCount, plural, one {Importing {importingCount} board from Trello} other {Importing {importingCount} boards from Trello}}"},importingFromAsanaMessage:{id:"importActions.importingFromAsana.loadingMessage",defaultMessage:"{importingCount, plural, one {Importing {importingCount} project from Asana} other {Importing {importingCount} projects from Asana}}"},importingFromEvernoteMessage:{id:"importActions.importingFromEvernote.loadingMessage",defaultMessage:"{importingCount, plural, one {Importing {importingCount} notebook from Evernote} other {Importing {importingCount} notebooks from Evernote}}"},importFailed:{id:"importActions.importFailedError.message",defaultMessage:"Import failed."},trelloImportFailed:{id:"importActions.trelloImportFailedError.message",defaultMessage:"Trello import failed."},asanaImportFailed:{id:"importActions.asanaImportFailedError.message",defaultMessage:"Asana import failed."},evernoteImportFailed:{id:"importActions.evernoteImportFailedError.message",defaultMessage:"Evernote import failed."},importTitle:{id:"importActions.importTitle",defaultMessage:"Import {date}",description:"'Import' is a noun"}});async function ae(e){const{environment:t,spaceStore:a,spaceViewStore:n,notebooks:r,userSettingsStore:i}=e;if(0===r.length)throw new Error("Expected at least one notebook");U.b({message:te.importingFromEvernoteMessage,interpolatedValues:{importingCount:r.length}}),Q.a.setState({open:!1});const s=await async function(e){const{environment:t,spaceStore:a,spaceViewStore:n,notebooks:r}=e,i=A.create(t),s=z.a.uniq(z.a.compact(r.map(e=>e.stack))).sort().reverse(),o={};let l=e=>!0;r.length>1&&s.length>0&&(s.forEach(e=>{const s=L.b({environment:t,spaceStore:a,spaceViewStore:n,isPrivate:!0,prepend:!0,loading:!1,title:e,transaction:i}),l=s.getContentStore();r.filter(t=>t.stack===e).forEach(e=>{const a=B.a({environment:t,type:G.a.copyIndicator,inMemoryRecordCache:s.inMemoryRecordCache,transaction:i});W.a({parent:l,append:a,transaction:i}),o[e.guid]=a})}),l=e=>!Boolean(e.stack));return r.filter(l).reverse().forEach(e=>{const r=L.b({environment:t,spaceStore:a,spaceViewStore:n,isPrivate:!0,prepend:!0,loading:!0,title:e.title,transaction:i});o[e.guid]=r}),await A.commit({environment:t,transaction:i}),o}({environment:t,spaceStore:a,spaceViewStore:n,notebooks:r}),o=s[r[0].guid];try{return await async function(e){const{environment:t,spaceStore:a,spaceViewStore:n,notebooks:r,waitForNotebook:i,notebookMapping:s,userSettingsStore:o}=e;let l;if(F.b(r,2,async e=>{await Promise.all(e.map(async e=>{const a=s[e.guid];if(!a)throw new Error("Missing notebook page ".concat(e.guid));const n=F.c();a===i&&(l=n),await async function(e){const{environment:t,notebookStore:a,notebook:n,firstCompleted:r}=e,i=x.importEvernote(t,{notebookId:n.guid,blockId:a.id,spaceId:a.pointer.spaceId,timestamp:Date.now(),parentTable:H.b}),{value:s}=await i.next();if(s.error)throw console.error(s.error),A.createAndCommit(t,e=>{const t=a.getParentBlockStore();if(t){const n=t.getContentStore();W.e({parent:n,remove:a,transaction:e})}}),s.error;r.resolve(void 0)}({environment:t,notebookStore:a,notebook:e,firstCompleted:n})}))}),!l)throw new Error("waitForNotebookFirstCompleted not defined.");o.getSettings().created_evernote_getting_started||await L.c({environment:t,type:"evernote",spaceStore:a,spaceViewStore:n,userSettingsStore:o});await l.promise}({environment:t,waitForNotebook:o,notebookMapping:s,notebooks:r,spaceStore:a,spaceViewStore:n,userSettingsStore:i}),U.a(),o}catch(l){throw _.showErrorMessage(Z.default.formatMessage(te.evernoteImportFailed)),U.a(),l}}var ne=a("mF3+"),re=a("5Nka"),ie=a("zTdN"),se=a("LEzx");class oe extends se.a{getInitialState(){return{searchQuery:"",selection:new Set}}}var le=oe,ce=a("dXb3"),de=a("3DNc"),ue=a("mjq6"),pe=a("Ng05"),me=a("ZQ9l"),he=a("bxQm");class ge extends i.a{renderComponent(){return r.a.createElement("div",{style:this.getStyle()},"·")}getStyle(){return{display:"inline-block",textAlign:"center",color:this.props.disabled?this.theme.lightTextColor:this.theme.mediumTextColor,userSelect:"none",WebkitUserSelect:"none",width:8}}}var fe=ge,be=a("aEEb");function ye(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Se(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ye(Object(a),!0).forEach((function(t){ve(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ye(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function ve(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Ee extends i.a{constructor(){super(...arguments),this.storeTypes={store:le},this.handleSelectAllClick=()=>{const{sections:e,analyticsName:t}=this.props,{store:a}=this.stores,{selection:n}=a.state;for(const r of e)for(const e of r.items)n.add(e.key);a.emit(),D.bc(this.environment,{name:t})},this.handleDeselectAllClick=()=>{const{analyticsName:e}=this.props,{store:t}=this.stores,{selection:a}=t.state;a.clear(),t.emit(),D.Zb(this.environment,{name:e})},this.handleToggleItem=e=>{const{analyticsName:t}=this.props,{store:a}=this.stores,{selection:n}=a.state;n.has(e.key)?(n.delete(e.key),D.cc(this.environment,{name:t})):(n.add(e.key),D.ac(this.environment,{name:t})),a.emit()},this.handleImport=()=>{const{sections:e}=this.props,{selection:t}=this.stores.store.state,a=z.a.flatten(e.map(e=>e.items)),n=[];t.forEach(e=>{const t=a.find(t=>t.key===e);t&&n.push(t)}),this.props.onComplete(n)}}willMount(e){const t=this.stores.store.state.selection,[a]=e.sections;if(a){const[e]=a.items;e&&t.add(e.key)}this.stores.store.emit()}renderComponent(){return r.a.createElement(M.b,{menuType:M.b.MenuType.Popup,header:this.renderMenuHeader(),footer:this.renderMenuFooter(),width:280,maxHeight:350},this.renderMenuList())}renderMenuHeader(){const{searchInputPlaceholder:e}=this.props,{searchQuery:t}=this.stores.store.state,a=Boolean(t);return r.a.createElement(k.a,{isInput:!0,desktopStyle:{paddingBottom:2}},r.a.createElement(ce.a,{focus:!0,focusAfterAnimation:!0,value:t,onChange:e=>{const{store:t}=this.stores;t.setState(Se({},t.state,{searchQuery:e.target.value}))},placeholder:e}),r.a.createElement(me.a,{isTokenTitle:!0,style:{marginTop:2},title:r.a.createElement("div",{style:{marginLeft:-3}},r.a.createElement(he.a,{onClick:this.handleSelectAllClick,disabled:a,disabledFeedback:!0},r.a.createElement(Y.FormattedMessage,{id:"importPopup.selectAll",defaultMessage:"Select all"})),r.a.createElement(fe,{disabled:a}),r.a.createElement(he.a,{onClick:this.handleDeselectAllClick,disabled:a,disabledFeedback:!0},r.a.createElement(Y.FormattedMessage,{id:"importPopup.deselectAll",defaultMessage:"Deselect all"})))}))}renderMenuFooter(){const e=0===this.stores.store.state.selection.size;return r.a.createElement(k.a,{topBorder:!0,desktopStyle:{paddingTop:8,paddingBottom:8}},r.a.createElement(me.a,{title:r.a.createElement(pe.a,{disabled:e,onClick:this.handleImport},r.a.createElement(Y.FormattedMessage,{id:"integrationImportPopup.importButton.label",defaultMessage:"Import"}))}))}renderMenuList(){const{sections:e,noSearchResultsPlaceholder:t}=this.props,{store:a}=this.stores,{searchQuery:n,selection:i}=a.state,s=e.map(e=>{const t=Object(ue.b)(n,e.items,t=>"".concat(t.name," ").concat(e.name));return Se({},e,{items:t})}).filter(e=>e.items.length>0);if(0===s.length)return r.a.createElement(k.a,null,r.a.createElement(ie.a,{title:t}));const o=s.map(t=>({key:t.name,render:a=>r.a.createElement(k.a,Object.assign({},a,{title:e.length>1?t.name:void 0})),items:t.items.map(e=>{const t=()=>this.handleToggleItem(e);return{key:e.key,render:a=>r.a.createElement(d.a,Object.assign({},a,{title:e.name,icon:r.a.createElement(de.a,{checked:i.has(e.key),size:16,onClick:t}),right:void 0!==e.count&&r.a.createElement(be.a,{isSmall:!0},e.count)})),action:t}})}));return r.a.createElement(C.a,{type:C.a.Type.Vertical,initialFocus:void 0,sections:o})}}var Me=Ee,Ce=a("9f/M");class we extends i.a{constructor(){super(...arguments),this.handleClickImportTrello=()=>{D.E(this.environment,{name:"trello",from:this.props.analyticsFrom})},this.handleTrelloAuth=async()=>{await Ce.a({environment:this.environment,requestStore:this.props.requestStore})},this.handleRemoveTrello=async()=>{await x.disconnectTrello(this.environment,{}),await this.props.requestStore.refresh(),D.Qd(this.environment,{name:"trello"})},this.handleImportTrelloComplete=async(e,t)=>{const{boards:a}=e,n=a.filter(e=>Boolean(t.find(t=>t.key===e.id)));D.Vb(this.environment,{name:"trello",count:t.length});const r=await async function(e){const{environment:t,boards:a,spaceStore:n,spaceViewStore:r}=e;U.b({message:te.importingFromTrelloMessage,interpolatedValues:{importingCount:a.length}}),q.a.setState({open:!1});const i=A.create(t),s=a.map(e=>L.b({environment:t,spaceStore:n,spaceViewStore:r,isPrivate:!0,prepend:!0,loading:!0,title:e.name,transaction:i}));await new Promise(e=>{i.postSubmitCallbacks.push(e),A.commit({environment:t,transaction:i})});try{return await Promise.all(s.map(async(e,n)=>{const r=a[n],{value:i}=await x.importTrello(t,{boardId:r.id,blockId:e.id,spaceId:e.pointer.spaceId}).next();if(i.error)throw i.error})),U.a(),s[0]}catch(o){throw A.createAndCommit(t,e=>{for(const t of s)W.e({parent:n.getPagesStore(),remove:t,transaction:e})}),_.showErrorMessage(Z.default.formatMessage(te.trelloImportFailed)),U.a(),new Error(o)}}({environment:this.environment,spaceStore:this.props.spaceStore,spaceViewStore:this.props.spaceViewStore,boards:n});this.props.onComplete(r)}}renderComponent(){const{device:e}=this.environment,{trelloResult:t,intl:a}=this.props,{account:n,boards:i}=t,s={key:"default",name:a.formatMessage({id:"trelloImportOption.boardProperty.defaultName",defaultMessage:"Boards"}),items:i.map(e=>({key:e.id,name:e.name}))},o={title:"Trello",logo:re.a.images.import.trelloPng,actionButton:n&&this.props.renderItemActionsButton([{name:a.formatMessage({id:"trelloImportOption.actionsMenu.import",defaultMessage:"Import"}),action:()=>q.a.setState({open:!0})},{name:a.formatMessage({id:"trelloImportOption.actionsMenu.connectAnotherAccount",defaultMessage:"Connect another account"}),action:this.handleTrelloAuth},{name:a.formatMessage({id:"trelloImportOption.actionsMenu.removeIntegration",defaultMessage:"Remove"}),action:this.handleRemoveTrello}]),onClick:()=>{}};return r.a.createElement(u.a,{popupType:e.isMobile?u.a.PopupType.SlideUp:u.a.PopupType.Popup,buttonPopupStore:q.a,onClick:this.handleClickImportTrello,render:()=>r.a.createElement(Me,{searchInputPlaceholder:a.formatMessage({id:"trelloImportOption.search.placeholder",defaultMessage:"Search for a board…",description:"'Board' is a Trello term."}),noSearchResultsPlaceholder:a.formatMessage({id:"trelloImportOption.search.noResultsPlaceholder",defaultMessage:"No boards",description:"'Board' is a Trello term."}),analyticsName:"trello",sections:[s],onComplete:e=>this.handleImportTrelloComplete(t,e)}),renderOrigin:e=>{let{onClick:t}=e;return r.a.createElement(v,Object.assign({},o,{onClick:n?t:this.handleTrelloAuth}))}})}}var Oe=Object(Y.injectIntl)(we),ke=a("r8MX"),Pe=a("H4VD"),Te=a("BJ/B"),De=a("0CAA");class Ie extends i.a{constructor(){super(...arguments),this.handleClickImportEvernote=()=>{D.E(this.environment,{name:"evernote",from:this.props.analyticsFrom})},this.handleRemoveEvernote=async()=>{await x.disconnectEvernote(this.environment,{}),await this.props.requestStore.refresh(),D.Qd(this.environment,{name:"evernote"})},this.handleEvernoteAuth=async()=>{await Te.a({environment:this.environment,requestStore:this.props.requestStore})},this.handleImportEvernoteComplete=async(e,t)=>{const{notebooks:a}=e,n=a.filter(e=>Boolean(t.find(t=>t.key===e.guid)));D.Vb(this.environment,{name:"evernote",count:t.length});const r=await ae({environment:this.environment,spaceStore:this.props.spaceStore,spaceViewStore:this.props.spaceViewStore,userSettingsStore:this.props.userSettingsStore,notebooks:n});this.props.onComplete(r)},this.handleEvernoteHelpClick=()=>{Pe.navigateToExternalURL({environment:this.environment,url:Object(De.a)("guides.importEvernote")})}}renderComponent(){const{device:e}=this.environment,{evernoteResult:t,intl:a}=this.props,{userInfo:n,notebooks:i}=t,s=z.a.groupBy(i,e=>e.stack||""),o=Object.keys(s).map(e=>{const t=e||"Top-Level";return{key:t,name:t,items:(s[e]||[]).map(e=>({key:e.guid,name:e.title,count:e.noteCount}))}}),{data:l}=ke.default.state,c=Boolean(l&&l.credits.find(e=>"import_evernote"===e.type&&e.activated)),d={title:"Evernote",logo:re.a.images.import.evernotePng,shouldWrapCaption:!n&&!c,caption:n?n.name||n.username||n.email:c?void 0:a.formatMessage({id:"evernoteImportOption.caption.getCredit",defaultMessage:"Get $5 in credit on import"}),actionButton:n?this.props.renderItemActionsButton([{name:a.formatMessage({id:"evernoteImportOption.actionsMenu.learnMore",defaultMessage:"Learn more"}),action:this.handleEvernoteHelpClick},{name:a.formatMessage({id:"evernoteImportOption.actionsMenu.import",defaultMessage:"Import"}),action:()=>Q.a.setState({open:!0})},{name:a.formatMessage({id:"evernoteImportOption.actionsMenu.connectAnotherAccount",defaultMessage:"Connect another account"}),action:this.handleEvernoteAuth},{name:a.formatMessage({id:"evernoteImportOption.actionsMenu.removeIntegration",defaultMessage:"Remove"}),action:this.handleRemoveEvernote}]):this.props.defaultActionButton,onClick:()=>{}};return r.a.createElement(u.a,{popupType:e.isMobile?u.a.PopupType.SlideUp:u.a.PopupType.Popup,buttonPopupStore:Q.a,onClick:this.handleClickImportEvernote,render:()=>r.a.createElement(Me,{searchInputPlaceholder:a.formatMessage({id:"evernoteImportOption.search.placeholder",defaultMessage:"Search for a notebook…",description:"'Notebook' is an Evernote term."}),noSearchResultsPlaceholder:a.formatMessage({id:"evernoteImportOption.search.noResultsPlaceholder",defaultMessage:"No notebooks",description:"'Notebook' is an Evernote term."}),analyticsName:"evernote",sections:o,onComplete:e=>this.handleImportEvernoteComplete(t,e)}),renderOrigin:e=>{let{onClick:t}=e;return r.a.createElement(v,Object.assign({},d,{onClick:n?t:this.handleEvernoteAuth}))}})}}var Fe=Object(Y.injectIntl)(Ie),je=(a("a1Th"),a("3eY8"));class xe extends i.a{constructor(){super(...arguments),this.handleClickImportAsana=()=>{D.E(this.environment,{name:"asana",from:this.props.analyticsFrom})},this.handleAsanaAuth=async()=>{await je.a({environment:this.environment,requestStore:this.props.requestStore})},this.handleRemoveAsana=async()=>{await x.disconnectAsana(this.environment,{}),await this.props.requestStore.refresh(),D.Qd(this.environment,{name:"asana"})},this.handleImportAsanaComplete=async(e,t)=>{const a=z.a.flatten(z.a.values(e.projects)).filter(e=>Boolean(t.find(t=>t.key===e.gid.toString())));D.Vb(this.environment,{name:"asana",count:t.length});const n=await async function(e){const{environment:t,projects:a,spaceStore:n,spaceViewStore:r}=e;U.b({message:te.importingFromAsanaMessage,interpolatedValues:{importingCount:a.length}}),N.a.setState({open:!1});const i=A.create(t),s=a.map(e=>L.b({environment:t,spaceStore:n,spaceViewStore:r,isPrivate:!0,prepend:!0,loading:!0,title:e.name,transaction:i}));await A.commit({environment:t,transaction:i});try{return await Promise.all(s.map(async(e,n)=>{const r=a[n],{value:i}=await x.importAsana(t,{blockId:e.id,spaceId:e.pointer.spaceId,projectId:r.gid}).next();if(i.error)throw i.error})),U.a(),s[0]}catch(o){throw A.createAndCommit(t,e=>{for(const t of s)W.e({parent:n.getPagesStore(),remove:t,transaction:e})}),_.showErrorMessage(Z.default.formatMessage(te.asanaImportFailed)),U.a(),new Error(o)}}({environment:this.environment,spaceStore:this.props.spaceStore,spaceViewStore:this.props.spaceViewStore,projects:a});this.props.onComplete(n)}}renderComponent(){const{asanaResult:e,intl:t}=this.props,{account:a,workspaces:n,projects:i}=e,s=n.map(e=>{const t=i[e.gid]||[];return{key:e.gid.toString(),name:e.name,items:t.map(e=>({key:e.gid.toString(),name:e.name}))}}),o={title:"Asana",logo:re.a.images.import.asanaPng,caption:a&&a,actionButton:a&&this.props.renderItemActionsButton([{name:t.formatMessage({id:"asanaImportOption.actionsMenu.import",defaultMessage:"Import"}),action:()=>N.a.setState({open:!0})},{name:t.formatMessage({id:"asanaImportOption.actionsMenu.connectAnotherAccount",defaultMessage:"Connect another account"}),action:this.handleAsanaAuth},{name:t.formatMessage({id:"asanaImportOption.actionsMenu.removeIntegration",defaultMessage:"Remove"}),action:this.handleRemoveAsana}]),onClick:()=>{}},{device:l}=this.environment;return r.a.createElement(u.a,{popupType:l.isMobile?u.a.PopupType.SlideUp:u.a.PopupType.Popup,buttonPopupStore:N.a,onClick:this.handleClickImportAsana,render:()=>r.a.createElement(Me,{searchInputPlaceholder:t.formatMessage({id:"asanaImportOption.search.placeholder",defaultMessage:"Search for a project…",description:"'Project' is an Asana term."}),noSearchResultsPlaceholder:t.formatMessage({id:"asanaImportOption.search.noResultsPlaceholder",defaultMessage:"No projects",description:"'Project' is an Asana term."}),analyticsName:"asana",sections:s,onComplete:t=>this.handleImportAsanaComplete(e,t)}),renderOrigin:e=>{let{onClick:t}=e;return r.a.createElement(v,Object.assign({},o,{onClick:a?t:this.handleAsanaAuth}))}})}}var Be=Object(Y.injectIntl)(xe);async function Ae(e){const t=await x.getTrelloBoards(e,{});return"success"===t.type?t.data:(console.error(t.error),{boards:[]})}async function Re(e){const t=await x.getAsanaWorkspaces(e,{});if("success"===t.type){const{account:e}=t.data;return e?t.data:{workspaces:[],projects:{}}}return console.error(t.error),{workspaces:[],projects:{}}}async function Le(e){try{const t=await x.getEvernoteNotebooks(e,{});if("success"===t.type){const{notebooks:e,userInfo:a}=t.data;return{notebooks:e,userInfo:a}}return console.error(t.error),{notebooks:[],userInfo:void 0}}catch(t){return console.error(t),{notebooks:[],userInfo:void 0}}}var Ue=a("2ZkR");function _e(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function We(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?_e(Object(a),!0).forEach((function(t){Ne(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):_e(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Ne(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class qe extends i.a{constructor(){super(...arguments),this.storeTypes={trelloRequestStore:O.a,asanaRequestStore:O.a,evernoteRequestStore:O.a},this.handleFileUploadClick=async e=>{D.E(this.environment,{name:e,from:this.props.analyticsFrom});const t=await async function(e){const{environment:t,pageStore:a,spaceStore:n,isTeamPage:r,spaceViewStore:i,uploadType:s}=e;let o;try{const e=await R.b({multiple:!0,accept:J[s].join(",")});if(0===e.length)return;const g=1===e.length,f=await new Promise((a,n)=>{R.f({environment:t,files:e,bucket:"temporary",preventLimitFreeFileSize:!0,onStart:()=>{U.b({message:g?te.uploadingOneFile:te.uploadingMultipleFilesNotStarted,interpolatedValues:{totalNumberOfFiles:e.length,percentComplete:0}})},onProgress:t=>{let{uploadedFiles:a,progressPercent:n}=t;U.b({message:g?te.uploadingOneFile:te.uploadingMultipleFilesInProgress,interpolatedValues:{numberOfUploadedFiles:a,totalNumberOfFiles:e.length,percentComplete:n}})},onComplete:t=>{U.b({message:g?te.uploadingOneFile:te.uploadingMultipleFilesComplete,interpolatedValues:{totalNumberOfFiles:e.length,percentComplete:100}}),a(t)},onError:n})});let b,y;if(a&&a.isEmptyPage())e.length>1||a.isInsideCollection()?(b=a.id,y="AppendToBlock"):(b=a.id,y="ReplaceBlock");else{const a=A.create(t),s=Z.default.formatMessage(te.importTitle,{date:Object(I.a)().format("ll")}),l=L.b({environment:t,spaceStore:n,spaceViewStore:i,isPrivate:!r,prepend:!r,title:s,transaction:a});o=l,b=l.id,y=e.length>1?"AppendToBlock":"ReplaceBlock";const c=F.c();a.postSubmitCallbacks.push(c.resolve),A.commit({environment:t,transaction:a}),await c.promise}const S=f.map((t,a)=>({fileURL:t,fileName:e[a].name}));let v=0;U.b({message:g?te.importingOneFile:te.importingMultipleFilesInProgress,interpolatedValues:{numberOfImportedFiles:v,totalNumberOfFiles:e.length}});for(const{fileURL:a,fileName:r}of S){if("confluence"===s){const e=x.importConfluenceExport(t,{fileURL:a,fileName:r,pageId:b,spaceId:n.id});var l,c=!0,d=!1;try{for(var u,p,m=ee(e);c=(u=await m.next()).done,p=await u.value,!c;c=!0){const e=p;if(e.error)throw e.error;e.value.isComplete||U.b(e.value.status)}}catch(h){d=!0,l=h}finally{try{c||null==m.return||await m.return()}finally{if(d)throw l}}}else if("AppendToBlock"===y){const{value:e}=await x.importFile(t,{fileURL:a,fileName:r,importType:y,pageId:b,spaceId:n.id}).next();if(e.error)throw e.error}else if("ReplaceBlock"===y){const{value:e}=await x.importFile(t,{fileURL:a,fileName:r,importType:y,pageId:b,spaceId:n.id}).next();if(e.error)throw e.error}v++,U.b({message:g?te.importingOneFile:te.importingMultipleFilesInProgress,interpolatedValues:{numberOfImportedFiles:v,totalNumberOfFiles:e.length}})}return U.a(),j.a.createChildStore(n,{table:H.b,id:b})}catch(g){let e;throw U.a(),A.createAndCommit(t,e=>{o&&W.e({parent:n.getPagesStore(),remove:o,transaction:e})}),e=g.clientData&&g.clientData.type&&$.a[g.clientData.type]?Z.default.formatMessage($.a[g.clientData.type],g.clientData.messageValues):Z.default.formatMessage(te.importFailed),_.showErrorMessage(e),g}}({environment:this.environment,pageStore:this.props.pageStore,spaceStore:this.props.spaceStore,spaceViewStore:this.props.spaceViewStore,uploadType:e});t&&this.props.onComplete(t)}}renderComponent(){if(!p.a.state.online)return r.a.createElement("div",{style:We({},qe.wrapStyle,{fontSize:14,color:this.theme.mediumTextColor})},r.a.createElement(Y.FormattedMessage,{id:"importOptions.offlineErrorMessage",defaultMessage:"Please go online to import."}));const{analyticsFrom:e}=this.props;return this.renderRequests(t=>t?r.a.createElement("div",{style:qe.wrapStyle},this.renderOptions(t)):r.a.createElement("div",{style:"onboarding"===e?{}:qe.wrapStyle},r.a.createElement(E.a,null)))}renderOptions(e){return r.a.createElement("div",{style:{display:"flex"}},r.a.createElement("div",{style:We({},qe.optionsColumnStyle,{marginRight:16})},this.renderEvernoteImportOption(e.evernoteResult),this.renderTrelloImportOption(e.trelloResult),this.renderAsanaImportOption(e.asanaResult),this.renderConfluenceImportOption()),r.a.createElement("div",{style:We({},qe.optionsColumnStyle,{marginRight:16})},r.a.createElement(v,{title:r.a.createElement(Y.FormattedMessage,{id:"importOptions.textMarkdown.title",defaultMessage:"Text & Markdown",description:"Button title for importing plain text and/or Markdown content into Notion"}),icon:ne.a.importText,onClick:()=>this.handleFileUploadClick("markdown")}),r.a.createElement(v,{title:"CSV",icon:ne.a.importCSV,onClick:()=>this.handleFileUploadClick("csv")}),r.a.createElement(v,{title:"HTML",icon:ne.a.importHTML,onClick:()=>this.handleFileUploadClick("html")}),r.a.createElement(v,{title:"Word",logo:re.a.images.import.wordPng,onClick:()=>this.handleFileUploadClick("docx")})),r.a.createElement("div",{style:qe.optionsColumnStyle},r.a.createElement(v,{title:"Google Docs",logo:re.a.images.import.googleDocsPng,actionButton:this.renderHelpButtonToURL(Object(De.a)("guides.importGoogleDocs")),onClick:()=>this.handleFileUploadClick("gdocs")}),r.a.createElement(v,{title:"Dropbox Paper",logo:re.a.images.import.dropboxPaperPng,actionButton:this.renderHelpButtonToURL(Object(De.a)("guides.importDropboxPaper")),onClick:()=>this.handleFileUploadClick("dropbox")}),r.a.createElement(v,{title:"Quip",logo:re.a.images.import.quipPng,actionButton:this.renderHelpButtonToURL(Object(De.a)("guides.importQuip")),onClick:()=>this.handleFileUploadClick("quip")}),r.a.createElement(v,{title:"Workflowy",logo:re.a.images.import.workflowyPng,actionButton:this.renderHelpButtonToURL(Object(De.a)("guides.importWorkflowy")),onClick:()=>this.handleFileUploadClick("workflowy")})))}renderRequests(e){return r.a.createElement(w.a,{request:this.environment,performRequest:Ae,requestStore:this.stores.trelloRequestStore,render:(t,a)=>r.a.createElement(w.a,{request:this.environment,performRequest:Re,requestStore:this.stores.asanaRequestStore,render:(t,n)=>r.a.createElement(w.a,{request:this.environment,performRequest:Le,requestStore:this.stores.evernoteRequestStore,render:(t,r)=>e(a&&n&&r?{trelloResult:a,asanaResult:n,evernoteResult:r}:void 0)})})})}renderTrelloImportOption(e){return r.a.createElement(Oe,{trelloResult:e,analyticsFrom:this.props.analyticsFrom,renderItemActionsButton:this.renderItemActionsButton,onComplete:this.props.onComplete,requestStore:this.stores.trelloRequestStore,spaceStore:this.props.spaceStore,spaceViewStore:this.props.spaceViewStore,userSettingsStore:this.props.userSettingsStore})}renderAsanaImportOption(e){return r.a.createElement(Be,{asanaResult:e,analyticsFrom:"onboarding",renderItemActionsButton:this.renderItemActionsButton,onComplete:this.props.onComplete,requestStore:this.stores.asanaRequestStore,spaceStore:this.props.spaceStore,spaceViewStore:this.props.spaceViewStore,userSettingsStore:this.props.userSettingsStore})}renderConfluenceImportOption(){var e;if(e=this.environment,"on"===Ue.default.getGroup(e,"confluence-import"))return r.a.createElement(v,{title:"Confluence",logo:re.a.images.import.confluencePng,onClick:()=>this.handleFileUploadClick("confluence"),actionButton:this.renderHelpButtonToURL(Object(De.a)("guides.importConfluence"))})}renderEvernoteImportOption(e){return r.a.createElement(Fe,{evernoteResult:e,analyticsFrom:"onboarding",renderItemActionsButton:this.renderItemActionsButton,defaultActionButton:this.renderHelpButtonToURL(Object(De.a)("guides.importEvernote")),onComplete:this.props.onComplete,requestStore:this.stores.evernoteRequestStore,spaceStore:this.props.spaceStore,spaceViewStore:this.props.spaceViewStore,userSettingsStore:this.props.userSettingsStore})}renderHelpButtonToURL(e){return r.a.createElement(P.a,{renderTooltip:()=>r.a.createElement(Y.FormattedMessage,{id:"importOptions.helpButton.tooltip",defaultMessage:"Learn about how to import"}),render:t=>r.a.createElement(l.a,Object.assign({external:!0,href:e,style:{marginLeft:"auto"}},t),r.a.createElement(c.a,{icon:ne.a.help}))})}renderItemActionsButton(e){return r.a.createElement(u.a,{popupType:T.b.Popup,renderOrigin:e=>r.a.createElement(c.a,Object.assign({icon:ne.a.dots},e)),render:t=>{const a={key:"section",render:e=>r.a.createElement(k.a,Object.assign({},e)),items:e.map(e=>{let{name:a,action:n}=e;return{key:a,render:e=>r.a.createElement(d.a,Object.assign({},e,{title:a})),action:()=>{n(),t.close()}}})};return r.a.createElement(M.b,{menuType:M.b.MenuType.Popup,width:200},r.a.createElement(C.a,{type:C.a.Type.Vertical,initialFocus:void 0,sections:[a]}))}})}}qe.wrapStyle={display:"flex",alignItems:"center",justifyContent:"center",width:752,minHeight:240},qe.optionsColumnStyle={width:240};var Ve=qe,ze=a("/6eU"),He=a("d9nj");class Ge extends i.a{constructor(){super(...arguments),this.handleModalDismiss=()=>{o.a.setState({open:!1})},this.handleImportComplete=e=>{o.a.setState({open:!1}),Pe.navigateToBlock({environment:this.environment,store:e})}}renderComponent(){const e=o.a.state;return r.a.createElement(ze.a,{open:e.open,innerStyle:Ge.wrapStyle,preventHideChildrenWhileOpening:!0,render:()=>r.a.createElement(n.Fragment,null,r.a.createElement("div",{style:Ge.modalTopbarWrapStyle},r.a.createElement("div",{style:Ge.modalTopbarHeaderStyle},r.a.createElement(Y.FormattedMessage,{id:"importModal.importButton.label",defaultMessage:"Import"})),this.renderHelpButton()),r.a.createElement("div",null,this.renderImportOptions(e))),onDismiss:this.handleModalDismiss})}renderHelpButton(){return r.a.createElement(l.a,{href:Object(De.a)("guides.import"),onClick:()=>D.C(this.environment,{from:"import"}),external:!0},r.a.createElement(He.a,{isSmall:!0,icon:ne.a.help,isGray:!0},r.a.createElement(Y.FormattedMessage,{id:"importModal.helpButton.label",defaultMessage:"Learn about importing"})))}renderImportOptions(e){const{currentBlockStore:t,currentSpaceStore:a,currentSpaceViewStore:n,currentUserSettingsStore:i}=s.default.state;if(t&&a&&n&&i)return r.a.createElement(Ve,{pageStore:e.open&&e.pageStore?e.pageStore:t,spaceStore:a,spaceViewStore:n,userSettingsStore:i,analyticsFrom:"modal",onComplete:this.handleImportComplete,readOnlyCreditButton:!1})}}Ge.wrapStyle={padding:"24px 36px 24px",minWidth:300},Ge.modalTopbarWrapStyle={display:"flex",alignItems:"center",marginTop:8,marginBottom:18},Ge.modalTopbarHeaderStyle={fontSize:24,lineHeight:1.2,marginBottom:6,fontWeight:g.a.fontWeight.bold,marginRight:"auto"};t.default=Ge},"BJ/B":function(e,t,a){"use strict";a.d(t,"a",(function(){return f}));var n=a("bkwR"),r=a("VkkH"),i=a("S26v"),s=a("tP7q"),o=a("A9TN"),l=a("Wnyi"),c=a("hvW1"),d=a("VBxf"),u=a("y6Dp"),p=a("cw0H"),m=a("RqMp"),h=a("J9+s");const g=Object(h.defineMessages)({authenticatingWithEvernote:{id:"evernoteActions.authenticatingWithEvernote.loadingMessage",defaultMessage:"Authenticating with Evernote…"},titleMessage:{defaultMessage:"Evernote login",id:"evernoteActions.loginPopupModal.title"}});async function f(e){const{environment:t,requestStore:a}=e,h=Object(l.b)(t);let f=Object(s.d)(o.default.baseURL,{authType:h,userId:t.currentUser.id});f=h.redirectToAuth?f:await Object(l.c)(t,f);const b=await r.a(t,{width:580,height:700,url:f,titleMessage:g.titleMessage});if(!b)return;const y=i.e(b),S=y.query.oauth_token,v=y.query.oauth_verifier;if(!S||!v)return;c.b({message:g.authenticatingWithEvernote});const E=await n.authWithEvernote(t,{requestToken:S,verifier:v});if("failed"===E.type)return console.error(E.error),d.showError(E),void c.a();u.p(t,{name:"evernote"}),await a.refresh(),p.a.setState({open:!0}),m.a.setState({open:!0}),c.a()}},Cihu:function(e,t,a){"use strict";a.r(t);var n=a("q1tI"),r=a.n(n),i=a("6f7s"),s=a("EZe4"),o=a("wldR"),l=a("uN94");class c extends o.a{constructor(){super(...arguments),this.handleContextMenu=e=>{const{device:t}=this.environment;t.isAndroid||l.default.isOnboarding||Object(s.d)({event:e,context:s.a.EditorContextMenu,callback:()=>{t.isElectron||this.environment.currentUser.isLoggedIn()&&e.preventDefault()}})},this.handleDragStart=e=>{e.preventDefault()}}didMount(){window.addEventListener("contextmenu",this.handleContextMenu),window.addEventListener("dragstart",this.handleDragStart)}willUnmount(){window.removeEventListener("contextmenu",this.handleContextMenu),window.removeEventListener("dragstart",this.handleDragStart)}}var d=c,u=(a("ioFf"),a("rGqo"),a("LvDl")),p=a.n(u),m=a("6rsX"),h=a("qHvo"),g=a("v/t1"),f=a("wpmu"),b=a("HRSx"),y=a("jWHj"),S=a("sjR4"),v=a("AmMh"),E=a("57cz"),M=a("Ucj+"),C=a("fbat"),w=a("PuL6"),O=a("EmAo"),k=a("szb2"),P=a("lfst"),T=a("HTHG"),D=a("nZ1u"),I=a("fYc2"),F=a("XfKI");function j(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function x(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?j(Object(a),!0).forEach((function(t){B(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):j(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function B(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class A extends o.a{constructor(){super(...arguments),this.didTouchEnd=!1,this.handleWindowMouseMove=e=>{if(this.didTouchEnd)return void(this.didTouchEnd=!1);const{isDragging:t}=h.b.state;t?this.updateDragState():this.updateHoverState(e.target,e.clientX,e.clientY)},this.handleWindowKeyEvent=e=>{const{isDragging:t}=h.b.state;t&&this.updateDragState()},this.handleWindowMouseMoveThrottled=p.a.throttle(this.handleWindowMouseMove,60),this.handleWindowTouchEnd=e=>{this.didTouchEnd=!0},this.handleWindowScroll=()=>{m.i(),this.clearHoverState()},this.handleWindowResize=()=>{m.i(),this.clearHoverState()},this.handleGlobalMenuIsOpenChange=()=>{const e=C.a.state,t=T.n.state;e.isOpen&&!e.menuIsOpen&&t&&C.a.reset()},this.memoizedCanDragCache=new WeakMap,this.memoizedCanDrag=e=>{const t=this.memoizedCanDragCache.get(e);if(this.memoizedCanDragCache.has(e))return t;const a=Object(F.o)({environment:this.environment,blocks:e,publicEditMode:this.pageContext&&this.pageContext.publicEditModeStore.state});return this.memoizedCanDragCache.set(e,a),a}}leftRightLeeway(){const{device:e}=this.environment;return e.isMobile?9999:0}didMount(){super.didMount();const{device:e}=this.environment;g.a(window,"mousemove",this.handleWindowMouseMoveThrottled),e.isIOS&&g.a(window,"touchend",this.handleWindowTouchEnd),g.a(window,"keydown",this.handleWindowKeyEvent),g.a(window,"keyup",this.handleWindowKeyEvent),h.b.addListener(this.handleWindowMouseMoveThrottled),g.a(window,"scroll",this.handleWindowScroll,!0),g.a(window,"resize",this.handleWindowResize),T.n.addListener(this.handleGlobalMenuIsOpenChange),m.h()}willUnmount(){super.willUnmount();const{device:e}=this.environment;g.b(window,"mousemove",this.handleWindowMouseMoveThrottled),e.isIOS&&g.b(window,"touchend",this.handleWindowTouchEnd),g.b(window,"keydown",this.handleWindowKeyEvent),g.b(window,"keyup",this.handleWindowKeyEvent),h.b.removeListener(this.handleWindowMouseMoveThrottled),g.b(window,"scroll",this.handleWindowScroll,!0),g.b(window,"resize",this.handleWindowResize),T.n.removeListener(this.handleGlobalMenuIsOpenChange)}updateDragState(){const e=h.b.state;if(!e.isDragging)return;const{draggedStores:t,currentX:a,currentY:n,offsetX:r,offsetY:i,isNativeDrag:s}=e,o={x:a,y:n},l={x:a-r,y:n-i},c=this.findNearbyDropZones({mousePoint:o,originPoint:l},t[0],s);if(c.ontoDropZone)h.b.setState(x({},e,{currentDropZone:c.ontoDropZone,currentHintDropZones:[],currentParentStore:void 0}));else if(c.verticalDropZone)h.b.setState(x({},e,{currentDropZone:c.verticalDropZone,currentHintDropZones:[],currentParentStore:void 0}));else{if(c.horizontalDropZones.length>0){const t=c.horizontalDropZones[0],a=p.a.tail(c.horizontalDropZones),n=v.a.findSelectableFromStore(t.store);if(n){const r=n.getContextClosestSelectable();let i;return r&&r.props.store!==t.store&&r.props.shouldShowParentHalo&&(i=r.props.store),void h.b.setState(x({},e,{currentDropZone:t,currentHintDropZones:a,currentParentStore:i}))}}h.b.setState(x({},e,{currentDropZone:void 0,currentHintDropZones:[],currentParentStore:void 0}))}}clearHoverState(){const e=C.a.state;e.isOpen&&!e.menuIsOpen&&C.a.reset()}updateHoverState(e,t,a){const n=C.a.state;if(!n.isOpen||!n.menuIsOpen){const r=this.findHoverMenuTarget(e,t,a);r?n.isOpen&&r.selectable.props.store===n.currentStore||C.a.setState({isOpen:!0,currentStore:r.selectable.props.store,container:r.container,menuIsOpen:!1}):C.a.reset()}}findNearbyDropZones(e,t,a){const{device:n}=this.environment,r=y.a(),{selectableRectMap:i}=M.a.state,s=i.keys();let o=s.next();const l=v.a.findSelectableFromStore(t),c=l?l.getContextSelectableContainer():void 0,d=[];for(;!o.done;){const t=o.value;o=s.next();const l=i.get(t),u=t.getContextSelectableContainer(),p=t.props.dropzoneMustBeWithinHorizontalBound?0:this.leftRightLeeway();if(n.isMobile&&u!==c)continue;if(!u||u.props.disable)continue;const m=t.getReferencePoint(e);if(l&&e.mousePoint.x>=l.left&&e.mousePoint.x<=l.right&&e.mousePoint.y>=l.top&&e.mousePoint.y<=l.bottom&&this.selectableIsDragging(t)&&!r.option)return{ontoDropZone:void 0,verticalDropZone:void 0,horizontalDropZones:[]};const{mousePoint:g}=e;(a?t.props.canNativeDropOnto:t.props.canDropOnto)&&l&&g.x>=l.left&&g.x<=l.right&&g.y>=l.top&&g.y<=l.bottom&&!this.selectableIsDragging(t)&&this.selectableCanAcceptDrop(t,h.a.Onto)&&d.push({selectable:t,direction:h.a.Onto,left:l.left,top:l.top,width:l.width,height:l.height}),(a?t.props.canNativeDropLeft:t.props.canDropLeft)&&l&&m.y>=l.top&&m.y<=l.bottom&&Math.abs(m.x-l.left)<=A.verticalDropZoneMaxHorizontalOffset&&(r.option||!this.selectableIsDragging(t))&&this.selectableCanAcceptDrop(t,h.a.Left)&&d.push({selectable:t,direction:h.a.Left,left:l.left,top:l.top,width:0,height:l.height}),(a?t.props.canNativeDropRight:t.props.canDropRight)&&l&&m.y>=l.top&&m.y<=l.bottom&&Math.abs(m.x-l.right)<=A.verticalDropZoneMaxHorizontalOffset&&(r.option||!this.selectableIsDragging(t))&&this.selectableCanAcceptDrop(t,h.a.Right)&&d.push({selectable:t,direction:h.a.Right,left:l.right,top:l.top,width:0,height:l.height}),(a?t.props.canNativeDropAbove:t.props.canDropAbove)&&l&&m.x>=l.left-A.verticalDropZoneExtraLeftEdgeOffset-p&&m.x<=l.right+p&&(r.option||!this.selectableIsDragging(t))&&this.selectableCanAcceptDrop(t,h.a.Above)&&d.push({selectable:t,direction:h.a.Above,left:l.left,top:l.top,width:l.width,height:0}),(a?t.props.canNativeDropBelow:t.props.canDropBelow)&&l&&m.x>=l.left-A.verticalDropZoneExtraLeftEdgeOffset-p&&m.x<=l.right+p&&(r.option||!this.selectableIsDragging(t))&&this.selectableCanAcceptDrop(t,h.a.Below)&&d.push({selectable:t,direction:h.a.Below,left:l.left,top:l.bottom,width:l.width,height:0})}const u=d.filter(e=>e.direction===h.a.Above||e.direction===h.a.Below),m=p.a.minBy(u,t=>{let{selectable:a,top:n}=t;return Math.abs(n-a.getReferencePoint(e).y)});let g=u.filter(e=>{let{top:t}=e;return Math.abs(t-(m?m.top:0))<=A.competingHorizontalDropZoneMinDist});if(g.length>1){g=g.filter(t=>{let{selectable:a,left:n,width:r}=t;const i=a.getReferencePoint(e).x;return i>=n-this.leftRightLeeway()&&i<=n+r+this.leftRightLeeway()}),g=p.a.sortBy(g,e=>{let{left:t}=e;return t});let t=0;for(;t<g.length-1;t++){const a=g[t+1],n=a.selectable.getReferencePoint(e).x;if(a.left>n)break}g=g.slice(0,t+1),g.reverse()}const f=p.a.map(g,e=>{let{selectable:t,direction:a}=e;return{store:t.props.store,direction:a}});let b;const S=d.filter(e=>e.direction===h.a.Onto),E=p.a.minBy(S,e=>e.height);if(E){u.some(t=>{const a=t.selectable.getReferencePoint(e).y;return Math.abs(t.top-a)<A.competingOntoDropZoneVerticalOffset})||(b={store:E.selectable.props.store,direction:E.direction})}let C;const w=d.filter(e=>e.direction===h.a.Left||e.direction===h.a.Right);let O=p.a.minBy(w,t=>{const a=t.selectable.getReferencePoint(e).x;return Math.abs(t.left-a)});if(O){const e=O,t=w.filter(t=>Math.abs(t.left-e.left)<A.verticalDropZoneAmbiguousDist);t.length>0&&(O=p.a.minBy(t,e=>e.left))}if(O){const e=O;u.some(t=>t.top>=e.top&&t.top+t.height<=e.top+e.height)||(C={store:O.selectable.props.store,direction:O.direction})}return{ontoDropZone:b,verticalDropZone:C,horizontalDropZones:f}}findHoverMenuTarget(e,t,a){if(h.b.state.isDragging||D.a.state.isActive||T.n.state)return;const{selectableRectMap:n}=M.a.state,r=I.a.getSortedComponents().find(t=>{const a=t.getNode();return Boolean(a&&a.contains(e))}),{defaultContainer:i}=S.default.state,s=r||i;if(!s)return;const o=n.keys();let l=o.next();const c=[];for(;!l.done;){const e=l.value,r=n.get(e);(e.props.shouldShowHoverMenu||e.props.shouldShowCommentMenu)&&e.getContextSelectableContainer()===s&&r&&a>=r.top&&a<=r.bottom&&t>=r.left-A.hoverMaxHorizontalOffset&&t<=r.right&&c.push(e),l=o.next()}const d=p.a.sortBy(c,e=>{const t=n.get(e);return t?-t.left:1/0}),u=d.find(e=>{const t=e.getNode();if(t){if(d.find(a=>{if(a!==e){const e=a.getNode();return Boolean(e&&t.contains(e))}return!1}))return!1}return!0});return u?{selectable:u,container:s}:void 0}selectableIsDragging(e){const t=h.b.state;if(!t.isDragging)return;const{draggedStores:a}=t;for(;e;){if(a.indexOf(e.props.store)>=0)return!0;e=e.getContextClosestSelectable()}return!1}selectableCanAcceptDrop(e,t){if(O.a.state.isOpen&&!k.c.state.open)return!1;if(w.a.state.isOpen)return!1;const a=h.b.state,n=a.isDragging?a.draggedStores:[],r=!!a.isDragging&&a.isNativeDrag,i=e.props.store;let s,o,l=!1,c=!1;if(n.find(e=>{const t=E.a.findOutlinerItemFromStore(e);return!!t&&(s=t.props.type,l=t.props.isTopLevelItem,!0)}),t===h.a.Onto&&"collection"===i.getParentTable()){const e=i.getParentId();if(n.find(t=>Boolean(t instanceof f.a&&"collection"===t.getParentTable()&&t.getParentId()===e)))return!1}const d=Boolean(n.find(e=>e.isCollectionView()));if(d&&"collection"===i.getParentTable()&&t!==h.a.Onto&&"bookmarks"!==s)return!1;if(d&&i.isCollectionView()&&t===h.a.Onto)return!1;if(d&&i.isCollectionView()&&!i.recordStoreParent()&&t!==h.a.Onto)return!1;const u=E.a.findOutlinerItemFromStore(i);if(u&&(o=u.props.type,c=u.props.isTopLevelItem),o&&r)return!1;if("bookmarks"===s&&l&&("bookmarks"!==o||!c||t===h.a.Onto))return!1;if("bookmarks"===o&&c&&t!==h.a.Onto&&("bookmarks"!==s||!l))return!1;if("shared"===o&&"shared"!==s&&t!==h.a.Onto)return!1;if("shared"===s&&"shared"!==o&&n.some(e=>!e.isTopLevel()))return!1;if(o&&c&&t!==h.a.Onto){if(n.find(e=>{const t=e.getType();return Boolean(!t||!b.s[t])}))return!1}const{device:p}=this.environment;return!(o&&p.isMobile&&t===h.a.Onto&&c)&&((!n.find(e=>Boolean(e instanceof f.a&&e.isInlineCollectionView()))||t!==h.a.Left&&t!==h.a.Right)&&(n.some(e=>Boolean(P.a.findCollectionTemplatePickerItemFromStore(e)))===Boolean(P.a.findCollectionTemplatePickerItemFromStore(i))&&(!(t===h.a.Onto&&i&&!Object(F.p)({environment:this.environment,blocks:[i],publicEditMode:this.pageContext&&this.pageContext.publicEditModeStore.state}))&&!!this.memoizedCanDrag(n))))}}A.verticalDropZoneMaxHorizontalOffset=200,A.hoverMaxHorizontalOffset=150,A.competingOntoDropZoneVerticalOffset=7,A.verticalDropZoneExtraLeftEdgeOffset=14,A.verticalDropZoneAmbiguousDist=20,A.competingHorizontalDropZoneMinDist=2;var R=A,L=a("FcJC"),U=a("QcDD"),_=a("dccM"),W=a("UcZb");class N extends o.a{constructor(){super(...arguments),this.mouseSpeed=1/0,this.setPreviousMousePosition=(e,t)=>{this.previousMousePosition={x:e,y:t},clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.previousMousePosition=void 0},100)},this.handleWindowMouseMove=e=>{Object(s.d)({event:e,context:s.a.SidebarMouseMove,callback:()=>{if(this.updatePageViewRectThrottled(),void 0!==this.previousMousePosition&&(this.mouseSpeed=Math.sqrt(Math.pow(e.clientX-this.previousMousePosition.x,2)+Math.pow(e.clientY-this.previousMousePosition.y,2))),this.setPreviousMousePosition(e.clientX,e.clientY),this.cachedPageViewRect){const{sidebarMinTriggerWidth:t,sidebarOpenWidthPercent:a}=N,n=W.c.state,r=W.e.state,i=e.clientX,s=this.cachedPageViewRect.left,o=Math.max(s*a,t);i<o&&!k.c.state.open&&this.mouseSpeed<N.mouseSpeedThreshold&&0!==this.mouseSpeed&&!n&&L.open(),i>r&&i>o&&n&&L.close()}}})},this.handleWindowMouseOut=e=>{e.toElement||e.relatedTarget||L.close()},this.updatePageViewRectThrottled=p.a.throttle(this.updatePageViewRect,500)}didMount(){window.addEventListener("mousemove",this.handleWindowMouseMove),window.addEventListener("mouseout",this.handleWindowMouseOut)}willUnmount(){window.removeEventListener("mousemove",this.handleWindowMouseMove),window.removeEventListener("mouseout",this.handleWindowMouseOut)}updatePageViewRect(){const e=this.getPageViewWrapEl();this.cachedPageViewRect=e?e.getBoundingClientRect():document.body.getBoundingClientRect()}getPageViewWrapEl(){const{currentBlockStore:e}=U.default.state,t=_.a.findComponent(t=>t.props.store===e);if(t){const e=t.getContentWrapEl();if(e)return e}}}N.sidebarOpenWidthPercent=.38,N.sidebarMinTriggerWidth=18,N.mouseSpeedThreshold=5;var q=N,V=a("mcFc"),z=a("bPtJ"),H=a("bkwR"),G=a("AvkE"),Q=a("A9TN"),Y=a("H4VD"),Z=a("OUVA"),X=a("bK/N"),K=a("D2XV"),J=a("Wae9"),$=a("CpD0"),ee=a("JuT7"),te=a("Ko8Q"),ae=a("J9+s"),ne=a("7TLZ"),re=a("gHFd");class ie extends o.a{constructor(){super(...arguments),this.lastEmitValue=-1,this.handleNotificationEmit=async(e,t)=>{if(t===this.lastEmitValue)return;this.lastEmitValue=t;const a=await H.getUserNotifications(this.environment,{size:21});if("failed"===a.type)return;const{results:n}=a.data;J.a.setState({results:n}),this.syncInitialBadgeNumber();const r=p.a.union.apply(null,n.map(e=>e.unreceived.notificationIds));for(const i of r)this.displayNotification(i)},this.handleNotificationEmitThrottled=p.a.throttle(this.handleNotificationEmit,1e3),this.handleNotificationEmitWhenActive=(e,t)=>{$.a.whenActive(()=>{this.handleNotificationEmitThrottled(e,t)})},this.updateBadgeNumbers=()=>{const{results:e}=J.a.state,{reactNative:t}=this.environment,a=e.reduce((e,t)=>e+t.unread.mentions,0);t&&t.setBadgeNumber(a),a>0?X.setBadge("".concat(a)):X.setBadge("")},this.syncInitialBadgeNumber=p.a.once(this.updateBadgeNumbers)}willMount(){this.startMessageListeners(),J.a.addListener(this.updateBadgeNumbers)}willUnmount(){this.stopMessageListeners(),J.a.removeListener(this.updateBadgeNumbers)}startMessageListeners(){const{currentUserStore:e}=U.default.state;if(e){const t=Object(te.f)(e.id);this.listenerReference=ee.a.addListener(t,this.handleNotificationEmitWhenActive,void 0)}}stopMessageListeners(){this.listenerReference&&ee.a.removeListener(this.listenerReference)}async displayNotification(e){const t=Object(z.c)(this.props.rootStore,{table:V.a,id:e});await t.load();const a=t.getValue();if(!a)return;const n=Object(ne.b)(t,a.activity_id,a.space_id);await n.load();const r=n.getValue(),{currentUserStore:i,currentSpaceViewStore:s}=U.default.state;if(i&&s&&r&&!r.invalid&&!G.k(r,i.id)&&await X.shouldSendNotification()&&"undefined"!=typeof Notification){await s.load();const e=s.getValue();if(!e)return;if(!G.l(r))return;if(!e.notify_desktop)return;if(!this.environment.device.isDesktop)return;const a=(0,(await re.deps.desktop.loader()).PushNotification)({activity:r,getRecordValue:t.getRecordValue,userTimeZone:K.m,intl:this.props.intl});if(!a)return;const{subject:n,body:i}=a;new Notification(n,{body:i,silent:!0}).addEventListener("click",()=>{const e=G.j({activity:r,getRecordValue:t.getRecordValue,baseUrl:Q.default.baseURL}),a=G.f(r),n=Object(Z.b)(e,[a,"desktop_push"]);Y.navigate({environment:this.environment,url:n})})}}}var se=Object(ae.injectIntl)(ie),oe=a("z8HZ");class le extends o.a{constructor(){super(...arguments),this.handleOpen=()=>{oe.a.setState({open:!0})},this.handleClose=()=>{oe.a.setState({open:!1})}}willMount(){X.inPageSearch.started.addListener(this.handleOpen),X.inPageSearch.stopped.addListener(this.handleClose)}willUnmount(){X.inPageSearch.started.removeListener(this.handleOpen),X.inPageSearch.stopped.removeListener(this.handleClose)}}var ce=le,de=a("hi+p"),ue=a("VOS9"),pe=a("wXH4"),me=a("y6Dp"),he=a("2Y+N"),ge=a("dXb3"),fe=a("gbGO"),be=a("VyA+"),ye=a("0hFN"),Se=a("fwa5"),ve=a("KTXS"),Ee=a("nPEg"),Me=a("0CAA"),Ce=a("Qc3L");function we(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Oe(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class ke extends o.a{constructor(){super(...arguments),this.renderOverlay=()=>{const{device:e}=this.environment,t=Se.a.state;if(!t.isActive)return;const{originBlockRect:a,actions:n,inputValue:i}=t,s={environment:this.environment,blocks:t.stores,originRect:a},o=t.showInput&&this.renderInputSection(),l=t.stores[0];let c;return c=e.isPhone?{menuType:fe.b.MenuType.Modal,title:r.a.createElement(ae.FormattedMessage,{defaultMessage:"Actions",id:"blockMenu.actionButton.label"}),right:r.a.createElement(Ee.DoneMenuText,null),onClickRight:this.handleOverlayBgClick,header:o}:{menuType:fe.b.MenuType.Popup,width:220,header:o},r.a.createElement(be.a,{capture:!0,onBackspace:p.a.identity},r.a.createElement(fe.b,Object.assign({},c),r.a.createElement(ue.a,{filter:i,context:s,sections:n,onAccept:this.handleAccept,initialFocus:i?0:void 0}),!i&&this.renderBlockAuthorInfo(),!i&&r.a.createElement(Ce.a,{store:l}),!i&&l.isCollectionView()&&this.renderCollectionHelpButton()))},this.handleOverlayBgClick=()=>{de.a()},this.handleAccept=e=>{const t=Se.a.state;if(!t.isActive)return;const{stores:a}=S.default.state,{analyticsFrom:n}=t,r=a[0];if(r){const t=r.getValue();t&&me.q(this.environment,{analyticsName:e.analyticsName,from:n,block_type:t.type})}e.closeParentMenu&&de.a()},this.handleInputChange=e=>{Se.a.state.isActive&&Se.a.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?we(Object(a),!0).forEach((function(t){Oe(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):we(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},Se.a.state,{inputValue:e.target.value}))}}renderComponent(){const{device:e}=this.environment,t=Se.a.state;return r.a.createElement(pe.c,{popupType:e.isPhone?pe.c.PopupType.SlideUp:pe.c.PopupType.Popup,open:t.isActive,originRect:t.isActive?t.originBlockRect:void 0,onDismiss:this.handleOverlayBgClick,placementToOrigin:pe.c.Placement.Bottom,alignmentToOrigin:pe.c.Alignment.Start,originGap:0,preventScaleTransition:!0,render:this.renderOverlay,preventBlockRenderQueueOnEnter:e.isMobile})}renderBlockAuthorInfo(){const e=Se.a.state;if(e.isActive&&!(e.stores.length>1))return r.a.createElement(ye.a,{store:e.stores[0],isPageMoreButton:!1})}renderInputSection(){const{device:e}=this.environment,{intl:t}=this.props,a=Se.a.state;if(!a.isActive||e.isPhone)return;const{inputValue:n}=a;return r.a.createElement(he.a,{isInput:!0},r.a.createElement(ge.a,{value:n,onChange:this.handleInputChange,focus:!0,focusAfterAnimation:!0,placeholder:t.formatMessage({defaultMessage:"Filter actions…",id:"blockMenu.filterForActions.placeholder"}),allowDelete:!0}))}renderCollectionHelpButton(){return r.a.createElement(he.a,{topBorder:!0,disableDesktopPadding:!0},r.a.createElement(ve.a,{title:r.a.createElement(ae.FormattedMessage,{defaultMessage:"Learn about databases",id:"blocks.blockMenu.collectionHelpButton"}),href:Object(Me.a)("guides.database"),analyticsFrom:"block_menu"}))}}var Pe=Object(ae.injectIntl)(ke),Te=a("yNyh"),De=a("OYeE"),Ie=a("aEEb");function Fe(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function je(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class xe extends o.a{constructor(){super(...arguments),this.handleOverlayBgClick=e=>{De.a.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Fe(Object(a),!0).forEach((function(t){je(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Fe(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},De.a.state,{active:!1,stringValue:""}))}}renderComponent(){const{device:e}=this.environment,{active:t,stringValue:a}=De.a.state,n=window.innerWidth/2-150,i=window.innerHeight/2;return r.a.createElement(pe.c,{popupType:e.isReactNative?pe.c.PopupType.SlideUp:pe.c.PopupType.Popup,open:t,originRect:{top:i,left:n},onDismiss:this.handleOverlayBgClick,placementToOrigin:pe.c.Placement.Bottom,alignmentToOrigin:pe.c.Alignment.Start,originGap:0,render:()=>r.a.createElement(be.a,{capture:!0,onEnter:p.a.identity,onCommandEnter:p.a.identity,onCommandShiftEnter:p.a.identity,onCommandSlash:p.a.identity,onDelete:p.a.identity,onBackspace:p.a.identity,onEsc:p.a.identity,onLeft:p.a.identity,onRight:p.a.identity,onUntab:p.a.identity,onTab:p.a.identity,onSelectAll:p.a.identity,onRedo:p.a.identity,onUndo:p.a.identity,onToggleBold:p.a.identity,onToggleItalics:p.a.identity,onToggleStrike:p.a.identity,onToggleCode:p.a.identity,onCut:p.a.identity,onCopy:p.a.identity,onPaste:p.a.identity,onKeypress:p.a.identity},r.a.createElement("div",{style:{padding:8,width:300}},r.a.createElement(Te.b,{style:{width:"100%",fontSize:12},value:a,focus:!0,textarea:!0,selectAll:!0,readOnly:!0}),r.a.createElement(Ie.a,{isSmall:!0,style:{marginTop:6,pointerEvents:"none"}},r.a.createElement(ae.FormattedMessage,{defaultMessage:"Right click and copy the link above",id:"clipboardInputRenderer.copyLink.message"}))))})}}var Be=xe,Ae=a("i8i4"),Re=a.n(Ae);class Le extends o.a{didMount(){super.didMount();const e=Re.a.findDOMNode(this);e&&e instanceof Element&&this.props.ghostElement.forEach((t,a)=>{let{cloned:n}=t;e.children[a].appendChild(n)})}renderComponent(){return r.a.createElement("div",null,this.props.ghostElement.map((e,t)=>{let{rect:{left:a,top:n,width:i,height:s}}=e;return r.a.createElement("div",{key:t,style:{position:"absolute",top:n,left:a,width:i,height:s,opacity:this.environment.device.isMobile?.25:.4,pointerEvents:"none"}})}))}}var Ue=Le,_e=a("fHgN");class We extends o.a{constructor(){super(...arguments),this.renderGhost=()=>{const e=h.b.state;if(!e.isDragging)return;const t=e.draggedStores.map((t,a)=>r.a.createElement(Ue,{key:"".concat(a),store:t,ghostElement:e.ghostElements[a]}));return r.a.createElement("div",{style:this.getGhostStyle()},t)},this.isDragging=this.createComputedStore(()=>h.b.state.isDragging)}renderComponent(){return r.a.createElement(_e.a,{open:this.isDragging.state,render:this.renderGhost})}getGhostStyle(){const e=h.b.state;if(!e.isDragging)return;const{startX:t,startY:a,currentX:n,currentY:r}=e,i=r-a;return{position:"absolute",top:0,left:0,transform:"translate3d(".concat(n-t,"px, ").concat(i,"px, 0)")}}}var Ne=We,qe=a("M64d"),Ve=a("ikHm"),ze=a("NOLh"),He=a("LoBg"),Ge=a("Iece"),Qe=a("Sb6f"),Ye=a("EtGu"),Ze=a("zmp8"),Xe=a("d9nj"),Ke=a("T1kp");function Je(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function $e(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Je(Object(a),!0).forEach((function(t){et(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Je(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function et(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class tt extends o.a{constructor(){super(...arguments),this.renderOverlay=()=>{const{isOpen:e,renderFullScreenNode:t,fullScreenNodeRect:a}=Ye.a.state;if(!a)return;const n=window.innerWidth,i=window.innerHeight,s=n-2*tt.edgePadding,o=i-2*tt.edgePadding;let l=s,c=l/a.width*a.height;if(c>o){const e=c/o;c/=e,l/=e}const d=(n-l)/2,u=(i-c)/2,m={translateX:a.left,translateY:a.top,width:a.width,height:a.height},h={translateX:d,translateY:u,width:l,height:c};let g;return t&&(g=t()),Object(qe.a)(t=>r.a.createElement(be.a,{capture:e,onEsc:this.handleClose,onEnter:p.a.identity,onSpace:this.handleClose,onCommandEnter:this.handleClose,onCommandShiftEnter:p.a.identity,onCommandSlash:p.a.identity,onUp:p.a.identity,onDown:p.a.identity,onDelete:p.a.identity,onBackspace:p.a.identity,onLeft:p.a.identity,onRight:p.a.identity,onUntab:p.a.identity,onTab:p.a.identity,onSelectAll:p.a.identity,onRedo:p.a.identity,onUndo:p.a.identity,onToggleBold:p.a.identity,onToggleItalics:p.a.identity,onToggleStrike:p.a.identity,onToggleCode:p.a.identity,onCut:p.a.identity,onCopy:p.a.identity,onPaste:p.a.identity,onKeypress:p.a.identity},r.a.createElement(He.a,{capture:e},r.a.createElement("div",Object.assign({onClick:this.handleClose,ref:e=>{this.rootEl=e},style:this.getStyle(e)},t),r.a.createElement(ze.a,{isVisible:e,enterAnimationStyle:{opacity:0},exitAnimationStyle:{opacity:0},animationStyle:{opacity:.8},render:()=>r.a.createElement("div",{style:tt.backgroundStyle}),onAnimationEnd:this.handleBackgroundAnimationEnd}),r.a.createElement(ze.a,{ref:e=>{this.animatedEl=e},isVisible:e,enterAnimationStyle:m,exitAnimationStyle:m,animationStyle:h,springConfig:{translateX:tt.springConfig,translateY:tt.springConfig,width:tt.springConfig,height:tt.springConfig},render:()=>r.a.createElement("div",{style:tt.fullScreenNodeWrapStyle},g),onAnimationEnd:this.handleFullscreenNodeAnimationEnd}),r.a.createElement("div",{style:this.getCloseButtonStyle(e)},r.a.createElement(Xe.a,{onClick:this.handleClose,style:{color:"#fff"}},r.a.createElement(ae.FormattedMessage,{defaultMessage:"Close",id:"fullscreenRenderer.closeButton.label",description:"Shown in the top right corner when viewing an asset (image, file, etc.) in full screen mode, to close out of full screen mode."})))))))},this.handleClose=()=>{Ke.a(),m.e(this.environment)},this.handleResize=()=>{const{isOpen:e}=Ye.a.state;e&&this.enqueueForceUpdate()},this.handleFrameScrollerUpdate=()=>{this.updateRootElFromScroll()},this.handleBackgroundAnimationEnd=()=>{const{isOpen:e}=Ye.a.state;e||Ye.a.setState($e({},Ye.a.state,{backgroundAnimationComplete:!0}))},this.handleFullscreenNodeAnimationEnd=()=>{const{isOpen:e}=Ye.a.state;e||Ye.a.setState($e({},Ye.a.state,{fullscreenNodeAnimationComplete:!0}))}}didMount(){super.didMount(),window.addEventListener("resize",this.handleResize),Ge.a.addListener(this.handleFrameScrollerUpdate)}didMountOrUpdate(){super.didMountOrUpdate(),this.updateRootElFromScroll()}willUnmount(){super.willUnmount(),window.removeEventListener("resize",this.handleResize),Ge.a.removeListener(this.handleFrameScrollerUpdate)}renderComponent(){const{isOpen:e,fullscreenNodeAnimationComplete:t,backgroundAnimationComplete:a}=Ye.a.state;return r.a.createElement(_e.a,{open:e||!t||!a,render:this.renderOverlay})}getRenderedEl(){const e=Re.a.findDOMNode(this.animatedEl);if(e)return e.childNodes[0]}updateRootElFromScroll(){if(this.getRenderedEl()){const{scrollTop:e}=Ge.a.state,{startScrollTop:t}=Ye.a.state,a=e-t;this.rootEl.style.transform="translateY(".concat(-a,"px)")}}getStyle(e){return{zIndex:Ve.m,position:"fixed",top:0,left:0,right:0,bottom:0,pointerEvents:e?"auto":"none",cursor:"zoom-out"}}getCloseButtonStyle(e){const{WindowSizeStore:t}=this.environment;return{position:"absolute",top:t.getSafePaddingBottomCSS(16),right:t.getSafePaddingRightCSS(18),display:e?"block":"none",fontWeight:Qe.a.fontWeight.medium}}}tt.edgePadding=32,tt.springConfig={stiffness:65,damping:10,precision:.001},tt.fullScreenNodeWrapStyle={position:"absolute",top:0,left:0,display:"flex"},tt.backgroundStyle={position:"absolute",top:0,left:0,right:0,bottom:0,background:Ze.f.black};var at=tt,nt=a("vX3W"),rt=a("cgvQ"),it=a("t3i2"),st=a("G4GV"),ot=a("UZfs"),lt=a("APM9"),ct=a("2m/B"),dt=a("LeVO"),ut=a("FIf6"),pt=a("p+Y9"),mt=a("R+Q+"),ht=a("fCO4"),gt=a("T4gQ"),ft=a("mF3+"),bt=a("Cycz"),yt=a("mVDJ"),St=a("r8MX"),vt=a("cX/5"),Et=a("MeYt"),Mt=a("bxQm"),Ct=a("prF1"),wt=a("1y3T"),Ot=a("Pl3d"),kt=a("4HCU"),Pt=a("wlCD"),Tt=a("IYZQ"),Dt=a("SR/M"),It=a("VVDu"),Ft=a("7M94"),jt=a("vl8/"),xt=a("5FB0"),Bt=a("5w/s");function At(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Rt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?At(Object(a),!0).forEach((function(t){Lt(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):At(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Lt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const Ut=Object(ae.defineMessages)({embedPlaceholder:{id:"mediaPicker.embedPlaceholder.text",defaultMessage:"Paste in https://…"},filterPlaceholder:{id:"mediaPicker.emojiFilter.text",defaultMessage:"Filter…"},unsplashPlaceholder:{id:"mediaPicker.unsplashPlaceholder.text",defaultMessage:"Search for an image…"}});class _t extends o.a{constructor(){super(...arguments),this.storeTypes={embedInputStore:st.a,emojiInputStore:st.a,emojiPickerStore:yt.a,unsplashInputStore:st.a},this.renderUnsplashResults=(e,t,a,i)=>i?!a||a&&!a.length?r.a.createElement(ot.a,{shouldWrapCaption:!0,caption:r.a.createElement(ae.FormattedMessage,{defaultMessage:"No results found.",id:"mediaPicker.unsplash.noResultsText"}),style:{textAlign:this.props.isSmallWidth?"left":"center",color:this.theme.mediumTextColor}}):r.a.createElement(n.Fragment,null,a.map(t=>this.renderUnsplashImage(e,t)),r.a.createElement(ot.a,{shouldWrapCaption:!0,caption:r.a.createElement(ae.FormattedMessage,{defaultMessage:"Search to find more results.",id:"mediaPicker.unsplash.searchText"}),style:{textAlign:this.props.isSmallWidth?"left":"center",color:this.theme.mediumTextColor}})):r.a.createElement("div",{style:this.getLoadingContainerStyle()},r.a.createElement(Pt.a,null)),this.renderUnsplashImage=(e,t)=>{const{device:a}=this.environment;return r.a.createElement("div",{key:t.id,style:{width:a.isMobile?"33%":"25%",padding:3}},r.a.createElement(Et.a,{hoveredStyle:{opacity:.85},onClick:()=>this.handleSelectUnsplashImage(e,t)},r.a.createElement(ct.a,{src:t.thumbUrl,style:{width:"100%",height:64,objectFit:"cover",objectPosition:"center 0%",borderRadius:3}})),r.a.createElement(Ie.a,{isSmall:!0,isSecondaryColor:!0,style:{marginTop:2,marginBottom:4}},r.a.createElement(ae.FormattedMessage,{defaultMessage:"by <inlinetextlink>{authorName}</inlinetextlink>",id:"mediaPicker.unsplash.byAuthor",description:"Caption attributing the author of the Unsplash image",values:{authorName:t.authorName,inlinetextlink:function(){for(var e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];return r.a.createElement(Tt.a,{external:!0,href:t.unsplashUrl},a)}}})))},this.handleEmbedSubmit=e=>()=>{const t=this.stores.embedInputStore.state.inputValue;t&&e.onChange(t)},this.handleSelectUnsplashImage=async(e,t)=>{const a=await Object(xt.b)({environment:this.environment,url:t.downloadUrl,method:"GET",json:!0});"success"===a.type&&e.onChange({url:a.data.url})},this.handleSwipeLeft=()=>{if(!vt.a.state.isActive)return;const e=this.getTabs(),t=e.map(e=>e.type).indexOf(vt.a.state.currentTab),a=e[t+1];void 0!==a&&this.handleTabChange(a.type)},this.handleSwipeRight=()=>{if(!vt.a.state.isActive)return;const e=this.getTabs(),t=e.map(e=>e.type).indexOf(vt.a.state.currentTab),a=e[t-1];void 0!==a&&this.handleTabChange(a.type)},this.handleTabChange=e=>{vt.a.state.isActive&&vt.a.setState(Rt({},vt.a.state,{currentTab:e}))},this.handleRandomEmojiClick=()=>{const{device:e}=this.environment,t=this.getTabs().find(e=>e.type===this.props.currentTab);if(t&&"emoji"===t.type){const a=Object(Bt.c)();t.onChange(a,{keepVisible:!e.isMobile})}},this.handleEmojiFilterChange=e=>{const{emojiInputStore:t,emojiPickerStore:a}=this.stores;t.setState(Rt({},t.state,{inputValue:e.currentTarget.value})),a.setState(Rt({},a.state,{loadEmojiCount:yt.a.emojisPerPage}))}}renderComponent(){const{device:e}=this.environment,t=this.renderTabsHeader(),a=this.renderInputHeader(),i=(t||a)&&r.a.createElement(n.Fragment,null,t,a);let s;return e.isMobile?s={menuType:fe.b.MenuType.Modal,title:this.props.title,header:i,right:r.a.createElement(ae.FormattedMessage,{defaultMessage:"Close",id:"mediaPicker.mobileCloseButton.label"}),onClickRight:this.props.onCancel,left:this.props.onDelete&&r.a.createElement(ae.FormattedMessage,{defaultMessage:"Remove",id:"mediaPicker.mobileRemoveButton.label"}),onClickLeft:this.props.onDelete}:(s={menuType:fe.b.MenuType.Popup,header:i},s.width=this.props.popupWidth||300,s.height=this.props.popupHeight,s.maxHeight=this.props.maxHeight,s.maxWidth=this.props.maxWidth),r.a.createElement(ht.a,{onSwipeLeft:this.handleSwipeLeft,onSwipeRight:this.handleSwipeRight,render:e=>r.a.createElement(fe.b,Object.assign({},s,e,{className:Ft.G}),this.renderCurrentTab())})}renderTabsHeader(){const{device:e}=this.environment;if(!(this.getTabs().length<=1)||this.props.onDelete){const t={gallery:r.a.createElement(ae.FormattedMessage,{id:"mediaPicker.tabs.gallery",defaultMessage:"Gallery"}),embed:r.a.createElement(ae.FormattedMessage,{id:"mediaPicker.tabs.embedLink",defaultMessage:"Embed link"}),file:r.a.createElement(ae.FormattedMessage,{id:"mediaPicker.tabs.upload",defaultMessage:"Upload"}),emoji:r.a.createElement(ae.FormattedMessage,{id:"mediaPicker.tabs.emoji",defaultMessage:"Emoji"}),unsplash:r.a.createElement(n.Fragment,null,ft.a.unsplashLogo({width:12,marginRight:4,height:12}),r.a.createElement("span",null,"Unsplash")),drive:r.a.createElement(ae.FormattedMessage,{id:"mediaPicker.tabs.browse",defaultMessage:"Browse"})},a=this.getTabs(),i=a.findIndex(e=>e.type===this.props.currentTab),s=a.map(e=>e.title||t[e.type]),o=a.find(e=>e.type===this.props.currentTab),l=o&&"emoji"!==o.type&&e.isAndroid;return r.a.createElement(mt.a,{tabs:s,selectedIndex:i,onChange:e=>{const t=a[e];this.handleTabChange(t.type)},right:r.a.createElement(n.Fragment,null,o&&"emoji"===o.type&&r.a.createElement(Xe.a,{isGray:!0,icon:ft.a.random,onClick:this.handleRandomEmojiClick},r.a.createElement(ae.FormattedMessage,{id:"mediaPicker.emojiTab.random",defaultMessage:"Random"})),this.props.onDelete&&!e.isMobile&&r.a.createElement(Xe.a,{isGray:!0,onClick:this.props.onDelete},r.a.createElement(ae.FormattedMessage,{id:"mediaPicker.tabs.remove",defaultMessage:"Remove"}))),style:Rt({},l&&{borderBottom:"none"})})}}renderInputHeader(){const{device:e}=this.environment,t=this.getTabs().find(e=>e.type===this.props.currentTab),a=!e.isMobile||void 0;if(t&&"emoji"===t.type)return r.a.createElement("div",{style:{margin:e.isMobile?0:"10px 0"}},r.a.createElement(ge.a,{value:this.stores.emojiInputStore.state.inputValue,focusInitial:a,placeholder:jt.default.formatMessage(Ut.filterPlaceholder),showClearButton:!0,left:ft.a.searchThick(this.getSearchIconStyle()),onChange:this.handleEmojiFilterChange,style:Rt({},e.isAndroid&&{borderBottom:"none"})}))}renderCurrentTab(){const e=this.getTabs().find(e=>e.type===this.props.currentTab);if(!e)return r.a.createElement(ae.FormattedMessage,{defaultMessage:"Uh oh! Something went wrong.",id:"mediaPicker.errorMessage"});switch(e.type){case"embed":return this.renderEmbedTab(e);case"file":return this.renderUploadTab(e);case"emoji":return this.renderEmojiTab(e);case"gallery":return this.renderGalleryTab(e);case"unsplash":return this.renderUnsplashTab(e);case"drive":return this.renderGoogleDriveTab(e)}}renderEmojiTab(e){return r.a.createElement(lt.a,{onSubmit:e.onChange,filter:this.stores.emojiInputStore.state.inputValue,store:this.stores.emojiPickerStore,isCallout:this.props.isCallout})}renderGalleryTab(e){return r.a.createElement("div",{style:{paddingBottom:8}},p.a.map(it.a,(t,a)=>r.a.createElement(he.a,{key:a,title:r.a.createElement(Ct.a,{style:{marginLeft:-5},href:t.url,external:!0},r.a.createElement(Mt.a,null,jt.default.formatMessage(t.title))),isTitleUppercase:!0,noTextOverflow:!0},r.a.createElement("div",{style:this.getGalleryWrapStyle()},t.items.map((t,a)=>{let{coverUrl:n,title:i,subtitle:s,position:o}=t;return r.a.createElement("div",{key:a,style:{width:"25%",padding:3}},r.a.createElement(dt.a,{originGap:0,placement:dt.a.Placement.Bottom,delayThreshold:600,renderTooltip:()=>r.a.createElement("div",{style:{maxWidth:180,whiteSpace:"normal"}},r.a.createElement("span",{style:{color:this.theme.regularInvertedTextColor}},jt.default.formatMessage(i))," ",r.a.createElement("span",{style:{color:this.theme.mediumInvertedTextColor}},s&&jt.default.formatMessage(s))),render:t=>r.a.createElement(Et.a,Object.assign({hoveredStyle:{opacity:.85}},t,{onClick:()=>{e.onChange({url:n,position:o})}}),r.a.createElement(wt.a,{url:n,width:200,isAuthenticated:!1,render:(e,t)=>t&&r.a.createElement(ct.a,{src:t,style:{width:"100%",height:64,objectFit:"cover",objectPosition:"center ".concat(100*(o||0),"%"),borderRadius:3}})}))}))})))))}renderUnsplashTab(e){const{device:t}=this.environment;return r.a.createElement("div",{style:{paddingBottom:8}},r.a.createElement(he.a,{desktopStyle:{marginTop:8,marginBottom:6}},r.a.createElement(ge.a,{value:this.stores.unsplashInputStore.state.inputValue,placeholder:jt.default.formatMessage(Ut.unsplashPlaceholder),showClearButton:!0,focus:!t.isMobile||void 0,onChange:e=>{this.stores.unsplashInputStore.setState(Rt({},this.stores.unsplashInputStore.state,{inputValue:e.target.value}))}})),r.a.createElement("div",{style:this.getGalleryWrapStyle()},r.a.createElement(Ot.a,{request:this.stores.unsplashInputStore.state.inputValue,debounce:kt.b,performRequest:async e=>{const t=await H.searchUnsplashImages(this.environment,{query:e,page:0});if("success"===t.type)return t.data.results;throw t.error},render:(t,a,n)=>this.renderUnsplashResults(e,t,a,n)})))}renderUploadTab(e){const{data:t}=St.default.state;return r.a.createElement(n.Fragment,null,e.fileUpload&&r.a.createElement(he.a,{desktopStyle:{marginTop:this.props.isSmallWidth?8:24}},r.a.createElement(gt.a,{title:r.a.createElement(ae.FormattedMessage,{defaultMessage:"Choose a file",id:"mediaPicker.chooseFile.button.label"}),focused:!1,onClick:()=>this.handleUpload(e),fullWidth:this.props.isSmallWidth})),this.renderMediaCapture(e),e.caption&&r.a.createElement(ot.a,{shouldWrapCaption:!0,caption:e.caption,style:{textAlign:this.props.isSmallWidth?"left":"center",color:this.theme.mediumTextColor}}),e.preventUploadLimitFreeFileSize||t&&bt.E(t)&&r.a.createElement("div",{style:{height:8}}),t&&!e.preventUploadLimitFreeFileSize&&!bt.E(t)&&r.a.createElement(ot.a,{shouldWrapCaption:!0,caption:r.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:this.props.isSmallWidth?"flex-start":"center"}},r.a.createElement("div",{style:{marginRight:6,color:this.theme.mediumTextColor}},r.a.createElement(ae.FormattedMessage,{defaultMessage:"The maximum size per file is {filesize} MB.",id:"mediaPicker.maximumFileSize.notice",values:{filesize:pt.a}})),!l.default.isOnboarding.state&&r.a.createElement(ut.a,{subscriptionTier:bt.k(this.environment)||"team",onClick:()=>{this.props.onCancel&&this.props.onCancel()},analyticsName:"media_picker",desktopStyle:{marginBottom:1}}))}))}renderMediaCapture(e){if(e.imageUpload||e.videoUpload)return r.a.createElement(he.a,{desktopStyle:{marginTop:this.props.isSmallWidth?8:24}},e.imageUpload&&r.a.createElement(gt.a,{title:r.a.createElement(ae.FormattedMessage,{defaultMessage:"Choose an image",id:"mediaPicker.chooseImage.buttonText"}),focused:!1,onClick:()=>this.handleUpload(e,"image/*"),fullWidth:this.props.isSmallWidth}),e.videoUpload&&r.a.createElement(gt.a,{title:r.a.createElement(ae.FormattedMessage,{defaultMessage:"Choose a video",id:"mediaPicker.chooseVideo.buttonText"}),focused:!1,onClick:()=>this.handleUpload(e,"video/*"),fullWidth:this.props.isSmallWidth}))}renderEmbedTab(e){const{device:t}=this.environment;return r.a.createElement(n.Fragment,null,r.a.createElement(he.a,{desktopStyle:{marginTop:8,marginBottom:6}},r.a.createElement(ge.a,{type:"url",value:this.stores.embedInputStore.state.inputValue,placeholder:e.inputPlaceholder||jt.default.formatMessage(Ut.embedPlaceholder),showClearButton:!0,focus:!t.isMobile||void 0,onSubmit:this.handleEmbedSubmit(e),onChange:e=>{this.stores.embedInputStore.setState(Rt({},this.stores.embedInputStore.state,{inputValue:e.target.value}))}})),r.a.createElement(he.a,null,r.a.createElement(gt.a,{onClick:this.handleEmbedSubmit(e),focused:!1,title:e.buttonText||r.a.createElement(ae.FormattedMessage,{defaultMessage:"Embed link",id:"mediaPicker.embedTab.embedLinkButtonText"}),fullWidth:this.props.isSmallWidth})),e.caption&&r.a.createElement(ot.a,{shouldWrapCaption:!0,caption:e.caption,style:{textAlign:t.isMobile?"left":"center"}}))}renderGoogleDriveTab(e){return r.a.createElement(Ot.a,{request:this.environment,performRequest:rt.b,render:(t,a,n)=>{if(!n)return r.a.createElement(he.a,null,r.a.createElement(It.a,null));const i=a&&a.accounts?a.accounts:[];return this.renderGoogleDriveAccounts(e,i)}})}renderGoogleDriveAccounts(e,t){return 0===t.length?r.a.createElement(he.a,null,r.a.createElement(Dt.a,{title:r.a.createElement(ae.FormattedMessage,{defaultMessage:"Connect Google account",id:"mediaPicker.menuItem.connectFirstGoogleAccount.label"}),onClick:()=>e.onSelect(),focused:!1,style:{color:this.theme.blueColor}}),r.a.createElement(ot.a,{shouldWrapCaption:!1,caption:r.a.createElement(ae.FormattedMessage,{defaultMessage:"Find and embed your Google Drive files.",id:"mediaPicker.menuItem.connectFirstGoogleAccount.caption"})})):r.a.createElement(n.Fragment,null,r.a.createElement(he.a,null,t.map((t,a)=>r.a.createElement(Dt.a,{key:t.accountId,title:r.a.createElement(ae.FormattedMessage,{defaultMessage:"Choose from {accountName}",id:"mediaPicker.menuItem.choosePagesFromAccount.label",values:{accountName:t.accountName}}),onClick:()=>e.onSelect(t),focused:!1}))),r.a.createElement(he.a,{topBorder:!0},r.a.createElement(Dt.a,{title:r.a.createElement(ae.FormattedMessage,{defaultMessage:"Connect another account",id:"mediaPicker.menuItem.connectMoreGoogleAccounts.label"}),onClick:()=>e.onSelect(),style:{color:this.theme.mediumTextColor},focused:!1})))}getTabs(){return this.props.tabs}async handleUpload(e,t){const a=await pt.b({multiple:!1,accept:t});a.length&&e.onUpload(a[0])}getLoadingContainerStyle(){return{display:"flex",alignItems:"center",justifyContent:"center",minHeight:320,flex:1}}getSearchIconStyle(){return{width:14,height:14,marginRight:6,flexGrow:0,flexShrink:0,color:this.theme.regularIconColor}}getGalleryWrapStyle(){const{device:e,WindowSizeStore:t}=this.environment;return{display:"flex",flexWrap:"wrap",alignContent:"flex-start",background:this.theme.popoverBackground,paddingTop:e.isMobile?12:0,paddingBottom:e.isMobile?12:0,paddingLeft:e.isMobile?t.getSafePaddingLeftCSS(14):12,paddingRight:e.isMobile?t.getSafePaddingRightCSS(14):12,boxShadow:e.isMobile?"0 1px 0 ".concat(this.theme.regularDividerColor):""}}}var Wt=_t;class Nt extends o.a{constructor(){super(...arguments),this.handleCloseOverlay=()=>{nt.a()}}renderComponent(){const{device:e}=this.environment,{state:t}=vt.a;return r.a.createElement(pe.c,{popupType:e.isMobile?pe.c.PopupType.SlideUp:pe.c.PopupType.Popup,open:t.isActive,originRect:t.isActive?t.originRect:void 0,originGap:t.isActive?t.originGap:void 0,placementToOrigin:pe.c.Placement.Bottom,alignmentToOrigin:pe.c.Alignment.Center,preventScaleTransition:!0,onDismiss:this.handleCloseOverlay,render:()=>{if(t.isActive)return r.a.createElement(Wt,Object.assign({},t,{onCancel:this.handleCloseOverlay}))}})}}var qt=Nt,Vt=a("/mqF"),zt=a("MBf9");class Ht extends o.a{constructor(){super(...arguments),this.handleDragOver=e=>{e.preventDefault(),this.startDrag(e),this.continueDragThrottled(e)},this.handleDrop=e=>{e.preventDefault();const t=Array.from(e.dataTransfer.files);t.length>0&&zt.createAndCommit(this.environment,e=>{Vt.d({environment:this.environment,files:t,analyticsFrom:"native_drag",transaction:e})})},this.startDrag=e=>{Vt.g(this.environment,{startX:e.clientX,startY:e.clientY,stores:[],isNativeDrag:!0,getGhostElement:void 0})&&m.e(this.environment)},this.continueDrag=e=>{this.cancelDragTimeout&&window.clearTimeout(this.cancelDragTimeout),this.cancelDragTimeout=window.setTimeout(this.cancelDrag,this.getCancelDragTimeoutMS()),Vt.e(this.environment,{currentX:e.clientX,currentY:e.clientY})},this.continueDragThrottled=p.a.throttle(this.continueDrag,Ht.dragOverThrottleMS),this.cancelDrag=()=>{Vt.a(this.environment)}}didMount(){super.didMount(),window.addEventListener("dragover",this.handleDragOver),window.addEventListener("drop",this.handleDrop)}willUnmount(){super.willUnmount(),window.removeEventListener("dragover",this.handleDragOver),window.removeEventListener("drop",this.handleDrop)}getCancelDragTimeoutMS(){const{device:e}=this.environment;return e.isLinux?2e3:200}}Ht.dragOverThrottleMS=62.5;var Gt=Ht,Qt=a("X4ZB"),Yt=a("Oy36"),Zt=a("fJHT"),Xt=a("N34Z"),Kt=a("6BvA"),Jt=a("unoy");class $t extends o.a{constructor(){super(...arguments),this.renderPopupContent=()=>r.a.createElement(ta,null)}renderComponent(){const{device:e}=this.environment,{blockStore:t,originRect:a}=Kt.a.state;return r.a.createElement(pe.c,{popupType:e.isMobile?pe.c.PopupType.SlideUp:pe.c.PopupType.Popup,open:Boolean(t),originRect:a,placementToOrigin:pe.c.Placement.Bottom,alignmentToOrigin:pe.c.Alignment.Center,originGap:4,onDismiss:()=>Qt.a(this.environment),render:this.renderPopupContent})}}class ea extends o.a{constructor(){super(...arguments),this.handleRecordIconChange=e=>{const{blockStore:t}=Kt.a.state;if(t){const a=t.getIconStore();a&&zt.createAndCommit(this.environment,t=>{Xt.c({store:a,value:e,transaction:t})})}}}didMount(){const{blockStore:e}=Kt.a.state;if(!e)return;const t=e.getTitleStore();t&&Jt.k({environment:this.environment,store:t,canSelectAllBlocks:!1})}renderComponent(){const{device:e}=this.environment,{blockStore:t}=Kt.a.state;if(!t)return;const a=t.getTitleStore();if(!a)return;let n;return n=e.isMobile?{menuType:fe.b.MenuType.ActionSheet}:{menuType:fe.b.MenuType.Popup,width:380},r.a.createElement(fe.b,Object.assign({},n),r.a.createElement("div",{style:this.getWrapStyle()},this.renderIcon(t),r.a.createElement(Zt.a,{store:a,disabled:!t.canEdit(),onEsc:()=>Qt.a(this.environment),onEnter:()=>Qt.a(this.environment),disableSlashCommands:!0,disableEmojiCommands:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,placeholder:this.props.intl.formatMessage({defaultMessage:"Untitled",id:"renamePageMenuPopup.input.placeholder"}),style:this.getInputStyle()})))}renderIcon(e){const t={width:28,height:28,marginRight:6,flexShrink:0,flexGrow:0,boxShadow:"inset 0 0 0 1px ".concat(this.theme.darkDividerColor)};return e.canEdit()?r.a.createElement(Yt.a,{disabled:!1,bucket:"secure",icon:e.getIcon(),isEmptyPage:e.isEmptyPage(),size:18,style:t,onChange:this.handleRecordIconChange}):r.a.createElement(Yt.a,{disabled:!0,icon:e.getIcon(),isEmptyPage:e.isEmptyPage(),size:18,style:t})}getWrapStyle(){return{display:"flex",alignItems:"center",color:this.theme.regularTextColor,fontSize:"13px",padding:"4px 8px"}}getInputStyle(){return{display:"flex",alignItems:"center",flexGrow:1,fontSize:14,lineHeight:"20px",paddingTop:4,paddingBottom:4,paddingLeft:10,paddingRight:10,width:"100%",borderRadius:3,boxShadow:this.theme.inputBoxShadow,background:this.theme.inputBackground,cursor:"text",position:"relative"}}}const ta=Object(ae.injectIntl)(ea);var aa=$t,na=a("Hl/2"),ra=a("I6hv"),ia=a("Gw5o"),sa=a("Cm2F"),oa=a("QTGx"),la=a("Z1H8");function ca(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function da(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ca(Object(a),!0).forEach((function(t){ua(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ca(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function ua(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const pa=[ra.a.Open,ra.a.Resolved];class ma extends o.a{constructor(){super(...arguments),this.handleChangeTab=e=>{const t=ra.b.state;t.open&&ra.b.setState(da({},t,{tab:pa[e]}))}}renderComponent(){const{device:e}=this.environment;let t;return t=e.isMobile?{menuType:fe.b.MenuType.Modal,title:r.a.createElement(ae.FormattedMessage,{defaultMessage:"Discussion",id:"blockDiscussionMenu.mobileMenu.title"}),header:this.renderMenuHeader(),right:r.a.createElement(Ee.DoneMenuText,null),onClickRight:sa.a,whiteBackground:!0}:{menuType:fe.b.MenuType.Popup,header:this.renderMenuHeader(),width:480,maxHeight:"50vh",onClickOutside:sa.a},r.a.createElement(He.a,{capture:!0},r.a.createElement(la.a,{capture:!0,render:()=>r.a.createElement(be.a,{capture:!0,onEsc:sa.a},r.a.createElement(fe.b,Object.assign({},t),this.renderMenuContent()))}))}renderMenuHeader(){const{device:e}=this.environment,t=ne.m(this.props.blockStore).length,a=ne.l(this.props.blockStore).length;return r.a.createElement(mt.a,{tabs:[t?r.a.createElement(ae.FormattedMessage,{defaultMessage:"Open ({numberOfOpenDiscussions})",id:"blockDiscussionMenu.openDiscussionsTab.title",values:{numberOfOpenDiscussions:t}}):r.a.createElement(ae.FormattedMessage,{defaultMessage:"Open",id:"blockDiscussionMenu.openDiscussionsTabEmpty.title"}),a?r.a.createElement(ae.FormattedMessage,{defaultMessage:"Resolved ({numberOfResolvedDiscussions})",id:"blockDiscussionMenu.resolvedDiscussionsTab.title",values:{numberOfResolvedDiscussions:a}}):r.a.createElement(ae.FormattedMessage,{defaultMessage:"Resolved",id:"blockDiscussionMenu.resolvedDiscussionsTabEmpty.title"})],selectedIndex:pa.indexOf(this.props.tab),onChange:this.handleChangeTab,style:da({},e.isAndroid&&{borderBottom:"none"})})}renderMenuContent(){const{device:e}=this.environment;if(this.props.tab===ra.a.Open){const t=ne.m(this.props.blockStore);if(t.length){const a=t.map((e,t,a)=>r.a.createElement(ia.a,{key:e.id,store:e,format:ia.a.Format.Menu,isFirst:0===t,isOnly:1===a.length,discussionLocation:"block_menu",alwaysShowResolve:!0,blockStore:this.props.blockStore,onDismiss:sa.a})),i=this.props.blockStore.getType(),s=i&&b.r[i];if(e.isMobile&&s){const e=oa.a(this.props.blockStore);return e?r.a.createElement(n.Fragment,null,r.a.createElement("div",{style:{padding:"12px 16px",boxShadow:"0 1px 0 ".concat(this.theme.regularDividerColor),marginBottom:1}},r.a.createElement(e,{store:this.props.blockStore,disabled:!0,hideContent:!0,style:{fontSize:14,pointerEvents:"none"},isQuickFind:!0})),a):a}return a}return this.renderEmptyState(r.a.createElement(ae.FormattedMessage,{defaultMessage:"No comments to show.",id:"blockDiscussionMenu.emptyState.noCommentsMessage"}))}{const e=ne.l(this.props.blockStore);return e.length?e.map((e,t,a)=>r.a.createElement(ia.a,{key:e.id,store:e,format:ia.a.Format.Menu,isFirst:0===t,isOnly:1===a.length,discussionLocation:"block_menu",alwaysShowResolve:!0,blockStore:this.props.blockStore,onDismiss:sa.a})):this.renderEmptyState(r.a.createElement(ae.FormattedMessage,{defaultMessage:"No resolved comments.",id:"blockDiscussionMenu.emptyStatte.noResolvedCommentsMessage"}))}}renderEmptyState(e){const{device:t}=this.environment;return r.a.createElement("div",{style:{textAlign:"center",padding:t.isMobile?"64px 18px":"32px 18px 36px",fontSize:14,color:this.theme.mediumTextColor}},e)}}var ha=ma;class ga extends o.a{constructor(){super(...arguments),this.renderDiscussionMenu=()=>{if(ra.b.state.open)return r.a.createElement(ha,{rect:ra.b.state.rect,tab:ra.b.state.tab,blockStore:ra.b.state.blockStore})}}renderComponent(){const{device:e}=this.environment,{open:t,rect:a}=ra.b.state;return r.a.createElement(pe.c,{popupType:e.isMobile?pe.c.PopupType.SlideUp:pe.c.PopupType.Popup,open:t,originRect:a,placementToOrigin:pe.c.Placement.Bottom,alignmentToOrigin:pe.c.Alignment.Center,disableMouseCapture:!0,originGap:4,render:this.renderDiscussionMenu,preventScaleTransition:!0,preventOpacityTransition:!0,onDismiss:sa.a})}}var fa=ga,ba=a("VBxf"),ya=a("SeL1"),Sa=a("gRnv"),va=a("74GD"),Ea=a("B2+S");class Ma extends o.a{constructor(){super(...arguments),this.renderDiscussionInput=()=>{if(Ea.a.state.open){const{blockStore:e,discussionInputStore:t}=Ea.a.state;return r.a.createElement(va.a,{capture:!0},r.a.createElement(la.a,{capture:!0,render:()=>r.a.createElement("div",{style:this.getStyle()},r.a.createElement(ya.a,{parentStore:e,onCancel:this.handleDismiss,onSubmit:this.handleSubmit,discussionInputStore:t,isMobileSlideUpMenu:!0,shouldSaveUnsentComments:!1}))}))}},this.handleSubmit=()=>{const e=Ea.a.state;if(e.open){const t=e.discussionInputStore.state.textStore.getValue();t&&t.length>0&&("inline"===e.type?zt.createAndCommit(this.environment,a=>{Sa.c({environment:this.environment,textStore:e.textStore,selection:e.selection,commentTextValue:t,transaction:a})}):"block"===e.type&&zt.createAndCommit(this.environment,a=>{Sa.b({environment:this.environment,blockStore:e.blockStore,commentTextValue:t,transaction:a})})),Sa.a(this.environment)}},this.handleDismiss=()=>{const e=Ea.a.state;if(e.open){const t=e.discussionInputStore.state.textStore.getValue();t&&t.length>0?ba.showDialog({message:r.a.createElement(ae.FormattedMessage,{id:"newDiscussionMenu.discardCommentConfirmationDialog.prompt",defaultMessage:"Do you want to discard the comment?"}),showCancel:!0,keepFocus:!0,items:[{label:r.a.createElement(ae.FormattedMessage,{id:"newDiscussionMenu.discardCommentConfirmationDialog.discardButton.label",defaultMessage:"Discard"}),color:"red",onAccept:()=>Sa.a(this.environment)}]}):Sa.a(this.environment)}}}renderComponent(){const{device:e}=this.environment,{open:t,rect:a}=Ea.a.state;return r.a.createElement(pe.c,{popupType:e.isReactNative?pe.c.PopupType.SlideUp:pe.c.PopupType.Popup,keepFocus:!0,open:t,originRect:a,placementToOrigin:pe.c.Placement.Bottom,alignmentToOrigin:pe.c.Alignment.Center,originGap:4,onDismiss:this.handleDismiss,render:this.renderDiscussionInput})}getStyle(){const{device:e,WindowSizeStore:t}=this.environment;return{width:e.isReactNative?"100%":470,maxWidth:e.isMobileBrowser?"90vw":"100%",paddingTop:8,paddingBottom:e.isAndroid?12:8,paddingLeft:e.isReactNative?t.getSafePaddingLeftCSS(10):10,paddingRight:e.isReactNative?t.getSafePaddingRightCSS(10):10}}}var Ca=Ma,wa=a("qE2X"),Oa=a("SYQx");class ka extends o.a{constructor(){super(...arguments),this.renderDiscussion=()=>{const{device:e}=this.environment;if(Oa.a.state.open){const{discussionStore:t,discussionInputStore:a,blockStore:n}=Oa.a.state;let i;return i=e.isMobile?{menuType:fe.b.MenuType.Modal,title:r.a.createElement(ae.FormattedMessage,{defaultMessage:"Discussion",id:"discussion.mobileReplyMenu.title"}),right:r.a.createElement(ae.FormattedMessage,{defaultMessage:"Close",id:"discussion.mobileReplyMenu.closeButton.label"}),onClickRight:()=>wa.a(this.environment),whiteBackground:!0}:{menuType:fe.b.MenuType.Popup,width:420,maxWidth:e.isMobileBrowser?"80vw":"100%"},r.a.createElement(fe.b,Object.assign({},i),r.a.createElement(la.a,{capture:!0,render:()=>r.a.createElement(ia.a,{store:t,discussionInputStore:a,onDismiss:()=>wa.a(this.environment),format:ia.a.Format.Menu,isFirst:!0,isOnly:!0,discussionLocation:"reply_menu",alwaysShowResolve:!0,blockStore:n})}))}}}renderComponent(){const{device:e}=this.environment,{open:t,rect:a}=Oa.a.state;return r.a.createElement(pe.c,{popupType:e.isMobile?pe.c.PopupType.SlideUp:pe.c.PopupType.Popup,open:t,originRect:a,placementToOrigin:pe.c.Placement.Bottom,alignmentToOrigin:pe.c.Alignment.Center,originGap:4,onDismiss:()=>wa.a(this.environment),render:this.renderDiscussion})}}var Pa=ka,Ta=(a("SRfc"),a("Vd3H"),a("ALSZ")),Da=a("WgIs"),Ia=a("f0kS"),Fa=a("sbdd"),ja=a("zTdN"),xa=a("ttM1"),Ba=a("wFTq"),Aa=a("9c8K"),Ra=a("cBa6"),La=a("awNq"),Ua=a("O+wX"),_a=a("vJXr"),Wa=a("xAD1"),Na=a("WaiN"),qa=a("24Pt"),Va=a("DNgp"),za=a("5/h/"),Ha=a("VpIZ"),Ga=a("GJWe"),Qa=a("tzmq"),Ya=a("daQZ"),Za=a("Ajfl"),Xa=a("6nbh"),Ka=(a("B22C"),a("g4rC"));function Ja(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function $a(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const en=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ja(Object(a),!0).forEach((function(t){$a(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ja(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},Qe.a.textOverflowStyle,{fontWeight:Qe.a.fontWeight.medium,maxWidth:160,display:"inline-block",verticalAlign:"bottom"});function tn(e){const{pageTitle:t}=e;return t?r.a.createElement(ae.FormattedMessage,{defaultMessage:"New “{filterText}” page in…",id:"createPageMenuItem.title.withPageName",values:{filterText:r.a.createElement("span",{style:en},t)}}):r.a.createElement(ae.FormattedMessage,{defaultMessage:"Add new page in…",id:"createPageMenuItem.title.withoutPageName"})}function an(e){const{pageTitle:t}=e;return t?r.a.createElement(ae.FormattedMessage,{defaultMessage:"New “{filterText}” sub-page",id:"createSubpageMenuItem.title.withPageName",values:{filterText:r.a.createElement("span",{style:en},t)}}):r.a.createElement(ae.FormattedMessage,{defaultMessage:"Add new sub-page",id:"createSubpageMenuItem.title.withoutPageName"})}o.a;var nn=a("Pqcg"),rn=a("5Nka"),sn=a("uSCg"),on=a("G8iD"),ln=a("/ssM"),cn=a("CSYU"),dn=a("+NSf");function un(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function pn(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?un(Object(a),!0).forEach((function(t){mn(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):un(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function mn(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const hn=Object(ae.defineMessages)({mentionAll:{defaultMessage:"Mention a person, page, or date…",id:"mentionMenu.personPageDate.prompt2"},mentionPersonPage:{defaultMessage:"Mention a person or page…",id:"mentionMenu.personPage.prompt2"},mentionPersonDate:{defaultMessage:"Mention a person or date…",id:"mentionMenu.personDate.prompt2"},mentionPageDate:{defaultMessage:"Mention a page or date…",id:"mentionMenu.pageDate.prompt2"},mentionPerson:{defaultMessage:"Mention a person…",id:"mentionMenu.person.prompt2"},mentionDate:{defaultMessage:"Mention a date…",id:"mentionMenu.date.prompt2"},mentionPage:{defaultMessage:"Type to link or add page…",id:"mentionMenu.page.prompt2"},addPage:{defaultMessage:"Type to add or link page…",id:"mentionMenu.addPage.prompt2"}}),gn=Object(ae.defineMessages)({autocompleteToday:{defaultMessage:"Today",id:"mentionMenu.date.autocomplete.today"},autocompleteNextTuesday:{defaultMessage:"Next Tuesday 3pm",id:"mentionMenu.date.autocomplete.nextTuesday"},autocompleteReminder:{defaultMessage:"Remind tomorrow 9am",id:"mentionMenu.date.autocomplete.reminder"},reminder:{defaultMessage:"Remind {dateTime}",id:"mentionMenu.date.remindAtDateTime",description:"dateTime will be a message representing the date (with or without time) that the user wants to be reminded at, like 'Tomorrow 3pm' or 'Mar 1, 2020'"},noResults:{defaultMessage:"No results",id:"mentionMenu.noSearchResults.title",description:"A label describing that no results have been found."}});class fn extends o.a{constructor(){super(...arguments),this.storeTypes={ignoreSelectionAreaStore:Xa.a,localPageMentionRequestStore:cn.a,localCachePageMentionRequestStore:cn.a},this.renderMentionResult=(e,t)=>{const{intl:a}=this.props,n=Na.a.state,i=n.open&&n.insertionType,s={sections:[],nextSectionShouldHaveTopBorder:()=>s.sections.length>0,addSection(e){e&&this.sections.push(e)}};"+"===i&&s.addSection(this.getCreatePageMenuSection(s.nextSectionShouldHaveTopBorder())),s.addSection(this.getDateResultsMenuSection(t,s.nextSectionShouldHaveTopBorder())),s.addSection(this.getUserResultsMenuSection(t,s.nextSectionShouldHaveTopBorder())),s.addSection(this.getPageResultsMenuSection(t,s.nextSectionShouldHaveTopBorder())),("@"===i&&this.filterStore.state||"[["===i)&&s.addSection(this.getCreatePageMenuSection(s.nextSectionShouldHaveTopBorder()));const{sections:o}=s;let l,c;if(_a.a.state.online){const e=n.mentionTypes.user,t=n.mentionTypes.page,r=n.mentionTypes.date;let i="";const s=hn;e&&t&&r?i=a.formatMessage(s.mentionAll):e&&t?i=a.formatMessage(s.mentionPersonPage):e&&r?i=a.formatMessage(s.mentionPersonDate):t&&r?i=a.formatMessage(s.mentionPageDate):e?i=a.formatMessage(s.mentionPerson):r?i=a.formatMessage(s.mentionDate):t&&n&&(i=n.open&&"+"===n.insertionType?a.formatMessage(hn.addPage):a.formatMessage(s.mentionPage)),this.setTemporaryInputData({title:i,icon:this.renderTemporaryInputEmptyIcon(),allowTabCompletion:!1}),l=void 0}else l=r.a.createElement(ja.a,{title:r.a.createElement(ae.FormattedMessage,{defaultMessage:"Please go online to mention a person or page.",id:"mentionMenu.offlineMessage"})});0===o.length&&(c=r.a.createElement(he.a,null,r.a.createElement(ja.a,{title:r.a.createElement(ae.FormattedMessage,Object.assign({},gn.noResults))})));const{device:d}=this.environment;let u;return u=this.isActionSheet()?{menuType:fe.b.MenuType.ActionSheet,disableBottomPadding:!0}:{menuType:fe.b.MenuType.Popup,width:this.getMenuDesktopWidth(),maxHeight:d.isMobile?"30vh":"40vh",onClickOutside:Ta.d},r.a.createElement(fe.b,Object.assign({},u,{header:l}),r.a.createElement(be.a,{capture:Na.a.state.open,onBackspace:this.shouldCaptureBackspace()?this.handleEmptyBackspace:void 0,onTab:this.handleTab}),r.a.createElement(Da.a,{type:Da.a.Type.Vertical,initialFocus:this.getMenuInitialFocus(),sections:o,onEmptyEnter:this.handleCancel}),c)},this.handleCreateInAutocompleteQueryChange=e=>{this.updateOpenState({createInQuery:e})},this.renderCreateInMenu=()=>{const e=Na.a.state;if(!e.open)return;const t="block"===e.textStore.table?e.textStore.id:void 0;return r.a.createElement(Ba.a,{targets:[],isAddTo:!0,isCreateIn:!0,onAccept:e=>{Ta.b({environment:this.environment,titleText:this.getNormalizedFilter(),ignoreSelectionAreaStore:this.stores.ignoreSelectionAreaStore,createInValue:e})},captureSelection:!0,restoreSelection:!0,parentBlockId:t,onAutocompleteQueryChange:this.handleCreateInAutocompleteQueryChange,ignoreSelectionAreaStore:this.stores.ignoreSelectionAreaStore,autocompleteQuery:e.createInQuery,desktopWidth:this.getMenuDesktopWidth(),onCancel:this.handleCreateInCancel})},this.handleCreateInStart=()=>{this.updateOpenState({showCreateIn:!0})},this.handleCreateInCancel=()=>{this.updateOpenState({showCreateIn:!1,createInQuery:""})},this.handleEmptyBackspace=e=>{this.shouldCaptureBackspace()&&e.preventDefault(),this.handleCancel()},this.handleCancel=()=>{Ta.d()},this.handleTab=e=>{e.preventDefault();const t=this.tabCompletionString;if(!t)return;const a=Va.default.state;if("editing"!==a.mode)return;const n=Na.a.state;n.open&&n.textStore===a.store&&zt.createAndCommit(this.environment,e=>{Za.n({environment:this.environment,transaction:e,string:t,store:a.store,selection:a.selection,disableMentions:!0,disableDateMentions:!0,disableEmojiCommands:!0,disableSlashCommands:!0})})},this.tabCompletionString=void 0,this.letterCharacterClass=(()=>{try{return/(?:[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEF\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7C6\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB67\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDEC0-\uDEEB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D])/}catch(e){return/[a-zA-Z]/}})(),this.inputSelectionsStore=this.createComputedStore(()=>{const e=Na.a.state;if(e.open)return Aa.c(e.textStore,e.oldTextValue,e.insertionType)}),this.filterStore=this.createComputedStore(()=>{const e=this.inputSelectionsStore.state,t=Na.a.state;if(e&&t.open)return Aa.b(t.textStore,e)}),this.popupOpenStore=this.createComputedStore(()=>{const e=Na.a.state;return!!e.open&&("+"!==e.insertionType||""!==this.getNormalizedFilter())}),this.performUserMentionRequest=async e=>{const t=Na.a.state;if(!t.open)return;const a=t.mentionTypes.user?await this.getUserResults(e):[];return""===e?a.slice(0,2):a.slice(0,20)},this.performLocalCachePageMentionRequest=async()=>{const{currentSpaceStore:e,currentSpaceViewStore:t}=U.default.state;if(e)return qa.h({environment:this.environment,currentSpaceStore:e,currentSpaceViewStore:t})},this.performLocalPageMentionRequest=e=>{const{localCachePageMentionRequestStore:t}=this.stores,a=t.state.result;if(!a)return;const n=qa.g({input:e,cache:a});if(!n)return;if(0===n.results.length)return{error:ln.d.NoResults};const r=T.d();if(!r)return;const i=qa.n({sort:e.query.sort,unsorted:n.results,batchSize:on.b,currentUserId:this.environment.currentUser.id}).results.map(e=>pn({},e,{store:f.a.createChildStore(r,{table:b.b,id:e.id})}));return{value:{total:i.length,results:i}}},this.performPageMentionRequest=async e=>{const t=Na.a.state;if(!t.open)return[];const a=t.mentionTypes.page?await this.getPageResults(e):[];return""===e?a.slice(0,2):a.slice(0,20)},this.getUserResults=async e=>{if(_a.a.state.online){return await kt.l({environment:this.environment,query:e,membersOnly:!1})}return[]},this.getPageResults=async e=>{if(!_a.a.state.online)return[];const t=Na.a.state,a=t.open&&Object(ne.n)(t.textStore)&&t.textStore;return await kt.e({nearBlock:a||void 0,environment:this.environment,query:e,source:"mention_menu",limit:20})},this.getDateResults=e=>{const t=Na.a.state;if(!t.open)return[];const{intl:a}=this.props,n=t.mentionTypes.reminder;return t.mentionTypes.date?function(e,t,a){if(0===e.length)return p.a.compact([{label:a.formatMessage(gn.autocompleteToday),value:()=>K.nb(K.m)},t?void 0:{label:a.formatMessage(gn.autocompleteNextTuesday),value:()=>{const e=K.ob(K.m),t=e.clone().day(2);return t.isSameOrBefore(e)&&t.add(1,"week"),t.add(1,"week"),t.hour(15),{type:"datetime",start_date:t.format(K.ib),start_time:t.format(K.kb),time_zone:K.m}}},t?{label:a.formatMessage(gn.autocompleteReminder),value:()=>({type:"datetime",start_date:K.pb(K.m).start_date,start_time:"09:00",reminder:{unit:"day",value:0,time:K.w},time_zone:K.m})}:void 0]);const n=t?Object(La.e)(e,a):Object(La.d)(e,a);if(n){let e=Object(Ua.a)({value:n,date_format:"relative",userTimeZone:K.m,intl:a,allowRelativeDates:!0});return n.reminder&&(e=a.formatMessage(gn.reminder,{dateTime:e})),[{label:e,value:()=>n}]}return[]}(e,n,a).slice(0,6):[]}}willMountOrUpdate(){const e=Na.a.state,t=this.filterStore.state;if(e.open){const a=Va.default.state,n="editing"===a.mode&&a.store===e.textStore,r=this.stores.ignoreSelectionAreaStore.state.savedTextSelectionStoreState,i=r&&"editing"===r.mode&&r.store===e.textStore;if(!n&&!i)return void Ta.d();const s=n&&"editing"===a.mode&&a.selection,o=this.inputSelectionsStore.state;if(o&&s&&(s.startIndex<o.filter.startIndex||s.endIndex>o.filter.endIndex))return void Ta.d();const l=this.filterStore.state&&this.filterStore.state[0];if("+"===e.insertionType&&l&&!l.match(this.letterCharacterClass))return void Ta.d();if(void 0===t)return void Ta.d()}}renderComponent(){const{device:e}=this.environment,t=Na.a.state,a=Wa.a.findComponent(e=>e.props.capture),n=this.popupOpenStore.state;let i;if(a&&e.isMobile){const e=a.stores.store.state.rect;e&&(i={height:"calc(100vh - ".concat(e.height,"px)")})}const s=t.open&&t.showCreateIn;return r.a.createElement(pe.c,{popupType:this.isActionSheet()?pe.c.PopupType.SlideUp:pe.c.PopupType.Popup,open:n,originRect:t.open?t.selectionRect:void 0,slideUpWrapStyle:i,placementToOrigin:pe.c.Placement.Bottom,alignmentToOrigin:pe.c.Alignment.Start,originGap:8,disableMouseCapture:!0,disableContentScroll:!0,onDismiss:this.handleCancel,disableDarkOverlayBackground:e.isMobile&&!a,keepFocus:!0,render:()=>e.isMobile?r.a.createElement(r.a.Fragment,null,this.renderMentionSearch(),r.a.createElement(pe.c,{popupType:pe.c.PopupType.SlideUp,render:this.renderCreateInMenu,open:s,keepFocus:!0})):s?this.renderCreateInMenu():this.renderMentionSearch()})}renderMentionSearch(){var e=this;const t=this.getNormalizedFilter(),a=Na.a.state,n=dn.default.createMetric("rum.mention_menu_ready");return r.a.createElement(Ot.a,{requestStore:a.userRequestStore,request:t,performRequest:this.performUserMentionRequest,render:i=>r.a.createElement(Ot.a,{requestStore:a.pageRequestStore,request:t,performRequest:this.performPageMentionRequest,debounce:kt.b,render:a=>r.a.createElement(Ot.a,{requestStore:this.stores.localCachePageMentionRequestStore,request:U.default.state.currentSpaceStore&&U.default.state.currentSpaceStore.id,performRequest:this.performLocalCachePageMentionRequest,render:s=>r.a.createElement(Ot.a,{requestStore:this.stores.localPageMentionRequestStore,debounce:kt.a,request:{query:{text:t,filters:ln.e({isDeletedOnly:!1,isNavigableOnly:!0,excludeTemplates:!0,requireEditPermissions:void 0}),sort:"Relevance"},limit:5},performRequest:function(){return Promise.resolve(e.performLocalPageMentionRequest(...arguments))},render:e=>this.renderMentionResult(i||a||e,this.getCurrentMentionResults(n))})})})})}getDateResultsMenuSection(e,t){const{dateResults:a}=e;if(0!==a.length)return this.applySectionLimit("date",{key:"date results",render:e=>r.a.createElement(he.a,Object.assign({},e,{title:r.a.createElement(ae.FormattedMessage,{defaultMessage:"Date",id:"mentionMenu.dateSection.title"}),topBorder:t,isTitleUppercase:!0})),items:a.map(e=>{let{label:t,value:a}=e;return{key:t,render:e=>(e.focused&&this.setTemporaryInputData({title:t,icon:this.renderTemporaryInputAtMentionIcon(),allowTabCompletion:!0}),r.a.createElement(Dt.a,Object.assign({},e,{title:t}))),action:()=>{zt.createAndCommit(this.environment,e=>{Ta.a({environment:this.environment,annotation:["d",pn({},a(),{date_format:"relative"})],transaction:e})})}}})})}renderSpinner(e){return r.a.createElement(xa.a,{show:e,showDelay:500,showHold:300,render:e=>r.a.createElement(Pt.a,{style:{textAlign:"center",visibility:e?"visible":"hidden",display:"inline",marginLeft:8}})})}renderTemporaryInputEmptyIcon(){const e=Na.a.state;if(e.open)return"+"===e.insertionType?this.renderTemporaryInputAddIcon():r.a.createElement("span",{style:{width:"1em",display:"inline-block",verticalAlign:"-0.15em",fill:this.theme.mediumIconColor,marginRight:"0.2em"}},ft.a.searchThick())}renderTemporaryInputAddIcon(){return r.a.createElement("span",{style:{width:"1em",display:"inline-block",verticalAlign:"-0.15em",fill:this.theme.mediumIconColor,marginRight:"0.2em"}},ft.a.plus())}renderTemporaryInputPageIcon(e){const t=e.getValue();if(t)return Object(Ga.h)({pageValue:t,showEmojiInline:!0,emojiType:Object(Qa.a)(this.environment),baseUrl:Q.default.baseURL,getRecordValue:e.getRecordValue,isClient:!0,isSafariOrIOS:this.environment.device.isSafari||this.environment.device.isIOS,currentUserId:this.environment.currentUser.id})}renderTemporaryInputAtMentionIcon(){return r.a.createElement("span",{style:{width:"1em",display:"inline-block",verticalAlign:"-0.15em",fill:this.theme.mediumIconColor,marginRight:"0.2em"}},ft.a.at())}getUserResultsMenuSection(e,t){const{userResults:a}=e;if(0!==a.length)return this.applySectionLimit("user",{key:"user results",render:e=>r.a.createElement(he.a,Object.assign({},e,{title:r.a.createElement(ae.FormattedMessage,{defaultMessage:"People",id:"mentionMenu.peopleSection.title"}),topBorder:t,isTitleUppercase:!0})),items:p.a.compact(a.map(e=>({key:e.id,render:t=>(t.focused&&this.setTemporaryInputData({title:Object(za.e)(e),icon:this.renderTemporaryInputAtMentionIcon(),allowTabCompletion:!0}),r.a.createElement(Ia.a,Object.assign({},t,{user:e}))),action:()=>{zt.createAndCommit(this.environment,t=>{Ta.a({environment:this.environment,annotation:Object(Ra.o)(e.id),transaction:t})})}})))})}getPageResultsMenuSection(e,t){const{pageResults:a}=e,n=r.a.createElement(r.a.Fragment,null,0===a.length?r.a.createElement(ae.FormattedMessage,Object.assign({},gn.noResults)):r.a.createElement(ae.FormattedMessage,{defaultMessage:"Link to page",id:"mentionMenu.pagesSection.title2"}),this.renderSpinner(Na.a.state.pageRequestStore.state.loading));return this.applySectionLimit("page",{key:"page results",render:e=>r.a.createElement(he.a,Object.assign({},e,{title:n,topBorder:t,isTitleUppercase:!0})),items:p.a.compact(a.map(e=>{const t=T.d();if(!t)return;const a=f.a.createChildStore(t,{table:b.b,id:e});return{key:e,render:e=>{if(e.focused){const e=a.getValue();if(e){const t=Object(Ha.h)({table:a.table,value:e,getRecordValue:a.getRecordValue,userTimeZone:K.m,intl:this.props.intl});this.setTemporaryInputData({title:t||"",icon:this.renderTemporaryInputPageIcon(a),allowTabCompletion:!0})}}return r.a.createElement(Fa.a,Object.assign({},e,{store:a}))},action:()=>{zt.createAndCommit(this.environment,t=>{Ta.a({environment:this.environment,annotation:["p",e],transaction:t})})}}}))})}getCreatePageMenuSection(e){if(!this.canCreatePage())return;const t=Na.a.state;if(!t.open)return;const{intl:a}=this.props,n=this.getNormalizedFilter(),i="@"===t.insertionType?r.a.createElement(ae.FormattedMessage,{id:"mentionMenu.createPageSection.title",defaultMessage:"New page"}):void 0;return{key:"create page",render:t=>r.a.createElement(he.a,Object.assign({title:i,isTitleUppercase:!0},t,{topBorder:e})),items:[{key:"add new subpage",action:async()=>{const e=Object(Ya.c)(t.textStore);e&&await Ta.b({environment:this.environment,ignoreSelectionAreaStore:this.stores.ignoreSelectionAreaStore,titleText:this.getNormalizedFilter(),createInValue:e.createInValue,onPageCreated:e=>{e&&""===Ra.Y(e.getTitleValue())&&Y.navigateToBlock({environment:this.environment,store:e})}})},render:e=>{e.focused&&this.setTemporaryInputData({title:0===n.length?a.formatMessage(hn.addPage):"",icon:this.renderTemporaryInputAddIcon(),allowTabCompletion:!1});const t=t=>r.a.createElement(Dt.a,Object.assign({},Object(sn.a)(t||{},e),{icon:ft.a.plus({width:16}),title:r.a.createElement(an,{pageTitle:this.getNormalizedFilter()})}));return this.environment.device.isMobile?t():r.a.createElement(dt.a,{renderTooltip:()=>r.a.createElement(nn.a,{imageURL:rn.a.images.tooltips.pageMenu.newSubpagePng,imageWidth:140,imageHeight:100,caption:r.a.createElement(ae.FormattedMessage,Object.assign({},Ba.b.createSubpage))}),placement:dt.a.Placement.Right,delayThreshold:0,render:e=>t(e)})}},{key:"open create in menu",action:this.handleCreateInStart,render:e=>{e.focused&&this.setTemporaryInputData({title:0===n.length?a.formatMessage(hn.addPage):"",icon:this.renderTemporaryInputAddIcon(),allowTabCompletion:!1});const t=r.a.createElement(tn,{pageTitle:this.getNormalizedFilter()}),i=a=>r.a.createElement(Dt.a,Object.assign({},Object(sn.a)(a||{},e),{icon:ft.a.alias({width:16}),title:t}));return this.environment.device.isMobile?i():r.a.createElement(dt.a,{renderTooltip:()=>r.a.createElement(nn.a,{imageURL:rn.a.images.tooltips.pageMenu.newPageInPng,imageWidth:140,imageHeight:100,caption:r.a.createElement(ae.FormattedMessage,Object.assign({},Ba.b.newPageIn))}),placement:dt.a.Placement.Right,delayThreshold:0,render:e=>i(e)})}}]}}applySectionLimit(e,t){const a=Na.a.state;if(!a.open)return t;if(a.expandSection&&a.expandSection===e)return t;const{items:n}=t,i=this.environment.device.isPhone?3:5;return n.length<=i?t:pn({},t,{items:[...n.slice(0,i),{key:"show more",render:e=>r.a.createElement(Dt.a,Object.assign({},e,{icon:ft.a.dots({width:16,fill:this.theme.mediumTextColor}),title:r.a.createElement("span",{style:{color:this.theme.mediumTextColor}},r.a.createElement(ae.FormattedMessage,{defaultMessage:"{numberMore} more results",id:"mentionMenu.showMoreResultsButton.title",values:{numberMore:n.length-i}}))})),action:()=>{this.updateOpenState({expandSection:e})}}]})}updateOpenState(e){const t=Na.a.state;t.open&&Na.a.setState(pn({},t,{},e))}getNormalizedFilter(){const e=this.filterStore.state;return e?Na.a.state.open&&"[["===Na.a.state.insertionType&&e.endsWith("]]")?e.slice(0,-2).trim():e.trim():""}setTemporaryInputData(e){const t=Na.a.state;if(!t.open)return;if(!e)return void t.temporaryInputData.set(void 0);const{device:a}=this.environment,{title:n,icon:r,allowTabCompletion:i}=e,s=this.filterStore.state||"",o=n.toLowerCase().startsWith(s)?n.slice(s.length):"";this.tabCompletionString=i?o:void 0;const l=a.isFirefox?void 0:r;t.temporaryInputData.set({prefix:t.insertionType,suffix:"[["===t.insertionType&&s.endsWith("]]")?"]]":"",completion:o,prefixIcon:l})}getCurrentMentionResults(e){const t=Na.a.state,a=t.userRequestStore.state.result||[],n=t.pageRequestStore.state.result||[],r=this.getDateResults(this.getNormalizedFilter());let i=n;const{result:s}=this.stores.localPageMentionRequestStore.state;if(s&&!s.error){const e=s.value.results,t=T.d();i=t?qa.b({environment:this.environment,isOnline:_a.a.state.online,results:{local:e,server:n.map(e=>pn({},e,{store:f.a.createChildStore(t,{table:b.b,id:e.id})}))}})||[]:e}const o=t.userRequestStore.state.ready&&t.pageRequestStore.state.ready;return o&&dn.default.emit(this.environment,e),{userResults:a,pageResults:i.map(e=>e.id),dateResults:r,ready:o}}canCreatePage(){return!!Na.a.state.mentionTypes.createPage}isActionSheet(){const{device:e}=this.environment;return e.isReactNative&&!e.isTablet}shouldCaptureBackspace(){return""===this.filterStore.state}getMenuInitialFocus(){if(""!==this.getNormalizedFilter())return 0}getMenuDesktopWidth(){return 330}}var bn=Object(ae.injectIntl)(fn);var yn=a("sQnJ"),Sn=a("qxI2"),vn=a("BJyN"),En=a("GKeo");class Mn extends o.a{constructor(){super(...arguments),this.renderMenu=()=>{const{device:e}=this.environment,t=En.a.state;if(!t.open)return;const a=this.getSections(t),n=this.getFilter(t);let i;return i=e.isReactNative&&!e.isTablet?{menuType:fe.b.MenuType.ActionSheet}:{menuType:fe.b.MenuType.Popup,width:324,maxHeight:"40vh",onClickOutside:yn.d},r.a.createElement(fe.b,Object.assign({},i),r.a.createElement(ue.a,{sections:a,onAccept:this.handleAccept,context:{environment:this.environment,blocks:S.default.state.stores,originRect:t.selectionRect},filter:n,initialFocus:0,onEmptyEnter:this.handleCancel,useLimit:!0}))},this.handleCancel=()=>{yn.d()},this.handleAccept=e=>{const t=S.default.state.stores[0];t&&me.q(this.environment,{analyticsName:e.analyticsName,from:"slash_menu",block_type:t.getType()}),zt.createAndCommit(this.environment,e=>{yn.a({environment:this.environment,transaction:e})})}}willMountOrUpdate(){const e=En.a.state;if(e.open){const t=Va.default.state,a=this.getFilter(e),n=Object(Sn.a)(this.getSections(e),{blocks:S.default.state.stores,environment:this.environment},a||"");("editing"!==t.mode||t.store!==e.textStore||Aa.d(a,!0,n.length))&&yn.d()}}renderComponent(){const{device:e}=this.environment,t=En.a.state;return r.a.createElement(pe.c,{popupType:e.isReactNative&&!e.isTablet?pe.c.PopupType.SlideUp:pe.c.PopupType.Popup,open:t.open,originRect:t.open?t.selectionRect:void 0,placementToOrigin:pe.c.Placement.Bottom,alignmentToOrigin:pe.c.Alignment.Start,originGap:4,disableMouseCapture:!0,disableContentScroll:!0,onDismiss:this.handleCancel,render:this.renderMenu})}getFilter(e){return Aa.a(e.textStore,e.oldTextValue,!e.isAddMenu)}getSections(e){return e.isAddMenu?vn.i:vn.n}}var Cn=Mn,wn=a("Wfos"),On=a("F1uM"),kn=a("udrG"),Pn=a("nFzZ"),Tn=a("7IvN"),Dn=a("tP7q");const In=Object(ae.defineMessages)({image:{defaultMessage:"Embed image",id:"embedMenu.action.image"},video:{defaultMessage:"Embed video",id:"embedMenu.action.video"},tweet:{defaultMessage:"Embed Tweet",id:"embedMenu.action.tweet"},drive:{defaultMessage:"Embed Google Drive",id:"embedMenu.action.drive"},gist:{defaultMessage:"Embed GitHub Gist",id:"embedMenu.action.gist"},figma:{defaultMessage:"Embed Figma",id:"embedMenu.action.figma"},invision:{defaultMessage:"Embed Invision project",id:"embedMenu.action.invision"},abstract:{defaultMessage:"Embed Abstract project",id:"embedMenu.action.abstract"},framer:{defaultMessage:"Embed Framer prototype",id:"embedMenu.action.framer"},whimsical:{defaultMessage:"Embed Whimsical board",id:"embedMenu.action.whimsical"},miro:{defaultMessage:"Embed Miro board",id:"embedMenu.action.miro"},audio:{defaultMessage:"Embed audio",id:"embedMenu.action.audio"},maps:{defaultMessage:"Embed Google Map",id:"embedMenu.action.maps"},loom:{defaultMessage:"Embed Loom",id:"embedMenu.action.loom"},typeform:{defaultMessage:"Embed Typeform",id:"embedMenu.action.typeform"},codepen:{defaultMessage:"Embed CodePen",id:"embedMenu.action.codepen"},pdf:{defaultMessage:"Embed PDF",id:"embedMenu.action.pdf"},embed:{defaultMessage:"Create embed",id:"embedMenu.action.createEmbed"}}),Fn=Object(ae.defineMessages)({linkToPage:{defaultMessage:"Link to page",id:"embedMenu.actions.linkToPage.title"},mentionPage:{defaultMessage:"Mention page",id:"embedMenu.actions.mentionPage.title"},createLinkedDatabase:{defaultMessage:"Create linked database",id:"embedMenu.actions.createLinkedDatabase.title"},bookmarkMenuItem:{defaultMessage:"Create bookmark",id:"embedMenu.actions.createBookmark.title"},dismissItem:{defaultMessage:"Dismiss",id:"embedMenu.actions.dismiss.title"}}),jn={image:jt.default.formatMessage(In.image),video:jt.default.formatMessage(In.video),tweet:jt.default.formatMessage(In.tweet),drive:jt.default.formatMessage(In.drive),gist:jt.default.formatMessage(In.gist),figma:jt.default.formatMessage(In.figma),invision:jt.default.formatMessage(In.invision),abstract:jt.default.formatMessage(In.abstract),framer:jt.default.formatMessage(In.framer),whimsical:jt.default.formatMessage(In.whimsical),miro:jt.default.formatMessage(In.miro),audio:jt.default.formatMessage(In.audio),maps:jt.default.formatMessage(In.maps),loom:jt.default.formatMessage(In.loom),typeform:jt.default.formatMessage(In.typeform),codepen:jt.default.formatMessage(In.codepen),pdf:jt.default.formatMessage(In.pdf),embed:jt.default.formatMessage(In.embed)};class xn extends o.a{constructor(){super(...arguments),this.renderMenu=()=>{const{device:e}=this.environment,t=Tn.a.state;if(!t.open)return;const a=this.getSections(t);let n;return n=e.isMobile?{menuType:fe.b.MenuType.ActionSheet}:{menuType:fe.b.MenuType.Popup,width:320,maxHeight:"40vh"},r.a.createElement(fe.b,Object.assign({},n,{className:Ft.u}),r.a.createElement(Da.a,{type:Da.a.Type.Vertical,sections:a,initialFocus:0}))},this.handleDismiss=()=>{wn.c()},this.handleAccept=e=>{wn.a({environment:this.environment,blockType:e})}}willMountOrUpdate(){const e=Tn.a.state;if(e.open){const t=Va.default.state;"empty"!==t.mode&&"readOnly"!==t.mode&&t.store.id===e.textStore.id&&t.selection.endIndex===e.urlSelection.endIndex||wn.c()}}renderComponent(){const{device:e}=this.environment,t=Tn.a.state;return r.a.createElement(pe.c,{popupType:e.isReactNative&&!e.isTablet?pe.c.PopupType.SlideUp:pe.c.PopupType.Popup,open:t.open,originRect:t.open?t.selectionRect:void 0,placementToOrigin:pe.c.Placement.Bottom,alignmentToOrigin:pe.c.Alignment.Start,originGap:4,disableMouseCapture:!0,disableContentScroll:!0,disableDarkOverlayBackground:e.isMobile,keepFocus:e.isMobile,render:this.renderMenu,onDismiss:this.handleDismiss})}getSections(e){const{device:t}=this.environment,{url:a,textStore:n}=e,i=[],s=Object(Dn.l)({url:a,baseUrl:Q.default.baseURL,isMobile:t.isMobile,protocol:Q.default.protocol,currentUrl:window.location.href});if("page"===s.name){const e=f.a.createChildStore(n,{table:b.b,id:s.blockId});i.push({name:jt.default.formatMessage(Fn.mentionPage),validator:()=>!0,type:"mention-page"}),i.push({name:jt.default.formatMessage(Fn.linkToPage),validator:()=>!e.isCollectionView(),type:kn.a.page}),i.push({name:jt.default.formatMessage(Fn.createLinkedDatabase),validator:()=>e.isCollectionView(),type:kn.a.collectionViewPage})}const o=Pn.j(jn);for(const r of o)"embed"!==r&&i.push({name:jn[r],validator:On.b[r],type:r});return i.push({name:jt.default.formatMessage(Fn.bookmarkMenuItem),validator:On.i,type:kn.a.bookmark}),i.push({name:jn.embed,validator:On.b.embed,type:"embed"}),[{key:"embed section",render:e=>r.a.createElement(he.a,Object.assign({},e)),items:[{key:"dismiss",render:e=>r.a.createElement(Dt.a,Object.assign({},e,{title:jt.default.formatMessage(Fn.dismissItem)})),action:this.handleDismiss},...p.a.compact(i.map(e=>{let{name:t,validator:n,type:i}=e;if(n({url:a,baseUrl:Q.default.baseURL})){return{key:"embed ".concat(t),render:e=>r.a.createElement(Dt.a,Object.assign({},e,{title:t})),action:()=>this.handleAccept(i)}}}))]}]}}var Bn=xn,An=a("RI9y"),Rn=a("ICWk"),Ln=a("i3uR"),Un=a("9hmv"),_n=a("q8I6"),Wn=a("xPzf"),Nn=a("6fCZ"),qn=a("AjLL"),Vn=a("TDb4"),zn=a("y4kc"),Hn=a("kaWB"),Gn=a("6SEd"),Qn=a("NMKT"),Yn=a("43ch"),Zn=a("0Osm"),Xn=a("bk3b"),Kn=a("ieCD"),Jn=a("gha2"),$n=a("VcFn"),er=a("LEzx");class tr extends er.a{getInitialState(){return{open:!1}}}var ar=new tr,nr=a("5k6+"),rr=a("typy"),ir=a("2bwL"),sr=a("xstG");function or(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function lr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?or(Object(a),!0).forEach((function(t){cr(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):or(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function cr(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class dr extends o.a{constructor(){super(...arguments),this.mouseIsDownExternally=!1,this.renderOverlay=()=>{const{isActive:e}=$n.a.state;return r.a.createElement(ze.a,{isVisible:e,enterAnimationStyle:{opacity:0},animationStyle:{opacity:1},exitAnimationStyle:{opacity:0},springConfig:{opacity:{stiffness:100,damping:10,precision:1e-4}},render:this.renderAnimated,onAnimationEnd:this.handleAnimationEnd})},this.renderAnimated=()=>{const{top:e,left:t}=$n.a.state;return r.a.createElement("div",{className:Ft.Fb,style:{pointerEvents:"none",position:"absolute",top:e,left:0,display:"flex",width:"100%"}},r.a.createElement("div",{style:{flexShrink:1,width:Math.max(t-dr.leftOffset,0),minWidth:24}}),Object(qe.a)(e=>r.a.createElement("div",Object.assign({style:{pointerEvents:"none",padding:12}},e),this.lastRenderState&&this.renderMenu(this.lastRenderState))),r.a.createElement("div",{style:{flexGrow:1,flexShrink:1,minWidth:36}}))},this.updateRichTextState=()=>{const e=$n.a.state;if(Kn.a.state.open||Jn.a.state.open)return;if(ir.b.state)return Qn.a();const t=Va.default.state;if("editing"!==t.mode)return Qn.a();const a=t.store;if(a.table!==b.b&&a.table!==Hn.a&&a.table!==Gn.a)return Qn.a();if(!this.environment.currentUser.isLoggedIn()||!a.canComment())return;const n=An.get();if(!a||T.k())return Qn.a();const r=Yn.a.findEditableWithStore(a);if(r&&r.props.disableAnnotation)return Qn.a();if(r&&r.props.disabled)return Qn.a();const i=r?r.getContextClosestSelectable():void 0,s=i?i.props.store:void 0;if(s&&(s.isLocked()||s.isNavigableAncestorLocked()))return Qn.a();if(this.mouseIsDownExternally&&e.blockTarget!==s)return Qn.a();let o=!1;if(a.table===b.b){const e=a.getRecordStoreAtRootPath().getValue();e&&(o=dr.richTextMenuBlockTypesBlacklist[e.type])}if(!a||Kt.a.isActive()||nr.a.isActive()||sr.a.isOpen()||o||!n||!this.hasNonCollapsedTextSelection()||ar.state.open)Qn.a();else{let e=0,t=0;const a=An.getRect(n);if(a&&(e=a.left,t=a.top-dr.height-25,t<this.getTopbarHeight()))return Qn.a();0===Math.abs($n.a.state.top-t)&&Math.abs($n.a.state.left-e)<10&&(t=$n.a.state.top,e=$n.a.state.left),$n.a.setState(lr({},$n.a.state,{isActive:!0,isAnimatingClosed:!1,top:t,left:e,blockTarget:S.default.state.stores[0]}))}},this.updateRichTextStateThrottled=p.a.throttle(this.updateRichTextState,200,{leading:!1}),this.handleAnimationEnd=()=>{$n.a.state.isActive||$n.a.setState(lr({},$n.a.state,{isAnimatingClosed:!1})),this.lastRenderState=this.renderStateStore.state},this.renderStateStore=this.createComputedStore(()=>{const{isActive:e,blockTarget:t}=$n.a.state,a=Va.default.state;if(e&&"editing"===a.mode){const e=Va.default.isEditingComment(),n=Va.default.isEditingCaption(),r=t&&t.getParentTable()===Gn.a,i=this.pageContext&&this.pageContext.publicEditModeStore.state,s=(!i||"edit"===i)&&a.store.canEdit(),o=t&&t.getType(),l=o&&dr.richTextMenuActionsBlacklist[o],c={showTurnInto:Boolean(!e&&!r&&!n&&t&&s),showBold:Boolean(s),showItalic:Boolean(s),showStrikethrough:Boolean(s),showUnderline:Boolean(s),showCode:Boolean(s),showLink:Boolean(s),showHighlight:Boolean(s&&!e),showDiscuss:Boolean(!e&&t&&!r),showEquation:Boolean(s),showMention:Boolean(!e&&t&&!r&&s),showActionButton:Boolean(!e&&!n&&t&&!r),blockTarget:t,isComment:e};if(l&&l.size>0)for(const t of l)c[t]=!1;return c}})}didMount(){S.default.addListener(this.updateRichTextStateThrottled),Va.default.addListener(this.updateRichTextStateThrottled),Ge.a.addListener(this.updateRichTextState),Zn.a.addListener(this.updateRichTextState),Xn.a.addListener(this.updateRichTextState)}willUnmount(){Va.default.removeListener(this.updateRichTextStateThrottled),S.default.removeListener(this.updateRichTextStateThrottled),Ge.a.removeListener(this.updateRichTextState),Zn.a.removeListener(this.updateRichTextState),Xn.a.removeListener(this.updateRichTextState)}willMountOrUpdate(){const e=this.renderStateStore.state;e&&(this.lastRenderState=e)}renderComponent(){const{isActive:e,isAnimatingClosed:t}=$n.a.state;return r.a.createElement(_e.a,{open:e||t,render:this.renderOverlay})}renderMenu(e){const{isActive:t}=$n.a.state;return r.a.createElement("div",{style:{display:"inline-flex",alignItems:"stretch",height:dr.height,background:this.theme.popoverBackground,overflow:"hidden",fontSize:14,lineHeight:1.2,borderRadius:3,boxShadow:this.theme.mediumBoxShadow,pointerEvents:t?"auto":"none"},onMouseDown:e=>e.preventDefault()},e.showTurnInto&&e.blockTarget&&this.renderTurnInto(e.blockTarget),e.showLink&&this.renderLinkButton(!0),e.showDiscuss&&e.blockTarget&&this.renderCommentButton(e.blockTarget),r.a.createElement("div",{style:{display:"flex"}},e.showBold&&this.renderBoldButton(),e.showItalic&&this.renderItalicButton(),e.showUnderline&&this.renderUnderlineButton(),e.showStrikethrough&&this.renderStrikethroughButton(),e.showCode&&this.renderCodeButton(),e.showEquation&&this.renderEquationButton()),e.showHighlight&&r.a.createElement(rr.a,{style:this.getBorderRight()}),e.showMention&&this.renderMention(),e.showActionButton&&e.blockTarget&&this.renderActionButton(e.blockTarget))}renderTurnInto(e){let t=r.a.createElement(ae.FormattedMessage,{defaultMessage:"Turn into",id:"richTextMenu.turnIntoButton.label"});const{intl:a}=this.props,n=e.getType();if(n){const e=Rn.b[n];t=e&&e.displayName||t}return r.a.createElement(Ln.a,{popupType:Ln.a.PopupType.Popup,buttonPopupStore:Jn.a,originGap:4,renderOrigin:e=>r.a.createElement(dt.a,{renderTooltip:()=>a.formatMessage({defaultMessage:"Turn into",id:"richTextMenu.turnIntoButton.tooltip"}),render:a=>r.a.createElement(Et.a,Object.assign({style:lr({display:"flex",alignItems:"center",padding:"0 8px",whiteSpace:"nowrap"},this.getBorderRight())},Object(sn.a)(e,a)),t,ft.a.chevronDown({width:10,marginLeft:4,fill:this.theme.lightIconColor}))}),render:()=>r.a.createElement(fe.b,{menuType:fe.b.MenuType.Popup},r.a.createElement(ue.a,{context:{blocks:[e],environment:this.environment},sections:[vn.r],onAccept:t=>{Qn.a(),me.q(this.environment,{analyticsName:t.analyticsName,from:"rich_text_menu",block_type:e.getType()})}})),onClick:()=>{me.be(this.environment,{action:"turn_into"})}})}renderBoldButton(){return r.a.createElement(Un.a,{type:"b",tooltipLabel:r.a.createElement(n.Fragment,null,r.a.createElement("div",null,r.a.createElement(ae.FormattedMessage,{defaultMessage:"Bold",id:"richTextMenu.boldButton.tooltip"})),r.a.createElement("div",null,r.a.createElement(Vn.a,{style:{color:this.theme.mediumInvertedTextColor},name:"toggleBold"})))},"B")}renderItalicButton(){return r.a.createElement(Un.a,{type:"i",tooltipLabel:r.a.createElement(n.Fragment,null,r.a.createElement("div",null,r.a.createElement(ae.FormattedMessage,{defaultMessage:"Italicize",id:"richTextMenu.italicsButton.tooltip"})),r.a.createElement("div",null,r.a.createElement(Vn.a,{style:{color:this.theme.mediumInvertedTextColor},name:"toggleItalics"})))},r.a.createElement("span",{style:{fontStyle:"italic"}},"i"))}renderStrikethroughButton(){return r.a.createElement(Un.a,{type:"s",tooltipLabel:r.a.createElement(n.Fragment,null,r.a.createElement("div",null,r.a.createElement(ae.FormattedMessage,{defaultMessage:"Strike-through",id:"richTextMenu.strikeThroughButton.tooltip"})),r.a.createElement("div",null,r.a.createElement(Vn.a,{style:{color:this.theme.mediumInvertedTextColor},name:"toggleStrike"})))},r.a.createElement("span",{style:{textDecoration:"line-through"}},"S"))}renderUnderlineButton(){return r.a.createElement(Un.a,{type:"_",tooltipLabel:r.a.createElement(n.Fragment,null,r.a.createElement("div",null,r.a.createElement(ae.FormattedMessage,{defaultMessage:"Underline",id:"richTextMenu.underlineButton.tooltip"})),r.a.createElement("div",null,r.a.createElement(Vn.a,{style:{color:this.theme.mediumInvertedTextColor},name:"toggleUnderline"})))},r.a.createElement("span",{style:{textDecoration:"underline"}},"U"))}renderCodeButton(){return r.a.createElement(Un.a,{type:"c",style:{padding:"0 6px"},tooltipLabel:r.a.createElement(n.Fragment,null,r.a.createElement("div",null,r.a.createElement(ae.FormattedMessage,{defaultMessage:"Mark as code",id:"richTextMenu.markAsCodeButton.tooltip"})),r.a.createElement("div",null,r.a.createElement(Vn.a,{style:{color:this.theme.mediumInvertedTextColor},name:"toggleCode"})))},ft.a.code({width:15,height:15}))}renderLinkButton(e){const t=this.environment.device.isMobile;return r.a.createElement(_n.a,{style:this.getBorderRight()},e&&ft.a.alias({width:t?18:16,height:t?18:16,marginRight:4,fill:this.theme.regularIconColor}),r.a.createElement("span",{style:{borderBottom:"1px solid ".concat(this.theme.linkDecorationColor)}},r.a.createElement(ae.FormattedMessage,{defaultMessage:"Link",id:"richTextMenu.linkButton.tooltip"})),e&&ft.a.chevronDown({width:10,marginLeft:4,fill:this.theme.lightIconColor}))}renderEquationButton(){return r.a.createElement(Wn.a,{style:this.getBorderRight(),onClick:()=>{me.be(this.environment,{action:"e"}),Qn.a()}},ft.a.equation({width:16,height:16}))}renderMention(){return r.a.createElement(dt.a,{renderTooltip:()=>r.a.createElement(n.Fragment,null,r.a.createElement("div",null,r.a.createElement(ae.FormattedMessage,{defaultMessage:"Mention a person,{br}page, or date",id:"richTextMenu.mentionButton.tooltip",values:{br:r.a.createElement("br",null)}})),r.a.createElement("div",{style:{color:this.theme.mediumInvertedTextColor}},"@")),render:e=>r.a.createElement(Et.a,Object.assign({style:lr({},this.getBorderRight(),{padding:"0 8px"})},e,{onClick:()=>{Ta.e(this.environment,{page:!0,createPage:!0,user:!0,bot:!0,date:!0,reminder:!0}),me.be(this.environment,{action:"mention"})}}),ft.a.mention({width:14,fill:this.theme.regularTextColor}))})}renderCommentButton(e){return r.a.createElement(zn.a,{style:this.getBorderRight(),blockStore:e})}renderActionButton(e){return r.a.createElement(Nn.a,{store:e,style:{borderRight:"none",borderRadius:0,padding:0,width:30,height:"none"},iconStyle:{fill:this.theme.regularTextColor},fadeIn:!1,onClick:()=>{me.be(this.environment,{action:"more"})}})}hasNonCollapsedTextSelection(){const e=An.get();return!!e&&!e.collapsed&&"editing"===Va.default.state.mode&&Va.default.state.selection.startIndex!==Va.default.state.selection.endIndex}getTopbarHeight(){const{device:e}=this.environment;return e.isElectronMac?qn.a.desktopMacHeight:qn.a.defaultHeight}getBorderRight(){return{boxShadow:"1px 0 0 ".concat(this.theme.regularDividerColor),marginRight:1}}}dr.richTextMenuBlockTypesBlacklist={[kn.a.factory]:!0},dr.richTextMenuActionsBlacklist={[kn.a.code]:new Set(["showMention","showCode"])},dr.leftOffset=60,dr.height=32;var ur=Object(ae.injectIntl)(dr),pr=a("ox2z"),mr=a("D8Ld"),hr=a("VpJM"),gr=a("w5u6");function fr(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function br(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class yr extends o.a{constructor(){super(...arguments),this.handleContextMenu=(e,t)=>{if(e.preventDefault(),t.misspelledWord){const e=Va.default.state;if("editing"===e.mode&&e.selection.startIndex===e.selection.endIndex){const a=Ra.t(e.store.getValue()||[],t.misspelledWord),n=e.selection.startIndex,r=Ra.v(a,n);r&&Jt.m({store:e.store,selection:r})}}ar.setState({open:!0,menuInfo:t})},this.handleDismiss=()=>{ar.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?fr(Object(a),!0).forEach((function(t){br(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):fr(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},ar.state,{open:!1}))}}willMount(){X.electronApi&&X.electronApi.contextMenu&&X.electronApi.contextMenu.addListener(this.handleContextMenu)}willUnmount(){X.electronApi&&X.electronApi.contextMenu&&X.electronApi.contextMenu.removeListener(this.handleContextMenu)}renderComponent(){const{menuInfo:e,open:t}=ar.state,{device:a}=this.environment,{x:n,y:i}=this.getClickPosition(e),s={bottom:i,top:i,height:0,left:n,right:n,width:0},o=e?this.getMenuSections(e):[],l=document.activeElement,c=An.get();let d=null,u=null;(l instanceof HTMLInputElement||l instanceof HTMLTextAreaElement)&&(d=l.selectionStart,u=l.selectionEnd);for(const r of o)for(const e of r.items){const t=e.action;e.action=e=>{l.focus(),l instanceof HTMLInputElement||l instanceof HTMLTextAreaElement?(l.selectionStart=d,l.selectionEnd=u):c&&An.set(c,a),gr.default.afterNextFlush(()=>{t(e)})}}return r.a.createElement(pe.c,{open:t&&o.length>0,popupType:pe.c.PopupType.Popup,originRect:s,render:()=>r.a.createElement(mr.a,{capture:!0,allowEsc:!0},r.a.createElement(fe.b,{menuType:fe.b.MenuType.Popup},r.a.createElement(Da.a,{type:Da.a.Type.Vertical,sections:o,initialFocus:void 0,onAccept:this.handleDismiss}))),onDismiss:this.handleDismiss,overlayContainerStore:hr.a})}getClickPosition(e){const t=Object(X.getCurrentZoom)();return{x:e?e.x/t:0,y:e?e.y/t:0}}getMenuSections(e){const t=[],a=this.getSpellingCorrectionItems(e);if(a.length>0){const e=t.length>0;t.push({key:"spellingCorrectionItems",items:a,render:t=>r.a.createElement(he.a,Object.assign({},t,{topBorder:e}))})}const n=this.getDisableSpellCheckItems(e);if(n.length>0){const e=t.length>0;t.push({key:"disableSpellCheckItems",items:n,render:t=>r.a.createElement(he.a,Object.assign({},t,{topBorder:e}))})}const i=this.getSearchItems(e);if(i.length>0){const e=t.length>0;t.push({key:"searchItems",items:i,render:t=>r.a.createElement(he.a,Object.assign({},t,{topBorder:e}))})}const s=this.getLinkMenuItems(e);if(s.length>0){const e=t.length>0;t.push({key:"linkMenuItems",items:s,render:t=>r.a.createElement(he.a,Object.assign({},t,{topBorder:e}))})}const o=this.getImageMenuItems(e);if(o.length>0){const e=t.length>0;t.push({key:"imageMenuItems",items:o,render:t=>r.a.createElement(he.a,Object.assign({},t,{topBorder:e}))})}const l=this.getTextEditingItems(e);if(l.length>0){const e=t.length>0;t.push({key:"textEditingItems",items:l,render:t=>r.a.createElement(he.a,Object.assign({},t,{topBorder:e}))})}const c=this.getEnableSpellCheckItem(e);if(c.length>0){const e=t.length>0;t.push({key:"enableSpellCheckItems",items:c,render:t=>r.a.createElement(he.a,Object.assign({},t,{topBorder:e}))})}return t}getLinkMenuItems(e){const t=[];return e.linkURL&&e.linkURL.length>0&&(e.linkURL.startsWith("mailto:")?t.push({key:"copy-email",action:()=>{X.electronApi&&X.electronApi.copyText&&X.electronApi&&X.electronApi.copyText(e.linkText)},render:e=>r.a.createElement(Dt.a,Object.assign({},e,{title:r.a.createElement(ae.FormattedMessage,{defaultMessage:"Copy email address",id:"desktop.rightClickMenu.copyEmailAddress"})}))}):t.push({key:"copy-link",action:()=>{X.electronApi&&X.electronApi.copyText&&X.electronApi&&X.electronApi.copyText(e.linkURL)},render:e=>r.a.createElement(Dt.a,Object.assign({},e,{title:r.a.createElement(ae.FormattedMessage,{defaultMessage:"Copy link",id:"desktop.rightClickMenu.copyLink"})}))}),t.push({key:"open-link",action:()=>{X.electronApi&&X.electronApi.openExternalUrl(e.linkURL)},render:e=>r.a.createElement(Dt.a,Object.assign({},e,{title:r.a.createElement(ae.FormattedMessage,{defaultMessage:"Open link",id:"desktop.rightClickMenu.openLink"})}))})),t}getImageMenuItems(e){const t=[];return e.hasImageContents&&e.srcURL&&e.srcURL.length>0&&(t.push({key:"copy-image",action:()=>{X.electronApi&&X.electronApi.copyImage&&X.electronApi.copyImage(e.srcURL)},render:e=>r.a.createElement(Dt.a,Object.assign({},e,{title:r.a.createElement(ae.FormattedMessage,{defaultMessage:"Copy image",id:"desktop.rightClickMenu.copyImage"})}))}),t.push({key:"copy-image-address",action:()=>{X.electronApi&&X.electronApi.copyText&&X.electronApi.copyText(e.srcURL)},render:e=>r.a.createElement(Dt.a,Object.assign({},e,{title:r.a.createElement(ae.FormattedMessage,{defaultMessage:"Copy image address",id:"desktop.rightClickMenu.copyImageAddress"})}))})),t}isEditing(e){return e.isEditable||e.inputFieldType&&"none"!==e.inputFieldType}hasMisspelling(e){return this.isEditing(e)&&e.misspelledWord&&e.misspelledWord.length>0}getSpellingCorrectionItems(e){const t="SpellCheckStore"in this.environment&&this.environment.SpellCheckStore,a=[];if(this.hasMisspelling(e)&&t&&t.isEnabled()){const n=t.getCorrections(e);for(const e of n)a.push({key:e,action:()=>{X.electronApi&&X.electronApi.replaceMisspelling&&X.electronApi.replaceMisspelling(e)},render:t=>r.a.createElement(Dt.a,Object.assign({},t,{title:e}))})}return a}getDisableSpellCheckItems(e){const t="SpellCheckStore"in this.environment&&this.environment.SpellCheckStore,a=[];return this.hasMisspelling(e)&&t&&t.isEnabled()&&a.push({key:"disable",action:()=>{t.setEnabled(!1)},render:e=>r.a.createElement(Dt.a,Object.assign({},e,{title:r.a.createElement(ae.FormattedMessage,{defaultMessage:"Disable spell check",id:"desktop.spellcheckMenuItem.disableSpellcheck.title"})}))}),a}getEnableSpellCheckItem(e){const t="SpellCheckStore"in this.environment&&this.environment.SpellCheckStore,a=[];return this.isEditing(e)&&t&&!t.isEnabled()&&a.push({key:"enable",action:()=>{t.setEnabled(!0)},render:e=>r.a.createElement(Dt.a,Object.assign({},e,{title:r.a.createElement(ae.FormattedMessage,{defaultMessage:"Enable spell check",id:"desktop.spellcheckMenuItem.enableSpellcheck.title"})}))}),a}getSearchItems(e){const t=[];return e.selectionText&&e.selectionText.length>0&&t.push({key:"google",action:()=>{if(X.electronApi){const t="https://www.google.com/#q=".concat(encodeURIComponent(e.selectionText.trim()));X.electronApi.openExternalUrl(t)}},render:e=>r.a.createElement(Dt.a,Object.assign({},e,{title:r.a.createElement(ae.FormattedMessage,{defaultMessage:"Search with Google",id:"desktop.searchMenuItem.searchWithGoogle.title"})}))}),t}getTextEditingItems(e){const t=[];return this.isEditing(e)&&(e.editFlags.canCut&&t.push({key:"cut",action:()=>{X.electronApi&&X.electronApi.cut&&X.electronApi.cut()},render:e=>r.a.createElement(pr.a,Object.assign({},e,{title:r.a.createElement(ae.FormattedMessage,{defaultMessage:"Cut",id:"desktop.textEditingMenuItem.cutAction.title"}),shortcuts:["cut"]}))}),e.editFlags.canCopy&&t.push({key:"copy",action:()=>{X.electronApi&&X.electronApi.copy&&X.electronApi.copy()},render:e=>r.a.createElement(pr.a,Object.assign({},e,{title:r.a.createElement(ae.FormattedMessage,{defaultMessage:"Copy",id:"desktop.textEditingMenuItem.copyAction.title"}),shortcuts:["copy"]}))}),e.editFlags.canPaste&&t.push({key:"paste",action:()=>{X.electronApi&&X.electronApi.paste&&X.electronApi.paste()},render:e=>r.a.createElement(pr.a,Object.assign({},e,{title:r.a.createElement(ae.FormattedMessage,{defaultMessage:"Paste",id:"desktop.textEditingMenuItem.pasteAction.title"}),shortcuts:["paste"]}))})),t}}var Sr=yr,vr=a("m8rc"),Er=a("du8U");function Mr(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}function Cr(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function wr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Cr(Object(a),!0).forEach((function(t){Or(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Cr(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Or(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class kr extends o.a{constructor(){super(...arguments),this.handleChangeValue=e=>{if(!e)return void this.removeDateAnnotation();const t=this.getEverythingIWant();if(!t)return;const{date_format:a,time_format:n}=t;this.setDateAnnotationData(wr({date_format:a,time_format:n},e))},this.handleChangeDateFormat=e=>{const t=this.getEverythingIWant();if(!t)return;const{dateValue:a,time_format:n}=t;this.setDateAnnotationData(wr({date_format:e,time_format:n},a))},this.handleChangeTimeFormat=e=>{const t=this.getEverythingIWant();if(!t)return;const{dateValue:a,date_format:n}=t;this.setDateAnnotationData(wr({date_format:n,time_format:e},a))},this.setDateAnnotationData=e=>{const t=this.getEverythingIWant();if(!t)return;const{textStore:a,textValue:n,tokenIndex:r,annotations:i}=t,s=n.map((t,a)=>{if(a===r){const a=i.map(t=>Ra.qb(t)?["d",e]:t);return Ra.n(t[0],a)}return t});zt.createAndCommit(this.environment,e=>{Xt.c({store:a,value:s,transaction:e})})},this.removeDateAnnotation=()=>{const e=this.getEverythingIWant();if(!e)return;const{textStore:t,textValue:a,tokenIndex:n}=e,r=a.filter((e,t)=>t!==n);zt.createAndCommit(this.environment,e=>{Xt.c({store:t,value:r,transaction:e})})}}renderComponent(){const{device:e}=this.environment,t=Er.a.state;return r.a.createElement(pe.c,{popupType:e.isMobile?pe.c.PopupType.SlideUp:pe.c.PopupType.Popup,open:t.open,originRect:t.originRect,onDismiss:vr.a,render:()=>{const e=this.getEverythingIWant();if(!e)return null;const{date_format:a,time_format:n,dateValue:i}=e;return r.a.createElement(re.DependencyConsumer,{dependency:re.deps.menus},e=>{let{DatePropertyMenu:s}=e;return r.a.createElement(s,{firstDayOfWeek:T.q.state,value:i,locked:!1,onChangeValue:this.handleChangeValue,dateFormat:a,onChangeDateFormat:this.handleChangeDateFormat,timeFormat:n,onChangeTimeFormat:this.handleChangeTimeFormat,onDismiss:vr.a,disabled:!1,shouldShowReminder:!!t.open&&t.allowReminders})})}})}getEverythingIWant(){const e=Er.a.state;if(e.open){const{textStore:t,tokenIndex:a}=e,n=t.getValue();if(n){const e=n[a];if(e){const r=Ra.db(e),i=Ra.x(r);if(i){const s=Ra.J(i),{date_format:o,time_format:l}=s;return{textStore:t,textValue:n,tokenIndex:a,token:e,annotations:r,date_format:o,time_format:l,dateValue:Mr(s,["date_format","time_format"])}}}}}}}var Pr=kr,Tr=a("/6eU"),Dr=a("bjn0"),Ir=a("Etmo"),Fr=a("ZQ9l"),jr=a("OxuQ"),xr=a("bFnu");function Br(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ar(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Br(Object(a),!0).forEach((function(t){Rr(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Br(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Rr(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Lr extends o.a{constructor(){super(...arguments),this.storeTypes={mouseStore:xr.a},this.handleMouseEnter=()=>{this.stores.mouseStore.setState(Ar({},this.stores.mouseStore.state,{mouseEntered:!0}))},this.handleMouseLeave=()=>{this.stores.mouseStore.setState(Ar({},this.stores.mouseStore.state,{mouseEntered:!1}))},this.handleMouseDown=()=>{this.stores.mouseStore.setState(Ar({},this.stores.mouseStore.state,{mousePressed:!0}))},this.handleMouseUp=()=>{this.stores.mouseStore.setState(Ar({},this.stores.mouseStore.state,{mousePressed:!1}))},this.handleWindowMouseUp=()=>{this.stores.mouseStore.setState(Ar({},this.stores.mouseStore.state,{mousePressed:!1,mouseEntered:!1}))}}willMount(){Object(g.a)(window,"mouseup",this.handleWindowMouseUp)}willUnmount(){Object(g.b)(window,"mouseup",this.handleWindowMouseUp)}renderComponent(){const{mouseEntered:e,mousePressed:t}=this.stores.mouseStore.state;return this.props.render({mouseEntered:e,mousePressed:t,events:{onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp}})}}var Ur=Lr;function _r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Wr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?_r(Object(a),!0).forEach((function(t){Nr(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):_r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Nr(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class qr extends o.a{renderComponent(){const{device:e}=this.environment,{title:t,caption:a,image:n,onClick:i}=this.props;return r.a.createElement(Ur,{render:s=>{let{mouseEntered:o,events:l}=s;return r.a.createElement("div",Object.assign({},l,{onClick:i,style:this.getWrapStyle(o)}),r.a.createElement("img",{src:n,style:this.getImageStyle(o)}),r.a.createElement("div",{style:this.getInfoStyle()},r.a.createElement("div",{style:this.getTitleStyle()},r.a.createElement("span",{style:this.getMobileTitleStyle()},t)),!e.isMobile&&r.a.createElement("div",{style:this.getCaptionStyle()},a)))}})}getWrapStyle(e){const{device:t}=this.environment;return Wr({display:"flex",flexDirection:t.isMobile?"column":"row",alignItems:"center",flexGrow:0},e&&{cursor:"pointer"},{},t.isMobile?{padding:"12px 4px 16px"}:{marginBottom:8})}getImageStyle(e){const{device:t}=this.environment,{selected:a}=this.props,n=(()=>a?"0 0 0 2px ".concat(Ze.f.blue):e?"0 0 0 2px ".concat(this.theme.darkDividerColor):"0 0 0 1px ".concat(this.theme.darkDividerColor))(),r=t.isMobile?"42vw":"169px";return{display:"flex",flexDirection:"column",borderRadius:3,boxShadow:n,transition:"box-shadow 200ms ease-out",marginTop:8,marginBottom:t.isMobile?12:8,height:"calc(".concat(r," / (169 / 97))"),maxHeight:97,maxWidth:r}}getInfoStyle(){const{device:e}=this.environment;return Wr({display:"flex",flexDirection:"column"},!e.isMobile&&{marginLeft:16})}getTitleStyle(){const{device:e}=this.environment,{selected:t}=this.props;return Wr({display:"flex",fontSize:14},t&&!e.isMobile&&{fontWeight:600},{marginBottom:2},e.isMobile&&{justifyContent:"center"})}getMobileTitleStyle(){const{device:e}=this.environment,{selected:t}=this.props;return e.isMobile?Wr({fontSize:12,padding:"2px 10px",borderRadius:20,textAlign:"center"},t&&{background:Ze.f.blue,color:Ze.f.white}):{}}getCaptionStyle(){return{fontSize:12,color:this.theme.mediumTextColor}}}var Vr=qr,zr=a("Erf6"),Hr=a("Ng05"),Gr=a("IULH"),Qr=a("sSHh");function Yr(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Zr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Yr(Object(a),!0).forEach((function(t){Xr(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Yr(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Xr(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Kr extends o.a{constructor(){super(...arguments),this.storeTypes={databaseSearchButtonPopupStore:Ka.a},this.renderDesktopModalContent=()=>{const{currentBlockStore:e}=U.default.state,t=zr.a.state;if(t.open&&e)return r.a.createElement("div",{style:Kr.modalStyle},r.a.createElement("div",{style:Kr.modalHeaderStyle},r.a.createElement(ae.FormattedMessage,{id:"database.relationProperty.createModal.header",defaultMessage:"Create a relation to another database"})),r.a.createElement("div",{style:Kr.sourceSectionStyle},r.a.createElement("div",{style:Kr.defaultTextStyle},r.a.createElement(ae.FormattedMessage,{id:"database.relationProperty.createModal.description",defaultMessage:"A relation allows you to link pages from other databases."})),this.renderDatabaseButtonPopup()),t.relationCollectionId===t.targetCollectionId&&r.a.createElement("div",{style:Kr.selfRelationSectionStyle},r.a.createElement("div",{style:Kr.defaultTextStyle},r.a.createElement(ae.FormattedMessage,{id:"database.relationProperty.createModal.selfRelationPrompt",defaultMessage:"You selected the same database. In which property should the linked pages appear?"})),this.renderSelfRelationConfigure()),r.a.createElement("div",{style:{display:"flex",alignItems:"center"}},r.a.createElement(Qr.a,{title:r.a.createElement(ae.FormattedMessage,{id:"database.relationProperty.createModal.helpCenterLink",defaultMessage:"Learn about relations"}),href:Object(Me.a)("guides.relations"),analyticsFrom:"configure_relation_modal"}),r.a.createElement(Gr.a,{isLarge:!0,style:{marginLeft:"auto",marginRight:12},onClick:this.handleCancelClick},r.a.createElement(ae.FormattedMessage,{id:"database.relationProperty.createModal.cancelButton",defaultMessage:"Cancel"})),r.a.createElement(Hr.a,{isLarge:!0,onClick:this.handleDoneClick,disabled:!this.canAccept()},r.a.createElement(ae.FormattedMessage,{id:"database.relationProperty.createModal.confirmButton",defaultMessage:"Create relation"}))))},this.renderMobilePopupContent=()=>{const e=zr.a.state;if(e.open)return r.a.createElement(fe.b,{menuType:fe.b.MenuType.Modal,right:r.a.createElement(Ee.DoneMenuText,null),left:r.a.createElement(Ee.CancelMenuText,null),title:r.a.createElement(ae.FormattedMessage,{id:"database.relationProperty.createModal.databaseSelect.label",defaultMessage:"Select a database"}),onClickRight:this.handleDoneClick,onClickLeft:this.handleCancelClick,rightDisabled:!this.canAccept()},r.a.createElement(he.a,{title:r.a.createElement(ae.FormattedMessage,{id:"database.relationProperty.createModal.databaseSelect.mobile.title",defaultMessage:"Database source"})},r.a.createElement(Fr.a,{title:this.renderDatabaseButtonPopup()})),r.a.createElement("div",{style:this.getMobileSectionCaption()},r.a.createElement(ae.FormattedMessage,{id:"database.relationProperty.createModal.databaseSelect.mobile.caption",defaultMessage:"The database you wish to link to."})),e.relationCollectionId===e.targetCollectionId&&r.a.createElement(n.Fragment,null,r.a.createElement("div",{style:Zr({},this.getMobileSectionHeading(),{marginTop:28})},r.a.createElement(ae.FormattedMessage,{id:"database.relationProperty.createModal.selfRelationPrompt.mobileTitle",defaultMessage:"Self-relation type"})),r.a.createElement("div",{style:this.getMobileSectionCaption()},r.a.createElement(ae.FormattedMessage,{id:"database.relationProperty.createModal.selfRelationPrompt",defaultMessage:"You selected the same database. In which property should the linked pages appear?"})),r.a.createElement(he.a,{disableMobilePadding:!0},r.a.createElement(Fr.a,{title:this.renderSelfRelationConfigure()})),r.a.createElement("div",{style:this.getMobileSectionCaption()},this.renderSelfRelationCaption(e.selfRelationType))),r.a.createElement(he.a,null,r.a.createElement(ve.a,{title:r.a.createElement(ae.FormattedMessage,{id:"database.relationProperty.createModal.helpCenterLinkMobile",defaultMessage:"Learn about relations"}),href:Object(Me.a)("guides.relations"),analyticsFrom:"configure_relation_modal"})))},this.renderDatabaseButtonPopupOrigin=e=>{const{device:t}=this.environment,{currentBlockStore:a}=U.default.state;if(zr.a.state.open&&a)return t.isMobile?r.a.createElement(Et.a,Object.assign({mobileFeedback:!0,style:{width:"100%"}},e),this.getButtonTitle()):r.a.createElement(Gr.a,Object.assign({isLarge:!0,style:{width:"100%"}},e),this.getButtonTitle(),ft.a.chevronDown({width:10,marginLeft:4,fill:this.theme.lightIconColor}))},this.renderDatabaseButtonPopupContent=()=>{const{device:e}=this.environment,{currentBlockStore:t}=U.default.state,a=zr.a.state;if(!a.open||!t)return;const i={request:a.collectionSearchQuery,debounce:kt.b,performRequest:this.getCollectionAutocompleteItems,render:(i,s,o)=>{let l;if(i&&(l=r.a.createElement(he.a,null,r.a.createElement(ja.a,{title:"Something went wrong."}))),o||(l=r.a.createElement(he.a,null,r.a.createElement(ja.a,{title:"Loading..."}))),s&&0===s.length)l=r.a.createElement(he.a,null,r.a.createElement(ja.a,{title:this.props.intl.formatMessage({id:"database.relationProperty.createModal.noResults",defaultMessage:"No results"})}));else{const e=(s||[]).map(e=>{const a=Dr.a.createChildStore(t,{table:Gn.a,id:e});return{key:e,render:e=>r.a.createElement(Fa.a,Object.assign({store:a},e)),action:()=>{this.handleSelectCollection(e)}}});l=r.a.createElement(Da.a,{type:Da.a.Type.Vertical,initialFocus:a.collectionSearchQuery?0:void 0,sections:[{key:"results",render:e=>r.a.createElement(he.a,Object.assign({},e)),items:e}]})}return e.isMobile?r.a.createElement(n.Fragment,null,l):r.a.createElement("div",{style:Kr.customPopupStyle},l)}},s=r.a.createElement(he.a,{isInput:!0},this.renderDatabaseInputMenuItem());let o;return o=e.isMobile?{menuType:fe.b.MenuType.Modal,title:r.a.createElement(ae.FormattedMessage,{id:"database.relationProperty.createModal.databaseSelect.label",defaultMessage:"Select a database"}),right:r.a.createElement(Ee.DoneMenuText,null),header:s,onClickRight:this.handleDatabaseSearchDoneClick}:{menuType:fe.b.MenuType.Popup,width:"100%",header:s},r.a.createElement(fe.b,Object.assign({},o),r.a.createElement(Ot.a,Object.assign({},i)))},this.handleSamePropertyClick=()=>{const e=zr.a.state;e.open&&zr.a.setState(Zr({},e,{selfRelationType:"same_property"}))},this.handleSeparatePropertyClick=()=>{const e=zr.a.state;e.open&&zr.a.setState(Zr({},e,{selfRelationType:"separate_property"}))},this.getCollectionAutocompleteItems=async e=>kt.c(this.environment,{query:e,limit:20,source:"relation_setup_menu"}),this.handleDatabaseSearchInputChange=e=>{const t=zr.a.state;t.open&&zr.a.setState(Zr({},t,{collectionSearchQuery:e.target.value}))},this.handleSelectCollection=e=>{const t=zr.a.state;t.open&&(zr.a.setState(Zr({},t,{targetCollectionId:e})),this.stores.databaseSearchButtonPopupStore.setState({open:!1}))},this.handleDatabaseSearchDoneClick=()=>{this.stores.databaseSearchButtonPopupStore.setState({open:!1})},this.handleCancelClick=()=>{Ir.b()},this.handleDoneClick=()=>{Ir.a(this.environment)},this.handleDatabaseButtonPopupClick=()=>{const e=zr.a.state;e.open&&zr.a.setState(Zr({},e,{collectionSearchQuery:""}))}}renderComponent(){const{device:e}=this.environment,{open:t}=zr.a.state;return e.isMobile?r.a.createElement(pe.a,{popupType:pe.b.SlideUp,alignmentToOrigin:pe.a.Alignment.Start,open:t,render:this.renderMobilePopupContent,onDismiss:Ir.b}):r.a.createElement(Tr.a,{open:t,render:this.renderDesktopModalContent,onDismiss:Ir.b})}renderSelfRelationConfigure(){const e=zr.a.state;if(e.open)return r.a.createElement("div",{style:this.getSelfRelationButtonWrapStyle()},r.a.createElement(Vr,{title:r.a.createElement(ae.FormattedMessage,{id:"database.relationProperty.createModal.selfRelationPrompt.createNewPropertyOption.title",defaultMessage:"Create a new property"}),caption:this.renderSelfRelationCaption("separate_property"),image:rn.a.images.selfRelationSeparateSvg,selected:"separate_property"===e.selfRelationType,onClick:this.handleSeparatePropertyClick}),r.a.createElement(Vr,{title:r.a.createElement(ae.FormattedMessage,{id:"database.relationProperty.createModal.selfRelationPrompt.samePropertyOption.title",defaultMessage:"Use the same property"}),caption:this.renderSelfRelationCaption("same_property"),image:rn.a.images.selfRelationSameSvg,selected:"same_property"===e.selfRelationType,onClick:this.handleSamePropertyClick}))}getButtonTitle(){const{currentBlockStore:e}=U.default.state,t=zr.a.state;if(t.open&&e){if(t.targetCollectionId){const a=Dr.a.createChildStore(e,{table:Gn.a,id:t.targetCollectionId});return r.a.createElement("div",{style:{display:"flex",alignItems:"center"}},r.a.createElement(Yt.a,{disabled:!0,icon:a.getIcon(),isEmptyPage:!1,size:20}),r.a.createElement(jr.a,{store:a,style:{margin:"0 6px"}}))}return r.a.createElement("span",{style:{color:this.theme.mediumTextColor}},r.a.createElement(ae.FormattedMessage,{id:"database.relationProperty.createModal.databaseSelect.label",defaultMessage:"Select a database"}))}}renderDatabaseButtonPopup(){const{device:e}=this.environment;return r.a.createElement(Ln.a,{popupType:e.isMobile?pe.b.SlideUp:pe.b.Popup,renderOrigin:this.renderDatabaseButtonPopupOrigin,render:this.renderDatabaseButtonPopupContent,buttonPopupStore:this.stores.databaseSearchButtonPopupStore,onClick:this.handleDatabaseButtonPopupClick,style:{width:440}})}renderDatabaseInputMenuItem(){const e=zr.a.state;if(e.open)return r.a.createElement(ge.a,{focus:!0,focusAfterAnimation:!0,value:e.collectionSearchQuery,onChange:this.handleDatabaseSearchInputChange,placeholder:this.props.intl.formatMessage({id:"database.relationProperty.createModal.databaseSelect.placeholder",defaultMessage:"Search for a database…"})})}renderSelfRelationCaption(e){var t=this;return"same_property"===e?r.a.createElement(n.Fragment,null,r.a.createElement(ae.FormattedMessage,{id:"database.relationProperty.createModal.selfRelationPrompt.createNewPropertyOption.caption",defaultMessage:'<b>No syncing.</b> Use this option when modeling a "Related tasks" property in a "Task" database.',values:{b:function(){for(var e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];return r.a.createElement("b",{style:{color:t.theme.regularTextColor}},a)}}})):r.a.createElement(n.Fragment,null,r.a.createElement(ae.FormattedMessage,{id:"database.relationProperty.createModal.selfRelationPrompt.samePropertyOption.caption",defaultMessage:'<b>Sync both ways.</b> Use this option when modeling "Parent Task" and "Child Task" properties in a "Task" database.',values:{b:function(){for(var e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];return r.a.createElement("b",{style:{color:t.theme.regularTextColor}},a)}}}))}canAccept(){const e=zr.a.state;return e.open&&e.targetCollectionId}getSelfRelationButtonWrapStyle(){const{device:e}=this.environment;return{display:"flex",flexDirection:e.isMobile?"row":"column",justifyContent:"space-between"}}getMobileSectionHeading(){return{marginTop:8,marginRight:16,marginBottom:8,marginLeft:16,fontSize:12,textTransform:"uppercase",color:this.theme.mediumTextColor}}getMobileSectionCaption(){return{marginTop:8,marginRight:16,marginBottom:8,marginLeft:16,fontSize:12,color:this.theme.mediumTextColor}}}Kr.defaultTextStyle={marginBottom:8,fontSize:14},Kr.modalStyle={padding:30,width:538},Kr.modalHeaderStyle={fontWeight:600,marginBottom:20},Kr.sourceSectionStyle={marginBottom:30},Kr.selfRelationSectionStyle={marginBottom:30},Kr.customPopupStyle={maxHeight:"24vh"};var Jr=Object(ae.injectIntl)(Kr),$r=(a("pIFo"),a("QmC8")),ei=a("AXyr");function ti(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ai(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ti(Object(a),!0).forEach((function(t){ni(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ti(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function ni(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class ri extends o.a{constructor(){super(...arguments),this.renderModal=()=>{if(!this.lastOpenState)return;const{acceptLabel:e,requiredInputValue:t}=this.lastOpenState,a=[{key:"accept",render:t=>r.a.createElement(Gr.a,Object.assign({isRed:!0,isLarge:!0,style:ri.buttonStyle,hovered:t.focused},t),e),action:this.handleAccept},{key:"cancel",render:e=>r.a.createElement(Gr.a,Object.assign({isLarge:!0,style:ri.buttonStyle,hovered:e.focused},e),r.a.createElement(ae.FormattedMessage,{id:"confirmationInputDialog.cancelButton.label",defaultMessage:"Cancel"})),action:this.handleCancel}];return r.a.createElement(He.a,{capture:!0},r.a.createElement("div",null,r.a.createElement("div",{style:{minHeight:64,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:16}},this.lastOpenState.message),r.a.createElement(Te.b,{value:this.lastOpenState.inputValue,onChange:this.handleInputChange,style:{height:38,marginBottom:2},placeholder:t}),r.a.createElement(Da.a,{type:Da.a.Type.Vertical,initialFocus:void 0,sections:[{key:"dialog",render:e=>r.a.createElement(he.a,Object.assign({},e)),items:a}]})))},this.handleAccept=()=>{const e=$r.a.state;e.open&&(this.cleanAcceptInput(e.inputValue)===this.cleanAcceptInput(e.requiredInputValue)?ei.a({didConfirm:!0}):ba.showErrorMessage(r.a.createElement(ae.FormattedMessage,{id:"confirmDialogInput.incorrectInputError.message",defaultMessage:'Please type "{requiredInputValue}" to continue',values:{requiredInputValue:e.requiredInputValue}})))},this.cleanAcceptInput=e=>e.trim().toLowerCase().replace(/’/g,"'"),this.handleCancel=()=>{ei.a({didConfirm:!1})},this.handleInputChange=e=>{const t=$r.a.state;t.open&&$r.a.setState(ai({},t,{inputValue:e.target.value}))}}renderComponent(){const e=$r.a.state;return e.open&&(this.lastOpenState=ai({},e)),r.a.createElement(Tr.a,{open:e.open,keepFocus:!0,overlayZIndex:Ve.a,onDismiss:this.handleCancel,preventHideChildrenWhileOpening:!0,innerStyle:{borderRadius:3,paddingTop:24,paddingBottom:16,paddingLeft:32,paddingRight:32,width:this.lastOpenState&&this.lastOpenState.width||336,fontSize:16,boxShadow:this.theme.largeBoxShadow,background:this.theme.contentBackground,maxHeight:"90vh",overflowY:"scroll",marginLeft:24,marginRight:24},render:this.renderModal})}}ri.buttonStyle={width:"100%",marginTop:16};var ii=ri,si=a("NbyO"),oi=a("mKX5"),li=a("lk/1"),ci=a("922z"),di=a("8fuX"),ui=a("zK7c"),pi=a("XBB3"),mi=a("lBar"),hi=a("g90h"),gi=a("G+Ai"),fi=a("zgcg");function bi(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function yi(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?bi(Object(a),!0).forEach((function(t){Si(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):bi(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Si(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class vi extends o.a{constructor(){super(...arguments),this.handleOverrideLinkClick=e=>{Object(si.b)(),Y.navigate({environment:this.environment,url:e})},this.loadSnapshot=async e=>{const{timestamp:t}=e,a=e.block?e.block.id:e.blockId;if(!a)throw new Error("Could not construct a pointer.");const n=await H.getSnapshotContents(this.environment,e);if("failed"===n.type)throw n.error;const r=new ci.a(n.data.contentMap),i=this.environment.currentUser.id,s=new li.a;for(const{pointer:p,value:g}of r)g&&s.setRecord({pointer:p,userId:i},yi({},g,{role:"reader"}));s.snapshotData={blockId:a,timestamp:t};const o=new Set,l=[];for(const{pointer:p,value:g}of r){if(p.table!==b.b||!g||!g.value)continue;const{value:e}=g,t=e,a=[...Ha.e(t),...Ha.z(t)?[]:t.content||[]];for(const n of a){if(!s.getRecord({pointer:{table:b.b,id:n},userId:i})&&Object(hi.f)(n)&&!o.has(n)){o.add(n);const e=Object(z.c)(this.props.blockStore,{table:b.b,id:n});e&&l.push(e)}}}const c=new Set,d=new Set;for(const{pointer:p,value:g}of r){if(!g||!g.value)continue;const{table:e}=p,{value:t}=g;if(e===b.b){const e=t;for(const t of Ha.k(e))c.add(t);e.created_by_table&&e.created_by_id&&(e.created_by_table===za.a?c.add(e.created_by_id):d.add(e.created_by_id)),e.last_edited_by_table&&e.last_edited_by_id&&(e.last_edited_by_table===za.a?c.add(e.last_edited_by_id):d.add(e.last_edited_by_id))}else if(e===Hn.a){const e=t;e.created_by_id&&e.created_by_table&&(e.created_by_table===za.a?c.add(e.created_by_id):d.add(e.created_by_id))}}const u=p.a.compact(Array.from(c).map(e=>Object(z.c)(this.props.blockStore,{table:za.a,id:e}))),m=p.a.compact(Array.from(d).map(e=>Object(z.c)(this.props.blockStore,{table:gi.a,id:e}))),h=[...l,...u,...m];return await Promise.all(h.map(async e=>{await e.load();const t=e.getValue();t&&s.setRecord({pointer:{table:e.table,id:t.id},userId:i},{role:"reader",value:t})})),{blockStore:new f.a(this.environment,{table:b.b,id:a},{inMemoryRecordCache:s}),timestamp:t}}}getChildContext(){return yi({},this.context,{overrideLinkClick:this.handleOverrideLinkClick})}renderComponent(){const e={request:{blockId:this.props.blockStore.id,timestamp:this.props.timestamp},performRequest:this.loadSnapshot,render:(e,t,a)=>r.a.createElement(xa.a,{show:!a||!t,showDelay:400,showHold:400,render:a=>a?r.a.createElement("div",{style:this.getSpinnerWrapperStyles()},r.a.createElement(Pt.a,null)):e?r.a.createElement("div",{style:{padding:32}},r.a.createElement(ae.FormattedMessage,{defaultMessage:"Something went wrong.",id:"pageSnapshotPreview.unknownPreviewLoadError.message"})):t?r.a.createElement(ui.a,{key:t.timestamp,store:t.blockStore,isDefaultContainer:!0,render:e=>r.a.createElement(di.b,Object.assign({style:{background:this.theme.contentBackground,zIndex:1,flexGrow:1},type:this.useSeparateHorizontalScroller(t.blockStore)?di.a.Y:di.a.All},e),r.a.createElement(pi.b,{store:t.blockStore,disabled:!0,loadingContainerStore:void 0,context:pi.a.InAppTemplatePreview,paddingBottom:pi.b.paddingBottom(this.environment),paddingLeft:pi.b.defaultPaddingLeftRight(this.environment),paddingRight:pi.b.defaultPaddingLeftRight(this.environment),pageCoverHeight:pi.b.defaultPageCoverHeight(this.environment)}))}):void 0})};return r.a.createElement(Ot.a,Object.assign({},e))}useSeparateHorizontalScroller(e){return!e.isCollectionView()||!mi.b(this.environment)}getSpinnerWrapperStyles(){return{padding:32,display:"flex",alignItems:"center",justifyContent:"center"}}}vi.contextTypes=o.b,vi.childContextTypes=fi.a;var Ei=vi,Mi=a("cYwG");class Ci extends o.a{constructor(){super(...arguments),this.handleScroll=e=>{if(this.props.loading)return;e>(this.props.loadMoreOffsetThreshold||200)||this.props.resultSize>=this.props.fetchSize&&this.props.onLoadMore()}}renderComponent(){return r.a.createElement(Mi.a,{onChange:this.handleScroll})}}var wi=Ci,Oi=a("DbeH"),ki=a("j9U3"),Pi=a("7KuZ"),Ti=a("1G+a");function Di(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ii(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Di(Object(a),!0).forEach((function(t){Fi(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Di(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Fi(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class ji extends o.a{constructor(){super(...arguments),this.renderSnapshotsListRequest=()=>{const{device:e}=this.environment,t=ki.a.state;if(!t.open)return;const a={request:{blockId:t.blockStore.id,size:t.size},performRequest:e=>this.loadSnapshotsList(e,t),render:(a,n,i)=>r.a.createElement(xa.a,{show:Boolean(!n||n.snapshots.length>=t.size&&t.openSnapshotNearTimestamp),showDelay:400,showHold:100,render:r=>e.isMobile?this.renderMobileHistory({snapshotValues:n?n.snapshots:[],menuState:t,error:a,initialLoading:r,loadingMore:!i}):this.renderDesktopHistory({snapshotValues:n?n.snapshots:[],menuState:t,error:a,initialLoading:r,loadingMore:!i})})};return r.a.createElement(Ot.a,Object.assign({},a))},this.renderMobileHistory=e=>{let t,a;return this.historyIsEnabled()?e.loadingMore||0!==e.snapshotValues.length||(t=this.renderUnavailableMessage(ji.noSnapshotsMessage,!1)):t=this.renderUnavailableMessage(this.getUnavailableMessage(),bt.k(this.environment)||"team"),a=e.error?r.a.createElement("div",{style:ji.wrapStyle},r.a.createElement(ae.FormattedMessage,{defaultMessage:"Something went wrong",id:"historyModal.errorMessage"})):e.initialLoading?r.a.createElement("div",{style:ji.wrapStyle},r.a.createElement(Pt.a,null)):r.a.createElement(n.Fragment,null,r.a.createElement(di.b,{type:di.a.Y},this.renderSnapshotsMenuList(e)),this.renderMobileSnapshotPreview(e.menuState)),r.a.createElement(fe.b,{menuType:fe.b.MenuType.Modal,title:r.a.createElement(ae.FormattedMessage,{defaultMessage:"History",id:"historyModal.mobileHistoryMenu.title"}),left:this.renderMobileHelpButton(),right:r.a.createElement(Ee.DoneMenuText,null),onClickRight:si.b,header:t},a)},this.renderDesktopHistory=e=>{let t;return t=e.error?r.a.createElement("div",{style:ji.wrapStyle},r.a.createElement(ae.FormattedMessage,{defaultMessage:"Something went wrong",id:"historyModal.desktopModal.errorMessage"})):e.initialLoading?r.a.createElement("div",{style:ji.wrapStyle},r.a.createElement(Pt.a,null)):this.historyIsEnabled()?e.menuState.snapshot&&!this.snapshotIsAvailable(e.menuState.snapshot)?this.renderUnavailableMessage(ji.restrictedMessage,"enterprise"):e.loadingMore||0!==e.snapshotValues.length?this.renderDesktopSnapshotPreview(e.menuState):this.renderUnavailableMessage(ji.noSnapshotsMessage,!1):this.renderUnavailableMessage(this.getUnavailableMessage(),bt.k(this.environment)||"team"),r.a.createElement(n.Fragment,null,r.a.createElement("div",{style:{display:"flex",flexDirection:"column",width:"calc(100% - ".concat(ji.sidebarWidth,"px)"),boxShadow:"1px 0 0 ".concat(this.theme.regularDividerColor)}},t),this.renderDesktopSidebar(e))},this.renderSnapshotsMenuList=e=>{const{device:t}=this.environment,{menuState:a,loadingMore:i}=e,s=p.a.compact(e.snapshotValues.map(e=>{const n=this.snapshotIsAvailable(e);return{key:e.id,action:()=>{si.f(this.environment,e)},render:i=>{const s=e.authors||[],o=this.props.intl.formatList(p.a.compact(s.map((e,t)=>{if(e.table===za.a){const t=Object(z.c)(a.blockStore,e).getValue();if(!t)return;return Object(za.e)(t)}{const t=Object(z.c)(a.blockStore,e).getValue();if(!t)return;return t.name}})),{type:"conjunction",style:"narrow"}),l=r.a.createElement("div",{style:Ii({},Qe.a.textOverflowStyle)},o),c=Boolean(a.snapshot&&a.snapshot.id===e.id);if(n){const a=Object(oi.a)(parseInt(e.timestamp)).format("lll");return r.a.createElement(dt.a,{key:i.key,render:a=>r.a.createElement(Dt.a,Object.assign({},Object(sn.a)(i,a),{title:Object(oi.a)(parseInt(e.timestamp)).calendar(),focused:!t.isMobile&&c,caption:l})),renderTooltip:()=>r.a.createElement("div",{style:{maxWidth:270,whiteSpace:"normal"}},r.a.createElement("div",null,a),r.a.createElement("div",null,o))})}{const a=!this.historyIsEnabled();return r.a.createElement(dt.a,{key:i.key,render:n=>r.a.createElement(Dt.a,Object.assign({},Object(sn.a)(n,i),{title:r.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},r.a.createElement("div",{style:Ii({},t.isMobile&&{display:"flex",flex:1},{},Qe.a.textOverflowStyle)},Object(oi.a)(parseInt(e.timestamp)).calendar()),!a&&r.a.createElement(ut.a,{subscriptionTier:"enterprise",analyticsName:"history_modal",desktopStyle:{marginLeft:8},onClick:()=>this.handleUpgrade("enterprise")})),focused:!t.isMobile&&c,disabled:a,caption:l})),renderTooltip:()=>r.a.createElement(ae.FormattedMessage,{defaultMessage:"Upgrade to view this snapshot.",id:"historyModal.snapshotsMenuList.upgrade.tooltip"}),disableTooltip:!a})}}}})),o=a.snapshot&&a.snapshot.id,l=s.findIndex(e=>o===e.key),c=[{key:"snapshots",render:e=>r.a.createElement(he.a,Object.assign({},e)),items:s}];return r.a.createElement(n.Fragment,null,r.a.createElement(Da.a,{type:Da.a.Type.Vertical,initialFocus:l,sections:c}),r.a.createElement(wi,{loading:i,fetchSize:a.size,resultSize:e.snapshotValues.length,onLoadMore:si.c}),r.a.createElement(xa.a,{show:i,showDelay:300,showHold:100,render:e=>e&&r.a.createElement("div",{style:ji.wrapStyle},r.a.createElement(Pt.a,null))}))},this.handleUpgrade=e=>{Oi.a(this.environment,{from:"history_modal",for:e})},this.loadSnapshotsList=async(e,t)=>{const{device:a}=this.environment,n=await H.getSnapshotsList(this.environment,e);if("failed"===n.type)throw n.error;const{snapshots:r}=n.data;if(t.openSnapshotNearTimestamp){const e=parseInt(t.openSnapshotNearTimestamp),a=r.findIndex(t=>parseInt(t.timestamp)<e);0===r.length||(0===a?si.f(this.environment,r[a]):a>0?si.f(this.environment,r[a-1]):r.length<t.size?si.f(this.environment,r[r.length-1]):si.c())}else Boolean(t.snapshot)||a.isMobile||ki.a.setState(Ii({},t,{snapshot:r[0]}));return n.data},this.iconSize=()=>{const{device:e}=this.environment;return e.isMobile?24:20}}renderComponent(){const{device:e}=this.environment,t=ki.a.state;return e.isMobile?r.a.createElement(pe.c,{popupType:pe.c.PopupType.SlideUp,open:t.open,render:this.renderSnapshotsListRequest,onDismiss:si.b}):r.a.createElement(Tr.a,{open:t.open,innerStyle:{height:"80vh",width:"80vw",overflow:"hidden",display:"flex"},onDismiss:si.b,render:this.renderSnapshotsListRequest,className:Ft.B})}renderMobileSnapshotPreview(e){if(this.historyIsEnabled())return r.a.createElement(pe.c,{popupType:pe.c.PopupType.SlideUp,open:Boolean(e.snapshot),forceFullScreenSlideUp:!0,render:()=>{if(!e.snapshot)return;const t=this.snapshotIsAvailable(e.snapshot),a=t?r.a.createElement(Ei,{blockStore:e.blockStore,timestamp:e.snapshot.timestamp}):this.renderUnavailableMessage(ji.restrictedMessage,"enterprise");return r.a.createElement(fe.b,{menuType:fe.b.MenuType.Modal,title:Object(oi.a)(parseInt(e.snapshot.timestamp)).calendar(),right:r.a.createElement(Ee.DoneMenuText,null),onClickRight:si.a,leftDisabled:!t,left:r.a.createElement(ae.FormattedMessage,{defaultMessage:"Restore",id:"historyModal.mobileSnapshotMenu.restoreButton.label"}),onClickLeft:()=>si.e(this.environment),whiteBackground:t,forceFullScreenSlideUp:!0},a)}})}renderDesktopSidebar(e){const{menuState:t}=e,a=Boolean(t.snapshot&&this.snapshotIsAvailable(t.snapshot)),n=!this.historyIsEnabled();return r.a.createElement("div",{style:this.getSidebarStyle()},r.a.createElement(di.b,{type:di.a.Y,style:{flex:1}},this.renderSnapshotsMenuList(e)),r.a.createElement("div",{style:{display:"flex",padding:14,borderTop:"\n\t\t\t\t\t\t\t1px solid ".concat(this.theme.regularDividerColor,"\n\t\t\t\t\t\t")}},r.a.createElement(dt.a,{disableTooltip:!n,renderTooltip:()=>r.a.createElement(ae.FormattedMessage,{defaultMessage:"Upgrade to restore snapshots.",id:"historyModal.desktopModal.sidebar.upgradeMessage.tooltip"}),render:e=>r.a.createElement(Hr.a,Object.assign({isLarge:!0,onClick:()=>si.e(this.environment),disabled:!a},e),r.a.createElement(ae.FormattedMessage,{defaultMessage:"Restore version",id:"historyModal.desktopModal.restoreButton.label"}))}),r.a.createElement(Gr.a,{isLarge:!0,style:{marginLeft:12},onClick:si.b},r.a.createElement(ae.FormattedMessage,{defaultMessage:"Cancel",id:"historyModal.desktopModal.cancelButton.label"}))),r.a.createElement(he.a,{topBorder:!0,disableDesktopPadding:!0},r.a.createElement(ve.a,{title:r.a.createElement(ae.FormattedMessage,{id:"historyModal.desktopModal.learnMoreButton.label",defaultMessage:"Learn about page history"}),href:Object(Me.a)("guides.pageHistory"),analyticsFrom:"page_history"})))}renderDesktopSnapshotPreview(e){if(e.snapshot)return r.a.createElement(n.Fragment,null,r.a.createElement("div",{style:{display:"flex",alignItems:"center",flexShrink:0,height:45,fontSize:14,paddingLeft:14}},e.blockStore.hasIcon()&&r.a.createElement(Yt.a,{disabled:!0,icon:e.blockStore.getIcon(),isEmptyPage:e.blockStore.isEmptyPage(),size:this.iconSize(),style:{marginRight:6}}),r.a.createElement(jr.a,{store:e.blockStore})),r.a.createElement(Ei,{blockStore:e.blockStore,timestamp:e.snapshot.timestamp}))}deviceSupportsUpgrade(e){const{device:t}=this.environment;return!t.isMobile||"personal"===e&&Object(Ti.b)({environment:this.environment})}renderUnavailableMessage(e,t){const{device:a}=this.environment,n=St.default.state.data;let i=this.deviceSupportsUpgrade(t);const s=n&&bt.x(n);return i&&Object(Ti.b)({environment:this.environment})&&"personal"===t&&!s&&(i=!1),r.a.createElement("div",{style:this.getUnavailableMessageStyle()},this.deviceSupportsUpgrade(t)&&this.renderVersionHistoryIcon(),r.a.createElement("div",{style:Ii({},!a.isMobile&&{maxWidth:340})},e),i&&t&&r.a.createElement(Hr.a,{isLarge:!0,onClick:()=>this.handleUpgrade(t),style:{marginTop:16}},r.a.createElement(ae.FormattedMessage,{defaultMessage:"Upgrade",id:"historyModal.upgradeForHistoryButton.label"})))}renderVersionHistoryIcon(){return ft.a.versionHistory({width:64,height:"auto",fill:this.theme.lightIconColor,marginBottom:12})}renderMobileHelpButton(){return r.a.createElement(Pi.a,{href:Object(Me.a)("guides.pageHistory"),analyticsFrom:"page_history"})}snapshotIsAvailable(e){return!!Q.default.isAdminMode||!!this.historyIsEnabled()&&(!!bt.S(this.environment,"enterprise")||parseInt(e.timestamp)>Date.now()-30*Pn.a)}historyIsEnabled(){return!!Q.default.isAdminMode||bt.K(this.environment)}getUnavailableMessage(){return r.a.createElement(n.Fragment,null,r.a.createElement(ae.FormattedMessage,{defaultMessage:"Version history is not available for free workspaces.",id:"historyModal.unavailableForFreeWorkspaces.messagePart1"}),r.a.createElement("br",null),r.a.createElement(ae.FormattedMessage,{defaultMessage:"Please upgrade to one of our paid plans.",id:"historyModal.unavailableForFreeWorkspaces.messagePart2"}))}getSidebarStyle(){return{display:"flex",flexDirection:"column",flexShrink:0,width:ji.sidebarWidth}}getUnavailableMessageStyle(){const{device:e}=this.environment;return Ii({display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",marginTop:28,padding:16,textAlign:"center",fontSize:14},e.isMobile?{position:"relative",zIndex:1,background:this.theme.popoverBackground,boxShadow:"\n\t\t\t\t\t\t\t0 -1px 0 ".concat(this.theme.regularDividerColor,",\n\t\t\t\t\t\t\t0 1px 0 ").concat(this.theme.regularDividerColor,"\n\t\t\t\t\t\t")}:{height:"100%"})}}ji.sidebarWidth=240,ji.restrictedMessage=r.a.createElement(ae.FormattedMessage,{defaultMessage:"Please upgrade to the Enterprise Plan to access versions older than 30 days.",id:"historyModal.upgradeToEnterprise.message"}),ji.noSnapshotsMessage=r.a.createElement(ae.FormattedMessage,{defaultMessage:"This page does not have any snapshots yet. Allow up to 10 minutes for the first snapshot to be generated.",id:"historyModal.noSnapshotsYet.message"}),ji.wrapStyle={display:"flex",justifyContent:"center",padding:32};var xi=Object(ae.injectIntl)(ji),Bi=a("ijm6");class Ai extends o.a{constructor(){super(...arguments),this.renderPopupContent=()=>r.a.createElement(Li,null)}renderComponent(){const{device:e}=this.environment,{blockStore:t,originRect:a}=nr.a.state;return r.a.createElement(pe.c,{popupType:e.isMobile?pe.c.PopupType.SlideUp:pe.c.PopupType.Popup,open:Boolean(t),originRect:a,placementToOrigin:pe.c.Placement.Bottom,alignmentToOrigin:pe.c.Alignment.Center,originGap:4,onDismiss:()=>Bi.a(this.environment),render:this.renderPopupContent})}}class Ri extends o.a{didMount(){const{blockStore:e}=nr.a.state;if(!e)return;const t=e.getTitleStore();t&&Jt.k({environment:this.environment,store:t,canSelectAllBlocks:!1})}renderComponent(){const{device:e}=this.environment,{blockStore:t}=nr.a.state;if(!t)return;const a=t.getTitleStore();if(!a)return;let n;return n=e.isMobile?{menuType:fe.b.MenuType.ActionSheet}:{menuType:fe.b.MenuType.Popup,width:380},r.a.createElement(fe.b,Object.assign({},n),r.a.createElement("div",{style:this.getWrapStyle()},r.a.createElement(Zt.a,{store:a,disabled:!t.canEdit(),onEsc:()=>Bi.a(this.environment),onEnter:()=>Bi.a(this.environment),disableSlashCommands:!0,disableEmojiCommands:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,placeholder:this.props.intl.formatMessage({defaultMessage:"Untitled",id:"renameFileMenuPopup.input.placeholder"}),style:this.getInputStyle()})))}getWrapStyle(){return{display:"flex",alignItems:"center",color:this.theme.regularTextColor,fontSize:"13px",padding:"4px 8px"}}getInputStyle(){return{display:"flex",alignItems:"center",flexGrow:1,fontSize:14,lineHeight:"20px",paddingTop:4,paddingBottom:4,paddingLeft:10,paddingRight:10,width:"100%",borderRadius:3,boxShadow:this.theme.inputBoxShadow,background:this.theme.inputBackground,cursor:"text",position:"relative"}}}const Li=Object(ae.injectIntl)(Ri);var Ui=Ai,_i=a("UWl0"),Wi=a("onX9");class Ni extends o.a{constructor(){super(...arguments),this.renderMenu=()=>{const{device:e}=this.environment,t=Wi.a.state;if(!t.open)return;let a;return a=e.isReactNative&&!e.isTablet?{menuType:fe.b.MenuType.ActionSheet}:{menuType:fe.b.MenuType.Popup,width:410,maxHeight:270,onClickOutside:_i.c},r.a.createElement(fe.b,Object.assign({},a),r.a.createElement(lt.a,{filter:this.getFilter(t)||"",onSubmit:this.handleSubmit,onNoResults:this.handleNoResults,isCallout:!1}))},this.handleNoResults=()=>{const e=Wi.a.state;if(!e.open)return;const t=this.getFilter(e),a=p.a.last(t);a&&/\s/g.test(a)&&_i.c()},this.handleSubmit=e=>{zt.createAndCommit(this.environment,t=>{_i.a({environment:this.environment,emoji:e,transaction:t})})},this.handleCancel=()=>{_i.c()}}willMountOrUpdate(){const e=Wi.a.state;if(e.open){const t=Va.default.state,a=this.getFilter(e);("editing"!==t.mode||t.store!==e.textStore||void 0===a||":"===a||a.startsWith("\n")||a.startsWith(" "))&&_i.c()}}renderComponent(){const{device:e}=this.environment,t=Wi.a.state;let a=!1;if(t.open){const e=this.getFilter(t);e&&e.length>0&&(a=!0),t.showPopupWithEmptyFilter&&(a=!0)}return r.a.createElement(pe.c,{popupType:e.isReactNative&&!e.isTablet?pe.c.PopupType.SlideUp:pe.c.PopupType.Popup,open:a,originRect:t.open?t.selectionRect:void 0,placementToOrigin:pe.c.Placement.Bottom,alignmentToOrigin:pe.c.Alignment.Start,originGap:4,disableMouseCapture:!0,disableContentScroll:!0,onDismiss:this.handleCancel,render:this.renderMenu,keepFocus:!0})}getFilter(e){return Aa.a(e.textStore,e.oldTextValue,!0)}}var qi=Ni,Vi=a("oqx9"),zi=a("Rnyl"),Hi=a("rXSH"),Gi=a("wllP"),Qi=a("wiBh");function Yi(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Zi(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Xi extends o.a{constructor(){super(...arguments),this.input=r.a.createRef(),this.handleInputChange=(e,t)=>{sr.a.isOpen()&&sr.a.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Yi(Object(a),!0).forEach((function(t){Zi(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Yi(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},sr.a.state,{value:e,error:t}))},this.handleSubmit=()=>{zt.createAndCommit(this.environment,e=>{zi.c({environment:this.environment,equationStore:sr.a,transaction:e})})},this.handleClose=()=>{zi.a()},this.handleLeft=e=>{if(!this.input.current)return;const t=this.input.current.getSelection();t&&"altKey"in e&&!e.altKey&&"shiftKey"in e&&!e.shiftKey&&0===t.startIndex&&0===t.endIndex&&(this.handleSubmit(),zi.a("Backward"))},this.handleRight=e=>{if(!sr.a.isOpen())return;if(!this.input.current)return;const t=this.input.current.getSelection();if(!t)return;const a=sr.a.state.value.length;"altKey"in e&&!e.altKey&&"shiftKey"in e&&!e.shiftKey&&t.startIndex===a&&t.endIndex===a&&(this.handleSubmit(),zi.a())},this.isDisabled=()=>{if("editing"!==Va.default.state.mode&&!sr.a.isOpen())return!0;if(sr.a.isOpen()&&!sr.a.state.savedTextSelectionState.store.canEdit())return!0;if(sr.a.isOpen()){const e=Object(Gi.b)(sr.a.state.savedTextSelectionState.store);if(e&&e.isLocked())return!0}if(sr.a.isOpen()&&sr.a.state.savedTextSelectionState.store.table===Hn.a){const e=this.getCommentValue(sr.a.state.savedTextSelectionState.store),{currentUserStore:t}=U.default.state;if(!e||!t)return!0;if(e.created_by_table!==za.a||t.id!==e.created_by_id)return!0}const e={[Ra.b.User]:Ra.b.User,[Ra.b.Page]:Ra.b.Page,[Ra.b.Bot]:Ra.b.Bot,[Ra.b.Date]:Ra.b.Date,[Ra.b.TemporaryPage]:Ra.b.TemporaryPage};for(const t of Object.values(e))if(Object(Qi.o)(t))return!0;return!1},this.INPUT_ORIGIN_GAP_PX=8}renderComponent(){if(sr.a.isOpen())return r.a.createElement(re.DependencyConsumer,{dependency:re.deps.prismjs},e=>{if(sr.a.isOpen())return r.a.createElement(Hi.a,{Prism:e,ref:this.input,isOpen:!0,equationValue:sr.a.state.value,error:sr.a.state.error,displayMode:"inline",disabled:this.isDisabled(),originRect:this.getInputOriginRect(),originGap:this.INPUT_ORIGIN_GAP_PX,onDismiss:this.handleClose,onChange:this.handleInputChange,onSubmit:this.handleSubmit,onLeft:this.handleLeft,onRight:this.handleRight})})}getCommentValue(e){return Vi.a.createChildStore(e,{table:Hn.a,id:e.id}).getValue()}getInputOriginRect(){if(sr.a.isOpen())return sr.a.state.savedTextSelectionRect}}var Ki=Xi;class Ji extends o.a{constructor(){super(...arguments),this.renderTooltip=()=>r.a.createElement(be.a,{capture:!0,onEnter:this.handleEnter,onCommandEnter:this.handleCommandEnter},r.a.createElement(r.a.Fragment,null,r.a.createElement(ae.FormattedMessage,{defaultMessage:"Open page",id:"pageMentionOverlay.openPage"}),r.a.createElement("div",null,r.a.createElement(Vn.a,{onlyShowFirst:!0,name:"enter",style:{color:this.theme.mediumInvertedTextColor}})))),this.handleEnter=e=>{const t=this.pageMentionTokenStore.state;if(!t)return;const{pageId:a,store:n}=t;if(!a)return;e.preventDefault&&e.preventDefault();const r=f.a.createChildStore(n,{table:b.b,id:a});Y.navigateToBlock({store:r,environment:this.environment,visitType:"Link"})},this.handleCommandEnter=e=>{const t=this.pageMentionTokenStore.state;if(!t)return;const{pageId:a,store:n}=t;if(!a)return;e.preventDefault();const r=f.a.createChildStore(n,{table:b.b,id:a});Y.navigateToBlock({store:r,environment:this.environment,visitType:"Link",metaClick:!0})},this.pageMentionTokenStore=this.createComputedStore(()=>{const e=Va.default.state;if("editing"!==e.mode)return;const{selection:t,store:a}=e;if(t.endIndex!==t.startIndex+1)return;const n=a.getValue(),r=Ra.gb(n,t.startIndex);if(!r||!Ra.Ab(r))return;const[i]=Ra.W([r]);return{pageId:i,store:a}})}renderComponent(){if(this.environment.device.isMobile)return;const e=An.getSelectionRect(),t=this.pageMentionTokenStore.state;return r.a.createElement(dt.a,{render:()=>{},renderTooltip:this.renderTooltip,originRect:e,forceVisibleState:Boolean(t&&e),placement:dt.a.Placement.Bottom})}}var $i=Ji,es=a("FmD2");class ts extends o.a{constructor(){super(...arguments),this.handleKey=e=>{D.a.state.isActive&&(e.preventDefault(),Object(es.b)({environment:this.environment,currentX:D.a.state.currentX,currentY:D.a.state.currentY,toggle:e.shiftKey}))},this.handleMouseMove=e=>{D.a.state.isActive&&(e.preventDefault(),Object(es.b)({environment:this.environment,currentX:e.clientX,currentY:e.clientY,toggle:e.shiftKey}))},this.handleMouseUp=e=>{D.a.state.isActive&&(e.preventDefault(),Object(es.a)(this.environment))}}willMount(){window.addEventListener("keydown",this.handleKey),window.addEventListener("keyup",this.handleKey),window.addEventListener("mousemove",this.handleMouseMove),window.addEventListener("mouseup",this.handleMouseUp)}willUnmount(){window.removeEventListener("keydown",this.handleKey),window.removeEventListener("keyup",this.handleKey),window.removeEventListener("mousemove",this.handleMouseMove),window.removeEventListener("mouseup",this.handleMouseUp)}renderComponent(){return null}}var as=ts,ns=a("FkPB"),rs=a("Zo/l"),is=a("GQP/"),ss=a("nM47"),os=a("W7EN"),ls=a("mUbl"),cs=a("S26v"),ds=a("yFBc"),us=a("PHZn"),ps=a("VhAz"),ms=a("d933"),hs=a("aZ00"),gs=a("Wvka");function fs(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function bs(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?fs(Object(a),!0).forEach((function(t){ys(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):fs(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function ys(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ss(e){const[t]=Object(ns.b)(Kn.a),a=Object(rs.a)(),i=Object(ns.a)(()=>{if(!t.open)return!1;if(t.focusMenu)return!1;const e=Va.default.state;if("editing"!==e.mode)return!0;const{store:a,selection:n}=e;return Object(Qi.m)(n)?!Ra.mb(a.getValue(),n.startIndex,n.endIndex,Ra.b.Link):!Object(Qi.n)(e.selection,t.savedTextSelectionState.selection)},[t]);return Object(n.useEffect)(()=>{i&&is.a()},[i]),r.a.createElement(pe.c,{popupType:a.isMobile?a.isTablet?pe.c.PopupType.Popup:pe.c.PopupType.SlideUp:pe.c.PopupType.Popup,style:{width:330},keepFocus:a.isPhone,open:t.open,originRect:t.open?t.selectionRect:void 0,placementToOrigin:pe.c.Placement.Bottom,alignmentToOrigin:pe.c.Alignment.Center,originGap:8,disableContentScroll:!0,onDismiss:is.a,render:()=>t.open?r.a.createElement(vs,{state:t}):void 0})}function vs(e){const{state:t}=e,a=Object(rs.d)(),i=Object(ae.useIntl)(),s=i.formatMessage({defaultMessage:"Paste link or search pages",id:"selectionLinkButton.search.createNewLinkPlaceholder",description:"Placeholder text in the link input field when there is no current link"}),o=i.formatMessage({defaultMessage:"Edit link or search pages",id:"selectionLinkButton.search.editLinkPlaceholder",description:"Placeholder text in the link input field when there is an existing link that will be modified"}),[l,c]=Object(n.useState)(!0);if(Object(n.useEffect)(()=>c(!1),[]),t.showCreateIn&&!a)return r.a.createElement(Es,{state:t});const d=!a||!t.showCreateIn,u=a?void 0:!t.showCreateIn&&t.focusMenu,p=t.editingToken?o:s,m=r.a.createElement(he.a,{isInput:!0,desktopStyle:Fs(t)?{marginBottom:8}:void 0},d&&r.a.createElement(ge.a,{onFocus:Ts,placeholder:p,value:t.url,onChange:Ps,focus:u,focusInitial:a,focusAfterAnimation:!0,allowArrows:!0}));let h;return h=a?{menuType:fe.b.MenuType.Modal,title:r.a.createElement(ae.FormattedMessage,{defaultMessage:"Link",id:"selectionLinkButton.mobile.title"}),right:r.a.createElement(Ee.CancelMenuText,null),onClickRight:is.a,header:m,footer:r.a.createElement(pe.c,{popupType:pe.c.PopupType.SlideUp,open:t.showCreateIn||!1,render:()=>r.a.createElement(Es,{state:t})})}:{menuType:fe.b.MenuType.Popup,header:m},r.a.createElement(mr.a,{capture:t.open&&(l||t.focusMenu),allowEsc:!0},r.a.createElement(fe.b,Object.assign({},h),r.a.createElement(Ms,{state:t})),r.a.createElement(be.a,{capture:!0,onCommandSlash:Ts}))}function Es(e){const{state:t}=e,a=Object(rs.b)(),i=Object(n.useCallback)(async e=>{if(!ss.j(a))return;const n=zt.create(a),r=Object(Ya.e)({environment:a,transaction:n,titleText:t.url||"",createInValue:e,recordStoreParent:t.savedTextSelectionState.store}),[i]=r.createdPages;i&&is.b({environment:a,url:Object(os.a)({pageId:i.id}),transaction:n,editingToken:t.editingToken,savedTextSelectionState:t.savedTextSelectionState}),await r.moveToStorePromise,await zt.commit({environment:a,transaction:n}),await Object(Ya.a)({analyticsFrom:"link_menu",createInState:r})},[t,a]),s="block"===t.savedTextSelectionState.store.table?t.savedTextSelectionState.store.id:void 0;return r.a.createElement(Ba.a,{targets:[],isAddTo:!0,isCreateIn:!0,onAccept:i,captureSelection:!1,restoreSelection:!1,parentBlockId:s,onAutocompleteQueryChange:Cs,autocompleteQuery:t.createInQuery||"",desktopWidth:330,onCancel:Os})}function Ms(e){const{state:t}=e,a=Object(rs.b)(),i=Object(rs.d)(),s=Object(us.b)(),[{online:o}]=Object(ns.b)(_a.a),l=Object(n.useMemo)(()=>Is(t),[t]),c=Object(n.useMemo)(()=>js(l),[l]),d=Object(n.useMemo)(()=>{const{store:e}=t.savedTextSelectionState;if(Object(ne.n)(e))return e},[t]),[{value:u,status:m}]=Object(ls.a)(async()=>{if(!l||!o)return[];return(await Object(kt.e)({nearBlock:d,environment:a,query:l,source:"mention_menu",limit:10})).map(e=>e.id)},[l,d,a,o]),h=Object(n.useMemo)(()=>{if(c&&"notion"===c.type){const e=u?p.a.without(u,c.notionPage.blockId):[];return[c,...e]}return u},[u,c]),g=Object(n.useMemo)(()=>{if(!h||0===h.length)return;if(c&&"web"===c.type&&c.url===l)return;const e=ms.a.withListenerIgnored(T.d);if(!e)return;const n=t.url?5:3,i=r.a.createElement(ae.FormattedMessage,{id:"selectionLinkButton.linkToPage.linkToBlock",defaultMessage:"Link to block",description:"Shown beneath a page title if linking to a block inside that page"}),s=r.a.createElement(ae.FormattedMessage,{defaultMessage:"Link to page",id:"selectionLinkButton.linkToPageSection.title"}),o=p.a.compact(h.map(n=>{const s="object"==typeof n?n.notionPage.peekViewBlockId||n.notionPage.blockId:n,o=f.a.createChildStore(e,{table:b.b,id:s});return{key:s,action:()=>{if("object"==typeof n){const e=Object(os.a)({pageId:n.notionPage.blockId,peekViewBlockId:n.notionPage.peekViewBlockId,discussionId:n.notionPage.discussionId,collectionViewId:n.notionPage.collectionViewId,scrollToBlockId:n.notionPage.scrollToBlockId});ks(a,t,e)}else ks(a,t,Object(os.a)({pageId:s}))},render:e=>{const t="object"==typeof n&&n.notionPage.scrollToBlockId;return r.a.createElement(Fa.a,Object.assign({},e,{store:o,caption:t?i:void 0,placeholder:r.a.createElement(xa.a,{showHold:300,showDelay:300,show:"resolved"===m,render:e=>e?r.a.createElement(ae.FormattedMessage,{id:"selectionLinkButton.linkToPage.unknownBlock",defaultMessage:"Unknown block"}):r.a.createElement(ae.FormattedMessage,{id:"selectionLinkButton.linkToPage.loading",defaultMessage:"Loading..."})})}))}}})).slice(0,n),d=h.some(e=>Boolean("object"==typeof e&&e.notionPage.scrollToBlockId));return{key:"mention results",items:o,render:e=>r.a.createElement(he.a,Object.assign({},e,{title:d?s:i,isTitleUppercase:!0}))}},[h,t,a,l,c,m]),y=Object(n.useMemo)(()=>{const e=r.a.createElement(ae.FormattedMessage,{defaultMessage:"Linked to",id:"selectionLinkButton.linkedToSection.title"}),n=Ds(t),i=n?Object(os.c)(n):void 0;if(i&&n){const t=ms.a.withListenerIgnored(T.d);if(!t)return;const s=f.a.createChildStore(t,{table:b.b,id:i});return{key:"linked to",render:t=>r.a.createElement(he.a,Object.assign({title:e,isTitleUppercase:!0},t)),items:[{key:"linked to page",action:e=>{let{event:t}=e;const r=t&&t.metaKey;r||Kn.a.setState({open:!1}),Object(Y.navigate)({environment:a,url:n,metaClick:r})},render:e=>r.a.createElement(Fa.a,Object.assign({},e,{store:s}))}]}}if(n)return{key:"linked to",render:t=>r.a.createElement(he.a,Object.assign({title:e,isTitleUppercase:!0},t)),items:[{key:"linked to web",action:e=>{let{event:t}=e;return Object(Y.navigate)({environment:a,url:n,metaClick:t&&t.metaKey})},render:e=>r.a.createElement(Dt.a,Object.assign({},e,{title:n,caption:r.a.createElement(ae.FormattedMessage,{defaultMessage:"Web page",id:"selectionLinkButton.linkedToSection.webPage"}),icon:ft.a.globe2({width:16,fill:s.mediumIconColor})}))}]}},[a,t,s]),S=Object(n.useMemo)(()=>{if(!c)return;if("notion"===c.type&&o)return;let e;if("web"===c.type)e=r.a.createElement(ae.FormattedMessage,{id:"selectionLinkButton.linkToWebPage",defaultMessage:"Link to web page"});else if("notion"===c.type)e=r.a.createElement(ae.FormattedMessage,{id:"selectionLinkButton.linkToPage",defaultMessage:"Link to page"});else{if("other"!==c.type)throw Object(ps.e)(c);e=r.a.createElement(ae.FormattedMessage,{id:"selectionLinkButton.linkToURL",defaultMessage:"Link to URL"})}return{key:"link to url",action:()=>ks(a,t,l),render:t=>r.a.createElement(Dt.a,Object.assign({},t,{title:e,icon:ft.a.link({width:16})}))}},[t,l,a,o,c]),v=Object(n.useMemo)(()=>{if(t.editingToken)return{key:"copy link",action:()=>function(e,t){const a=Ds(t);if(!a)return;const n=Object(os.c)(a),r=n?Object(gs.a)({pageId:n,baseUrl:Q.default.baseURL}):a;hs.c({environment:e,stringValue:r}),is.a()}(a,t),render:e=>r.a.createElement(Dt.a,Object.assign({},e,{title:r.a.createElement(ae.FormattedMessage,{id:"selectionLinkButton.copyLink",defaultMessage:"Copy link",description:"Copies the URL for the focused link to the user's clipboard"}),icon:ft.a.copy({width:16})}))}},[t,a]),E=Object(n.useMemo)(()=>{if(t.editingToken)return{key:"unlink",action:()=>is.d(a),render:e=>r.a.createElement(Dt.a,Object.assign({},e,{title:r.a.createElement(ae.FormattedMessage,{id:"selectionLinkButton.removeLink",defaultMessage:"Remove link"}),icon:ft.a.trash({width:16})}))}},[t.editingToken,a]),M=Object(n.useMemo)(()=>{if(!l)return;if(!t.savedTextSelectionState.store.isDefaultRecordCache())return;const e=js(l);return!e||e.url!==l&&!e.notionPage?{key:"create page",action:ws,render:e=>r.a.createElement(Dt.a,Object.assign({},e,{icon:ft.a.alias({width:16}),title:r.a.createElement(tn,{pageTitle:l})}))}:void 0},[l,t.savedTextSelectionState.store]),C=p.a.compact([g,y]),w=C.length>0,O=Object(n.useMemo)(()=>{const e=p.a.compact([S,v,E,M]);if(0!==e.length)return{key:"link actions",render:e=>r.a.createElement(he.a,Object.assign({topBorder:w},e)),items:e}},[w,S,v,E,M]),k=p.a.compact([...C,O]),P=Object(n.useMemo)(()=>{if(i)return;if(!c||!O||!S)return 0===k.length?void 0:0;const e=p.a.sum(C.map(e=>e.items.length))+O.items.indexOf(S);return Math.max(e,0)},[i,c,O,S,k,C]);return r.a.createElement(Da.a,{type:Da.a.Type.Vertical,initialFocus:P,sections:k})}function Cs(e){const t=Kn.a.state;t.open&&Kn.a.setState(bs({},t,{createInQuery:e}))}function ws(){const e=Kn.a.state;e.open&&Kn.a.setState(bs({},e,{showCreateIn:!0}))}function Os(){const e=Kn.a.state;e.open&&Kn.a.setState(bs({},e,{showCreateIn:!1,createInQuery:""}))}function ks(e,t,a){const n=Object(ds.a)(a);n&&zt.createAndCommit(e,a=>{is.b({environment:e,transaction:a,url:n,editingToken:t.editingToken,savedTextSelectionState:t.savedTextSelectionState})})}const Ps=e=>{const t=Kn.a.state;t.open&&Kn.a.setState(bs({},t,{url:e.target.value,focusMenu:!0}))};function Ts(){const e=Kn.a.state;e.open&&(e.focusMenu||Kn.a.setState(bs({},e,{focusMenu:!0})))}function Ds(e){const{editingToken:t}=e;if(!t)return;const a=Ra.db(t),n=Ra.A(a);return n?Ra.R(n):void 0}function Is(e){return e.url||""}function Fs(e){return""===Is(e)&&void 0===Ds(e)}function js(e){const t=Ra.T(e);if(t&&"url"===t.type){const e=Object(Dn.l)({url:t.href,baseUrl:Q.default.baseURL,isMobile:!1,protocol:void 0,currentUrl:void 0});return"page"===e.name?{type:"notion",url:t.href,notionPage:e}:{type:"web",url:t.href}}const a=Object(cs.i)({str:e,allowNoProtocol:!1});if(a)return{type:"other",url:a}}var xs=a("Ko2L"),Bs=a("DaKt"),As=a("gyLq"),Rs=a("mY49"),Ls=a("DyNK");function Us(e){const[t]=Object(ns.b)(xs.a),a="on"===Object(rs.c)("link-hover-preview"),i=Object(ns.c)(Bs.a),s=Object(Rs.b)(t,400,Object.is),o=t&&t===s,l=Object(n.useMemo)(()=>s&&s.token.node.getBoundingClientRect(),[s]);return a?r.a.createElement(pe.c,{disableMouseCapture:!0,preventCaptureEsc:!0,preventPointerEvents:!0,preventScaleTransition:!0,preventOpacityTransition:!0,popupType:pe.c.PopupType.Popup,open:Boolean(!i&&o),originRect:l,originGap:8,alignmentToOrigin:pe.c.Alignment.Start,placementToOrigin:pe.c.Placement.Bottom,useLightBoxShadow:!0,render:()=>s&&r.a.createElement(_s,{state:s})}):null}function _s(e){const{annotation:t,store:a}=e.state,i=Object(rs.b)(),s=Object(us.b)(),o=Ra.R(t),l=Object(os.c)(o),c=Object(us.a)(e=>({wrapper:{fontSize:Qe.a.fontSize.UISmall.desktop,padding:"4px 8px",color:e.mediumTextColor,fontWeight:Qe.a.fontWeight.medium,fill:e.mediumIconColor,maxWidth:450},icon:{height:"1em",width:"1em",marginRight:"0.25em",fill:e.mediumIconColor}}),[]),d=Object(ns.a)(()=>{if(!l)return;const e=f.a.createChildStore(a,{table:b.b,id:l}),t=e.getValue(),n=t&&Object(Ga.h)({pageValue:t,baseUrl:Q.default.baseURL,getRecordValue:a.getRecordValue,emojiType:Object(Qa.a)(i),isSafariOrIOS:i.device.isSafari||i.device.isIOS,isClient:!0,showEmojiInline:i.device.isWindows,currentUserId:i.currentUser.id}),s=t&&t.parent_id!==a.id?ft.a.alias(c.icon):void 0;return r.a.createElement(r.a.Fragment,null,n,s,r.a.createElement(jr.a,{style:Qe.a.textOverflowStyle,store:e}))},[l,s,c]);return Object(n.useEffect)(()=>{const e=p.a.throttle(Ls.a,200,{leading:!0});return g.a(window,"scroll",e,!0),()=>g.b(window,"scroll",e,!0)},[]),r.a.createElement(As.a,{style:c.wrapper,alignItems:"center"},d||r.a.createElement(r.a.Fragment,null,ft.a.globe2(c.icon),r.a.createElement("div",{style:Qe.a.textOverflowStyle},o)))}class Ws extends o.a{willMount(){this.environment.device.isMobile&&document.addEventListener("gesturestart",(function(e){e.preventDefault()}))}renderComponent(){const e=this.environment.currentUser.isLoggedIn(),{isMobile:t,isElectron:a}=this.environment.device,{currentSpaceStore:s}=U.default.state;return r.a.createElement(n.Fragment,null,r.a.createElement(ce,null),r.a.createElement(fa,null),r.a.createElement(Ca,null),r.a.createElement(Pa,null),r.a.createElement(d,null),r.a.createElement(i.a,{isRoot:!0,capture:!0}),r.a.createElement(R,null),e&&!t&&r.a.createElement(q,null),e&&s&&r.a.createElement(se,{rootStore:s}),r.a.createElement(Ne,null),r.a.createElement(Gt,null),r.a.createElement(Pe,null),r.a.createElement(aa,null),r.a.createElement(Ui,null),r.a.createElement(at,null),r.a.createElement(Be,null),!t&&r.a.createElement(ur,null),r.a.createElement(Ki,null),r.a.createElement($i,null),r.a.createElement(qt,null),r.a.createElement(na.a,{store:O.a}),r.a.createElement(na.a,{store:w.a}),r.a.createElement(bn,null),r.a.createElement(Cn,null),r.a.createElement(qi,null),r.a.createElement(Bn,null),r.a.createElement(Ss,null),a&&r.a.createElement(Sr,null),r.a.createElement(Pr,null),r.a.createElement(Jr,null),r.a.createElement(ii,null),r.a.createElement(as,null),e&&r.a.createElement(xi,null),r.a.createElement(Us,null))}}t.default=Ws},DQmc:function(e,t,a){"use strict";a.r(t);a("ioFf"),a("rGqo");var n=a("LvDl"),r=a.n(n),i=a("q1tI"),s=a.n(i),o=a("mF3+"),l=a("Mr7a"),c=a("4HCU"),d=a("wldR"),u=a("yisX"),p=a("y6Dp"),m=a("tw5M"),h=a("zmp8"),g=a("Sb6f"),f=a("LeVO"),b=a("Pl3d"),y=a("WgIs"),S=a("2Y+N"),v=a("f0kS"),E=a("SR/M"),M=a("gbGO"),C=a("zTdN"),w=a("W3at"),O=a("Cycz"),k=a("nM47"),P=a("r8MX"),T=a("Ng05"),D=a("7M94"),I=a("WLsh"),F=a("KTXS"),j=a("9wIn"),x=a("5/h/"),B=a("V1wX"),A=a("z22Z"),R=a("xL2i"),L=a("LNlx"),U=a("J9+s"),_=a("nPEg"),W=a("AXh+"),N=a("DbeH");class q extends d.a{renderComponent(){return s.a.createElement(S.a,Object.assign({},this.props,{title:s.a.createElement(U.FormattedMessage,{id:"inviteUserModal.searchDropdown.selectPersonTitle",defaultMessage:"Select a person"})}))}}var V=a("DNfA"),z=a("0CAA"),H=a("Pqcg"),G=a("5Nka"),Q=a("8f5p"),Y=a("VhAz"),Z=a("3JF5"),X=a("xRf7"),K=a("MeYt");function J(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function $(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?J(Object(a),!0).forEach((function(t){ee(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):J(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function ee(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class te extends d.a{renderComponent(){return s.a.createElement(K.a,{hovered:this.props.hovered,onClick:this.props.onClick,disabled:this.props.disabled,disabledFeedback:!0,style:$({},this.getButtonStyle(),{},this.props.isLarge&&{height:32},{},this.props.style),hoveredStyle:{background:this.theme.buttonHoveredBackground},pressedStyle:{background:this.theme.buttonPressedBackground},onMouseDown:this.props.onMouseDown,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,className:this.props.className},this.props.children)}getButtonStyle(){return{display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0,whiteSpace:"nowrap",height:28,borderRadius:3,boxShadow:this.theme.plainButtonBoxShadow,background:this.theme.inputBackground,color:this.theme.mediumTextColor,fill:h.f.white,lineHeight:1.2,paddingLeft:12,paddingRight:12,fontSize:14}}}var ae=te,ne=a("Oy36"),re=a("QcDD"),ie=a("7TLZ"),se=a("FUUC"),oe=a("HRSx");function le(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ce(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?le(Object(a),!0).forEach((function(t){de(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):le(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function de(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class ue extends d.a{constructor(){super(...arguments),this.storeTypes={permissionsInviteStore:m.a},this.renderOverlay=()=>{const{permissionsInviteStore:e}=this.stores,{tokenQuery:t}=e.state,a=Object(ie.n)(this.props.store),n=e.state.inviteTargets.map(e=>{const t="newUser"===e.type?e.value.email:"".concat(e.type,"-").concat(e.value.id);return s.a.createElement(j.a,{key:t,target:e,onClickRemove:this.handleClickRemoveToken})}),l={request:t,performRequest:async e=>{const[t,n,i,{user:s,email:o}]=await Promise.all([c.l({environment:this.environment,query:e,membersOnly:this.props.membersOnly}),c.j({environment:this.environment,query:e}),a?c.k({query:e,intl:this.props.intl}):[],c.d(this.environment,e)]),l=t.slice(0,10).map(e=>({type:"existingUser",value:e})),d=n.slice(0,10).map(e=>({type:"bot",value:e})),u=i.slice(0,10).map(e=>({type:"group",value:e}));return s&&l.push({type:"existingUser",value:s}),o&&l.push({type:"newUser",value:{email:o}}),{inviteUsers:r.a.uniqBy(l,e=>e.value.email),inviteBots:d,inviteGroups:u}},render:(e,n,r)=>{if(e)return s.a.createElement(q,{loading:!r},s.a.createElement(C.a,{title:s.a.createElement(U.FormattedMessage,{id:"inviteUserModal.searchInput.errorMessage",defaultMessage:"Something went wrong"})}));const i=(n&&n.inviteUsers||[]).filter(e=>!this.alreadyInvitingTarget(e)&&!("existingUser"===e.type&&this.targetHasPermission(e))),l=(n&&n.inviteBots||[]).filter(e=>!this.alreadyInvitingTarget(e)&&!this.targetHasPermission(e)),c=(n&&n.inviteGroups||[]).filter(e=>!this.alreadyInvitingTarget(e)&&!this.targetHasPermission(e)),{data:d}=P.default.state,u=i.map(e=>({key:"newUser"===e.type?e.value.email:e.value.id,render:t=>{const a=d?O.w(d):[],n="existingUser"===e.type&&a.find(t=>t.userId===e.value.id);let r;return n&&Object(A.a)(n.role)?r=s.a.createElement(f.a,{renderTooltip:()=>s.a.createElement(U.FormattedMessage,{id:"inviteUserModal.userRole.adminBadge.tooltip",defaultMessage:"This person is an admin in this workspace"}),render:e=>s.a.createElement("div",Object.assign({style:this.getBadgeStyle()},e),s.a.createElement(U.FormattedMessage,{id:"inviteUserModal.userRole.adminBadge.label",defaultMessage:"Admin"}))}):n&&Object(A.c)(n.role)?r=s.a.createElement(f.a,{renderTooltip:()=>s.a.createElement(U.FormattedMessage,{id:"inviteUserModal.userRole.memberBadge.tooltip",defaultMessage:"This person is a member in this workspace"}),render:e=>s.a.createElement("div",Object.assign({style:this.getBadgeStyle()},e),s.a.createElement(U.FormattedMessage,{id:"inviteUserModal.userRole.memberBadge.label",defaultMessage:"Member"}))}):n&&(r=s.a.createElement(f.a,{renderTooltip:()=>s.a.createElement(U.FormattedMessage,{id:"inviteUserModal.userRole.guest.tooltip",defaultMessage:"This person is a guest in this workspace"}),render:e=>s.a.createElement("div",Object.assign({style:this.getBadgeStyle()},e),s.a.createElement(U.FormattedMessage,{id:"inviteUserModal.userRole.guestBadge.label",defaultMessage:"Guest"}))})),"existingUser"===e.type?s.a.createElement(v.a,Object.assign({},t,{user:e.value,right:r})):s.a.createElement(E.a,Object.assign({},t,{icon:o.a.mail({width:ue.avatarSize,height:ue.avatarSize}),right:r,title:e.value.email.trim()}))},action:()=>{const{permissionsInviteStore:t}=this.stores;!t.state.isInviteTargetsEmpty&&Object(m.c)(t.state)||t.setState(ce({},t.state,{inviteTargets:[...t.state.inviteTargets,e],isInviteTargetsEmpty:!1,tokenQuery:""}))}})),p=l.map(e=>{const{value:t}=e;return{key:t.id,render:e=>{const a=(d?O.o(d):[]).find(e=>e.botId===t.id);let n;return a&&Object(A.a)(a.role)?n=s.a.createElement(f.a,{renderTooltip:()=>"This bot is an admin in this workspace",render:e=>s.a.createElement("div",Object.assign({style:this.getBadgeStyle()},e),"Admin")}):a&&Object(A.c)(a.role)?n=s.a.createElement(f.a,{renderTooltip:()=>"This bot is a member in this workspace",render:e=>s.a.createElement("div",Object.assign({style:this.getBadgeStyle()},e),"Member")}):a&&(n=s.a.createElement(f.a,{renderTooltip:()=>"This bot is a guest in this workspace",render:e=>s.a.createElement("div",Object.assign({style:this.getBadgeStyle()},e),"Guest")})),s.a.createElement(L.a,Object.assign({},e,{bot:t,right:n}))},action:()=>{const{permissionsInviteStore:t}=this.stores;(t.state.isInviteTargetsEmpty||Object(m.c)(t.state))&&(t.state.table===oe.b?this.stores.permissionsInviteStore.setState(ce({},t.state,{inviteTargets:[...t.state.inviteTargets,e],inviteRole:this.getDefaultRoleForBlockBot(),isInviteTargetsEmpty:!1,tokenQuery:"",table:t.state.table})):t.state.table===se.a?this.stores.permissionsInviteStore.setState(ce({},t.state,{inviteTargets:[...t.state.inviteTargets,e],inviteRole:this.getDefaultRoleForSpaceBot(),isInviteTargetsEmpty:!1,tokenQuery:"",table:t.state.table})):Object(Y.e)(t.state.table))}}}),{currentSpaceStore:h}=re.default.state,b=c.map(e=>{const{value:t}=e,a=Object(Q.a)({intl:this.props.intl,group:t}),n=h&&t.icon?{table:h.table,id:h.id,icon:t.icon}:void 0;return{key:t.id,render:e=>s.a.createElement(E.a,Object.assign({},e,{icon:s.a.createElement(ne.a,{disabled:!0,size:22,icon:n,isEmptyPage:!1,title:a}),title:a})),action:()=>{const{permissionsInviteStore:t}=this.stores;!t.state.isInviteTargetsEmpty&&Object(m.c)(t.state)||t.setState(ce({},t.state,{inviteTargets:[...t.state.inviteTargets,e],isInviteTargetsEmpty:!1,tokenQuery:""}))}}}),M=[],{permissionsInviteStore:w}=this.stores;if(u.length>0&&(w.state.isInviteTargetsEmpty||!Object(m.c)(w.state))&&M.push({key:"user results",render:e=>s.a.createElement(q,Object.assign({},e,{loading:!r})),items:u}),p.length>0&&(w.state.isInviteTargetsEmpty||Object(m.c)(w.state))&&M.push({key:"bot results",render:e=>s.a.createElement(S.a,Object.assign({},e,{title:"Select a bot",loading:!r})),items:p}),a&&b.length>0&&(w.state.isInviteTargetsEmpty||!Object(m.c)(w.state))&&M.push({key:"group results",render:e=>s.a.createElement(S.a,Object.assign({},e,{title:s.a.createElement(U.FormattedMessage,{id:"inviteUserModal.searchDropdown.selectGroupTitle",defaultMessage:"Select a group"}),loading:!r})),items:b}),0===M.length){const e=Object(I.b)(w.state.tokenQuery);if(e){const t={type:"newUser",value:{email:e}},a=this.alreadyInvitingTarget(t);if(!a)return;if(a)return s.a.createElement(q,{loading:!r},s.a.createElement(C.a,{title:s.a.createElement(U.FormattedMessage,{id:"inviteUserModal.userAlreadyInvitedMessage",defaultMessage:"Already inviting {user}.",values:{user:s.a.createElement("span",{style:{fontWeight:g.a.fontWeight.bold}},this.getTargetName(a))}})}));const i=(n&&n.inviteUsers||[]).find(t=>"existingUser"===t.type&&t.value.email===e);if(i&&"existingUser"===i.type&&this.targetHasPermission(i))return s.a.createElement(q,{loading:!r},s.a.createElement(C.a,{title:s.a.createElement(U.FormattedMessage,{id:"inviteUserModal.userAlreadyHasPermissionMessage",defaultMessage:"{user} already has permission.",values:{user:s.a.createElement("span",{style:{fontWeight:g.a.fontWeight.bold}},Object(x.e)(i.value))}})}))}return s.a.createElement(q,{loading:!r},s.a.createElement(C.a,{title:s.a.createElement(U.FormattedMessage,{id:"inviteUserModal.searchPersonDropdown.noSearchResultsMessage",defaultMessage:"Type or paste in emails above, separated by commas."})}))}return s.a.createElement(y.a,{type:y.a.Type.Vertical,initialFocus:t.length>0?0:void 0,sections:M})}},{device:d}=this.environment,u=Object(ie.p)(this.props.store)?this.props.intl.formatMessage({id:"inviteUserModal.searchInput.placeholder",defaultMessage:"Search name or emails"}):this.props.intl.formatMessage({id:"permissionsInvite.searchInput.placeholder",defaultMessage:"Search emails, names, or groups"}),p=s.a.createElement(w.a,{focus:!d.isMobile||void 0,focusInitial:d.isMobile,focusAfterAnimation:!0,format:w.a.Format.Share,value:t,onChange:this.handleInputChange,type:"email",tokens:n,disabled:!1,placeholder:u,onRemoveLastToken:()=>{const e=ce({},this.stores.permissionsInviteStore.state);e.inviteTargets=e.inviteTargets.slice(0,-1),0===e.inviteTargets.length&&(e.isInviteTargetsEmpty=!0,e.inviteRole=this.getDefaultRoleForNonBot()),this.stores.permissionsInviteStore.setState(e)},right:!d.isMobile&&this.renderDesktopInputRightInner(),onEmptyEnter:this.handleInviteClick,dontShowBorderBottom:d.isAndroid});let k;return k=d.isMobile?{menuType:M.b.MenuType.Modal,title:Object(ie.p)(this.props.store)?s.a.createElement(U.FormattedMessage,{id:"inviteUserModal.addMemberMenu.title",defaultMessage:"Add members"}):s.a.createElement(U.FormattedMessage,{id:"inviteUserModal.invitePersonMenu.title",defaultMessage:"Invite a person"}),right:s.a.createElement("div",{style:{color:h.f.blue}},s.a.createElement(U.FormattedMessage,{id:"inviteUserModal.mobile.inviteButton.label",defaultMessage:"Invite"})),left:s.a.createElement(_.CancelMenuText,null),onClickLeft:this.handleModalDismiss,onClickRight:this.handleInviteClick,header:p}:{menuType:M.b.MenuType.Popup,width:480,height:"60vh",header:p,tokenInputHeader:!0,footer:this.renderHelpButton()},s.a.createElement(M.b,Object.assign({},k,{className:D.C}),s.a.createElement(i.Fragment,null,d.isMobile&&s.a.createElement(S.a,{title:s.a.createElement(U.FormattedMessage,{id:"inviteUserModal.permissionLevel.title",defaultMessage:"Permission level"})},this.renderDesktopInputRightInnerSelect()),s.a.createElement(b.a,Object.assign({},l)),d.isMobile&&this.renderHelpButton()))},this.handleTrialClick=()=>{N.a(this.environment,{from:this.props.upgradeButtonName,for:"team_free"}),this.props.onUpgradeButtonClick&&this.props.onUpgradeButtonClick()},this.handleUpgradeClick=()=>{N.a(this.environment,{from:this.props.upgradeButtonName,for:"team"}),this.props.onUpgradeButtonClick&&this.props.onUpgradeButtonClick()},this.handleButtonClick=()=>{this.stores.permissionsInviteStore.setState({modalOpen:!0,tokenQuery:"",inviteTargets:[],inviteRole:this.getDefaultRoleForNonBot(),isInviteTargetsEmpty:!0,table:Object(ie.p)(this.props.store)?se.a:oe.b}),Object(ie.p)(this.props.store)?p.ld(this.environment):p.dd(this.environment)},this.handleInviteClick=async()=>{const{store:e}=this.props,{permissionsInviteStore:t}=this.stores,{tokenQuery:a}=t.state;if(Object(I.c)(a.trim())&&(t.state.isInviteTargetsEmpty||!Object(m.c)(t.state))){const e={type:"newUser",value:{email:a.trim()}};this.alreadyInvitingTarget(e)||t.setState(ce({},t.state,{inviteTargets:[...t.state.inviteTargets,e],isInviteTargetsEmpty:!1,tokenQuery:""}))}if(!t.state.isInviteTargetsEmpty&&t.state.inviteTargets.length>0)if(this.props.onInviteClick&&this.props.onInviteClick(),Object(m.c)(t.state))if(t.state.table===oe.b){if(!Object(ie.n)(e))throw new Error("Table mismatch.");const{inviteTargets:a,inviteRole:n}=t.state;t.reset(),await l.c({environment:this.environment,store:e,inviteTargets:a,inviteRole:n,isOnboarding:!1})}else if(t.state.table===se.a){if(!Object(ie.p)(e))throw new Error("Table mismatch.");const{inviteTargets:a,inviteRole:n}=t.state;t.reset(),await l.c({environment:this.environment,store:e,inviteTargets:a,inviteRole:n,isOnboarding:!1})}else Object(Y.e)(t.state);else{const{inviteTargets:a,inviteRole:n}=t.state;t.reset(),await l.c({environment:this.environment,store:e,inviteTargets:a,inviteRole:n,isOnboarding:!1})}this.props.onInviteComplete&&this.props.onInviteComplete()},this.handleModalDismiss=()=>{this.stores.permissionsInviteStore.setState(ce({},this.stores.permissionsInviteStore.state,{modalOpen:!1}))},this.handleInputChange=e=>{if(!this.stores.permissionsInviteStore.state.isInviteTargetsEmpty&&Object(m.c)(this.stores.permissionsInviteStore.state))return;const t=e.target.value,{extractedEmails:a,newInputValue:n}=Object(I.a)(t),r=a.map(e=>({type:"newUser",value:{email:e}})).filter(e=>!this.alreadyInvitingTarget(e));this.stores.permissionsInviteStore.setState(ce({},this.stores.permissionsInviteStore.state,{inviteTargets:[...this.stores.permissionsInviteStore.state.inviteTargets,...r],isInviteTargetsEmpty:!1,tokenQuery:n}))},this.handleClickRemoveToken=e=>{const{permissionsInviteStore:t}=this.stores;if(!t.state.isInviteTargetsEmpty)if(Object(m.c)(t.state))if(Object(m.c)(t.state)){const a=t.state.inviteTargets.filter(t=>t!==e);0===a.length?t.setState(ce({},t.state,{inviteTargets:[],inviteRole:this.getDefaultRoleForNonBot(),isInviteTargetsEmpty:!0})):t.setState(ce({},t.state,{inviteTargets:a}))}else Object(Y.e)(t.state);else{const a=t.state.inviteTargets.filter(t=>t!==e);0===a.length?t.setState(ce({},t.state,{inviteTargets:[],inviteRole:this.getDefaultRoleForNonBot(),isInviteTargetsEmpty:!0})):t.setState(ce({},t.state,{inviteTargets:a}))}}}async willMount(){await k.e(this.environment)}renderComponent(){const{store:e}=this.props,{device:t}=this.environment,{modalOpen:a}=this.stores.permissionsInviteStore.state;let n,r,i=!1;return e.canAdmin()?e.canAdmin()&&Object(ie.p)(e)&&P.default.state.data&&!O.L(this.environment)?(n=!1,i=!0,r=s.a.createElement(H.a,{imageURL:G.a.images.tooltips.upsells.spaceReadAndWritePng,imageWidth:240,imageHeight:100,caption:s.a.createElement(U.FormattedMessage,{defaultMessage:"Members are teammates you invite to your workspace. They can access and add pages for all members to see, or be added to pages with permissions for private collaboration.",id:"permissionsInvite.spaceAddMemberUpgradeTooltip.caption"}),title:s.a.createElement(U.FormattedMessage,{defaultMessage:"Upgrade to add members",id:"permissionsInvite.spaceAddMemberUpgradeTooltip.title"})})):n=!0:(n=!1,r=Object(ie.p)(e)?s.a.createElement(U.FormattedMessage,{id:"inviteUserButton.tooltip.adminsOnlyMessage",defaultMessage:"Only admins can add members."}):s.a.createElement(U.FormattedMessage,{id:"inviteUserButton.tooltip.fullAccessOnlyMessage",defaultMessage:"Only those with full access can add people."})),s.a.createElement("div",null,Object(ie.p)(e)?s.a.createElement(X.a,{open:a,onDismiss:this.handleModalDismiss,renderContent:this.renderOverlay,origin:s.a.createElement(f.a,{renderTooltip:()=>r,disableTooltip:n,render:e=>s.a.createElement(T.a,Object.assign({isLarge:!0,onClick:i?this.handleTrialClick:this.handleButtonClick,disabled:!n&&!i,style:ce({flex:this.props.shouldGrow?1:0},this.props.buttonStyle)},e),s.a.createElement(U.FormattedMessage,{id:"inviteUserButton.addMemberLabel",defaultMessage:"Add members"}))})}):s.a.createElement(X.a,{open:a,onDismiss:this.handleModalDismiss,renderContent:this.renderOverlay,origin:s.a.createElement(f.a,{renderTooltip:()=>r,disableTooltip:n,render:e=>s.a.createElement("div",{style:{display:"flex",alignItems:"center"}},s.a.createElement(ae,{onClick:i?this.handleTrialClick:this.handleButtonClick,disabled:!n&&!i,style:{flex:1,justifyContent:"flex-start",height:t.isMobile?34:26,borderTopRightRadius:0,borderBottomRightRadius:0}},s.a.createElement(U.FormattedMessage,{defaultMessage:"Add people, groups, or emails",id:"inviteUserButton.addGuestsAndGroupsLabel"})),s.a.createElement(T.a,Object.assign({onClick:i?this.handleTrialClick:this.handleButtonClick,disabled:!n&&!i,style:{height:t.isMobile?36:28,borderTopLeftRadius:0,borderBottomLeftRadius:0}},e),s.a.createElement(U.FormattedMessage,{id:"inviteUserButton.invitePersonLabel",defaultMessage:"Add people"})))})}))}renderHelpButton(){return s.a.createElement(S.a,{topBorder:!0,disableDesktopPadding:!0},s.a.createElement(F.a,{title:s.a.createElement(U.FormattedMessage,{id:"inviteUserModal.helpButton.caption",defaultMessage:"Learn how to invite people and set permissions"}),href:Object(z.a)("guides.invitePerson"),analyticsFrom:"invite_person"}))}renderDesktopInputRightInner(){return s.a.createElement("div",{style:{marginLeft:8,display:"flex",alignItems:"center"}},this.renderDesktopInputRightInnerSelect(),this.renderDesktopInputRightInnerButton())}renderDesktopInputRightInnerButton(){const{disabled:e}=this.props,{permissionsInviteStore:t}=this.stores,a=t.state.inviteTargets,n=a.filter(e=>{let{type:t}=e;return"newUser"===t}).map(e=>{let{value:t}=e;return t.email}),r=a.filter(e=>{let{type:t}=e;return"existingUser"===t}).map(e=>{let{value:t}=e;return t.id}),i=e||Object(W.d)({environment:this.environment,userIds:[...n,...r],includesOwner:!0});return s.a.createElement(f.a,{textWrap:!0,alignment:V.a.Center,disableTooltip:!i,renderTooltip:()=>s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{style:{width:280}},s.a.createElement(U.FormattedMessage,{id:"inviteUserButton.modalTooltip.guestLimitLine1",defaultMessage:"Your personal plan allows up to 5 unique guests."})),s.a.createElement("div",null,s.a.createElement(U.FormattedMessage,{id:"inviteUserButton.modalTooltip.guestLimitLine2",defaultMessage:"Upgrade to go unlimited."}))),render:e=>s.a.createElement(T.a,Object.assign({style:{minWidth:ue.inviteButtonWidth},onClick:i?this.handleUpgradeClick:this.handleInviteClick},e),i?s.a.createElement(U.FormattedMessage,{id:"inviteUserModal.inviteButton.upgradeLabel",defaultMessage:"Upgrade"}):s.a.createElement(U.FormattedMessage,{id:"inviteUserModal.inviteButton.label",defaultMessage:"Invite"}))})}renderDesktopInputRightInnerSelect(){const{device:e}=this.environment,{isSubscribed:t}=this.props,{permissionsInviteStore:a}=this.stores;return a.state.isInviteTargetsEmpty||!Object(m.c)(a.state)?s.a.createElement(u.a,{role:a.state.inviteRole,table:a.state.table,type:"user_permission",isSubscribed:t,isInvite:!0,onUpgradeButtonClick:this.props.onUpgradeButtonClick,upgradeButtonName:this.props.upgradeButtonName,buttonStyle:{display:"flex",whiteSpace:"nowrap",marginTop:e.isMobile?4:0,color:h.f.uiGray},isMenuItem:e.isMobile,onChange:e=>{!a.state.isInviteTargetsEmpty&&Object(m.c)(a.state)||a.setState(ce({},a.state,{inviteRole:e}))}}):a.state.table===oe.b?s.a.createElement(u.a,{role:a.state.inviteRole,table:a.state.table,type:"bot_permission",isSubscribed:t,isInvite:!0,onUpgradeButtonClick:this.props.onUpgradeButtonClick,upgradeButtonName:this.props.upgradeButtonName,buttonStyle:{display:"flex",whiteSpace:"nowrap",marginTop:e.isMobile?4:0,color:h.f.uiGray},isMenuItem:e.isMobile,onChange:e=>{(a.state.isInviteTargetsEmpty||Object(m.c)(a.state))&&a.state.table===oe.b&&a.setState(ce({},a.state,{inviteRole:e}))}}):a.state.table===se.a?s.a.createElement(u.a,{role:a.state.inviteRole,table:a.state.table,type:"bot_permission",isSubscribed:t,isInvite:!0,onUpgradeButtonClick:this.props.onUpgradeButtonClick,upgradeButtonName:this.props.upgradeButtonName,buttonStyle:{display:"flex",whiteSpace:"nowrap",marginTop:e.isMobile?4:0,color:h.f.uiGray},isMenuItem:e.isMobile,onChange:e=>{(a.state.isInviteTargetsEmpty||Object(m.c)(a.state))&&a.state.table===se.a&&a.setState(ce({},a.state,{inviteRole:e}))}}):Object(Y.e)(a.state)}getDefaultRoleForNonBot(){const{store:e,isSubscribed:t}=this.props;return Object(ie.p)(e)?t?"read_and_write":"editor":O.Q(this.environment)?"editor":"read_and_write"}getDefaultRoleForBlockBot(){return"read_and_write"}getDefaultRoleForSpaceBot(){return"editor"}alreadyInvitingTarget(e){return this.stores.permissionsInviteStore.state.inviteTargets.find(t=>"newUser"===e.type?"newUser"===t.type&&e.value.email===t.value.email:t.type===e.type&&t.value.id===e.value.id)}targetHasPermission(e){const t=this.props.store.getValue();return!!t&&Object(R.h)(t).some(t=>{switch(e.type){case"existingUser":return Object(A.q)(t)&&t.user_id===e.value.id;case"bot":return Object(A.g)(t)&&t.bot_id===e.value.id;case"group":return Object(A.i)(t)&&t.group_id===e.value.id;default:return!1}})}getTargetName(e){const{intl:t}=this.props;switch(e.type){case"newUser":return e.value.email;case"existingUser":return Object(B.d)(t,e.value);case"bot":return Object(Z.a)(e.value);case"group":return Object(Q.a)({intl:t,group:e.value});default:throw Object(Y.e)(e)}}getBadgeStyle(){const{device:e}=this.environment;return{display:"inline-flex",height:18,textTransform:"uppercase",fontSize:10,marginBottom:2,fontWeight:g.a.fontWeight.medium,letterSpacing:1,color:h.f.uiLightGray,border:"1px solid ".concat(h.f.uiLightGray),minWidth:ue.inviteButtonWidth,alignItems:"center",justifyContent:"center",paddingTop:e.isAndroid?2:1,paddingBottom:1,paddingLeft:3,paddingRight:3,borderRadius:3}}}ue.avatarSize=24,ue.inviteButtonWidth=70;t.default=Object(U.injectIntl)(ue)},G8iD:function(e,t,a){"use strict";a.d(t,"b",(function(){return l})),a.d(t,"a",(function(){return c}));a("ioFf"),a("rGqo");var n=a("/ssM"),r=a("LEzx");function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const l=20;var c;!function(e){e.Default="Default",e.Results="Results"}(c||(c={}));class d extends r.a{constructor(){super(...arguments),this.resetQuery=e=>{let{resetFilters:t}=e;this.setState(s({},this.state,{mode:c.Default,query:s({},this.state.query,{text:""},t&&{filters:Object(n.e)()}),limit:l,allResultsLoaded:!1}))},this.updateFilters=e=>{const t=this.state.query.filters,a=Object(n.f)(t,e);this.state.mode,c.Default,this.setState(s({},this.state,{query:s({},this.state.query,{filters:a})}))}}getInitialState(){return{mode:c.Default,isSidebarOpen:!1,query:{text:"",filters:Object(n.e)(),sort:"Relevance"},limit:l,allResultsLoaded:!1}}isSidebarOpen(){if(this.state.isSidebarOpen){const{state:e}=this;return!0}return!1}}d.Mode=c,t.c=d},"J9+n":function(e,t,a){"use strict";a.r(t);a("ioFf"),a("rGqo");var n=a("q1tI"),r=a.n(n),i=a("LvDl"),s=a.n(i),o=a("N34Z"),l=a("bkwR"),c=a("hvW1"),d=a("VBxf"),u=a("frzs"),p=a("QcDD"),m=a("y6Dp"),h=a("dlZW"),g=a("J9+s"),f=a("vl8/");const b=Object(g.defineMessages)({deletingAccount:{id:"accountActions.deletingAccount.loadingMessage",defaultMessage:"Deleting your account…"},noUserError:{id:"accountActions.deletingAccount.noUserToDeleteMessage",defaultMessage:"No account to delete."}}),y=function(e){const{userStore:t,data:a,transaction:n}=e,r={};a.givenName&&(r.given_name=a.givenName),a.familyName&&(r.family_name=a.familyName),r.profile_photo=a.profilePhoto,o.d({store:t,data:r,transaction:n})};var S=a("sdlW"),v=a("nM47"),E=a("LEzx"),M=a("D2XV");class C extends E.a{getInitialState(){return{uploadingProfilePhoto:!1,givenName:"",familyName:"",startDayOfWeek:Object(M.H)()}}getValueForUser(e,t){const a=e.getValue();if(a){const{given_name:e,family_name:n,profile_photo:r}=a,i=t.getSettings();return{uploadingProfilePhoto:!1,givenName:e||"",familyName:n||"",profilePhoto:r,startDayOfWeek:void 0===i.start_day_of_week?Object(M.H)():i.start_day_of_week}}}}var w=C;class O extends E.a{getInitialState(){return{emailDomains:[],name:"",domain:""}}getValueForSpace(e){const t=e.getValue(),a=e.getDomain();if(t){const{name:e,email_domains:n}=t;return{name:e||"",domain:a||"",emailDomains:n||[]}}}}var k=O;class P extends E.a{getInitialState(){return{disablePublicAccess:!1,disableGuests:!1,disableMoveToSpace:!1,disableExport:!1,disableSpacePageEdits:!1,disablePublicAccessRequests:!1}}getValueForSpace(e){const t=e.getValue();if(t){const{disable_public_access:e,disable_guests:a,disable_move_to_space:n,disable_export:r,disable_space_page_edits:i,disable_public_access_requests:s}=t;return{disablePublicAccess:Boolean(e),disableGuests:Boolean(a),disableMoveToSpace:Boolean(n),disableExport:Boolean(r),disableSpacePageEdits:Boolean(i),disablePublicAccessRequests:Boolean(s)}}}}var T=P;function D(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function I(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}async function F(e){const{environment:t,spaceId:a,store:n}=e,r=await l.getSamlConfigForSpace(t,{spaceId:a});if("failed"===r.type)d.showError(r);else if(r.data&&r.data.samlConfig){const e=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?D(Object(a),!0).forEach((function(t){I(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):D(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},r.data.samlConfig,{useMetadataUrl:Boolean(r.data.samlConfig.idpMetadataUrl)});return n.setState(e),r.data}return n.reset(),{}}class j extends E.a{getInitialState(){return{status:"unconfigured",emailDomains:[],spaceIds:[],createAccount:!1,useMetadataUrl:!1}}async getValueForSpace(e,t){const a=new j;return await F({environment:e,spaceId:t.id,store:a}),Promise.resolve(a.state)}}var x=j,B=a("toub"),A=a("wldR"),R=a("pqiZ"),L=a("/6eU"),U=a("AXyr"),_=a("qKs6"),W=a("A9TN"),N=a("2m/B"),q=a("yNyh"),V=a("wlCD"),z=a("2A6Q"),H=a("rQb/"),G=a("MYfK"),Q=a("MBf9"),Y=a("hU3F"),Z=a("Sb6f"),X=a("p+Y9"),K=a("1y3T"),J=a("vJXr"),$=a("zmp8"),ee=a("Ng05"),te=a("IULH");a("KKXr");function ae(){return(navigator.languages?navigator.languages.map(e=>e.toLowerCase()):navigator.language?[navigator.language.toLowerCase()]:navigator.userLanguage?[navigator.userLanguage.toLowerCase()]:[]).map(e=>e.split("-")[0])}const ne=["ar","az","he","fa","ur"];function re(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ie(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?re(Object(a),!0).forEach((function(t){se(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):re(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function se(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class oe extends A.a{renderComponent(){return this.renderTranslatedText()}renderTranslatedText(){const{translations:e}=this.props,t=ae();for(const a of t){const t=e[a];if(t)return r.a.createElement("div",{style:this.getTextStyle(a)},t)}}getTextStyle(e){return ne.includes(e)?ie({direction:"rtl"},this.props.style):ie({},this.props.style)}}var le=oe,ce=a("sSHh"),de=a("Mkmb"),ue=a("aEEb"),pe=a("HTHG"),me=a("VoJ/"),he=a("CSYU"),ge=a("ibYI"),fe=a("Cycz"),be=a("mF3+"),ye=a("kFin"),Se=a("CNGQ"),ve=a("bxQm"),Ee=a("sZEU");class Me extends E.a{getInitialState(){return{open:!1,authorized:!1,authorizationType:void 0}}}var Ce=Me,we=a("IYZQ"),Oe=a("zzAG");function ke(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Pe(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ke(Object(a),!0).forEach((function(t){Te(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ke(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Te(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class De extends A.a{constructor(){super(...arguments),this.storeTypes={store:Ce},this.renderModalContent=()=>{const{store:e}=this.stores,{state:t}=e;return r.a.createElement("div",{style:Pe({},this.styles.modal,{},this.getColors().modal)},r.a.createElement(ye.a,{fetch:this.getAuthorizationType,loading:e=>e&&r.a.createElement("div",{style:this.styles.loadingSpinner},r.a.createElement(V.a,null)),render:()=>r.a.createElement(r.a.Fragment,null,"Password"===t.authorizationType?this.renderVerifyPassword(t):"TemporaryPasscode"===t.authorizationType?this.renderVerifyCurrentEmail(t):void 0,t.authorized&&this.renderSetNewEmail(t))}))},this.renderSetNewEmail=e=>{const{store:t}=this.stores;if(t.state.authorized)return r.a.createElement(r.a.Fragment,null,r.a.createElement("p",{style:this.styles.paragraph},r.a.createElement(g.FormattedMessage,{id:"profileSettings.changeEmailModal.newEmailInstructions",defaultMessage:"Please enter a new email and we will send you a verification code."})),r.a.createElement("div",null,this.renderNewEmailInput()),t.state.newEmailPasscodeSent?this.renderNewEmailPasscodeInput(e):this.renderSendNewEmailPasscodeButton(e),this.renderEducationPlanDowngradeWarning())},this.handleSendCurrentEmailVerification=async()=>{const{userValue:e}=this.props,{store:t}=this.stores;if(!e)return;const a=await l.sendTemporaryPassword(this.environment,{email:e.email,disableLoginLink:!0,isSignup:!1});"success"===a.type?t.setState(Pe({},t.state,{currentEmailPasscodeSent:!0,currentEmailPasscode:"",error:void 0})):t.setState(Pe({},t.state,{currentEmailPasscodeSent:!0,error:Object(Oe.b)(this.props.intl,a)}))},this.handleChangeCurrentEmailPasscode=e=>{const{store:t}=this.stores;t.setState(Pe({},t.state,{currentEmailPasscode:e.currentTarget.value,error:void 0}))},this.handleChangePassword=e=>{const{store:t}=this.stores;t.setState({open:!0,authorized:!1,authorizationType:"Password",password:e.currentTarget.value,error:void 0})},this.handleClearPassword=()=>{const{store:e}=this.stores;e.setState({open:!0,authorized:!1,authorizationType:"Password",password:""})},this.handleSubmitAuthorization=async()=>{const{store:e}=this.stores;if(!e.state.authorized)if("Password"===e.state.authorizationType){const t=this.getUserCurrentEmail();if(!t)return;const a=await l.loginWithEmail(this.environment,{email:t,password:e.state.password});if("failed"===a.type)return void e.setState(Pe({},e.state,{error:Object(Oe.b)(this.props.intl,a)}));e.setState(Pe({},e.state,{authorized:!0,newEmail:"",newEmailPasscode:"",newEmailPasscodeSent:!1}))}else"TemporaryPasscode"===e.state.authorizationType&&e.setState(Pe({},e.state,{authorized:!0,newEmail:"",newEmailPasscode:"",newEmailPasscodeSent:!1}))},this.handleChangeNewEmail=e=>{const{store:t}=this.stores;t.setState(Pe({},t.state,{newEmail:e.currentTarget.value,error:void 0}))},this.handleClearNewEmail=()=>{const{store:e}=this.stores;e.setState(Pe({},e.state,{newEmail:"",newEmailPasscodeSent:!1,error:void 0}))},this.handleSendNewEmailVerification=async()=>{const{store:e}=this.stores;if(!e.state.authorized)return;const t=await l.sendEmailVerification(this.environment,{email:e.state.newEmail});"success"===t.type?e.setState(Pe({},e.state,{newEmailPasscodeSent:!0,newEmailPasscode:"",error:void 0})):e.setState(Pe({},e.state,{error:Object(Oe.b)(this.props.intl,t)}))},this.handleChangeNewEmailPasscode=e=>{const{store:t}=this.stores;t.setState(Pe({},t.state,{newEmailPasscode:e.currentTarget.value,error:void 0}))},this.handleSubmit=async()=>{const{store:e}=this.stores;if(!e.state.authorized)return;const t="Password"===e.state.authorizationType?{type:"Password",password:e.state.password,newEmail:e.state.newEmail,newEmailPasscode:e.state.newEmailPasscode}:{type:"CurrentEmail",currentEmailPasscode:e.state.currentEmailPasscode,newEmail:e.state.newEmail,newEmailPasscode:e.state.newEmailPasscode},a=await l.changeEmail(this.environment,t);"success"===a.type?await this.closeModal():e.setState(Pe({},e.state,{error:Object(Oe.b)(this.props.intl,a)}))},this.handleSendUsMessageClick=()=>{Ee.a({environment:this.environment,from:"change_email_student"})},this.openModal=()=>{const{store:e}=this.stores;e.setState({open:!0,authorized:!1,authorizationType:void 0})},this.closeModal=async()=>{const{store:e}=this.stores,{hasEducationPlan:t}=this.props;e.reset(),t&&await v.e(this.environment)},this.getAuthorizationType=async()=>{const{store:e}=this.stores,{intl:t}=this.props,a=this.getUserCurrentEmail();if(!a)return;const n=await Se.b({environment:this.environment,userEmail:a});n.error?e.setState({open:e.state.open,authorized:!1,authorizationType:void 0,error:t.formatMessage({id:"profileSettings.changeEmailModal.errorFetchingAccountData",defaultMessage:"Could not fetch account information for {currentEmail}."},{currentEmail:a})}):n.value.hasPassword?e.setState({open:!0,authorized:!1,authorizationType:"Password",password:""}):e.setState({open:!0,authorized:!1,authorizationType:"TemporaryPasscode",currentEmailPasscodeSent:!1,currentEmailPasscode:""})},this.styles={modal:{width:460,padding:32,borderRadius:3,fontSize:14},loadingSpinner:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center"},paragraph:{marginTop:12,marginBottom:14},error:{color:$.f.red,fontSize:12,marginTop:4,marginLeft:8},bold:{fontWeight:Z.a.fontWeight.bold},input:{padding:"4px 8px"},button:{marginTop:14},educationPlanWarning:{display:"flex",marginTop:14,paddingTop:14}}}renderComponent(){const{userValue:e}=this.props,{store:t}=this.stores;return r.a.createElement(r.a.Fragment,null,r.a.createElement(G.a,null,r.a.createElement(g.FormattedMessage,{id:"profileSettings.personalInfoSection.emailSetting.label",defaultMessage:"Email"})),r.a.createElement("div",null,r.a.createElement("span",{style:{marginRight:12}},e&&e.email),r.a.createElement(ve.a,{onClick:this.openModal},r.a.createElement(g.FormattedMessage,{id:"profileSettings.personalInfoSection.emailSetting.changeEmailButton.label",defaultMessage:"Change email"}))),r.a.createElement(L.a,{open:t.state.open,onDismiss:this.closeModal,render:this.renderModalContent}))}renderVerifyPassword(e){const{userValue:t}=this.props;if(t)return r.a.createElement(r.a.Fragment,null,r.a.createElement("p",{style:{margin:0}},this.renderCurrentEmail()),r.a.createElement("p",{style:this.styles.paragraph},r.a.createElement(g.FormattedMessage,{id:"profileSettings.changeEmailModal.enterPasswordInstructions",defaultMessage:"Please enter your password."})),r.a.createElement(q.b,{style:{display:"none"},type:"text",value:t.email,autoComplete:"username",disabled:!0}),r.a.createElement(q.b,{type:"password",disabled:e.authorized,value:e.password,onChange:this.handleChangePassword,showClearButton:!0,onClearButtonClick:this.handleClearPassword,onSubmit:this.handleSubmitAuthorization,placeholder:this.props.intl.formatMessage({id:"profileSettings.changeEmailModal.passwordInput.label",defaultMessage:"Password"}),style:this.styles.input,focusInitial:!0,autoComplete:"current-password"}),!e.authorized&&e.error&&r.a.createElement("div",{style:this.styles.error},e.error),!e.authorized&&r.a.createElement(ee.a,{isLarge:!0,style:this.styles.button,onClick:this.handleSubmitAuthorization},r.a.createElement(g.FormattedMessage,{id:"profileSettings.changeEmailModal.continueButton.label",defaultMessage:"Continue",description:"After the user verifies their current password or email, they click this button to continue changing their email."})))}renderVerifyCurrentEmail(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement("p",{style:Pe({},this.styles.paragraph,{marginTop:0})},this.renderCurrentEmail()," ",e.currentEmailPasscodeSent?r.a.createElement(g.FormattedMessage,{id:"profileSettings.changeEmailModal.sentVerificationCodeToCurrentEmail",defaultMessage:"We've sent a temporary verification code to this email."}):r.a.createElement(g.FormattedMessage,{id:"profileSettings.changeEmailModal.sendVerificationCodeToCurrentEmail",defaultMessage:"We'll send a temporary verification code to this email."})),e.currentEmailPasscodeSent?this.renderCurrentEmailPasscodeInput(e):this.renderSendCurrentEmailPasscodeButton())}renderSendCurrentEmailPasscodeButton(){return r.a.createElement(ee.a,{isLarge:!0,onClick:this.handleSendCurrentEmailVerification},r.a.createElement(g.FormattedMessage,{id:"profileSettings.changeEmailModal.sendCurrentEmailVerificationCode.label",defaultMessage:"Send verification code",description:"Sends a temporary verification passcode to the user's current email."}))}renderCurrentEmailPasscodeInput(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement(q.b,{value:e.currentEmailPasscode,onChange:this.handleChangeCurrentEmailPasscode,onSubmit:this.handleSubmitAuthorization,placeholder:this.props.intl.formatMessage({id:"profileSettings.changeEmailModal.enterCurrentEmailVerificationCodeInput.placeholder",defaultMessage:"Enter verification code"}),focusInitial:!0,style:this.styles.input}),!e.authorized&&r.a.createElement(ee.a,{isLarge:!0,style:this.styles.button,onClick:this.handleSubmitAuthorization},r.a.createElement(g.FormattedMessage,{id:"profileSettings.changeEmailModal.continueButton.label",defaultMessage:"Continue",description:"After the user verifies their current password or email, they click this button to continue changing their email."})))}renderNewEmailInput(){const{store:e}=this.stores;if(e.state.authorized)return r.a.createElement(q.b,{value:e.state.newEmail,onChange:this.handleChangeNewEmail,onSubmit:this.handleSendNewEmailVerification,showClearButton:!0,onClearButtonClick:this.handleClearNewEmail,placeholder:this.props.intl.formatMessage({id:"profileSettings.changeEmailModal.newEmailInput.placeholder",defaultMessage:"Enter new email"}),style:this.styles.input,focusInitial:!0})}renderSendNewEmailPasscodeButton(e){return r.a.createElement(r.a.Fragment,null,e.error&&r.a.createElement("div",{style:this.styles.error},e.error),r.a.createElement(ee.a,{isLarge:!0,style:this.styles.button,onClick:this.handleSendNewEmailVerification},r.a.createElement(g.FormattedMessage,{id:"profileSettings.changeEmailModal.sendVerificationCodeButton.label",defaultMessage:"Send verification code"})))}renderNewEmailPasscodeInput(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement("p",{style:this.styles.paragraph},r.a.createElement(g.FormattedMessage,{id:"profileSettings.changeEmailModal.verificationCodeSentMessage",defaultMessage:"We just sent you a temporary verification code to {newEmail}.",values:{newEmail:r.a.createElement("span",{style:this.styles.bold},e.newEmail)}})),r.a.createElement(q.b,{value:e.newEmailPasscode,onChange:this.handleChangeNewEmailPasscode,onSubmit:this.handleSubmit,placeholder:this.props.intl.formatMessage({id:"profileSettings.changeEmailModal.enterVerificationCodeInput.placeholder",defaultMessage:"Enter verification code"}),focusInitial:!0,style:this.styles.input}),e.error&&r.a.createElement("div",{style:this.styles.error},e.error),r.a.createElement(ee.a,{isLarge:!0,style:this.styles.button,onClick:this.handleSubmit},r.a.createElement(g.FormattedMessage,{id:"profileSettings.changeEmailModal.changeEmailButton.label",defaultMessage:"Change email"})))}renderEducationPlanDowngradeWarning(){var e=this;const{hasEducationPlan:t}=this.props;if(t)return r.a.createElement("div",{style:Pe({},this.styles.educationPlanWarning,{},this.getColors().educationPlanWarning)},be.a.help({width:14,marginTop:4,marginRight:6,fill:this.theme.lightIconColor})," ",r.a.createElement("div",null,r.a.createElement(g.FormattedMessage,{defaultMessage:"Changing your email may downgrade your workspace on a Free Education Plan to the basic Free Plan. You won't lose any data, but you'll need to upgrade to re-access paid features. Have questions about this? <sendmessagelink>Send us a message</sendmessagelink>.",id:"emailChangeSettings.downgradeEducationPlan.warning.message",values:{sendmessagelink:function(){for(var t=arguments.length,a=new Array(t),n=0;n<t;n++)a[n]=arguments[n];return r.a.createElement(we.a,{onClick:e.handleSendUsMessageClick},a)}}})))}renderCurrentEmail(){const{userValue:e}=this.props;if(e)return r.a.createElement(g.FormattedMessage,{id:"profileSettings.changeEmailModal.currentEmail",defaultMessage:"Your current email is {currentEmail}.",values:{currentEmail:r.a.createElement("span",{style:this.styles.bold},e&&e.email)}})}getUserCurrentEmail(){const{store:e}=this.stores,{userValue:t,intl:a}=this.props;if(t)return t.email;e.setState({open:e.state.open,authorized:!1,authorizationType:void 0,error:a.formatMessage({id:"profileSettings.changeEmailModal.errorNoUserValue",defaultMessage:"User value is undefined."})})}getColors(){return{modal:{background:this.theme.contentBackground},educationPlanWarning:{color:this.theme.lightTextColor,borderTop:"1px solid ".concat(this.theme.regularDividerColor)}}}}var Ie=Object(g.injectIntl)(De),Fe=a("2ZkR"),je=a("0CAA"),xe=a("qX+M");class Be extends E.a{getInitialState(){return{open:!1}}}var Ae=new Be;function Re(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Le(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Re(Object(a),!0).forEach((function(t){Ue(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Re(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Ue(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class _e extends A.a{constructor(){super(...arguments),this.handleLogOutFromActiveSessions=async()=>{await l.logoutActiveSessions(this.environment,{}),this.openConfirmationModal()}}renderComponent(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:this.getSettingsOptionStyle()},r.a.createElement(H.a,{smallMarginBottom:!0},r.a.createElement(g.FormattedMessage,{id:"manageActiveSessions.title",defaultMessage:"Log out of all devices"})),r.a.createElement(ue.a,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"80%"}},r.a.createElement(g.FormattedMessage,{id:"manageActiveSessions.logOutActiveSessions.label",defaultMessage:"You will be logged out of all other active sessions besides this one and will have to log back in."})),r.a.createElement(te.a,{isLarge:!0,isRed:!0,onClick:this.handleLogOutFromActiveSessions,style:{marginTop:12}},r.a.createElement(g.FormattedMessage,{id:"manageActiveSessions.logOutActiveSessions.button",defaultMessage:"Log out"}))),this.renderManageActiveSessionsModal())}renderManageActiveSessionsModal(){const{device:e}=this.environment,{open:t}=Ae.state,a=this.getUserEmailAddress();return r.a.createElement(L.a,{open:t,onDismiss:this.closeConfirmationModal,innerStyle:{width:e.isPhone?"90%":350,padding:24,display:"flex",flexDirection:"column"},render:()=>r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{marginBottom:24}},a?r.a.createElement(g.FormattedMessage,{id:"manageActiveSessions.confirmationModal.withEmail",defaultMessage:"You have been logged out from other active sessions for {email}.",values:{email:a}}):r.a.createElement(g.FormattedMessage,{id:"manageActiveSessions.confirmationModal.withoutEmail",defaultMessage:"You have been logged out from other active sessions for your account."})),r.a.createElement(ee.a,{onClick:this.closeConfirmationModal},r.a.createElement(g.FormattedMessage,{id:"manageActiveSessions.confirmationModal.close",defaultMessage:"Close"})))})}openConfirmationModal(){Ae.setState(Le({},Ae.state,{open:!0}))}closeConfirmationModal(){Ae.setState(Le({},Ae.state,{open:!1}))}getUserEmailAddress(){let e=void 0;const{currentUserStore:t}=p.default.state;if(t){const a=t.getValue();e=a&&a.email}return e}getSettingsOptionStyle(){const{device:e,WindowSizeStore:t}=this.environment;return{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%",height:"auto",paddingLeft:e.isMobile?t.state.paddingLeftCSS:0,paddingRight:e.isMobile?t.state.paddingRightCSS:0}}}var We=_e,Ne=a("8Gp+");function qe(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ve(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?qe(Object(a),!0).forEach((function(t){ze(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):qe(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function ze(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class He extends A.a{constructor(){super(...arguments),this.storeTypes={spaceProfileSettingsStore:w,passwordRequestStore:he.a,isEducationStore:Y.a.of(!1)},this.handleUploadProfilePhoto=()=>{X.c({environment:this.environment,onStart:this.handleUploadStart,bucket:"public",onError:this.handleUploadError,onComplete:this.handleUploadComplete,accept:"image/*"})},this.handleDeleteProfilePhoto=()=>{this.stores.spaceProfileSettingsStore.setState(Ve({},this.stores.spaceProfileSettingsStore.state,{profilePhoto:void 0}))},this.handleUpdateClick=()=>{const{givenName:e,familyName:t,profilePhoto:a,startDayOfWeek:n}=this.stores.spaceProfileSettingsStore.state;e&&t?(Q.createAndCommit(this.environment,r=>{const{currentUserStore:i,currentUserSettingsStore:s}=p.default.state;if(i&&y({userStore:i,data:{givenName:e,familyName:t,profilePhoto:a},transaction:r}),s){s.getSettings().start_day_of_week!==n&&_.f({userSettingsStore:s,data:{start_day_of_week:n},transaction:r})}}),B.a.setState(Ve({},B.a.state,{open:!1}))):d.showErrorMessage(r.a.createElement(g.FormattedMessage,{id:"profileSettings.personalInfoSection.firstOrLastNameMissing.message",defaultMessage:"Please fill in both first name and last name."}))},this.handleStartOfWeekToggle=()=>{const{state:e}=this.stores.spaceProfileSettingsStore,{startDayOfWeek:t}=e;this.stores.spaceProfileSettingsStore.setState(Ve({},e,{startDayOfWeek:t?0:1}))},this.handleCancelClick=()=>{B.a.setState(Ve({},B.a.state,{open:!1}))},this.handleGivenNameChange=e=>{this.stores.spaceProfileSettingsStore.setState(Ve({},this.stores.spaceProfileSettingsStore.state,{givenName:e.target.value}))},this.handleFamilyNameChange=e=>{this.stores.spaceProfileSettingsStore.setState(Ve({},this.stores.spaceProfileSettingsStore.state,{familyName:e.target.value}))},this.handleUploadStart=()=>{this.stores.spaceProfileSettingsStore.setState(Ve({},this.stores.spaceProfileSettingsStore.state,{uploadingProfilePhoto:!0}))},this.handleUploadError=()=>{this.stores.spaceProfileSettingsStore.setState(Ve({},this.stores.spaceProfileSettingsStore.state,{uploadingProfilePhoto:!1})),d.showErrorMessage(r.a.createElement(g.FormattedMessage,{id:"profileSettings.profilePhotoSection.uploadProfilePhotoError.message",defaultMessage:"Upload failed."}))},this.handleUploadComplete=e=>{this.stores.spaceProfileSettingsStore.setState(Ve({},this.stores.spaceProfileSettingsStore.state,{profilePhoto:e[0],uploadingProfilePhoto:!1}))},this.handleDeleteAccountClick=async()=>{const{currentUserStore:e,currentUserRootStore:t}=p.default.state;if(!e||!t)return;const a=e.getValue();if(!a)return;const n=s.a.compact(t.getSpaceViewStores().map(e=>e.getSpaceStore())).filter(e=>!Object(de.e)(e.getValue(),e.getRole())),i=s.a.compact(n.map(e=>Object(xe.getSpaceName)(this.environment,e)));await U.b({width:420,message:r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement(g.FormattedMessage,{id:"profileSettings.deleteAccountConfirmationDialog.warning",defaultMessage:"This action cannot be undone. This will permanently delete your entire account. All private workspaces will be deleted, and you will be removed from all shared workspaces."}),i.length>0&&r.a.createElement("ul",{style:{padding:0}},i.map(e=>r.a.createElement("li",{style:{marginTop:6,color:$.f.red,fontWeight:Z.a.fontWeight.medium,listStyle:"none"}},e)))," ",r.a.createElement(g.FormattedMessage,{id:"profileSettings.deleteAccountConfirmationDialog.prompt",defaultMessage:"Please type in your email to confirm."})),r.a.createElement(le,{style:{marginTop:16},translations:{es:"Esta acción no se puede deshacer. Esto eliminará permanentemente su cuenta completa. Se eliminarán todas las áreas de trabajo privadas y se eliminará de todas las áreas de trabajo compartidas. Por favor, escriba su correo electrónico para confirmar.",ru:"Это действие не может быть отменено. Это навсегда удалит всю вашу учетную запись. Все частные рабочие области будут удалены, и вы будете удалены из всех общих рабочих областей. Пожалуйста, введите ваш адрес электронной почты для подтверждения.",zh:"此操作无法撤消。 这将永久删除您的整个帐户。 将删除所有私有工作空间，您将从所有共享工作空间中删除。 请输入您的电子邮箱进行确认。",de:"Diese Aktion kann nicht rückgängig gemacht werden. Dadurch wird Ihr gesamtes Konto dauerhaft gelöscht. Alle privaten Arbeitsbereiche werden gelöscht und Sie werden aus allen freigegebenen Arbeitsbereichen entfernt. Bitte geben Sie Ihre E-Mail-Adresse zur Bestätigung ein.",fr:"Cette action ne peut pas être annulée. Cela supprimera définitivement votre compte en entier. Tous les espaces de travail privés seront supprimés et vous serez supprimé de tous les espaces de travail partagés. Veuillez taper votre email pour confirmer.",ja:"この操作を元に戻すことはできません。 これによりアカウント全体が完全に削除されます。 すべてのプライベートワークスペースが削除され、あなたはすべての共有ワークスペースから削除されます。 確認のためにメールアドレスを入力してください。",it:"Questa azione non può essere annullata. Questo eliminerà definitivamente l'intero account. Tutti gli spazi di lavoro privati verranno eliminati e verranno rimossi da tutti gli spazi di lavoro condivisi. Inserisci la tua email per confermare.",pt:"Essa ação não pode ser desfeita. Isso excluirá permanentemente sua conta inteira. Todos os espaços de trabalho privados serão excluídos e você será removido de todos os espaços de trabalho compartilhados. Por favor, digite o seu email para confirmar.",nl:"Deze actie kan niet ongedaan gemaakt worden. Hiermee wordt uw gehele account permanent verwijderd. Alle privéwerkruimten worden verwijderd en u wordt verwijderd uit alle gedeelde werkruimten. Voer je e-mailadres in om te bevestigen.",pl:"Tego działania nie można cofnąć. Spowoduje to trwałe usunięcie całego konta. Wszystkie prywatne obszary robocze zostaną usunięte, a użytkownik zostanie usunięty ze wszystkich współużytkowanych obszarów roboczych. Wpisz swój e-mail, aby potwierdzić.",sv:"Den här åtgärden kan inte ångras. Detta tar bort hela ditt konto permanent. Alla privata arbetsytor kommer att raderas, och du kommer att tas bort från alla delade arbetsytor. Vänligen skriv in din email för att bekräfta.",uk:"Цю дію не можна скасувати. Таким чином буде видалено весь обліковий запис назавжди. Всі приватні робочі області будуть видалені, і ви будете видалені з усіх спільних робочих областей. Будь ласка, введіть електронний лист для підтвердження.",no:"Denne handlingen kan ikke fortrykkes. Dette vil permanent slette hele kontoen din. Alle private arbeidsområder blir slettet, og du vil bli fjernet fra alle delte arbeidsområder. Vennligst skriv inn din epost for å bekrefte.",tr:"Bu işlem geri alınamaz. Bu işlem hesabınızın tamamını kalıcı olarak siler. Tüm özel çalışma alanları silinecek ve paylaşılan tüm çalışma alanlarından kaldırılacaksınız. Lütfen onaylamak için e-postanızı yazın.",cs:"Tuto akci nelze vrátit zpět. Tím bude trvale smazán celý váš účet. Všechny soukromé pracovní prostory budou smazány a budete ze všech sdílených pracovních prostor odstraněni. Pro potvrzení zadejte svůj e-mail.",vi:"Hành động này không thể được hoàn tác. Điều này sẽ xóa vĩnh viễn toàn bộ tài khoản của bạn. Tất cả các không gian làm việc riêng tư sẽ bị xóa và bạn sẽ bị xóa khỏi tất cả các không gian làm việc chung. Vui lòng nhập email của bạn để xác nhận.",da:"Denne handling kan ikke fortrydes. Dette vil permanent slette hele din konto. Alle private arbejdsområder slettes, og du vil blive fjernet fra alle delte arbejdsområder. Indtast venligst din email for at bekræfte.",hu:"Ez a művelet nem visszavonható. Ez véglegesen törli a teljes fiókot. Minden privát munkaterület törlődik, és eltávolításra kerül minden megosztott munkaterületről. Kérjük, írja be e-mail címét, hogy megerősítse.",ar:"لا يمكن التراجع عن هذا الإجراء. سيؤدي الإجراء إلى حذف حسابك بالكامل. سيتم أيضا حذف جميع مساحات العمل الخاصة ، وستتم إزالتك من جميع مساحات العمل المشتركة. يرجى كتابة البريد الإلكتروني الخاص بك للتأكيد.",th:"การกระทำนี้ไม่สามารถยกเลิกได้ นี่จะเป็นการลบบัญชีทั้งหมดของคุณอย่างถาวร พื้นที่ทำงานส่วนตัวทั้งหมดจะถูกลบและคุณจะถูกลบออกจากพื้นที่ทำงานที่ใช้ร่วมกันทั้งหมด กรุณาพิมพ์อีเมลของคุณเพื่อยืนยัน",he:"לא ניתן לבטל פעולה זו. פעולה זו תמחק לצמיתות את כל החשבון שלך. כל סביבות העבודה הפרטיות יימחקו, ותוסר מכל סביבות העבודה המשותפות. הקלד את האימייל שלך כדי לאשר.",fi:"Tätä toimintoa ei voi peruuttaa. Tämä poistaa koko tilin pysyvästi. Kaikki yksityiset työtilat poistetaan ja poistetaan kaikista jaetuista työtiloista. Vahvistaaksesi kirjoita sähköpostiosoitteesi.",id:"Tindakan ini tidak bisa dibatalkan. Ini akan secara permanen menghapus seluruh akun Anda. Semua ruang kerja pribadi akan dihapus, dan Anda akan dihapus dari semua ruang kerja bersama. Ketikkan email Anda untuk mengonfirmasi."}})),acceptLabel:0===i.length?r.a.createElement(g.FormattedMessage,{id:"profileSettings.deleteAccountConfirmationDialog.deleteAccountButton.label",defaultMessage:"Permanently delete account"}):r.a.createElement(g.FormattedMessage,{id:"profileSettings.deleteAccountConfirmationDialog.deleteAccountAndWorkspacesButton.label",defaultMessage:"{numberOfWorkspaces, plural, one {Permanently delete account and 1 workspace} other {Permanently delete account and {numberOfWorkspaces} workspaces}}",values:{numberOfWorkspaces:i.length}}),requiredInputValue:a.email})&&(B.a.reset(),async function(e){c.b({message:b.deletingAccount});const t=e.currentUser.id,{currentUserRootStore:a,currentUserStore:n}=p.default.state;if(!a||!n||!t)return c.a(),void d.showErrorMessage(f.default.formatMessage(b.noUserError));m.wb(e),await l.deleteUser(e,{}),await h.transactionQueue.clearForUser(t),u.logoutSingleAccount({environment:e,userId:t}),c.a()}(this.environment))}}willMount(e){super.willMount(e);const{spaceProfileSettingsStore:t,isEducationStore:a}=this.stores,{currentUserStore:n,currentUserSettingsStore:r,currentUserRootStore:i}=p.default.state;if(n&&r){const e=t.getValueForUser(n,r);e&&t.setState(e)}if(i){const e=(Object(fe.b)({environment:this.environment,userRootStore:i})||[]).some(e=>e===W.default.pricing.student.productId);a.set(e)}}renderComponent(){return J.a.state.online?this.renderSettings():this.renderOfflineMessage()}renderOfflineMessage(){return r.a.createElement(z.a,null,r.a.createElement(ue.a,{isSmall:!0,style:{textAlign:"center"}},r.a.createElement(g.FormattedMessage,{defaultMessage:"Please go online to manage your profile.",id:"profileSettings.offline.message"})))}renderSettings(){const{currentUserStore:e}=p.default.state;if(!e)return;e.getValue();const{profilePhoto:t,uploadingProfilePhoto:a,givenName:i,familyName:s,startDayOfWeek:o}=this.stores.spaceProfileSettingsStore.state,{passwordRequestStore:l}=this.stores,c="on"===Fe.default.getGroup(this.environment,"lion-tamer"),d="on"===Fe.default.getGroup(this.environment,"user-data-consent");return l.state.loading?r.a.createElement(V.a,{style:{margin:"50% auto"}}):r.a.createElement(z.a,{controlRow:this.renderControlRow()},this.renderSpaceProfileHeader(),r.a.createElement("div",{style:{marginBottom:24}},r.a.createElement(ce.a,{title:r.a.createElement(n.Fragment,null,r.a.createElement(g.FormattedMessage,{id:"profileSettings.helpButton.caption",defaultMessage:"Changes to account settings will apply to all of your workspaces."})," ",r.a.createElement(g.FormattedMessage,{id:"profileSettings.helpButton.learnMoreLink",defaultMessage:"<s>Learn more.</s>",values:{s:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return r.a.createElement("span",{style:{textDecoration:"underline"}},t)}}})),href:Object(je.a)("guides.profileSettings"),analyticsFrom:"profile_settings"})),r.a.createElement(H.a,null,r.a.createElement(g.FormattedMessage,{id:"profileSettings.profilePhotoSection.title",defaultMessage:"Photo"})),t&&r.a.createElement(K.a,{url:t,isAuthenticated:!1,stripGoogleIconQuery:!0,width:90,render:(e,t)=>r.a.createElement("div",{style:{width:90,height:90}},r.a.createElement(N.a,{src:t,style:{width:90,height:90,objectFit:"cover",borderRadius:"100%"}}))}),r.a.createElement(te.a,{isLarge:!0,onClick:this.handleUploadProfilePhoto,style:{marginTop:8,marginBottom:4}},r.a.createElement("div",{style:{display:"flex",alignItems:"center"}},r.a.createElement(g.FormattedMessage,{id:"profileSettings.profilePhotoSection.uploadPhotoButton.label",defaultMessage:"Upload photo"}),a&&r.a.createElement(V.a,{style:{marginLeft:4}}))),t&&"on"===Fe.default.getGroup(this.environment,"remove-profile-photo-string")&&r.a.createElement(te.a,{onClick:this.handleDeleteProfilePhoto,style:{marginTop:4,marginLeft:12,marginBottom:2}},r.a.createElement("div",{style:{display:"flex",alignItems:"center"}},r.a.createElement(g.FormattedMessage,{id:"profileSettings.profilePhotoSection.removePhotoButton.label",defaultMessage:"Remove"}))),z.a.renderDivider(),r.a.createElement(H.a,null,r.a.createElement(g.FormattedMessage,{id:"profileSettings.personalInfoSection.title",defaultMessage:"Personal info"})),r.a.createElement(Ie,{userValue:Object(pe.g)(this.environment),hasEducationPlan:this.stores.isEducationStore.get()}),r.a.createElement(G.a,{hasMarginTop:!0},r.a.createElement(g.FormattedMessage,{id:"profileSettings.personalInfoSection.firstNameInput.label",defaultMessage:"First name",description:"User's first name, also known as forename or given name."})),r.a.createElement(q.b,{value:i,onChange:this.handleGivenNameChange}),r.a.createElement(G.a,{hasMarginTop:!0}," ",r.a.createElement(g.FormattedMessage,{id:"profileSettings.personalInfoSection.lastNameInput.label",defaultMessage:"Last name",description:"User's last name, also known as family name or surname"})),r.a.createElement(q.b,{value:s,onChange:this.handleFamilyNameChange}),z.a.renderDivider(),r.a.createElement(me.a,{isEducationPlan:this.props.isEducationPlan,requestStore:l}),d&&z.a.renderDivider(),d&&r.a.createElement(Ne.a,null),z.a.renderDivider(),r.a.createElement(We,null),!c&&z.a.renderDivider(),!c&&r.a.createElement(ge.a,{onClick:this.handleStartOfWeekToggle,startDayOfWeek:o}),z.a.renderDivider(),r.a.createElement(H.a,null,r.a.createElement(g.FormattedMessage,{id:"profileSettings.dangerousSettings.title",defaultMessage:"Danger zone",description:"Title for the user settings that we consider 'dangerous', like deleting an account."})),r.a.createElement(te.a,{isLarge:!0,isRed:!0,onClick:this.handleDeleteAccountClick},r.a.createElement(g.FormattedMessage,{id:"profileSettings.dangerousSettings.deleteAccountButton.label",defaultMessage:"Delete my account"})))}renderControlRow(){return r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(ee.a,{isLarge:!0,onClick:this.handleUpdateClick},r.a.createElement(g.FormattedMessage,{id:"profileSettings.updateButton.label",defaultMessage:"Update"})),r.a.createElement(te.a,{isLarge:!0,style:{marginLeft:12},onClick:this.handleCancelClick},r.a.createElement(g.FormattedMessage,{id:"profileSettings.cancelButton.label",defaultMessage:"Cancel"})))}renderSpaceProfileHeader(){return r.a.createElement(H.a,{large:!0,divider:"full"},r.a.createElement(g.FormattedMessage,{id:"profileSettings.title",defaultMessage:"Account"}))}}var Ge=Object(g.injectIntl)(He);function Qe(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ye(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Ze extends A.a{renderComponent(){return r.a.createElement("div",{style:this.getStyle(),onMouseDown:this.props.onMouseDown,onClick:this.props.onClick,onDoubleClick:this.props.onDoubleClick,onContextMenu:this.props.onContextMenu},r.a.createElement("div",{style:this.getSidebarStyle()},this.props.sidebar),r.a.createElement("div",{style:this.getChildrenStyle()},this.props.children))}getStyle(){return{display:"flex",height:"100%",flexDirection:this.props.isReversed?"row-reverse":"row"}}getSidebarStyle(){return function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Qe(Object(a),!0).forEach((function(t){Ye(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Qe(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({width:160,height:"100%",background:this.theme.sidebarBackground,flexGrow:0,flexShrink:0},this.props.sidebarStyle)}getChildrenStyle(){return{flexGrow:1,position:"relative",zIndex:1,height:"100%"}}}var Xe=Ze,Ke=a("Oy36"),Je=a("uSCg");function $e(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function et(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?$e(Object(a),!0).forEach((function(t){tt(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):$e(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function tt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class at extends A.a{constructor(){super(...arguments),this.handleKeyDown=e=>{"Backspace"===e.key&&0===this.props.value.length&&this.props.onRemoveLastToken()}}renderComponent(){const{device:e}=this.environment;return r.a.createElement("div",{onClick:this.props.onClick,style:e.isMobile?this.getMobileWrapStyle():this.getDesktopWrapStyle()},this.props.tokens,this.renderInput())}renderInput(){const{device:e}=this.environment,t=0===this.props.tokens.length;return r.a.createElement(q.b,Object.assign({format:q.b.Format.Transparent},Object(Je.a)({onKeyDown:this.handleKeyDown},{onChange:this.props.onChange}),{value:this.props.value,onSubmit:this.props.onSubmit,onBlur:this.props.onBlur,focus:this.props.focus,style:et({},at.inputStyle,{margin:e.isMobile?"0 8px 8px 0":"0 6px 6px 0"}),readOnly:this.props.readOnly,inputStyle:{height:18},size:1,type:this.props.type,placeholder:t?this.props.placeholder:"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1}))}getDesktopWrapStyle(){return et({display:"flex",flexWrap:"wrap",alignItems:"flex-start",minHeight:32,boxShadow:this.theme.inputBoxShadow,background:this.theme.inputBackground,borderRadius:3,fontSize:14,cursor:"text",overflow:"hidden",padding:"7px 9px 0px"},this.props.style)}getMobileWrapStyle(){return et({},this.getDesktopWrapStyle(),{fontSize:14,padding:"7px 10px 0"})}}at.inputStyle={flexGrow:1,flexShrink:1,flexBasis:60,minWidth:60,width:"auto",lineHeight:"20px"};var nt=at,rt=a("7Q97"),it=a("LeVO"),st=a("aZ00"),ot=a("wXH4"),lt=a("gbGO"),ct=a("WgIs"),dt=a("SR/M"),ut=a("2Y+N"),pt=a("r8MX"),mt=(a("WLsh"),a("lODM")),ht=a("FIf6"),gt=a("tvfY"),ft=a("mjq6"),bt=a("5/h/");function yt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function St(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?yt(Object(a),!0).forEach((function(t){vt(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):yt(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function vt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Et(){return r.a.createElement(g.FormattedMessage,{id:"spaceBasicSettings.workspaceNameSection.nameInput.caption",defaultMessage:"You can use your name or the name of your team. Keep it simple.",description:"The caption below the text input where a user edits the name of their workspace"})}const Mt=Object(g.defineMessages)({nameInputPlaceholder:{id:"spaceBasicSettings.nameInput.placeholder",defaultMessage:"e.g. company name"},workspaceDomainInputPlaceholder:{id:"spaceBasicSettings.domainSection.workspaceDomainInput.placeholder",defaultMessage:"URL"},allowedEmailDomainsInputPlaceholder:{id:"spaceBasicSettings.allowedEmailDomainsSection.emailDomainInput.placeholder",defaultMessage:"Type an email domain…"},copyDomainTooltip:{id:"spaceBasicSettings.workspaceDomain.tooltip",defaultMessage:"Click to copy link"}});class Ct extends A.a{constructor(){super(...arguments),this.storeTypes={spaceBasicSettingsStore:k,tokenQuery:Y.a.of("")},this.handleSpaceNameChange=e=>{this.stores.spaceBasicSettingsStore.setState(St({},this.stores.spaceBasicSettingsStore.state,{name:e.target.value}))},this.handleSpaceUrlChange=e=>{this.stores.spaceBasicSettingsStore.setState(St({},this.stores.spaceBasicSettingsStore.state,{domain:S.B(e.target.value)})),this.forceUpdate()},this.handleConfirm=async()=>{const{spaceStore:e}=this.props,{spaceBasicSettingsStore:t}=this.stores;await S.A({environment:this.environment,spaceStore:e,spaceBasicSettingsStore:t}),B.a.setState(St({},B.a.state,{open:!1}))},this.handleCancelClick=()=>{B.a.setState(St({},B.a.state,{open:!1}))},this.handleExportClick=()=>{const{currentSpaceStore:e}=p.default.state;e&&mt.h({environment:this.environment,root:{table:"space",id:e.id}})},this.handleExportMembersClick=()=>{const{currentSpaceStore:e}=p.default.state,{data:t}=pt.default.state;e&&t&&"subscribed_admin"===t.type&&mt.e({spaceStore:e,subscriptionData:t,intl:this.props.intl})},this.handleLeaveClick=()=>{const{spaceStore:e}=this.props,{currentUserSettingsStore:t}=p.default.state;t&&d.showDialog({message:r.a.createElement(g.FormattedMessage,{id:"spaceBasicSettings.leaveWorkspaceConfirmationDialog.prompt",defaultMessage:"Are you sure you want to leave this workspace?"}),showCancel:!0,keepFocus:!0,items:[{label:r.a.createElement(g.FormattedMessage,{id:"spaceBasicSettings.leaveWorkspaceConfirmationDialog.leaveButton.label",defaultMessage:"Leave"}),color:"red",onAccept:async()=>{await S.l({environment:this.environment,spaceId:e.id,userSettingsStore:t})&&(m.ic(this.environment),B.a.setState(St({},B.a.state,{open:!1})))}}]})},this.handleDeleteClick=async()=>{const{currentUserSettingsStore:e}=p.default.state;if(!e)return;const{spaceStore:t,intl:a}=this.props,n=Object(xe.getSpaceName)(this.environment,t)||a.formatMessage({defaultMessage:"Untitled workspace",id:"spaceBasicSettings.deleteWorkspace.untitledWorkspace.placeholder"});await U.b({message:r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement(g.FormattedMessage,{id:"spaceBasicSettings.deleteWorkspaceConfirmationDialog.prompt",defaultMessage:"This action cannot be undone. This will permanently delete the workspace, including all pages and files. Please type the name of the workspace to confirm."})),r.a.createElement(le,{style:{marginTop:16},translations:{es:"Esta acción no se puede deshacer. Esto eliminará permanentemente el espacio de trabajo, incluidas todas las páginas y archivos. Por favor escriba el nombre del espacio de trabajo para confirmar.",ru:"Это действие не может быть отменено. Это навсегда удалит рабочее пространство, включая все страницы и файлы. Пожалуйста, введите название рабочей области для подтверждения.",zh:"此操作无法撤消。 这将永久删除工作区，包括所有页面和文件。 请输入要确认的工作空间的名称。",de:"Diese Aktion kann nicht rückgängig gemacht werden. Dadurch wird der Arbeitsbereich einschließlich aller Seiten und Dateien dauerhaft gelöscht. Bitte geben Sie den Namen des Arbeitsbereichs zur Bestätigung ein.",fr:"Cette action ne peut pas être annulée. Cela supprimera définitivement l'espace de travail, y compris toutes les pages et tous les fichiers. Veuillez saisir le nom de l'espace de travail pour confirmer.",ja:"この操作を元に戻すことはできません。 これにより、すべてのページとファイルを含むワークスペースが完全に削除されます。 確認するワークスペースの名前を入力してください。",it:"Questa azione non può essere annullata. Questo eliminerà definitivamente l'area di lavoro, incluse tutte le pagine e i file. Digita il nome dell'area di lavoro per confermare.",pt:"Essa ação não pode ser desfeita. Isso excluirá permanentemente o espaço de trabalho, incluindo todas as páginas e arquivos. Por favor, digite o nome do espaço de trabalho para confirmar.",nl:"Deze actie kan niet ongedaan gemaakt worden. Hiermee wordt de werkruimte permanent verwijderd, inclusief alle pagina's en bestanden. Typ de naam van de werkruimte om te bevestigen.",pl:"Tego działania nie można cofnąć. Spowoduje to trwałe usunięcie obszaru roboczego, w tym wszystkich stron i plików. Wpisz nazwę obszaru roboczego, aby potwierdzić.",sv:"Den här åtgärden kan inte ångras. Detta tar bort arbetsytan permanent, inklusive alla sidor och filer. Vänligen skriv in arbetsplatsens namn för att bekräfta.",uk:"Цю дію не можна скасувати. Це дозволить остаточно видалити робочу область, включаючи всі сторінки та файли. Введіть назву робочої області для підтвердження.",no:"Denne handlingen kan ikke fortrykkes. Dette vil permanent slette arbeidsområdet, inkludert alle sider og filer. Vennligst skriv navnet på arbeidsområdet for å bekrefte.",tr:"Bu işlem geri alınamaz. Bu, tüm sayfaları ve dosyaları içeren çalışma alanını kalıcı olarak siler. Lütfen onaylamak için çalışma alanının adını yazın.",cs:"Tuto akci nelze vrátit zpět. Tím se trvale odstraní pracovní prostor včetně všech stránek a souborů. Zadejte prosím název pracovního prostoru, který chcete potvrdit.",vi:"Hành động này không thể được hoàn tác. Điều này sẽ xóa vĩnh viễn không gian làm việc, bao gồm tất cả các trang và tệp. Vui lòng nhập tên của không gian làm việc để xác nhận.",da:"Denne handling kan ikke fortrydes. Dette vil permanent slette arbejdsområdet, inklusive alle sider og filer. Indtast navnet på arbejdsområdet for at bekræfte.",hu:"Ez a művelet nem visszavonható. Ez véglegesen törli a munkaterületet, beleértve az összes oldalt és fájlt. Kérjük, írja be a munkaterület nevét a megerősítéshez.",ar:"لا يمكن التراجع عن هذا الإجراء. سيؤدي ذلك إلى حذف مساحة العمل كليا ، بما يشمل جميع الصفحات والملفات. يرجى كتابة اسم مساحة العمل للتأكيد.",th:"การกระทำนี้ไม่สามารถยกเลิกได้ นี่จะเป็นการลบพื้นที่ทำงานอย่างถาวรรวมถึงหน้าและไฟล์ทั้งหมด โปรดพิมพ์ชื่อของพื้นที่ทำงานเพื่อยืนยัน",he:"לא ניתן לבטל פעולה זו. פעולה זו תמחק לצמיתות את סביבת העבודה, כולל כל הדפים והקבצים. הקלד את שם מרחב העבודה כדי לאשר.",fi:"Tätä toimintoa ei voi peruuttaa. Tämä poistaa työtilan pysyvästi, mukaan lukien kaikki sivut ja tiedostot. Vahvista kirjoittamalla työtilan nimi.",id:"Tindakan ini tidak bisa dibatalkan. Ini akan secara permanen menghapus ruang kerja, termasuk semua halaman dan file. Silakan ketik nama ruang kerja untuk mengonfirmasi."}})),acceptLabel:r.a.createElement(g.FormattedMessage,{id:"spaceBasicSettings.deleteWorkspaceConfirmationDialog.deleteWorkspaceButton.label",defaultMessage:"Permanently delete workspace"}),requiredInputValue:n})&&(S.h({environment:this.environment,spaceId:t.id,userSettingsStore:e}),m.ub(this.environment),B.a.setState(St({},B.a.state,{open:!1})))},this.handleRecordIconChange=e=>{const{spaceStore:t}=this.props;Q.createAndCommit(this.environment,a=>{o.c({store:t.getIconStore(),value:e,transaction:a})})}}willMount(e){super.willMount(e);const{spaceStore:t}=this.props,{spaceBasicSettingsStore:a}=this.stores,n=a.getValueForSpace(t);n&&a.setState(n)}renderComponent(){return J.a.state.online?this.renderSettings():this.renderOfflineMessage()}renderOfflineMessage(){return r.a.createElement(z.a,null,r.a.createElement(ue.a,{isSmall:!0,style:{textAlign:"center"}},r.a.createElement(g.FormattedMessage,{id:"spaceBasicSettings.offlineMessage",defaultMessage:"Please go online to manage settings."})))}renderSettings(){const{spaceStore:e}=this.props,{spaceBasicSettingsStore:t}=this.stores,{name:a,domain:i}=t.state,{data:s}=pt.default.state;if(!s)return;const o=e.canAdmin(),l=!e.canRead(),c=Object(xe.getSpacePermissionItems)(e),d=fe.L(this.environment),u=e.getValue(),p=o&&u&&!u.disable_export,m=o,h="subscribed_admin"===s.type&&"enterprise"===fe.i(this.environment);return r.a.createElement(z.a,{controlRow:o&&this.renderControlRow()},this.renderSpaceBasicHeader(),l&&r.a.createElement(ue.a,{isSmall:!0,isMultiline:!0,style:{textAlign:"center"}},r.a.createElement(g.FormattedMessage,{id:"spaceBasicSettings.guestLimitedAccessMessage",defaultMessage:"You are currently a guest in this workspace. Ask an admin to add you as a member in order to see other pages and workspace settings."})),l&&z.a.renderDivider(),o&&r.a.createElement(n.Fragment,null,r.a.createElement(H.a,null,r.a.createElement(g.FormattedMessage,{id:"spaceBasicSettings.workspaceNameSection.title",defaultMessage:"Name"})),r.a.createElement(q.b,{value:a,placeholder:f.default.formatMessage(Mt.nameInputPlaceholder),readOnly:!o,onChange:this.handleSpaceNameChange}),r.a.createElement(ue.a,{isSmall:!0,isMultiline:!0,style:{marginTop:4}},r.a.createElement(Et,null)),z.a.renderDivider()),o&&r.a.createElement(n.Fragment,null,r.a.createElement(H.a,null,r.a.createElement(g.FormattedMessage,{id:"spaceBasicSettings.workspaceIconSection.title",defaultMessage:"Icon"})),r.a.createElement("div",{style:{width:72,height:72,border:"1px solid ".concat(this.theme.regularDividerColor),borderRadius:6,display:"flex",justifyContent:"center",alignItems:"center"}},o?r.a.createElement(Ke.a,{bucket:"public",disabled:!1,icon:Object(xe.getSpaceIcon)(this.environment,e),isEmptyPage:!1,title:a,size:64,onChange:this.handleRecordIconChange}):r.a.createElement(Ke.a,{disabled:!0,icon:Object(xe.getSpaceIcon)(this.environment,e),isEmptyPage:!1,title:a,size:64})),r.a.createElement(ue.a,{isSmall:!0,isMultiline:!0,style:{marginTop:8}},r.a.createElement(g.FormattedMessage,{id:"spaceBasicSettings.workspaceIconSection.caption",defaultMessage:"Upload an image or pick an emoji. It will show up in your sidebar and notifications."})),z.a.renderDivider()),o&&r.a.createElement("div",null,r.a.createElement(H.a,null,r.a.createElement(g.FormattedMessage,{id:"spaceBasicSettings.domainSection.title",defaultMessage:"Domain"})),r.a.createElement("div",{style:{display:"flex",alignItems:"center"}},r.a.createElement("div",null,window.location.host,"/"),r.a.createElement("div",{style:{marginLeft:6,width:"100%"}},r.a.createElement(q.b,{value:i,placeholder:f.default.formatMessage(Mt.workspaceDomainInputPlaceholder),readOnly:!o,onChange:this.handleSpaceUrlChange}))),r.a.createElement(ue.a,{isSmall:!0,isMultiline:!0,style:{marginTop:4}},Ct.renderDomainCaption(this.environment,i,!0,this.theme)),z.a.renderDivider()),o&&d&&r.a.createElement(n.Fragment,null,r.a.createElement(H.a,null,r.a.createElement(g.FormattedMessage,{id:"spaceBasicSettings.allowedEmailDomainsSection.title",defaultMessage:"Allowed email domains"})),this.renderAllowedEmailDomains(),r.a.createElement(ue.a,{isSmall:!0,isMultiline:!0,style:{marginTop:4}},Ct.renderAllowEmailDomainsCaption()),z.a.renderDivider()),p&&r.a.createElement(n.Fragment,null,r.a.createElement(H.a,null,r.a.createElement(g.FormattedMessage,{id:"spaceBasicSettings.exportContentSection.title",defaultMessage:"Export content"})),r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(te.a,{isLarge:!0,onClick:this.handleExportClick},r.a.createElement(g.FormattedMessage,{id:"spaceBasicSettings.exportContentSection.exportButton.label",defaultMessage:"Export all workspace content"}))),r.a.createElement("div",{style:{height:12}}),r.a.createElement(ce.a,{title:r.a.createElement(g.FormattedMessage,{id:"spaceBasicSettings.exportContentSection.helpButton.caption",defaultMessage:"Learn about exporting workspaces."}),href:Object(je.a)("guides.exportWorkspace"),analyticsFrom:"space_settings"}),z.a.renderDivider()),m&&r.a.createElement(n.Fragment,null,r.a.createElement(H.a,{style:{display:"flex",alignItems:"center"}},r.a.createElement("span",{style:{marginRight:8}},r.a.createElement(g.FormattedMessage,{id:"spaceBasicSettings.exportMembersSection.title",defaultMessage:"Export members"})),!h&&r.a.createElement(ht.a,{subscriptionTier:"enterprise",analyticsName:"space_export_members",desktopStyle:{marginTop:-1}})),r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(te.a,{isLarge:!0,disabled:!h,onClick:this.handleExportMembersClick,disabledFeedback:!0},r.a.createElement(g.FormattedMessage,{id:"spaceBasicSettings.exportMembersSection.exportAsCSVButton.label",defaultMessage:"Export members as CSV"}))),r.a.createElement("div",{style:{height:12}}),r.a.createElement(ce.a,{title:r.a.createElement(g.FormattedMessage,{id:"spaceBasicSettings.exportMembersSection.helpButton.caption",defaultMessage:"Learn about exporting members."}),href:Object(je.a)("guides.exportMembers"),analyticsFrom:"space_settings"}),z.a.renderDivider()),r.a.createElement(H.a,null,r.a.createElement(g.FormattedMessage,{id:"spaceBasicSettings.dangerousSettingsSection.title",defaultMessage:"Danger zone"})),r.a.createElement("div",{style:{display:"flex"}},(c.length>1||l)&&r.a.createElement(te.a,{isLarge:!0,onClick:this.handleLeaveClick,style:{marginRight:o?12:void 0}},r.a.createElement(g.FormattedMessage,{id:"spaceBasicSettings.dangerousSettingsSection.leaveWorkspaceButton.label",defaultMessage:"Leave workspace"})),o&&r.a.createElement(te.a,{isLarge:!0,isRed:!0,onClick:this.handleDeleteClick},r.a.createElement(g.FormattedMessage,{id:"spaceBasicSettings.dangerousSettingsSection.deleteWorkspaceButton.label",defaultMessage:"Delete entire workspace"}))),o&&r.a.createElement(n.Fragment,null,r.a.createElement("div",{style:{height:12}}),r.a.createElement(ce.a,{title:r.a.createElement(g.FormattedMessage,{id:"spaceBasicSettings.dangerousSettingsSection.deleteWorkspaceHelpButton.caption",defaultMessage:"Learn about deleting workspaces."}),href:Object(je.a)("guides.deleteWorkspace"),analyticsFrom:"space_settings"})))}renderSpaceBasicHeader(){return r.a.createElement(H.a,{large:!0,divider:"full"},r.a.createElement(g.FormattedMessage,{id:"spaceBasicSettings.title",defaultMessage:"Workspace settings"}))}renderControlRow(){return r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(ee.a,{isLarge:!0,onClick:this.handleConfirm},r.a.createElement(g.FormattedMessage,{id:"spaceBasicSettings.updateButton.label",defaultMessage:"Update"})),r.a.createElement(te.a,{isLarge:!0,style:{marginLeft:12},onClick:this.handleCancelClick},r.a.createElement(g.FormattedMessage,{id:"spaceBasicSettings.cancelButton.label",defaultMessage:"Cancel"})))}renderAllowedEmailDomains(){const{device:e}=this.environment,{spaceStore:t}=this.props,{spaceBasicSettingsStore:a}=this.stores,{emailDomains:n}=a.state,i=t.canAdmin();return r.a.createElement(ot.c,{popupType:e.isMobile?ot.c.PopupType.SlideUp:ot.c.PopupType.Popup,sameWidthAsOrigin:!0,open:this.stores.tokenQuery.get().length>0,origin:r.a.createElement(nt,{placeholder:f.default.formatMessage(Mt.allowedEmailDomainsInputPlaceholder),value:this.stores.tokenQuery.get(),onChange:e=>this.stores.tokenQuery.set(e.target.value),readOnly:!i,onRemoveLastToken:()=>{const e=n.slice(0,n.length-1);a.setState(St({},a.state,{emailDomains:e}))},tokens:n.map(e=>r.a.createElement(rt.b,{showRemoveButton:!0,isSingle:!1,format:rt.b.Format.Medium,key:e,onClickRemove:()=>{const t=n.filter(t=>t!==e);a.setState(St({},a.state,{emailDomains:t}))},value:e}))}),render:()=>{const t=this.stores.tokenQuery.get().trim(),{data:i}=pt.default.state,{spaceStore:s}=this.props,o=r.a.createElement(g.FormattedMessage,{id:"spaceBasicSettings.allowedEmailDomainsSection.emailDomainsDropdown.placeholder",defaultMessage:"Type an email domain…"}),l=r.a.createElement(g.FormattedMessage,{id:"spaceBasicSettings.allowedEmailDomainsSection.emailDomainsDropdown.placeholderNoResults",defaultMessage:"Type an email domain of a member of this workspace…"}),c=i?fe.u(i).map(e=>{if(("unsubscribed_admin"===i.type||"unsubscribed_member"===i.type||"subscribed_admin"===i.type)&&i.joinedMemberIds.includes(e.userId)){const t=gt.a.createChildStore(s,{table:bt.a,id:e.userId}).getEmail();return t&&t.split("@")[1]}}).filter((e,t,a)=>Boolean(e&&t===a.indexOf(e)&&!n.includes(e))):[],d=Object(ft.b)(t,c,e=>e).map((e,t)=>({key:t,render:t=>r.a.createElement(dt.a,Object.assign({},t,{title:e})),action:()=>{const t=[...n,e];a.setState(St({},a.state,{emailDomains:t})),this.stores.tokenQuery.set("")}}));let u;return u=e.isMobile?{menuType:lt.b.MenuType.ActionSheet}:{menuType:lt.b.MenuType.Popup,width:"100%"},r.a.createElement(lt.b,Object.assign({},u),r.a.createElement(ct.a,{type:ct.a.Type.Vertical,initialFocus:d.length>0?0:void 0,sections:[{key:0,render:e=>r.a.createElement(ut.a,Object.assign({},e,{disableDesktopPadding:!0,title:d.length>0?o:l})),items:d}]}))},onDismiss:()=>{this.stores.tokenQuery.set("")}})}}Ct.renderDomainCaption=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0;const i="".concat(window.location.host,"/").concat(t);let s;if(t&&(s=a?r.a.createElement(it.a,{delayThreshold:0,renderTooltip:()=>f.default.formatMessage(Mt.copyDomainTooltip),render:t=>r.a.createElement(we.a,Object.assign({onClick:()=>{st.c({environment:e,stringValue:i})}},t),i)}):r.a.createElement("span",{style:{color:n.regularTextColor}},i)),!fe.S(e,"personal")&&!fe.S(e,"student"))return r.a.createElement("div",null,r.a.createElement(g.FormattedMessage,{id:"spaceBasicSettings.domainSection.workspaceDomainInput.caption",defaultMessage:"Share the link {linkText} to add anyone with an allowed email domain to your workspace.",values:{linkText:s}}))},Ct.renderAllowEmailDomainsCaption=()=>r.a.createElement(g.FormattedMessage,{id:"spaceBasicSettings.allowedEmailDomainsSection.emailDomainInput.caption",defaultMessage:"Anyone with email addresses at these domains can automatically join your workspace."});var wt=Object(g.injectIntl)(Ct),Ot=a("3wHm"),kt=a("5XPD"),Pt=a("2HDO"),Tt=a("Z1H8"),Dt=a("nWgh"),It=a("8fuX");class Ft extends E.a{getInitialState(){return{churnSurveyModalOpen:!1}}}var jt=Ft,xt=a("6BTz"),Bt=a("LB1/"),At=a("Z0iJ"),Rt=a("T8dS");function Lt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ut(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const _t={"en-US":{enterpriseContact:"https://notionup.typeform.com/to/FbZ6Tk",enterpriseTrial:"https://notionup.typeform.com/to/OHk8LR",startupFounder:"https://notionup.typeform.com/to/HgYsu8",startupPartner:"https://notionup.typeform.com/to/XEqmGB",nonprofit:"https://notionup.typeform.com/to/nlhrVv",apiPrivateBeta:"https://notionup.typeform.com/to/dSurQQp2"},"ko-KR":{enterpriseContact:"https://notionup.typeform.com/to/K5knuI18",enterpriseTrial:"https://notionup.typeform.com/to/XkdAkTfV",startupFounder:"https://notionup.typeform.com/to/DYAiiu7x",startupPartner:"https://notionup.typeform.com/to/GfPkKEJZ",nonprofit:"https://notionup.typeform.com/to/cSKAL2LL",apiPrivateBeta:"https://notionup.typeform.com/to/dSurQQp2"}};async function Wt(e){const t=_t[Rt.a][e.typeform];let a={};e.params&&(a=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Lt(Object(a),!0).forEach((function(t){Ut(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Lt(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},a,{},e.params));const n=t+"?".concat(Object.keys(a).map(e=>"".concat(e,"=").concat(a[e])).join("&"));m.pd(e.environment,{from:e.frontContext,name:e.typeform}),await Object(At.b)("https://embed.typeform.com/embed.js"),window.typeformEmbed.makePopup(n,{hideHeaders:!0,hideFooter:!1}).open()}const Nt=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return r.a.createElement("p",{style:{marginTop:8,marginBottom:8}},1===t.length?t[0]:r.a.Children.toArray(t))},qt=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return r.a.createElement(we.a,{external:!0,href:Object(je.a)("guides.guides")},t)},Vt=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return r.a.createElement(we.a,{external:!0,href:Object(je.a)("guides.billingAndPayment")},t)};function zt(e,t,a){Wt({environment:e,typeform:"enterpriseContact",frontContext:t,params:{source:a}})}const Ht={general:function(e){return[{question:r.a.createElement(g.FormattedMessage,{id:"faq.freeVsPersonalAndTeam.question",defaultMessage:"How is the free Personal Plan different from the Personal Pro and Team Plans?"}),answer:r.a.createElement(g.FormattedMessage,{id:"faq.freeVsPersonalAndTeam.answer",defaultMessage:'<p>The biggest difference is how you can collaborate with others.</p><p>The free Personal Plan is designed for individual use, but allows up to 5 unique guests. These are friends, family members, and others you can invite to collaborate with you privately on any page. You can also share a page publicly and turn on commenting or editing access. In the Share menu at the top right, turn on "Share to web" then "Allow editing." Any Notion user with the link will be able to edit your page.</p><p>With the Personal Pro Plan, you can invite unlimited guests for private collaboration. For example, if you run your own business, you can invite all your clients to provide feedback on your work. </p><p>With the Team Plan, you can add members to your workspace so you all share and work on the same content. It also comes with more permission and admin controls so you and your teammates can work together securely. See the plan comparison chart for more details.</p>',values:{p:Nt}})},{question:r.a.createElement(g.FormattedMessage,{id:"faq.overGuestLimitInFreePlan.question",defaultMessage:"What happens when I go over the guest limit on my Personal Plan?"}),answer:r.a.createElement(g.FormattedMessage,{id:"faq.overGuestLimitInFreePlan.answer",defaultMessage:"<p>Upgrade to the Personal Pro Plan for unlimited guests, or the Team Plan if you collaborate with the same group of people automatically. You can also review and remove inactive guests in Settings & Members.</p>",values:{p:Nt}})},{question:r.a.createElement(g.FormattedMessage,{id:"faq.teamTrial.question",defaultMessage:"How do I try out the Team Plan for free?"}),answer:r.a.createElement(g.FormattedMessage,{id:"faq.teamTrial.answer",defaultMessage:"<p>When asked how you would like to set up Notion during sign up, select Team, and you’ll be automatically enrolled in a Team Plan trial. You’ll get access to most features of a paid Team Plan, with a 1,000 block storage limit. If your team wants to add more than that, upgrade to the full Team Plan. Details above.</p>",values:{p:Nt}})},{question:r.a.createElement(g.FormattedMessage,{id:"faq.overStorageLimitInFreePlan.question",defaultMessage:"What happens when I go over the block storage limit on my Team trial?"}),answer:r.a.createElement(g.FormattedMessage,{id:"faq.overStorageLimitInFreePlan.answer",defaultMessage:"<p>You can still read, edit, and organize existing content blocks as usual, but you won’t be able to add new content blocks.</p><p>However, you can delete existing content blocks to free up your storage.</p>",values:{p:Nt}})},{question:r.a.createElement(g.FormattedMessage,{id:"faq.useNotionForFree.question",defaultMessage:"Can I use Notion for free?"}),answer:r.a.createElement(g.FormattedMessage,{id:"faq.useNotionForFree.answer",defaultMessage:"<p>Absolutely! Notion is free to use indefinitely.</p><p>The Personal Plan is completely free for individual use. The Team Plan has a free trial with a 1,000 block limit, more than enough to try out Notion with your team before upgrading.</p>",values:{p:Nt}})},{question:r.a.createElement(g.FormattedMessage,{id:"faq.whatIsABlock.question",defaultMessage:"What is a block?"}),answer:r.a.createElement(g.FormattedMessage,{id:"faq.whatIsABlock.answer",defaultMessage:"<p>A block is any single piece of content you add to your page, like a paragraph of text, a to-do item, an image, a code block, an embedded file, etc. Think of your page as being made up of these building blocks.</p>",values:{p:Nt}})},{question:r.a.createElement(g.FormattedMessage,{id:"faq.deleteBlocks.question",defaultMessage:"Can I delete blocks to free up my storage?"}),answer:r.a.createElement(g.FormattedMessage,{id:"faq.deleteBlocks.answer",defaultMessage:"<p>Of course! It works just like the storage limit on your phone or computer. If you delete something, you will free up space for more.</p>",values:{p:Nt}})},{question:r.a.createElement(g.FormattedMessage,{id:"faq.studentDiscount.question",defaultMessage:"Do you offer student discounts?"}),answer:r.a.createElement(g.FormattedMessage,{id:"faq.studentDiscount.answer",defaultMessage:"<p>The Personal Pro Plan is free for students and educators. This lets you collaborate with unlimited guests and gives you version history. Simply sign up with your school email address and you’ll immediately gain access to these features.</p><p>If you’re already on a Personal Pro Plan, change the email associated with your account to your school email address to get it for free. If you're already on our free Education Plan, you've been automatically upgraded to the Personal Pro Plan.</p><p><helpcenterlink>Visit the help center to learn more</helpcenterlink></p>",values:{p:Nt,helpcenterlink:qt}})},{question:r.a.createElement(g.FormattedMessage,{id:"faq.howToEarnCredit.question",defaultMessage:"How do I earn credit?"}),answer:r.a.createElement(g.FormattedMessage,{id:"faq.howToEarnCredit.answer",defaultMessage:"<p>You can earn credit by using Notion across your devices and trying out new features. Go to the Earn Credit tab in Settings & Members to learn more.</p>",values:{p:Nt}})},{question:r.a.createElement(g.FormattedMessage,{id:"faq.howToApplyCredit.question",defaultMessage:"How do I apply credit to my workspace?"}),answer:r.a.createElement(g.FormattedMessage,{id:"faq.howToApplyCredit.answer",defaultMessage:"<p>To apply credit, you must first upgrade to a paid plan. As part of this process, you can choose to apply some or all of your account credit to the plan.</p>",values:{p:Nt}})},{question:r.a.createElement(g.FormattedMessage,{id:"faq.whyBillingInformation.question",defaultMessage:"Why do you need my billing information if I have enough credit to pay for Notion?"}),answer:r.a.createElement(g.FormattedMessage,{id:"faq.whyBillingInformation.answer",defaultMessage:"<p>We still require your billing information, even if you applied enough credit to make your first bill $0, because you may run out of credit in the future and we need to be able to charge your account.</p>",values:{p:Nt}})},{question:r.a.createElement(g.FormattedMessage,{id:"faq.runOutOfCredit.question",defaultMessage:"What happens if I run out of credit?"}),answer:r.a.createElement(g.FormattedMessage,{id:"faq.runOutOfCredit.answer",defaultMessage:"<p>If you run out of credit, your account will be charged via your selected payment method.</p>",values:{p:Nt}})},{question:r.a.createElement(g.FormattedMessage,{id:"faq.maximumEarnedCredit.question",defaultMessage:"Is there a maximum amount of credit I can earn?"}),answer:r.a.createElement(g.FormattedMessage,{id:"faq.maximumEarnedCredit.answer",defaultMessage:"<p>Yes, you can earn up to {maximumAmountInDollars} in credit.</p>",values:{p:Nt,maximumAmountInDollars:Object(xt.b)({amount:Bt.f,currency:"dollar",intl:f.default.getIntl()})}})},{question:r.a.createElement(g.FormattedMessage,{id:"faq.advancedPermissions.question",defaultMessage:"What advanced permissions does the paid Team & Enterprise Plans offer?"}),answer:r.a.createElement(g.FormattedMessage,{id:"faq.advancedPermissions.answer",defaultMessage:'<p>If you are on a free Team trial, you can set the access level on each page to "Full access," "Can view," or "Can comment." That dictates how other users can interact with that page. "Full access" means someone can edit, comment, and share the page with others.</p><p>On paid Team and Enterprise Plans, you have the ability to grant "Can edit" access to other users. This gives someone the ability to edit and comment on that page, but not share it with others. This is especially useful if you do not want your content leaking outside your team.</p><p><contactsales>Contact sales to learn more</contactsales></p>',values:{p:Nt,contactsales:function(){for(var t=arguments.length,a=new Array(t),n=0;n<t;n++)a[n]=arguments[n];return r.a.createElement(we.a,{onClick:()=>zt(e,"faq","Advanced permissions")},a)}}})},{question:r.a.createElement(g.FormattedMessage,{id:"faq.teamAdminTools.question",defaultMessage:"What admin tools come with the Team Plan? "}),answer:r.a.createElement(g.FormattedMessage,{id:"faq.teamAdminTools.answer",defaultMessage:"<p>On a free Team trial, every member in your workspace is an admin. This means all of you can adjust team settings and invite other people into the workspace.</p><p>If you want only a few people to have admin abilities, we recommend upgrading to the full Team Plan. It comes with tools that allow you to make only select people admins while everyone else is a member. Members can't edit billing information or security options, and can't share your content outside the workspace.</p>",values:{p:Nt}})},{question:r.a.createElement(g.FormattedMessage,{id:"faq.personalPricing.question",defaultMessage:"How is pricing calculated for the Personal Pro Plan?"}),answer:r.a.createElement(g.FormattedMessage,{id:"faq.personalPricing.answer",defaultMessage:"<p>If you upgrade your workspace to Personal Pro, you will be charged a flat fee ($5 monthly or $48 yearly).</p><p>Guests are free of charge, but they can only be added to one page at a time.</p>",values:{p:Nt}})},{question:r.a.createElement(g.FormattedMessage,{id:"faq.teamPricing.question",defaultMessage:"How is pricing calculated for the Team Plan?"}),answer:r.a.createElement(g.FormattedMessage,{id:"faq.teamPricing.answer",defaultMessage:'<p>If you upgrade your workspace to the Team Plan, you will be charged a fee per member ($10 monthly or $96 yearly). For example, if you pay per month and have 5 members, you will be charged $50 each month.</p><p>Guests are free of charge – but they can only access individual pages they are invited to. In other words, guests won’t be able to see all the team pages under the "Workspace" section in the left sidebar.</p>',values:{p:Nt}})},{question:r.a.createElement(g.FormattedMessage,{id:"faq.monthlyAndYearlyBilling.question",defaultMessage:"Do you have monthly and yearly billing options?"}),answer:r.a.createElement(g.FormattedMessage,{id:"faq.monthlyAndYearlyBilling.answer",defaultMessage:"<p>Yes! We offer both monthly and yearly billing options. The yearly billing option is always cheaper (an estimated 20% discount). For example, the Team Plan is $10 per member per month when you choose the monthly option, but $8 per member per month if you choose to pay yearly.</p>",values:{p:Nt}})},{question:r.a.createElement(g.FormattedMessage,{id:"faq.addingAndRemovingMembers.question",defaultMessage:"How does adding and removing members work?"}),answer:r.a.createElement(g.FormattedMessage,{id:"faq.addingAndRemovingMembers.answer",defaultMessage:"<p>Whether you're on a monthly or yearly billing schedule, your account may be charged on a monthly basis if you make these types of changes. If you added members, your account will be charged a prorated amount based on the percentage of the billing cycle left at the time each member was added. If you removed members, your account will be credited in the same way.</p>",values:{p:Nt}})},{question:r.a.createElement(g.FormattedMessage,{id:"faq.changePlans.question",defaultMessage:"What happens when I change plans?"}),answer:r.a.createElement(g.FormattedMessage,{id:"faq.changePlans.answer",defaultMessage:"<p>Upgrading or downgrading your plan works similarly to adding and removing members. Your account will be charged or credited based on the percentage of the billing cycle left at the time the plan was changed.</p>",values:{p:Nt}})},{question:r.a.createElement(g.FormattedMessage,{id:"faq.cancelPlan.question",defaultMessage:"How do I cancel my paid plan?"}),answer:r.a.createElement(g.FormattedMessage,{id:"faq.cancelPlan.answer",defaultMessage:'<p>Your Notion subscription, annual or monthly, will automatically renew until you cancel it. You can cancel your subscription by going to "Settings & Members" in the left-hand sidebar on a desktop computer, then selecting "Plans," then "Downgrade." After you cancel, you’ll still have access to all the paid features until the end of your billing cycle.</p><p><billingandpaymentlink>More on billing & payment here</billingandpaymentlink></p>',values:{p:Nt,billingandpaymentlink:Vt}})},{question:r.a.createElement(g.FormattedMessage,{id:"faq.paymentFailure.question",defaultMessage:"What happens if my payment fails? Like if my credit card expires?"}),answer:r.a.createElement(g.FormattedMessage,{id:"faq.paymentFailure.answer",defaultMessage:"<p>Your account email will be notified after each failed payment. Payments may be retried up to 4 times within the next month. After this, if the payment did not succeed, you will be downgraded to the free plan.</p>",values:{p:Nt}})},{question:r.a.createElement(g.FormattedMessage,{id:"faq.changePaymentMethod.question",defaultMessage:"Can I change my payment method?"}),answer:r.a.createElement(g.FormattedMessage,{id:"faq.changePaymentMethod.answer",defaultMessage:"<p>You can change your payment method at any time in your billing settings.</p>",values:{p:Nt}})},{question:r.a.createElement(g.FormattedMessage,{id:"faq.refund.question",defaultMessage:"How do refunds work?"}),answer:r.a.createElement(g.FormattedMessage,{id:"faq.refund.answer",defaultMessage:"<p>Our refund policy is simple. If you believe you've made a mistake signing up for a paid Notion subscription online or in-app, please contact us inside the app or email team@makenotion.com. We'll be happy to refund you the full amount (not pro-rated) if you downgrade your subscription within 72 hours of signing up for monthly billing, or within 30 days of signing up for annual billing.</p><p>And if for any reason you're unhappy with Notion, please let us know at team@makenotion.com — we'd love to hear your feedback, and will be happy to work with you to create the best experience possible.</p>",values:{p:Nt}})},{question:r.a.createElement(g.FormattedMessage,{id:"faq.mandatoryRefund.question",defaultMessage:"What if I live in a region with a mandatory refund policy?"}),answer:r.a.createElement(g.FormattedMessage,{id:"faq.mandatoryRefund.answer",defaultMessage:"<p>If you live in the European Union, United Kingdom, or another region with a mandatory refund policy, you may be eligible for a monthly subscription refund past 72 hours. For example, customers in the European Union can receive a full refund for a monthly subscription within 14 days of purchase, rather than 72 hours.</p><p>To request a refund, please contact us inside the app or email team@makenotion.com. If you live in a region with a mandatory refund policy, please let us know and we'll be happy to assist you.</p>",values:{p:Nt}})},{question:r.a.createElement(g.FormattedMessage,{id:"faq.serviceLevelAgreement.question",defaultMessage:"Do you have a Service-Level Agreement (SLA)?"}),answer:r.a.createElement(g.FormattedMessage,{id:"faq.serviceLevelAgreement.answer",defaultMessage:"<p>We do not offer a standard SLA. For teams with greater than 100 members, we can offer a custom SLA.</p><p><contactsales>Contact sales to learn more</contactsales></p>",values:{p:Nt,contactsales:function(){for(var t=arguments.length,a=new Array(t),n=0;n<t;n++)a[n]=arguments[n];return r.a.createElement(we.a,{onClick:()=>zt(e,"faq","SLA")},a)}}})},{question:r.a.createElement(g.FormattedMessage,{id:"faq.importStorageLimit.question",defaultMessage:"How does importing content from another app affect my block storage limit if I'm on the Team Plan trial?"}),answer:r.a.createElement(g.FormattedMessage,{id:"faq.importStorageLimit.answer",defaultMessage:"<p>Content created via import doesn’t count toward your workspace’s storage limit. We want to make sure you get started with Notion as smoothly as possible.</p>",values:{p:Nt}})},{question:r.a.createElement(g.FormattedMessage,{id:"faq.paymentProcessor.question",defaultMessage:"How is my payment being processed?"}),answer:r.a.createElement(g.FormattedMessage,{id:"faq.paymentProcessor.answer",defaultMessage:"<p>We use Stripe to process your payment. It’s the same payment provider used by products such as Twitter, Pinterest, and Lyft. We do not handle your credit card information directly.</p>",values:{p:Nt}})},{question:r.a.createElement(g.FormattedMessage,{id:"faq.multipleTeams.question",defaultMessage:"Can I belong to multiple teams on Notion? "}),answer:r.a.createElement(g.FormattedMessage,{id:"faq.multipleTeams.answer",defaultMessage:"<p>Yes! You can use the same email address to create and join multiple teams. However, each one of these workspaces is on its own plan and needs to be upgraded individually.</p>",values:{p:Nt}})}]}};class Gt extends A.a{constructor(){super(...arguments),this.renderFaqItem=(e,t)=>r.a.createElement(n.Fragment,{key:t},r.a.createElement("div",{style:Gt.questionStyle},e.question),r.a.createElement("div",{style:this.getAnswerStyle()},e.answer)),this.handleHelpButtonClick=()=>{Ee.a({environment:this.environment,from:"pricing"})}}renderComponent(){return r.a.createElement("div",{style:{maxWidth:600}},this.getFaqList().map((e,t)=>this.renderFaqItem(e,t)),r.a.createElement("div",{style:{color:this.props.isSettings?this.theme.mediumTextColor:$.f.frontTextMedium}},this.props.cta?"intercom"===this.props.cta?this.renderIntercomCTA():this.renderGuidesCTA():null))}renderIntercomCTA(){var e=this;return r.a.createElement(g.FormattedMessage,{id:"faqList.moreQuestionsTextIntercom",defaultMessage:"Still have more questions? <messagelink>Send us a message</messagelink>",values:{messagelink:function(){for(var t=arguments.length,a=new Array(t),n=0;n<t;n++)a[n]=arguments[n];return r.a.createElement(we.a,{onClick:e.handleHelpButtonClick},a)}}})}renderGuidesCTA(){return r.a.createElement(g.FormattedMessage,{id:"faqList.moreQuestionsTextHelpCenter",defaultMessage:"Still have more questions? Learn more in our <messagelink>help center</messagelink>.",values:{messagelink:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return r.a.createElement(we.a,{href:Object(je.a)("guides.guides")},t)}}})}getFaqList(){return Ht[this.props.type](this.environment)}getAnswerStyle(){return{color:this.props.isSettings?this.theme.mediumTextColor:$.f.frontTextMedium,marginBottom:"1.5rem",lineHeight:1.5}}}Gt.questionStyle={fontWeight:Z.a.fontWeight.semibold,marginBottom:4};var Qt=Gt,Yt=a("4VgC"),Zt=a("DlEO"),Xt=a("62KP"),Kt=a("1Imc"),Jt=a("enKW"),$t=a("H4VD"),ea=a("qqdV"),ta=a("CI7d");function aa(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function na(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?aa(Object(a),!0).forEach((function(t){ra(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):aa(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function ra(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class ia extends A.a{constructor(){super(...arguments),this.storeTypes={loginStore:Kt.a,loginPermissionsStore:Xt.a},this.handleLoginClick=async()=>{const{email:e}=this.stores.loginStore.state;this.props.analyticsName&&m.Y(this.environment,{from:this.props.analyticsName});const t=await l.checkEmailType(this.environment,{email:e});if("failed"===t.type)return;const a=t.data;a.samlRedirect?u.redirectToSaml(this.environment,a.samlRedirect.redirectUrl):a.isGoogleAppsEmail?u.requestLoginWithGoogle({environment:this.environment,store:this.stores.loginStore,email:e,permissionsStore:this.stores.loginPermissionsStore}):a.hasPassword?($t.navigate({environment:this.environment,url:ea.d.login}),a.mustReverify?(await u.sendTemporaryPassword({environment:this.environment,store:Zt.a,reverify:!0}),this.stores.loginStore.reset()):Zt.a.setState({loginType:"password",email:e,password:"",emailInputFocused:!1,alert:void 0})):($t.navigate({environment:this.environment,url:ea.d.signup}),Zt.a.setState({loginType:"email",email:e,password:"",emailInputFocused:!1}),await u.sendTemporaryPassword({environment:this.environment,store:Zt.a}),this.stores.loginStore.reset())},this.handleInputChange=e=>{""===e.target.value&&this.stores.loginStore.reset(),this.stores.loginStore.setState(na({},this.stores.loginStore.state,{email:e.target.value}))},this.handleInputFocus=e=>{this.stores.loginStore.setState(na({},this.stores.loginStore.state,{emailInputFocused:!0}))},this.handleInputBlur=e=>{this.stores.loginStore.setState(na({},this.stores.loginStore.state,{emailInputFocused:!1}))}}renderComponent(){const e=this.renderPlaceholderText();return r.a.createElement("div",{style:this.getWrapStyle()},r.a.createElement(q.b,{style:ia.inputStyle,value:this.stores.loginStore.state.email,type:"email",format:q.b.Format.Large,autoFocus:!1,autoComplete:"off",placeholder:e,onSubmit:this.handleLoginClick,showClearButton:!0,onFocus:this.handleInputFocus,onBlur:this.handleInputBlur,onChange:this.handleInputChange}),r.a.createElement(Yt.a,{variant:this.props.buttonVariant?this.props.buttonVariant:"primary",style:{textAlign:"center",width:this.props.buttonWidth?this.props.buttonWidth:"auto"},onClick:this.handleLoginClick},this.props.buttonTitle||r.a.createElement(g.FormattedMessage,{id:"frontSignupComponent.submitButton.label",defaultMessage:"Sign up"})))}renderPlaceholderText(){const{persona:e,intl:t}=this.props,a=t.formatMessage({id:"frontSignupComponent.emailInput.genericEmailPlaceholder",defaultMessage:"Enter your email…"});switch(e){case"personal":return a;case"education":return t.formatMessage({id:"frontSignupComponent.emailInput.educationEmailPlaceholder",defaultMessage:"Enter your school email…"});case"team":return t.formatMessage({id:"frontSignupComponent.emailInput.teamEmailPlaceholder",defaultMessage:"Enter your work email…"});default:return a}}getWrapStyle(){return{width:"100%",maxWidth:this.props.maxWidth?this.props.maxWidth:320,display:"flex",alignItems:"center"}}}ia.inputStyle={fontSize:ta.a.fontSize.ui.m,height:36,flex:1,background:$.f.white,boxShadow:Jt.a.frontInputShadow,marginRight:8};var sa=Object(g.injectIntl)(ia),oa=a("5Nka"),la=a("7Vnh");class ca extends E.a{getInitialState(){return{termType:"yearly"}}}var da=new ca,ua=a("lEhh");function pa(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ma(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class ha extends A.a{renderComponent(){const e="yearly"===da.state.termType?"monthly":"yearly";return r.a.createElement("div",{style:this.getTermToggleStyle(this.theme),onClick:()=>{m.Rb(this.environment,{from:"pricing_grid_top",toggle_to:e}),da.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?pa(Object(a),!0).forEach((function(t){ma(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):pa(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},da.state,{termType:e}))}},r.a.createElement("div",{style:{marginRight:8}},this.props.isSettings?r.a.createElement(g.FormattedMessage,{id:"pricingGrid.pricingTermToggle.payAnnually.label",defaultMessage:"Pay annually"}):r.a.createElement(g.FormattedMessage,{id:"frontPricingPage.pricingTermToggle.payAnnually.label",defaultMessage:"Pay annually"})),r.a.createElement(ua.a,{on:"monthly"===da.state.termType}),r.a.createElement("div",{style:{marginLeft:8}},this.props.isSettings?r.a.createElement(g.FormattedMessage,{id:"pricingGrid.pricingTermToggle.payMonthly.label",defaultMessage:"Monthly"}):r.a.createElement(g.FormattedMessage,{id:"frontPricingPage.pricingTermToggle.payMonthly.label",defaultMessage:"Pay monthly"})))}getTermToggleStyle(e){return{cursor:"pointer",fontSize:14,color:e.mediumTextColor,display:"flex",alignItems:"center",marginBottom:8}}}var ga=ha;var fa=function(e){return!!e.device.isMobile||e.WindowSizeStore.state.width<960},ba=a("uRvc"),ya=a("VhAz"),Sa=a("w4oV"),va=a("V1wX");function Ea(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ma(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ea(Object(a),!0).forEach((function(t){Ca(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ea(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Ca(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const wa=["free","personal","team","enterprise"];class Oa extends A.a{willMount(e){const t=fe.p(e.data);t&&e.data&&da.setState({termType:"year"===t.interval?"yearly":"monthly"})}renderComponent(){return r.a.createElement("div",null,r.a.createElement("table",{style:this.getTableStyle(this.props.isSettings)},this.props.isSettings&&this.renderHeader(),r.a.createElement("tbody",null,la.e.map((e,t)=>this.renderSection(e,t))),!this.props.isSettings&&this.renderFooter()))}renderCheck(){return be.a.thinCheck({display:"inline",height:this.props.isSettings?12:14,width:this.props.isSettings?12:14,color:this.theme.regularTextColor})}upgradeLink(e,t){const{planState:a}=this.props;if(a)return r.a.createElement(we.a,{onClick:a.plans[e].onClick,style:{fontSize:12,fontWeight:500,textDecoration:"none",color:this.theme.mediumTextColor,lineHeight:1.2}},t||r.a.createElement(g.FormattedMessage,{id:"pricingGrid.planAttribute.button.upgrade",defaultMessage:"Upgrade"}))}renderPlanContent(e){const{label:t,upgradeCta:a,upgradeCTALabel:i}=e;return t&&a?r.a.createElement(n.Fragment,null,t,r.a.createElement("br",null),this.upgradeLink(a,i)):t||(a?r.a.createElement(n.Fragment,null,r.a.createElement(g.FormattedMessage,{id:"pricingGrid.planAttribute.notInTrial",defaultMessage:"Not in trial"}),r.a.createElement("br",null),this.upgradeLink(a,i)):this.renderCheck())}renderPlan(e,t,a){return r.a.createElement("td",{style:Ma({},this.getRowStyle(this.theme),{},this.getValueStyle(),{},this.getActiveStyle(this.theme,this.isPlanActive(e)),{},this.getBorderStyle(e))},a.hasFeature&&r.a.createElement(it.a,{delayThreshold:0,placement:it.a.Placement.Right,renderTooltip:()=>Object(la.f)(t),textWrap:!0,render:e=>r.a.createElement("div",Object.assign({style:{cursor:"help",lineHeight:1.3,padding:"6px 0"}},e),this.renderPlanContent(a))}))}renderItem(e,t){const a=this.props.isSettings?"auto":300,n=this.props.planState&&this.props.planState.isTeamTrial;return r.a.createElement("tr",{key:"table-row-".concat(t)},r.a.createElement("td",{style:Ma({},this.getRowStyle(this.theme),{},this.getRowLabelStyle(this.theme),{width:a,maxWidth:a,minWidth:a})},r.a.createElement(it.a,{delayThreshold:0,placement:it.a.Placement.Right,renderTooltip:()=>Object(la.f)(e.tooltip),textWrap:!0,render:t=>r.a.createElement("span",Object.assign({},t,{style:this.getTooltipInnerStyle(this.theme)}),e.label,e.isComingSoon&&this.renderComingSoonBadge())})),wa.map(t=>{const a="team"===t&&n?"teamTrial":t;return this.renderPlan(t,e.tooltip,e.plans[a])}))}renderEmptyTableCell(e,t){return r.a.createElement("td",{style:Ma({},this.getSectionStyle(this.theme,t),{},this.getValueStyle(),{},this.getActiveStyle(this.theme,this.isPlanActive(e)),{},this.getBorderStyle(e),{color:$.f.lightTextColor,fontWeight:400})},!this.props.isSettings&&this.getPlanName(e))}renderEmptyTableCells(e){return r.a.createElement(n.Fragment,null,wa.map(t=>this.renderEmptyTableCell(t,e)))}renderSection(e,t){const a=this.props.isSettings?"auto":300;return r.a.createElement(n.Fragment,{key:"table-section-".concat(t)},r.a.createElement("tr",null,r.a.createElement("td",{style:Ma({},this.getSectionStyle(this.theme,t),{width:a,maxWidth:a,minWidth:a})},e.label),this.renderEmptyTableCells(t)),e.items.map((e,t)=>this.renderItem(e,t)))}renderButton(e,t){const a=t.plans[e],n="notion-pricing-grid-upgrade-".concat(e);let i;switch(a.buttonType){case"current":i=r.a.createElement(g.FormattedMessage,{id:"pricingGrid.currentPlanButton.label",defaultMessage:"Current"});break;case"upgrade":i=r.a.createElement(g.FormattedMessage,{id:"pricingGrid.upgradePlanButton.label",defaultMessage:"Upgrade"});break;case"downgrade":i=r.a.createElement(g.FormattedMessage,{id:"pricingGrid.downgradePlanButton.label",defaultMessage:"Downgrade"});break;case"will-downgrade":i=r.a.createElement(g.FormattedMessage,{id:"pricingGrid.willDowngradePlanButton.label",defaultMessage:"Future plan"});break;case"resubscribe":i=r.a.createElement(g.FormattedMessage,{id:"pricingGrid.resubscribePlanButton.label",defaultMessage:"Resubscribe"});break;default:ya.e(a.buttonType)}if("current"===a.buttonType)return this.renderDisabledButtonWithTooltip({tooltip:r.a.createElement(g.FormattedMessage,{id:"pricingGrid.currentPlan.tooltip",defaultMessage:"This is your current active plan"}),label:r.a.createElement(g.FormattedMessage,{id:"pricingGrid.currentPlan.largeScreenLabel",defaultMessage:"Current plan"}),buttonClassName:n,wrapTooltip:!1});if(!t.canSwitchPlans){let e;return e=t.isInAppPurchase?r.a.createElement(g.FormattedMessage,{id:"pricingGrid.switchPlanFromInAppPurchase.tooltip",defaultMessage:"You're currently subscribed through an in-app purchase with Apple. To switch plans, cancel your subscription with Apple first."}):r.a.createElement(g.FormattedMessage,{id:"pricingGrid.switchPlanAsMember.tooltip",defaultMessage:"You need to be an administrator of this workspace to switch plans."}),this.renderDisabledButtonWithTooltip({tooltip:e,label:i,buttonClassName:n,wrapTooltip:!0})}return("personal"===e||"free"===e)&&t.memberCount>1?this.renderDisabledButtonWithTooltip({tooltip:r.a.createElement(g.FormattedMessage,{id:"pricingGrid.switchToPersonalPlanButton.tooltip",defaultMessage:"The Personal and Personal Pro Plans are only available for 1-person use. If you'd like to use these plans, please remove the other members in this workspace."}),label:i,buttonClassName:n,wrapTooltip:!0}):"will-downgrade"===a.buttonType?this.renderDisabledButtonWithTooltip({tooltip:r.a.createElement(g.FormattedMessage,{id:"pricingGrid.willDowngradePlan.tooltip",defaultMessage:"This is the plan after your current plan expires"}),label:r.a.createElement(g.FormattedMessage,{id:"pricingGrid.willDowngradePlan.largeScreenLabel",defaultMessage:"Future plan"}),buttonClassName:n,wrapTooltip:!1}):"downgrade"===a.buttonType?r.a.createElement(te.a,{isLarge:!0,style:{width:"100%"},onClick:()=>{m.Gd(this.environment,{plan:e,from:"pricing_grid_top",button_text:a.buttonType}),a.onClick()},className:n},i):r.a.createElement(ee.a,{isLarge:!0,style:{width:"100%"},onClick:()=>{m.Gd(this.environment,{plan:e,from:"pricing_grid_top",button_text:a.buttonType}),a.onClick()},className:n},i)}renderDisabledButtonWithTooltip(e){const{tooltip:t,label:a,buttonClassName:n,wrapTooltip:i}=e;return r.a.createElement(it.a,{style:{width:i?320:"auto"},textWrap:i,renderTooltip:()=>t,render:e=>r.a.createElement(te.a,Object.assign({style:{width:"100%",opacity:.5},isLarge:!0,disabled:!0},e,{className:n}),a)})}renderSalesContactLink(){return r.a.createElement(we.a,{onClick:()=>{const{currentUserStore:e}=p.default.state,t=e&&e.getValue();m.Z(this.environment),Sa.a.setState({open:!0,email:t&&t.email,name:t&&Object(va.d)(this.props.intl,t)})}},r.a.createElement("div",{style:this.getUpgradeButtonBelowLinkStyle()},r.a.createElement(g.FormattedMessage,{id:"pricingGrid.contactSalesLink",defaultMessage:"Contact sales"})))}renderTeamTrialIndicator(){return r.a.createElement(it.a,{delayThreshold:0,placement:it.a.Placement.Bottom,renderTooltip:()=>r.a.createElement(g.FormattedMessage,{id:"pricingGrid.inTeamTrial.tooltip",defaultMessage:"Your current Team trial has a 1,000 block limit. Upgrade to go unlimited."}),textWrap:!0,style:{width:280},render:e=>r.a.createElement("div",Object.assign({style:Ma({},this.getUpgradeButtonBelowLinkStyle(),{fontWeight:500,display:"flex",flexDirection:"row",cursor:"help"})},e),r.a.createElement("div",{style:{paddingRight:4,paddingTop:2}},this.renderCheck()),r.a.createElement("div",null,r.a.createElement(g.FormattedMessage,{id:"pricingGrid.inTeamTrial",defaultMessage:"In free trial"})))})}renderTeamTrialButton(e){if(e.isActive&&"resubscribe"===e.buttonType)return;const t="current"===e.buttonType?r.a.createElement(g.FormattedMessage,{id:"pricingGrid.cancelPlanLink",defaultMessage:"Cancel plan"}):r.a.createElement(g.FormattedMessage,{id:"pricingGrid.teamTrialLink",defaultMessage:"Try for free"});return r.a.createElement(we.a,{onClick:e.onClickTeamFree},r.a.createElement("div",{style:this.getUpgradeButtonBelowLinkStyle()},t))}getPlanName(e){const{intl:t}=this.props;switch(e){case"free":return t.formatMessage({id:"pricingGrid.personalFreePlanColumn.header",defaultMessage:"Personal"});case"personal":return t.formatMessage({id:"pricingGrid.personalProPlanColumn.header",defaultMessage:"Personal Pro"});case"team":return t.formatMessage({id:"pricingGrid.teamPlanColumn.header",defaultMessage:"Team"});case"enterprise":return t.formatMessage({id:"pricingGrid.enterprisePlanColumn.header",defaultMessage:"Enterprise"});default:return ya.e(e),""}}renderHeaderTitle(e){const t=this.getPlanName(e.plan);return r.a.createElement("td",{style:Ma({},this.getHeaderStyle(),{},this.getActiveStyle(this.theme,this.isPlanActive(e.plan)),{},this.getBorderStyle(e.plan))},!this.props.isSettings&&r.a.createElement("img",{style:{height:80,marginBottom:-5},src:e.image,alt:t}),r.a.createElement("div",{style:this.getHeaderTitleStyle()},t),void 0!==e.price&&r.a.createElement("div",{style:{display:fa(this.environment)?"block":"flex"}},r.a.createElement("div",{style:this.getHeaderPriceStyle()},e.price),void 0!==e.terms&&r.a.createElement("div",{style:this.getHeaderTermsStyle(this.theme)},Object(la.c)(this.props.intl,e.terms))),!this.props.isSettings&&"enterprise"===e.plan&&r.a.createElement("div",{style:{height:30}},this.renderSalesContactLink()))}renderHeaderLabels(){const e=this.isPlanActive("team")||this.isPlanActive("enterprise");return r.a.createElement("tr",null,r.a.createElement("td",{style:{width:"28%"}}),r.a.createElement("td",{style:Ma({},this.getHeaderLabelStyle(!e),{},this.getBorderStyle("free"),{borderLeft:this.props.isSettings?"1px solid ".concat(this.theme.lightDividerColor):void 0}),colSpan:2},r.a.createElement(g.FormattedMessage,{id:"pricingGrid.personalPlans.label",defaultMessage:"For individuals"})),r.a.createElement("td",{style:Ma({},this.getHeaderLabelStyle(e),{},this.getBorderStyle("enterprise")),colSpan:2},r.a.createElement(g.FormattedMessage,{id:"pricingGrid.teamPlans.label",defaultMessage:"For teams & businesses"})))}renderHeaderTitles(){const e=da.state.termType,t=Object(la.d)(W.default,this.props.intl);return r.a.createElement("tr",null,r.a.createElement("td",null),this.renderHeaderTitle({plan:"free",price:t.price[e].personal,image:oa.a.front.pricing.pricingFreeV2Png}),this.renderHeaderTitle({plan:"personal",price:t.price[e].pro,image:oa.a.front.pricing.pricingPersonalV2Png,terms:t.terms.pro}),this.renderHeaderTitle({plan:"team",price:t.price[e].team,image:oa.a.front.pricing.pricingTeamV2Png,terms:t.terms.team}),this.props.isSettings?this.renderHeaderTitle({plan:"enterprise",price:t.price[e].enterprise,image:oa.a.front.pricing.pricingEnterpriseV2Png,terms:t.terms.enterprise}):this.renderHeaderTitle({plan:"enterprise",image:oa.a.front.pricing.pricingEnterpriseV2Png}))}renderHeaderAction(e){const{planState:t}=this.props;if(t)return r.a.createElement("td",{style:Ma({},this.getHeaderStyle(),{},this.getActiveStyle(this.theme,this.isPlanActive(e)),{},this.getBorderStyle(e))},this.renderButton(e,t),this.renderHeaderSubAction(e))}renderHeaderSubAction(e){if("enterprise"===e)return r.a.createElement("div",{style:{marginTop:7}},this.renderSalesContactLink());if("team"===e){const{planState:t}=this.props;if(!t||!t.canSwitchPlans||t.plans.personal.isActive)return;return r.a.createElement("div",{style:{marginTop:7}},t.isTeamTrial?this.renderTeamTrialIndicator():this.renderTeamTrialButton(t.plans[e]))}}renderHeaderActions(){if(this.props.isSettings&&this.props.planState)return r.a.createElement("tr",null,r.a.createElement("td",{style:{width:"28%",verticalAlign:"top",paddingTop:16}},r.a.createElement(ga,{isSettings:this.props.isSettings})),wa.map(e=>this.renderHeaderAction(e)))}renderHeader(){return r.a.createElement("thead",null,this.renderHeaderLabels(),this.renderHeaderTitles(),this.renderHeaderActions())}renderStandardCTA(){return r.a.createElement(sa,{buttonTitle:r.a.createElement(g.FormattedMessage,{id:"pricingGrid.signupComponent.submitButton.label",defaultMessage:"Try it free"}),analyticsName:"pricing_grid_bottom",buttonWidth:100,persona:"personal"})}renderEnterpriseCTA(){return r.a.createElement(Yt.a,{variant:"secondary",isFullWidth:!0,onClick:()=>{Wt({environment:this.environment,typeform:"enterpriseTrial",frontContext:"pricing_grid_bottom",params:{source:"pricing_grid_bottom"}})}},r.a.createElement(g.FormattedMessage,{defaultMessage:"Try Enterprise",id:"pricingGrid.enterpriseCallToAction.message"}))}renderCTAs(){return r.a.createElement(n.Fragment,null,r.a.createElement("td",{colSpan:3,style:Ma({},this.getCTACellStyle())},r.a.createElement("div",{style:{display:"flex",justifyContent:"flex-start",width:"100%"}},this.renderStandardCTA())),r.a.createElement("td",{style:Ma({},this.getCTACellStyle())},this.renderEnterpriseCTA()))}renderFooter(){return r.a.createElement("tfoot",null,r.a.createElement("tr",null,r.a.createElement("td",{style:{verticalAlign:"middle",fontWeight:500}},r.a.createElement(g.FormattedMessage,{defaultMessage:"Sign up for free.{br}Add your team later.",id:"pricingGrid.footerSignupCallToAction.message",values:{br:r.a.createElement("br",null)}})),this.renderCTAs()))}renderComingSoonBadge(){return r.a.createElement("div",{style:{background:this.theme.buttonHoveredBackground,fontSize:10,fontWeight:500,letterSpacing:"0.015em",color:this.theme.mediumTextColor,display:"inline",textTransform:"uppercase",padding:"2px 4px",marginLeft:6,borderRadius:3,whiteSpace:"nowrap"}},r.a.createElement(g.FormattedMessage,{id:"pricingGrid.comingSoonBadge",defaultMessage:"Coming soon"}))}isPlanActive(e){return!(!this.props.planState||!this.props.planState.plans[e].isActive)}getTableStyle(e){return{fontSize:e?14:16,width:e?"100%":ba.b.m,tableLayout:"fixed",borderCollapse:"initial"}}getSectionStyle(e,t){const a={borderBottom:"1px solid ".concat(e.regularDividerColor),paddingBottom:7,paddingRight:15,fontWeight:500,verticalAlign:"bottom"};return Ma({},a,0===t?{paddingTop:this.props.isSettings?0:54}:{paddingTop:this.props.isSettings?20:42})}getUpgradeButtonBelowLinkStyle(){return{fontSize:this.props.isSettings?12:14}}getRowStyle(e){return{borderBottom:"1px solid ".concat(e.regularDividerColor)}}getRowLabelStyle(e){const t=(this.props.isSettings,5);return{color:e.mediumTextColor,paddingRight:10,paddingTop:t,paddingBottom:t+1,verticalAlign:"top"}}getCTACellStyle(){return{padding:"20px 15px"}}getValueStyle(){const e=this.props.isSettings?10:15;return{paddingLeft:e,paddingRight:e,textAlign:"left",overflow:"hidden",verticalAlign:"top"}}getActiveStyle(e,t){return{background:t?e.sidebarBackground:$.f.transparent}}getBorderStyle(e){return{borderLeft:this.props.isSettings?"1px solid ".concat(this.theme.lightDividerColor):void 0,borderRight:this.props.isSettings&&["enterprise"].includes(e)?"1px solid ".concat(this.theme.lightDividerColor):void 0}}getHeaderLabelStyle(e){const t=this.props.isSettings?10:15;return{paddingLeft:t,paddingRight:t,verticalAlign:"top",width:"36%",paddingTop:this.props.isSettings?10:0,fontWeight:700,fontSize:12,paddingBottom:10,borderBottom:e?"2px solid ".concat(this.theme.regularTextColor):"1px solid ".concat(this.theme.lightDividerColor),borderTop:"1px solid ".concat(this.theme.lightDividerColor)}}getHeaderStyle(){const e=this.props.isSettings?10:15;return{paddingLeft:e,paddingRight:e,verticalAlign:"top",width:"18%",paddingTop:this.props.isSettings?10:0}}getHeaderTitleStyle(){return{fontSize:this.props.isSettings?16:25,fontWeight:this.props.isSettings&&fa(this.environment)?500:700,lineHeight:1.3,marginBottom:2}}getHeaderPriceStyle(){return{fontSize:this.props.isSettings?20:25,marginRight:7}}getTooltipInnerStyle(e){return{cursor:"help",width:"100%",display:"inline-block"}}getHeaderTermsStyle(e){return{fontSize:this.props.isSettings?10:12,lineHeight:1,color:e.mediumTextColor,width:70,paddingTop:this.props.isSettings?fa(this.environment)?0:3:5}}}var ka=Object(g.injectIntl)(Oa);const Pa=["not_using_enough","too_difficult","trial_over","too_expensive","security_compliance_requirements","company_shutting_down","upgraded_by_mistake","using_alternative","missing_features","other"],Ta=["google_drive_docs","asana","trello","microsoft_office","atlassian_confluence","atlassian_jira","airtable","coda","dropbox_paper","quip","evernote","other"];class Da extends E.a{getInitialState(){return{reasons:[],reasonMissingFeatures:"",reasonOther:"",alternatives:[],alternativeOther:"",otherFeedback:""}}}var Ia=Da,Fa=a("3DNc"),ja=a("mKX5");function xa(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ba(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?xa(Object(a),!0).forEach((function(t){Aa(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):xa(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Aa(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const Ra=Object(g.defineMessages)({missingFeaturesPlaceholder:{id:"churnSurveyMenu.reasons.missingFeaturesPlaceholder",defaultMessage:"Let us know which features are missing..."},reasonOtherPlaceholder:{id:"churnSurveyMenu.reasons.reasonOtherPlaceholder",defaultMessage:"Tell us more..."},alternativeOtherPlaceholder:{id:"churnSurveyMenu.alternatives.alternativeOtherPlaceholder",defaultMessage:"Tell us more..."},otherFeedbackPlaceholder:{id:"churnSurveyMenu.other.otherFeedbackPlaceholder",defaultMessage:"Our team will review your feedback to make Notion better."}});class La extends A.a{constructor(){super(...arguments),this.shuffledReasons=[...s.a.shuffle(s.a.without(Pa,"other")),"other"],this.shuffledAlternatives=[...s.a.shuffle(s.a.without(Ta,"other")),"other"],this.storeTypes={store:Ia},this.handleAccept=()=>{Object(m.x)(this.environment,this.stores.store.state),this.props.onAccept()}}renderComponent(){var e=this;const{churnType:t,onClose:a,periodEnd:n}=this.props,{store:i}=this.stores,{reasons:o,reasonMissingFeatures:l,reasonOther:c,alternatives:d,alternativeOther:u,otherFeedback:p}=i.state,m=Object(ja.a)(n).format("LL");return r.a.createElement("div",{style:{fontSize:14}},r.a.createElement("div",{style:{display:"flex",fontSize:14,padding:24,paddingBottom:20,borderBottom:"1px solid ".concat(this.theme.lightDividerColor)}},r.a.createElement("div",null,r.a.createElement("h3",{style:La.headerStyle},"personal"===t?r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.header.personal.title",defaultMessage:"Downgrade to Personal"}):r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.header.team.title",defaultMessage:"Downgrade to Team Trial"})),r.a.createElement("p",{style:{lineHeight:1.4,margin:"8px 0 12px"}},r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.header.description",defaultMessage:"Notion is constantly improving. Before you downgrade, we’d love your input to help us make Notion better for everyone. Thank you for your feedback."})),r.a.createElement(te.a,{onClick:a},r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.goBackButton.title",defaultMessage:"Back to Plans"}))),r.a.createElement("div",{style:{alignSelf:"center",padding:"0px 8px"}},r.a.createElement("img",{src:oa.a.images.downgradeFeedbackPng,style:{filter:this.theme.illustrationFilter},width:160}))),r.a.createElement("div",{style:{padding:"8px 12px",margin:"20px 24px 12px 24px",background:this.theme.sidebarBackground,borderRadius:3}},r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.header.covidMessage",defaultMessage:"💛 If you are impacted by COVID-19, <contactuslink>contact us</contactuslink> for assistance.",values:{contactuslink:function(){for(var t=arguments.length,a=new Array(t),n=0;n<t;n++)a[n]=arguments[n];return r.a.createElement(we.a,{onClick:()=>{Object(Ee.a)({environment:e.environment,from:"churn_survey"})}},a)}}})),r.a.createElement("div",{style:La.surveySectionStyle},r.a.createElement("h4",{style:La.subheaderStyle},r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.reasons.title",defaultMessage:"1. What are your reasons for downgrading?"})),r.a.createElement("div",{style:this.getDescriptionStyle()},r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.reasons.description",defaultMessage:"Please select one or more"})),this.shuffledReasons.map(e=>{const t=o.includes(e);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{key:e,style:La.optionRowStyle,onClick:()=>{i.setState(Ba({},i.state,{reasons:t?s.a.without(o,e):[...o,e]}))}},r.a.createElement(Fa.a,{checked:t,size:14}),r.a.createElement("span",{style:{marginLeft:4}},this.renderMessageForReason(e))),"missing_features"===e&&t&&r.a.createElement(q.b,{style:La.inlineInputStyle,autoFocus:!0,value:l,placeholder:f.default.formatMessage(Ra.missingFeaturesPlaceholder),onChange:e=>{i.setState(Ba({},i.state,{reasonMissingFeatures:e.target.value}))}}),"other"===e&&t&&r.a.createElement(q.b,{style:La.inlineInputStyle,autoFocus:!0,value:c,placeholder:f.default.formatMessage(Ra.reasonOtherPlaceholder),onChange:e=>{i.setState(Ba({},i.state,{reasonOther:e.target.value}))}}))})),r.a.createElement("div",{style:La.surveySectionStyle},r.a.createElement("h4",{style:La.subheaderStyle},r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.alternatives.title",defaultMessage:"2. What tools are you using instead?"})),r.a.createElement("div",{style:this.getDescriptionStyle()},r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.alternatives.description",defaultMessage:"Please select one or more"})),this.shuffledAlternatives.map(e=>{const t=d.includes(e);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{key:e,style:La.optionRowStyle,onClick:()=>{i.setState(Ba({},i.state,{alternatives:t?s.a.without(d,e):[...d,e]}))}},r.a.createElement(Fa.a,{checked:t,size:14}),r.a.createElement("span",{style:{marginLeft:4}},this.renderMessageForAlternative(e))),"other"===e&&t&&r.a.createElement(q.b,{style:La.inlineInputStyle,autoFocus:!0,value:u,placeholder:f.default.formatMessage(Ra.alternativeOtherPlaceholder),onChange:e=>{i.setState(Ba({},i.state,{alternativeOther:e.target.value}))}}))})),r.a.createElement("div",{style:La.surveySectionStyle},r.a.createElement("h4",{style:La.subheaderStyle},r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.otherFeedback.title",defaultMessage:"3. Any other feedback for us?"})),r.a.createElement(q.b,{textarea:!0,style:{marginTop:4},value:p,placeholder:f.default.formatMessage(Ra.otherFeedbackPlaceholder),onChange:e=>{i.setState(Ba({},i.state,{otherFeedback:e.target.value}))}})),r.a.createElement("div",{style:{padding:"20px 24px",marginTop:20,borderTop:"1px solid ".concat(this.theme.lightDividerColor)}},r.a.createElement("h4",{style:La.subheaderStyle},r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.continueDowngrade.title",defaultMessage:"Continue downgrade?"})),r.a.createElement("p",{style:{margin:"4px 0 20px",lineHeight:1.4}},"personal"===t?r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.continueDowngrade.downgradeMessage.personal",defaultMessage:"If you cancel now, you'll still enjoy all the features of your paid plan until {periodEnd}. You can resubscribe or switch to another paid plan anytime.{br}After {periodEnd}, this workspace will be downgraded to the free Personal plan, with these restrictions: <li>Single-person use</li><li>Guest limit of 5 per workspace</li><li>Upload files up to 5 MB</li><li>No version history</li><li>No member shared workspace</li>",values:{periodEnd:r.a.createElement("span",{style:{fontWeight:600}},m),br:r.a.createElement("div",{style:{height:8}}),li:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return r.a.createElement("ul",{style:La.restrictionListItemStyle},r.a.createElement("li",null,t))}}}):r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.continueDowngrade.downgradeMessage.team",defaultMessage:"If you cancel now, you'll still enjoy all the features of your paid plan until {periodEnd}. You can resubscribe or switch to another paid plan anytime.{br}After {periodEnd}, this workspace will be downgraded to a free trial of the Team Plan, with these restrictions: <li>1,000 block limit</li><li>Upload files up to 5 MB</li><li>No version history</li><li>No bulk exports</li><li>No advanced permissions</li><li>No permission groups</li>",values:{periodEnd:r.a.createElement("span",{style:{fontWeight:600}},m),br:r.a.createElement("div",{style:{height:8}}),li:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return r.a.createElement("ul",{style:La.restrictionListItemStyle},r.a.createElement("li",null,t))}}})),r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(te.a,{isRed:!0,onClick:this.handleAccept},r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.downgradeButton.title",defaultMessage:"Downgrade"})),r.a.createElement(te.a,{onClick:a,style:{marginLeft:12}},r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.cancelButton.title",defaultMessage:"Cancel"})))))}renderMessageForReason(e){if("not_using_enough"===e)return r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.reasons.notUsingEnough",defaultMessage:"Not using it enough"});if("too_difficult"===e)return r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.reasons.toDifficult",defaultMessage:"Too difficult to use"});if("trial_over"===e)return r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.reasons.trialOver",defaultMessage:"Trial is over"});if("too_expensive"===e)return r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.reasons.tooExpensive",defaultMessage:"Too expensive"});if("security_compliance_requirements"===e)return r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.reasons.securityComplianceRequirements",defaultMessage:"Security or compliance requirements"});if("company_shutting_down"===e)return r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.reasons.companyShuttingDown",defaultMessage:"Company is shutting down or making cuts"});if("upgraded_by_mistake"===e)return r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.reasons.upgradedByMistake",defaultMessage:"Upgraded by mistake"});if("using_alternative"===e)return r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.reasons.usingAlternative",defaultMessage:"Using an alternative"});if("missing_features"===e)return r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.reasons.missingFeatures",defaultMessage:"Missing features"});if("other"===e)return r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.reasons.other",defaultMessage:"Other"});throw Object(ya.e)(e)}renderMessageForAlternative(e){if("google_drive_docs"===e)return r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.alternatives.googleDriveDocs",defaultMessage:"Google Drive / Docs"});if("asana"===e)return r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.alternatives.asana",defaultMessage:"Asana"});if("trello"===e)return r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.alternatives.trello",defaultMessage:"Trello"});if("microsoft_office"===e)return r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.alternatives.microsoftOffice",defaultMessage:"Microsoft 365 / Office"});if("atlassian_confluence"===e)return r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.alternatives.atlassianConfluence",defaultMessage:"Confluence"});if("atlassian_jira"===e)return r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.alternatives.atlassianJira",defaultMessage:"Jira"});if("airtable"===e)return r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.alternatives.airtable",defaultMessage:"Airtable"});if("coda"===e)return r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.alternatives.coda",defaultMessage:"Coda"});if("dropbox_paper"===e)return r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.alternatives.dropboxPaper",defaultMessage:"Dropbox Paper"});if("quip"===e)return r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.alternatives.quip",defaultMessage:"Quip"});if("evernote"===e)return r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.alternatives.evernote",defaultMessage:"Evernote"});if("other"===e)return r.a.createElement(g.FormattedMessage,{id:"churnSurveyMenu.alternatives.other",defaultMessage:"Other"});throw Object(ya.e)(e)}getDescriptionStyle(){return{margin:0,color:this.theme.mediumTextColor,marginBottom:8}}}La.optionRowStyle={display:"flex",alignItems:"center",cursor:"pointer",marginBottom:4},La.restrictionListItemStyle={paddingLeft:20,margin:"6px 0"},La.surveySectionStyle={padding:"8px 24px"},La.headerStyle={margin:0,marginBottom:8},La.subheaderStyle={margin:0,marginTop:8,fontSize:16,fontWeight:600},La.inlineInputStyle={marginBottom:12,marginLeft:18,width:"calc(100% - 18px)"};var Ua=La,_a=a("AfJk");function Wa(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Na(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Wa(Object(a),!0).forEach((function(t){qa(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Wa(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function qa(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Va extends A.a{constructor(){super(...arguments),this.storeTypes={store:jt},this.renderChurnSurveyModal=()=>{const e=this.stores.store.state,{data:t}=this.props,a=fe.p(t),n=fe.i(this.environment);if(e.churnSurveyModalOpen&&n&&a)return r.a.createElement(Ua,{churnType:e.churnType,periodEnd:a.periodEnd,onAccept:this.handleChurnSurveyModalAccept,onClose:this.handleChurnSurveyModalClose})},this.handleFreeClick=async()=>{const{data:e}=this.props;if(e&&"subscribed_admin"===e.type){const e=await new Promise(e=>{const{store:t}=this.stores;t.setState({churnType:"personal",churnSurveyModalOpen:!0,onAccept:()=>e(!0),onClose:()=>e(!1)})});if(!e)return;e&&await v.a({environment:this.environment,spaceStore:this.props.spaceStore,planType:"personal"})}else if(e&&("unsubscribed_admin"===e.type||"unsubscribed_member"===e.type)){await new Promise((e,t)=>{d.showDialog({showCancel:!0,keepFocus:!1,message:r.a.createElement("div",null,r.a.createElement("h4",{style:{margin:"8px 0 0"}},r.a.createElement(g.FormattedMessage,{id:"subscriptSettings.freePersonal.downgradeTitle",defaultMessage:"Downgrade to the Personal Plan?"})),r.a.createElement("p",{style:{margin:"8px 0"}},r.a.createElement(g.FormattedMessage,{id:"subscriptionSettings.freePersonal.downgradeMessage",defaultMessage:"The Personal Plan is free for 1-person use. You'll lose the ability to add members, and guests will be limited to 5 per workspace."}))),items:[{label:r.a.createElement(g.FormattedMessage,{id:"subscriptionSettings.freePersonal.downgradeConfirmationButton",defaultMessage:"Downgrade to Personal Plan"}),color:"red",onAccept:()=>{e(!0)}}],handleCancel:()=>{e(!1)}})})&&await v.a({environment:this.environment,spaceStore:this.props.spaceStore,planType:"personal"})}},this.handlePersonalClick=async()=>{const{spaceStore:e,data:t}=this.props,a=fe.p(t);if(a&&fe.J(t)){const t=Dt.d.personal[a.interval];await v.h({environment:this.environment,spaceStore:e,plan:t,billing:a.billing})}else v.d(this.environment,{subscriptionTier:"personal",from:"pricing_grid"})},this.handleEducationPlanClick=()=>{const{spaceStore:e}=this.props;v.i({environment:this.environment,spaceStore:e})},this.handleTeamClick=async()=>{const{spaceStore:e,data:t}=this.props,a=fe.p(t),n=a&&void 0===a.canceledAt;let i;if(a&&n&&"enterprise"!==fe.i(this.environment)&&(i=this.props.intl.formatMessage({id:"spaceSubscriptionPlans.teamPlan.confirmMessage",defaultMessage:"You are about to subscribe to Notion's Team Plan for {price} per member per {monthlyBilling, select, true {month} other {year}}.{br}You will be charged a prorated amount, minus any account balance."},{price:fe.j({subscriptionTier:"team",billingInterval:a.interval,intl:this.props.intl}),monthlyBilling:"month"===a.interval,br:r.a.createElement("br",null)})),i){const e="unsubscribed_admin"===t.type||"unsubscribed_member"===t.type||a&&a.canceledAt||"enterprise"!==fe.i(this.environment);if(!(await d.confirmUserAction({message:i,acceptLabel:this.props.intl.formatMessage({id:"spaceSubscriptionPlans.teamPlan.confirmButtonLabel",defaultMessage:"{upgrading, select, true {Upgrade to Team Plan} other {Downgrade to Team Plan}}"},{upgrading:e})})))return}if(a&&fe.J(t)){const t=Dt.d.team[a.interval];await v.h({environment:this.environment,spaceStore:e,plan:t,billing:a.billing})}else v.d(this.environment,{subscriptionTier:"team",from:"pricing_grid"})},this.handleTeamFreeClick=async()=>{const{data:e}=this.props;if(e&&"subscribed_admin"===e.type){const e=await new Promise(e=>{const{store:t}=this.stores;t.setState({churnType:"team",churnSurveyModalOpen:!0,onAccept:()=>e(!0),onClose:()=>e(!1)})});if(m.I(this.environment,{confirmed:e}),!e)return;e&&await v.a({environment:this.environment,spaceStore:this.props.spaceStore,planType:"team"})}else if(e&&("unsubscribed_admin"===e.type||"unsubscribed_member"===e.type)){const e=await new Promise((e,t)=>{d.showDialog({showCancel:!0,keepFocus:!1,message:r.a.createElement("div",null,r.a.createElement("h4",{style:{margin:"8px 0 0"}},r.a.createElement(g.FormattedMessage,{id:"subscriptionSettings.freeTeam.upgradeTitle",defaultMessage:"Try the Team Plan for free"})),r.a.createElement("p",{style:{margin:"8px 0"}},r.a.createElement(g.FormattedMessage,{id:"subscriptionSettings.freeTeam.upgradeMessage",defaultMessage:"You'll get access to most features of a paid Team Plan, with a 1,000 block storage limit. Upgrade to go unlimited anytime."}))),items:[{label:r.a.createElement(g.FormattedMessage,{id:"subscriptionSettings.startTeamTrialDialog.confirmationbutton",defaultMessage:"Start Team trial"}),color:"blue",onAccept:()=>{e(!0)}}],handleCancel:()=>{e(!1)}})});if(m.J(this.environment,{confirmed:Boolean(e)}),!e)return;e&&await v.a({environment:this.environment,spaceStore:this.props.spaceStore,planType:"team"})}},this.handleEnterpriseClick=async()=>{const{spaceStore:e,data:t}=this.props,a=fe.p(t),n=a&&void 0===a.canceledAt;if(a&&n){const e=r.a.createElement(g.FormattedMessage,{id:"subscriptionSettings.upgradeToEnterpriseDialog.message",defaultMessage:"You are about to subscribe to Notion's Enterprise Plan for {price} per member per {monthlyBilling, select, true {month} other {year}}.{br}You will be charged a prorated amount, minus any account balance.",values:{price:fe.j({subscriptionTier:"enterprise",billingInterval:a.interval,intl:this.props.intl}),monthlyBilling:"month"===a.interval,br:r.a.createElement("br",null)}});if(!(await d.confirmUserAction({message:e,acceptLabel:r.a.createElement(g.FormattedMessage,{id:"subscriptionSettings.upgradeToEnterpriseDialog.confirmationbutton",defaultMessage:"Upgrade to Enterprise Plan"})})))return}if(a&&fe.J(t)){const t=Dt.d.enterprise[a.interval];await v.h({environment:this.environment,spaceStore:e,plan:t,billing:a.billing})}else v.d(this.environment,{subscriptionTier:"enterprise",from:"pricing_grid"})},this.handleChurnSurveyModalAccept=()=>{const{store:e}=this.stores;e.state.churnSurveyModalOpen&&e.state.onAccept(),e.reset()},this.handleChurnSurveyModalClose=()=>{const{store:e}=this.stores;e.state.churnSurveyModalOpen&&e.state.onClose(),e.reset()}}willMount(){v.e(this.environment)}renderComponent(){return J.a.state.online?this.renderPlans():r.a.createElement(_a.a,null)}renderPlans(){const{churnSurveyModalOpen:e}=this.stores.store.state;return r.a.createElement("div",{style:Va.wrapStyle},r.a.createElement(It.b,{style:Va.scrollerStyle,type:It.a.Y},this.renderSubscriptionInfo(),this.renderPricingGrid(),this.renderPriceDisclaimer(),this.allowEducationUpgrade()&&this.renderStudentUpgrade(),this.renderFAQ(),r.a.createElement(L.a,{innerStyle:{width:600,height:"80vh",overflow:"scroll"},open:e,render:this.renderChurnSurveyModal,onDismiss:this.handleChurnSurveyModalClose})))}renderPriceDisclaimer(){const{intl:e}=this.props;return r.a.createElement("div",{style:Va.priceDisclaimerStyle},r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionPlans.priceDisclaimer",defaultMessage:"Prices shown are for annual billing. When billed month-to-month, the <b>Personal Pro Plan</b> is {personalMonthlyPrice} per month, the <b>Team Plan</b> is {teamMonthlyPrice} per member per month, and the <b>Enterprise Plan</b> is {enterpriseMonthlyPrice} per member per month.",values:{b:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return r.a.createElement("b",null,t)},personalMonthlyPrice:Object(xt.b)({amount:W.default.pricing.personal.monthlyPrice,currency:"dollar",intl:e}),teamMonthlyPrice:Object(xt.b)({amount:W.default.pricing.team.monthlyPricePerMember,currency:"dollar",intl:e}),enterpriseMonthlyPrice:Object(xt.b)({amount:W.default.pricing.enterprise.monthlyPricePerMember,currency:"dollar",intl:e})}}))}renderSubscriptionInfo(){const{spaceStore:e}=this.props,{data:t}=this.props;return"subscribed_admin"===t.type?r.a.createElement("div",{style:this.subscriptionInfoStyle()},fe.I(this.environment,e,t)):"unsubscribed_admin"===t.type||"unsubscribed_member"===t.type?r.a.createElement("div",{style:Na({},this.subscriptionInfoStyle(),{display:"flex",alignItems:"center",justifyContent:"space-between"})},r.a.createElement("div",null,fe.I(this.environment,e,t))):void 0}renderPricingGrid(){const e=this.getPlanState();return r.a.createElement(ka,{isSettings:!0,planState:e,data:this.props.data})}renderStudentUpgrade(){return r.a.createElement("div",{style:Va.subsectionStyle},r.a.createElement("div",{style:Va.subsectionTitleStyle},r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionPlans.studentsAndEducatorsSection.title",defaultMessage:"Students & educators"})),r.a.createElement("div",{style:{color:this.theme.mediumTextColor,marginBottom:15}},r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionPlans.studentsAndEducatorsSection.text",defaultMessage:"<p>Personal Pro Plans are free for students and educators! Simply sign up with your school email address and you'll immediately gain access to those features.</p><p>If you're already on a Personal Pro Plan, change the email associated with your account to your school email address to get it for free.</p>",values:{p:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return r.a.createElement("div",{style:{marginBottom:4}},t)}}})),r.a.createElement(ee.a,{isLarge:!0,onClick:this.handleEducationPlanClick},r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionPlans.studentsAndEducatorsSection.getEducationPlanButton.label",defaultMessage:"Get free Education plan"})))}renderFAQ(){return r.a.createElement("div",{style:Va.subsectionStyle},r.a.createElement("div",{style:Va.subsectionTitleStyle},r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionPlans.faqSection.title",defaultMessage:"FAQ"})),r.a.createElement(Qt,{cta:"intercom",type:"general",isSettings:!0}))}getMemberCount(){return fe.v(this.props.data)}canSwitchPlans(){const e=fe.z(this.props.data);return this.props.spaceStore.canAdmin()&&!e}calculateButtonState(e){const{data:t}=this.props,a=fe.D(t);if("personal_free"===e)return{free:"current",personal:"upgrade",team:"upgrade",enterprise:"upgrade"};if("personal"===e||"student"===e)return{free:a?"current":"downgrade",personal:a?"resubscribe":"current",team:"upgrade",enterprise:"upgrade"};if("team_free"===e||"free"===e)return{free:"downgrade",personal:"upgrade",team:"upgrade",enterprise:"upgrade"};if("team"===e)return{free:"downgrade",personal:"downgrade",team:a?"resubscribe":"current",enterprise:"upgrade"};if("enterprise"===e)return{free:"downgrade",personal:"downgrade",team:"downgrade",enterprise:a?"resubscribe":"current"};throw Object(ya.e)(e)}isButtonStateActive(e){return["current","resubscribe"].includes(e)}getPlanState(){const e=fe.i(this.environment);if(!e)return;const t="team_free"===e||"free"===e,a=fe.z(this.props.data),n=this.calculateButtonState(e);return{plans:{free:{buttonType:n.free,isActive:this.isButtonStateActive(n.free),onClick:this.handleFreeClick},personal:{buttonType:n.personal,isActive:this.isButtonStateActive(n.personal),onClick:this.handlePersonalClick},team:{buttonType:n.team,isActive:this.isButtonStateActive(n.team)||t,onClick:this.handleTeamClick,onClickTeamFree:this.handleTeamFreeClick},enterprise:{buttonType:n.enterprise,isActive:this.isButtonStateActive(n.enterprise),onClick:this.handleEnterpriseClick}},isTeamTrial:t,isInAppPurchase:a,canSwitchPlans:this.canSwitchPlans(),memberCount:this.getMemberCount()}}allowEducationUpgrade(){const{data:e}=this.props,t=this.getPlanState();return t&&t.canSwitchPlans&&!fe.y(e)&&1===t.memberCount&&(t.plans.free.isActive||t.plans.personal.isActive)}subscriptionInfoStyle(){return{textAlign:"left",marginBottom:24,fontSize:14,borderBottom:"1px solid ".concat(this.theme.regularDividerColor),paddingBottom:16}}}Va.wrapStyle={display:"flex",flexDirection:"column",height:"100%"},Va.scrollerStyle={transform:"translateZ(0px)",flexGrow:1,padding:30},Va.subscriptionInfoCtaButtonStyle={marginLeft:16,paddingLeft:10},Va.priceDisclaimerStyle={fontSize:14,marginTop:20,marginBottom:40},Va.subsectionStyle={fontSize:14,marginTop:40},Va.subsectionTitleStyle={fontSize:20,fontWeight:Z.a.fontWeight.bold,marginBottom:12};var za=Object(g.injectIntl)(Va),Ha=a("Nvzn");class Ga extends E.a{getInitialState(){return{paymentMethodModalOpen:!1,billingIntervalModalOpen:!1,billingEmailModalOpen:!1,vatIdModalOpen:!1,addressModalOpen:!1,applyCreditModalOpen:!1,billingEventsLimit:20,applyCouponModalOpen:!1,addressErrorMessage:void 0}}}var Qa=Ga;class Ya extends E.a{getInitialState(){return{inputValue:void 0}}}var Za=Ya;class Xa extends A.a{constructor(){super(...arguments),this.storeTypes={store:Za},this.handleInputChange=e=>{const{store:t}=this.stores,a=e.target.value,n=this.inputValueToCents(a);let r;r=a?void 0!==n?a:this.getCurrentInputValue():"",t.setState({inputValue:r}),this.forceUpdate(),this.props.onChange(this.inputValueToCents(r)||0)}}renderComponent(){const{focus:e,selectAll:t,availableCredit:a}=this.props,n=this.getCurrentInputValue();return r.a.createElement(q.b,{value:n,onChange:this.handleInputChange,focus:e,selectAll:t,disabled:a<=0,style:{maxWidth:120},inputStyle:{textAlign:"right"}})}getCurrentInputValue(){const{availableCredit:e}=this.props,{inputValue:t}=this.stores.store.state;return void 0===t?"".concat(Math.floor(e/100)):t}inputValueToCents(e){const{availableCredit:t}=this.props,a=Math.floor(100*parseFloat(e));if(!isNaN(a)&&a<=t&&a>=0)return a}}var Ka=Xa;const Ja={workspaceBalance:r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.workspaceSubscriptionBalance.title",defaultMessage:"Workspace balance"}),applyCoupon:r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.applyCoupon.title",defaultMessage:"Apply coupon"})};var $a=a("Pl3d"),en=a("d9nj"),tn=a("IdSf");function an(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function nn(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class rn extends A.a{constructor(){super(...arguments),this.storeTypes={store:Qa,billingHistoryRequestStore:he.a},this.performGetBillingHistoryRequest=async e=>{const{spaceStore:t}=this.props,a=await l.getBillingHistory(this.environment,{spaceId:t.id,limit:e});if("failed"===a.type)throw a.error;return a.data},this.renderBillingHistoryResults=(e,t)=>{this.props.mockBillingHistoryResult&&(t=this.props.mockBillingHistoryResult);const{billingHistoryRequestStore:a}=this.stores;return r.a.createElement("div",null,t&&0===t.events.length&&r.a.createElement("div",{style:{color:this.theme.mediumTextColor,fontSize:14}},r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.invoicesSection.noInvoicesMessage",defaultMessage:"This workspace has no payments yet."})),t&&t.events.length>0&&r.a.createElement("table",null,r.a.createElement("tbody",null,t.events.map(this.renderBillingHistoryEvent))),t&&!t.reachedEndOfResults&&r.a.createElement(en.a,{onClick:this.handleLoadMoreBillingEventsClick,style:{marginLeft:-4,width:"100%"}},r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.invoicesSection.loadMoreInvoicesButton.label",defaultMessage:"Load more"})),a.state.loading&&r.a.createElement(V.a,null))},this.renderBillingHistoryEvent=(e,t)=>{let a;const{intl:n}=this.props;return a="paid"===e.status?e.total<0?r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.invoicesSection.invoiceStatus.credited",defaultMessage:"Credited"}):r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.invoicesSection.invoiceStatus.paid",defaultMessage:"Paid"}):e.attempted?r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.invoicesSection.invoiceStatus.failed",defaultMessage:"Failed"}):r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.invoicesSection.invoiceStatus.due",defaultMessage:"Due",description:"Label for the amount that the user owes on a given invoice"}),r.a.createElement("tr",{style:{height:28,fontSize:14,whiteSpace:"nowrap"},key:t},r.a.createElement("td",{style:{width:"100%",paddingRight:18,color:this.theme.mediumTextColor}},Object(ja.a)(e.timestamp).format("LL")),r.a.createElement("td",{style:{paddingRight:18}},a),r.a.createElement("td",{style:{paddingRight:18,textAlign:"right"}},Object(xt.b)({amount:e.total,currency:"dollar",intl:n})),r.a.createElement("td",null,r.a.createElement(tn.a,{inline:!0,href:"/invoice/".concat(e.id),external:!0,innerStyle:this.getViewInvoiceButtonStyle()},r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.invoicesSection.viewInvoiceButton",defaultMessage:"View invoice"}))))},this.handleLoadMoreBillingEventsClick=()=>{this.stores.store.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?an(Object(a),!0).forEach((function(t){nn(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):an(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},this.stores.store.state,{billingEventsLimit:this.stores.store.state.billingEventsLimit+rn.billingEventsLimitIncrement}))}}renderComponent(){const{store:e,billingHistoryRequestStore:t}=this.stores,a={request:e.state.billingEventsLimit,performRequest:this.performGetBillingHistoryRequest,render:this.renderBillingHistoryResults};return r.a.createElement("div",null,r.a.createElement(H.a,{large:!0,divider:"full",style:{marginTop:36}},r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.invoicesSection.title",defaultMessage:"Invoices"})),r.a.createElement($a.a,Object.assign({},a,{requestStore:t})))}static getModalStyle(e){return{width:480,background:e.popoverBackground,padding:24,borderRadius:3}}getViewInvoiceButtonStyle(){return{color:this.theme.mediumTextColor,padding:"2px 3px",borderRadius:3}}}rn.billingEventsLimitIncrement=20,rn.modalTitleStyle={fontSize:18,marginBottom:16,fontWeight:Z.a.fontWeight.medium};var sn=Object(g.injectIntl)(rn);const on=Object(g.defineMessages)({apply_credit:{id:"spaceSubscriptionBilling.applyCreditButton.label",defaultMessage:"Apply credit",description:"Button a user clicks to apply Notion credits towards their Notion bill."},update:{id:"spaceSubscriptionBilling.updateButton.label",defaultMessage:"Update"},add:{id:"spaceSubscriptionBilling.addButton.label",defaultMessage:"Add"},apply:{id:"spaceSubscriptionBilling.apply.label",defaultMessage:"Apply"}});class ln extends A.a{renderComponent(){const{title:e,caption:t,buttonArgs:a}=this.props,n=r.a.createElement(g.FormattedMessage,Object.assign({},on[a.buttonPurpose]));return r.a.createElement("div",{style:{display:"flex",alignItems:"center",fontSize:14}},r.a.createElement("div",{style:{marginRight:"auto"}},e),r.a.createElement("div",{style:{color:this.theme.mediumTextColor}},t),r.a.createElement("div",{style:{minWidth:110,display:"flex",justifyContent:"flex-end"}},a.showButton&&r.a.createElement(en.a,{isBlue:!0,onClick:a.onClick,style:ln.buttonStyle},n)))}}ln.buttonStyle={marginLeft:18,marginRight:-4,fontWeight:Z.a.fontWeight.medium};var cn=Object(g.injectIntl)(ln),dn=a("gHFd"),un=a("MZdi"),pn=a("nQ/L"),mn=a("8FJR"),hn=a("AId3");function gn(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function fn(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?gn(Object(a),!0).forEach((function(t){bn(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):gn(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function bn(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const yn={offline:r.a.createElement(g.FormattedMessage,{defaultMessage:"Please go online to manage billing.",id:"spaceSubscriptionBilling.offline.message"})};class Sn extends A.a{constructor(){super(...arguments),this.couponEntryInput=null,this.storeTypes={store:Qa,billingHistoryRequestStore:he.a},this.renderPaymentMethodModal=()=>{const{customerData:e,spaceStore:t}=this.props;if(Object(pn.isStripeElementsEnabled)(this.environment))return r.a.createElement(dn.LazySpaceSubscriptionUpdatePaymentMethodModal,{customerData:e,spaceStore:t,onComplete:this.handleModalClose});const{temporaryBillingType:a}=this.stores.store.state,n=a||e.billing,i=Boolean(e.brand&&e.last4);return r.a.createElement(vn,{theme:this.theme,title:r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.changePaymentMethod.title",defaultMessage:"Change payment method"}),acceptAction:"update",onAccept:this.handlePaymentMethodAccept,onClose:this.handleModalClose},r.a.createElement("div",{style:{marginTop:12,marginBottom:16}},i?fe.H({currentBillingType:n,hasExistingCreditCard:i,handleUseCardClick:this.handleUseCardClick,handleCardUpdateClick:this.handleCardUpdateClick,handleSendInvoiceClick:this.handleSendInvoiceClick}):fe.H({currentBillingType:n,hasExistingCreditCard:i,handleUseCardClick:this.handleUseCardClick,handleSendInvoiceClick:this.handleSendInvoiceClick})))},this.renderBillingIntervalModal=()=>{const{temporaryBillingInterval:e}=this.stores.store.state,{customerData:t}=this.props,a=e||t.interval,{monthlyPlanAmount:n,yearlyPlanAmount:i}=t,s=1-i/(12*n);return r.a.createElement(vn,{theme:this.theme,title:r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.changeBillingInterval.title",defaultMessage:"Change billing interval"}),helpButton:r.a.createElement(ce.a,{title:r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.changeBillingInterval.helpButton.label",defaultMessage:"Learn about how this change will impact what you pay."}),href:Object(je.a)("guides.changeBillingInterval"),analyticsFrom:"billing_interval_settings"}),acceptAction:"update",onAccept:this.handleBillingIntervalAccept,onClose:this.handleModalClose},r.a.createElement("div",{style:{marginTop:12,marginBottom:16}},fe.G({environment:this.environment,productId:t.productId,yearlyPlanAmount:i,monthlyPlanAmount:n,yearlySavingsPercent:s,currentBillingInterval:a,handleMonthlyBillingClick:this.handleMonthlyBillingClick,handleYearlyBillingClick:this.handleYearlyBillingClick})))},this.renderApplyCreditModal=()=>{const{subscriptionData:e,customerData:t,intl:a}=this.props,{availableCredit:n}=e,i=this.getCurrentFormCreditAmount(),s=Math.max(0,(t.nextInvoiceAmount||0)-i);return r.a.createElement("div",{style:Sn.getModalStyle(this.theme)},r.a.createElement("div",{style:Sn.modalTitleStyle},r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.useCreditModal.title",defaultMessage:"Use Notion credit - {creditInDollars} available",values:{creditInDollars:Object(xt.b)({amount:n,currency:"dollar",intl:a})}})),r.a.createElement("div",{style:{fontSize:14,display:"flex",alignItems:"center",marginBottom:16}},r.a.createElement("div",{style:{width:"100%",marginRight:20,color:this.theme.mediumTextColor}},r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.useCreditModal.amountOfCreditQuestion",defaultMessage:"How much credit would you like to apply to your next invoice?"})),r.a.createElement(Ka,{availableCredit:n,focus:!0,selectAll:!0,onChange:this.handleApplyCreditAmountInputChange}),r.a.createElement("div",{style:{whiteSpace:"nowrap",marginLeft:8}},"/"," ",Object(xt.b)({amount:n,currency:"dollar",intl:a}))),r.a.createElement("div",{style:{borderTop:"1px solid ".concat(this.theme.regularDividerColor),paddingTop:16}},r.a.createElement("div",{style:{paddingBottom:18,fontSize:12,color:this.theme.mediumTextColor}},r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.useCreditModal.warning",defaultMessage:"Applying credit to your account <bold>cannot be undone</bold>.",values:{bold:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return r.a.createElement("b",null,t)}}})),r.a.createElement("div",{style:{display:"flex",alignItems:"center"}},r.a.createElement("div",{style:{fontSize:36,lineHeight:1}},Object(xt.b)({amount:s,currency:"dollar",intl:a})),r.a.createElement("div",{style:{marginLeft:8,fontSize:12,color:this.theme.mediumTextColor,alignSelf:"flex-end"}},r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.useCreditModal.nextInvoiceAmount",defaultMessage:"next invoice total",description:"Text that appears next to the amount, in dollars, that the user's next invoice will be after applying their Notion credits to their bill."})),r.a.createElement(te.a,{isLarge:!0,style:{marginLeft:"auto"},onClick:this.handleModalClose},r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.useCreditModal.cancelButton.label",defaultMessage:"Cancel"})),r.a.createElement(ee.a,{isLarge:!0,style:{marginLeft:12},disabled:i<=0,onClick:this.handleApplyCreditAccept},r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.useCreditModal.applyCreditButton.label",defaultMessage:"Apply credit"})))))},this.renderSingleTextFieldModal=(e,t,a,n,i)=>r.a.createElement(vn,{theme:this.theme,title:t,acceptAction:i,onAccept:n,onClose:this.handleModalClose},r.a.createElement(q.b,{focus:!0,selectAll:!0,value:e,onChange:a,onSubmit:n,style:Sn.modalInputStyle})),this.renderBillingEmailModal=()=>{const{customerData:e}=this.props,{temporaryBillingEmail:t}=this.stores.store.state,a=void 0!==t?t:e.billingEmail||"",n=e.billingEmail?"update":"add";return this.renderSingleTextFieldModal(a,r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.changeBillingEmailModal.title",defaultMessage:"Change billing email"}),this.handleBillingEmailChange,this.handleBillingEmailAccept,n)},this.renderVatIdModal=()=>{const{customerData:e}=this.props,{temporaryVatId:t}=this.stores.store.state,a=void 0!==t?t:e.vatId||"",n=e.vatId?"update":"add";return r.a.createElement(vn,{theme:this.theme,title:r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.changeVATIDModal.title",defaultMessage:"Change VAT/GST number"}),acceptAction:n,onAccept:this.handleVatIdAccept,onClose:this.handleModalClose},r.a.createElement(q.b,{focus:!0,selectAll:!0,value:a,onChange:this.handleVatIdChange,onSubmit:this.handleVatIdAccept,style:Sn.modalInputStyle}),r.a.createElement("div",{style:{color:this.theme.mediumTextColor,fontSize:Z.a.fontSize.UISmall.desktop,marginTop:-10}},r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.changeVATIDModal.subtitle",defaultMessage:"Please include your country code"})))},this.renderApplyCouponModal=()=>r.a.createElement(vn,{theme:this.theme,title:r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.applyCouponModal.title",defaultMessage:"Apply coupon"}),acceptAction:"apply",onAccept:()=>{this.couponEntryInput&&this.couponEntryInput.checkCouponCode()},onClose:this.handleModalClose},r.a.createElement(un.a,{ref:e=>this.couponEntryInput=e,hideApply:!0,handlePromo:async e=>{this.handleModalClose(),await v.h({environment:this.environment,spaceStore:this.props.spaceStore,coupon:e.id})&&Object(d.showMessage)({message:r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.applyCouponModal.successMessage",defaultMessage:"Coupon applied!"})})}})),this.updateTemporaryAddress=e=>{const{temporaryAddress:t}=this.stores.store.state;this.stores.store.setState(fn({},this.stores.store.state,{temporaryAddress:fn({},this.props.customerData.address,{},t,{},e)}))},this.renderAddressModal=()=>{const{customerData:e}=this.props,{temporaryAddress:t,addressErrorMessage:a}=this.stores.store.state,n=fe.i(this.environment);return r.a.createElement("div",{style:{display:"flex",flexDirection:"column",maxHeight:"75vh"}},r.a.createElement("div",{style:Sn.getModalStyle(this.theme)},r.a.createElement("div",{style:Sn.modalTitleStyle},r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.changeYourAddressModal.title",defaultMessage:"Change your address"})),r.a.createElement(mn.a,{address:t||{name:e.customerName||"",businessName:"",addressLine1:"",addressLine2:"",zipCode:"",city:"",state:"",country:""},updateAddress:this.updateTemporaryAddress,shouldShowBusinessName:Boolean(n&&["team","enterprise"].includes(n))}),r.a.createElement("div",{style:{color:$.f.red,marginTop:10}},a)),r.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end",padding:"16px 24px",background:this.theme.contentBackground}},r.a.createElement(te.a,{isLarge:!0,onClick:this.handleModalClose},r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.changeBillingAddressModal.cancelButton.label",defaultMessage:"Cancel"})),r.a.createElement(ee.a,{style:{marginLeft:12},isLarge:!0,disabled:void 0===this.getUpdatedAddress(),onClick:this.handleAddressAccept},r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.changeBillingAddressModal.updateButton.label",defaultMessage:"Update"}))))},this.handleChangePlanClick=()=>{B.a.setState({open:!0,currentTab:"plans"})},this.handlePaymentMethodChangeClick=()=>{this.stores.store.setState(fn({},this.stores.store.state,{paymentMethodModalOpen:!0}))},this.handleBillingIntervalChangeClick=()=>{this.stores.store.setState(fn({},this.stores.store.state,{billingIntervalModalOpen:!0}))},this.handleBillingEmailChangeClick=()=>{this.stores.store.setState(fn({},this.stores.store.state,{billingEmailModalOpen:!0}))},this.handleAddressChangeClick=()=>{this.stores.store.setState(fn({},this.stores.store.state,{addressModalOpen:!0}))},this.handleVatIdChangeClick=()=>{this.stores.store.setState(fn({},this.stores.store.state,{vatIdModalOpen:!0}))},this.handleApplyCouponClick=()=>{this.stores.store.setState(fn({},this.stores.store.state,{applyCouponModalOpen:!0}))},this.handleModalClose=()=>{this.stores.store.reset()},this.handleBillingEmailChange=e=>{this.stores.store.setState(fn({},this.stores.store.state,{temporaryBillingEmail:e.target.value}))},this.handleBillingEmailAccept=async()=>{const{spaceStore:e,customerData:t}=this.props,{temporaryBillingEmail:a}=this.stores.store.state;a!==t.billingEmail&&await v.h({environment:this.environment,spaceStore:e,billingEmail:a}),this.handleModalClose()},this.handleVatIdChange=e=>{this.stores.store.setState(fn({},this.stores.store.state,{temporaryVatId:e.target.value}))},this.handleVatIdAccept=async()=>{const{spaceStore:e,customerData:t}=this.props,{temporaryVatId:a}=this.stores.store.state;a!==t.vatId&&await v.h({environment:this.environment,spaceStore:e,vatId:a}),this.handleModalClose()},this.handleAddressAccept=async()=>{const{spaceStore:e}=this.props,t=this.getUpdatedAddress();if(!t)return void this.stores.store.setState(fn({},this.stores.store.state,{addressErrorMessage:this.props.intl.formatMessage({id:"spaceSubscriptionBilling.address.invalidError",defaultMessage:"Your address is invalid. Please update your address so we can process your payment."})}));const a=await Object(hn.a)(this.environment,t);if(!a.valid)return void this.stores.store.setState(fn({},this.stores.store.state,{addressErrorMessage:this.props.intl.formatMessage({id:"spaceSubscriptionBilling.address.invalidError",defaultMessage:"Your address is invalid. Please update your address so we can process your payment."})}));const n=fn({},t,{},a.validatedAddresses?a.validatedAddresses[0]:void 0);if(t)try{await v.f({environment:this.environment,spaceStore:e,address:n}),this.handleModalClose()}catch(r){}},this.getUpdatedAddress=()=>{const{customerData:e}=this.props,{temporaryAddress:t}=this.stores.store.state;if(t&&t!==e.address)return t},this.handleMonthlyBillingClick=()=>{this.stores.store.setState(fn({},this.stores.store.state,{temporaryBillingInterval:"month"}))},this.handleYearlyBillingClick=()=>{this.stores.store.setState(fn({},this.stores.store.state,{temporaryBillingInterval:"year"}))},this.handleBillingIntervalAccept=async()=>{const{spaceStore:e,customerData:t}=this.props,{temporaryBillingInterval:a}=this.stores.store.state;if(a&&a!==t.interval){const t=this.getPlanForOppositeBillingInterval();t&&await v.h({environment:this.environment,spaceStore:e,plan:t})}this.handleModalClose()},this.handleUseCardClick=()=>{this.stores.store.setState(fn({},this.stores.store.state,{temporaryBillingType:"charge_automatically"}))},this.handleSendInvoiceClick=()=>{this.stores.store.setState(fn({},this.stores.store.state,{temporaryBillingType:"send_invoice"}))},this.handleCardUpdateClick=async()=>{const{spaceStore:e}=this.props,{customerData:t}=this.props;if(t.billingEmail){const a=await v.c({name:"Update your Card",panelLabel:"Update",email:t.billingEmail});await v.h({environment:this.environment,spaceStore:e,billing:"charge_automatically",stripeToken:a})}this.handleModalClose()},this.handlePaymentMethodAccept=async()=>{const{spaceStore:e}=this.props,{customerData:t}=this.props,{temporaryBillingType:a}=this.stores.store.state,n=a||t.billing;if("charge_automatically"!==n||t.brand)n!==t.billing&&await v.h({environment:this.environment,spaceStore:e,billing:a});else{const{currentUserStore:a}=p.default.state,n=a?a.getValue():void 0,r=t.billingEmail||(n?n.email:void 0);if(!r)throw new Error("No billing email found.");const i=await v.c({name:"Update your Card",panelLabel:"Update",email:r});await v.h({environment:this.environment,spaceStore:e,billing:"charge_automatically",stripeToken:i,billingEmail:r})}this.handleModalClose()},this.handleApplyCreditClick=()=>{this.stores.store.setState(fn({},this.stores.store.state,{applyCreditModalOpen:!0}))},this.handleApplyCreditAccept=async()=>{const e=this.getCurrentFormCreditAmount(),{spaceStore:t}=this.props;e>0&&await v.h({environment:this.environment,spaceStore:t,creditAmount:e}),this.handleModalClose(),m.se(this.environment,{amount:e})},this.handleApplyCreditAmountInputChange=e=>{this.stores.store.setState(fn({},this.stores.store.state,{temporaryApplyCreditCents:e}))},this.handleRestartSubscriptionClick=async()=>{const{spaceStore:e}=this.props,{customerData:t}=this.props;await v.h({environment:this.environment,spaceStore:e,plan:t.plan}),this.handleModalClose()}}willMount(){v.e(this.environment)}renderComponent(){return J.a.state.online?this.renderBilling():Sn.renderOfflineMessage()}static renderOfflineMessage(){return r.a.createElement(z.a,null,r.a.createElement(ue.a,{isSmall:!0,style:{textAlign:"center"}},yn.offline))}renderBilling(){const{customerData:e,subscriptionData:t}=this.props,{paymentMethodModalOpen:a,billingIntervalModalOpen:n,billingEmailModalOpen:i,addressModalOpen:s,applyCreditModalOpen:o,vatIdModalOpen:l,applyCouponModalOpen:c}=this.stores.store.state;return r.a.createElement("div",{style:Sn.wrapStyle},r.a.createElement(It.b,{style:Sn.scrollerStyle,type:It.a.Y},this.renderHeader(e),this.renderSummary(t),this.renderPaymentMethod(e),this.renderSeparator(),this.renderBillingInterval(e),this.renderSeparator(),this.renderBillingEmail(e),this.renderSeparator(),this.renderAddress(e),this.renderSeparator(),this.renderVatId(e),this.renderSeparator(),this.renderCredit(e),this.renderSeparator(),this.renderCoupon(),this.renderSeparator(),r.a.createElement(sn,Object.assign({},this.props,{data:t})),r.a.createElement(L.a,{open:a,render:this.renderPaymentMethodModal,onDismiss:this.handleModalClose}),r.a.createElement(L.a,{open:n,render:this.renderBillingIntervalModal,onDismiss:this.handleModalClose}),r.a.createElement(L.a,{open:o,render:this.renderApplyCreditModal,onDismiss:this.handleModalClose}),r.a.createElement(L.a,{open:i,render:this.renderBillingEmailModal,onDismiss:this.handleModalClose}),r.a.createElement(L.a,{open:s,render:this.renderAddressModal,onDismiss:this.handleModalClose}),r.a.createElement(L.a,{open:l,render:this.renderVatIdModal,onDismiss:this.handleModalClose}),r.a.createElement(L.a,{open:c,render:this.renderApplyCouponModal,onDismiss:this.handleModalClose})))}renderHeader(e){let t=r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.legacyPlanTitle",defaultMessage:"Legacy Plan"});switch(e.productId){case W.default.pricing.personal.productId:t=r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.personalPlanTitle",defaultMessage:"Personal Pro Plan"});break;case W.default.pricing.student.productId:t=r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.personalEducationPlanTitle",defaultMessage:"Personal Pro (Education) Plan"});break;case W.default.pricing.team.productId:t=r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.teamPlanTitle",defaultMessage:"Team Plan"});break;case W.default.pricing.enterprise.productId:t=r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.enterprisePlanTitle",defaultMessage:"Enterprise Plan"})}return r.a.createElement(H.a,{large:!0,divider:"full"},t)}renderSummary(e){const{spaceStore:t}=this.props,a=fe.I(this.environment,t,e),n=fe.D(e),i="subscribed_admin"===e.type;return r.a.createElement("div",{style:Sn.summaryStyle},r.a.createElement("div",{style:Sn.summaryMessageStyle},a),n&&r.a.createElement(ee.a,{isLarge:!0,onClick:this.handleRestartSubscriptionClick,style:{marginRight:8}},r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.restartSubscriptionButton.label",defaultMessage:"Restart subscription"})),i&&r.a.createElement(te.a,{isLarge:!0,onClick:this.handleChangePlanClick},r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.changePlanButton.label",defaultMessage:"Change plan"})))}renderSeparator(){return r.a.createElement("div",{style:{flex:"none",height:1,marginTop:10,marginBottom:10,background:this.theme.regularDividerColor}})}renderPaymentMethod(e){return r.a.createElement(cn,{title:r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.paymentMethod.title",defaultMessage:"Payment method"}),caption:r.a.createElement(n.Fragment,null,"send_invoice"===e.billing&&r.a.createElement("div",null,r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.paymentMethod.value.achOrWireTransfer",defaultMessage:"ACH or Wire Transfer"})),"charge_automatically"===e.billing&&(e.last4&&e.brand?r.a.createElement("div",null,r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.paymentMethod.value.creditCard",defaultMessage:"{creditCardBrand} ending in {lastFourDigits}",values:{creditCardBrand:Object(Ha.a)(e.brand),lastFourDigits:e.last4}})):r.a.createElement("div",null,r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.paymentMethod.value.none",defaultMessage:"None",description:"The payment method setting we display for users who haven't set up a payment method yet"})))),buttonArgs:{showButton:!0,buttonPurpose:"update",onClick:this.handlePaymentMethodChangeClick}})}renderBillingInterval(e){return r.a.createElement(cn,{title:r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.billingInterval.title",defaultMessage:"Billing interval"}),caption:r.a.createElement("div",null,"month"===e.interval?r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.billingInterval.value.monthly",defaultMessage:"Monthly"}):r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.billingInterval.value.yearly",defaultMessage:"Yearly"})),buttonArgs:{showButton:Boolean(this.getPlanForOppositeBillingInterval()),buttonPurpose:"update",onClick:this.handleBillingIntervalChangeClick}})}renderBillingEmail(e){return r.a.createElement(cn,{title:r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.billingEmail.title",defaultMessage:"Billing email"}),caption:r.a.createElement("div",null,e.billingEmail||""),buttonArgs:{showButton:!0,buttonPurpose:Boolean(e.billingEmail)?"update":"add",onClick:this.handleBillingEmailChangeClick}})}renderVatId(e){return r.a.createElement(cn,{title:r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.VATID.title",defaultMessage:"VAT/GST number",description:"Title for the section where users can update their VAT (value added tax) identification number"}),caption:r.a.createElement("div",null,e.vatId||""),buttonArgs:{showButton:!0,buttonPurpose:Boolean(e.vatId)?"update":"add",onClick:this.handleVatIdChangeClick}})}renderAddress(e){return r.a.createElement(cn,{title:r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.yourAddress.title",defaultMessage:"Your address"}),caption:r.a.createElement("div",{style:{textAlign:"right",width:"80%",float:"right"}},this.renderAddressString(e.address)||""),buttonArgs:{showButton:!0,buttonPurpose:e.address&&!s.a.isEmpty(e.address)?"update":"add",onClick:this.handleAddressChangeClick}})}renderCredit(e){const t=-Math.min(0,e.accountBalance),{intl:a}=this.props;return r.a.createElement(cn,{title:Ja.workspaceBalance,caption:r.a.createElement("div",null,Object(xt.b)({amount:t,currency:"dollar",intl:a})),buttonArgs:{showButton:!0,buttonPurpose:"apply_credit",onClick:this.handleApplyCreditClick}})}renderCoupon(){return r.a.createElement(cn,{title:Ja.applyCoupon,caption:void 0,buttonArgs:{showButton:!0,buttonPurpose:"apply",onClick:this.handleApplyCouponClick}})}renderAddressString(e){return e?this.props.intl.formatList([e.name,e.businessName,e.addressLine1,e.country].filter(Boolean),{type:"conjunction",style:"narrow"}):""}getCurrentFormCreditAmount(){const{subscriptionData:e}=this.props,{store:t}=this.stores,{temporaryApplyCreditCents:a}=t.state;return void 0!==a?a:e.availableCredit}getPlanForOppositeBillingInterval(){const{customerData:e}=this.props,t=Dt.c.find(t=>t.indexOf(e.plan)>=0);if(t){const a=t.indexOf(e.plan);return t[0===a?1:0]}}static getModalStyle(e){return{width:480,background:e.popoverBackground,padding:24,borderRadius:3}}}function vn(e){const t=r.a.createElement(g.FormattedMessage,Object.assign({},on[e.acceptAction]));return r.a.createElement("div",{style:Sn.getModalStyle(e.theme)},r.a.createElement("div",{style:Sn.modalTitleStyle},e.title),e.children,r.a.createElement("div",{style:{marginBottom:20}},e.helpButton),r.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},r.a.createElement(te.a,{isLarge:!0,onClick:e.onClose,style:{marginRight:12}},r.a.createElement(g.FormattedMessage,{id:"spaceSubscriptionBilling.cancelButton.label",defaultMessage:"Cancel"})),r.a.createElement(ee.a,{isLarge:!0,onClick:e.onAccept},t)))}Sn.modalTitleStyle={fontSize:18,marginBottom:16,fontWeight:Z.a.fontWeight.medium},Sn.wrapStyle={display:"flex",flexDirection:"column",height:"100%"},Sn.scrollerStyle={height:"100%",padding:"36px 60px"},Sn.summaryStyle={display:"flex",alignItems:"flex-start",fontSize:14,marginBottom:36},Sn.summaryMessageStyle={marginRight:"auto",paddingRight:32},Sn.modalInputStyle={marginTop:12,marginBottom:20};var En=Object(g.injectIntl)(Sn);class Mn extends A.a{constructor(){super(...arguments),this.storeTypes={store:Qa,billingHistoryRequestStore:he.a}}willMount(){v.e(this.environment)}renderComponent(){const{data:e}=this.props;return J.a.state.online?r.a.createElement("div",{style:Mn.wrapStyle},r.a.createElement(It.b,{style:Mn.scrollerStyle,type:It.a.Y},r.a.createElement(H.a,{large:!0,divider:"full"},r.a.createElement(g.FormattedMessage,Object.assign({},B.d.billingTab))),this.renderCredit(e),this.renderSeparator(),r.a.createElement(sn,Object.assign({},this.props)))):Mn.renderOfflineMessage()}static renderOfflineMessage(){return r.a.createElement(z.a,null,r.a.createElement(ue.a,{isSmall:!0,style:{textAlign:"center"}},yn.offline))}renderCredit(e){const t=-Math.min(0,e.accountBalance),{intl:a}=this.props;return r.a.createElement(cn,{title:Ja.workspaceBalance,caption:r.a.createElement("div",null,Object(xt.b)({amount:t,currency:"dollar",intl:a})),buttonArgs:{showButton:!1,buttonPurpose:"apply_credit",onClick:s.a.noop}})}renderSeparator(){return r.a.createElement("div",{style:{flex:"none",marginTop:30}})}}Mn.wrapStyle={display:"flex",flexDirection:"column",height:"100%"},Mn.scrollerStyle={height:"100%",padding:"36px 60px"};var Cn=Object(g.injectIntl)(Mn);class wn extends E.a{getInitialState(){return{emailInputValue:"",showAllInviteCredits:!1}}}var On=wn,kn=a("RqMp"),Pn=a("58VE");function Tn(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Dn(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Tn(Object(a),!0).forEach((function(t){In(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Tn(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function In(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Fn extends A.a{constructor(){super(...arguments),this.handleImportActionClick=()=>{kn.a.setState({open:!0}),m.ob(this.environment,{type:"import_evernote"})},this.handleWebActionClick=()=>{$t.navigateToExternalURL({environment:this.environment,url:"/product"}),m.ob(this.environment,{type:"web_login"})},this.handleDesktopActionClick=()=>{$t.navigateToExternalURL({environment:this.environment,url:"/desktop"}),m.ob(this.environment,{type:"desktop_login"})},this.handleMobileActionClick=()=>{$t.navigateToExternalURL({environment:this.environment,url:"/mobile"}),m.ob(this.environment,{type:"mobile_login"})},this.handleBrowserExtensionActionClick=()=>{$t.navigateToExternalURL({environment:this.environment,url:"/web-clipper"}),m.ob(this.environment,{type:"browser_extension"})},this.handleMobileShareSheetActionClick=()=>{$t.navigateToExternalURL({environment:this.environment,url:"/mobile"}),m.ob(this.environment,{type:"mobile_share_sheet"})}}renderComponent(){return r.a.createElement("div",{style:this.getWrapperStyle()},r.a.createElement("div",{style:{flex:0}},this.renderLeft()),r.a.createElement("div",{style:this.getCenterStyle()},r.a.createElement("div",null,this.renderTitle()),r.a.createElement(ue.a,{isSmall:!0,style:{marginBottom:2}},this.renderCaption())),r.a.createElement("div",{style:{flex:0}},this.renderRight()))}renderTitle(){const{credit:e,intl:t}=this.props;if("invited_user"===e.type){const t=this.getUserStore(e.to_user_id).getValue();return r.a.createElement(n.Fragment,null,Object(bt.e)(t)," ",!e.activated&&t&&!t.onboarding_completed&&r.a.createElement("span",{style:{color:this.theme.mediumTextColor}},r.a.createElement(g.FormattedMessage,{id:"userCreditSettings.inviteFriendsSection.userHasNotSignedUpNote",defaultMessage:"(has not signed up)",description:"Annotation that appears next to a referred user's name if the user hasn't signed up for Notion yet"})),!e.activated&&t&&t.onboarding_completed&&r.a.createElement("span",{style:{color:this.theme.mediumTextColor}},r.a.createElement(g.FormattedMessage,{id:"userCreditSettings.inviteFriendsSection.userHasAlreadySignedUpNote",defaultMessage:"(has already signed up)",description:"Annotation that appears next to a referred user's name if the user has signed up for Notion already"})))}if("invited_by_user"===e.type){const t=this.getUserStore(e.from_user_id).getValue();return r.a.createElement(n.Fragment,null,Object(bt.e)(t),r.a.createElement("span",{style:{color:this.theme.mediumTextColor}},r.a.createElement(g.FormattedMessage,{id:"userCreditSettings.inviteFriendsSection.sourceOfReferralNote",defaultMessage:"(invited you)",description:"Annotation that appears next to the name of the user who invited this user to Notion"})))}return"import_evernote"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.evernoteImport.title",defaultMessage:"Import from Evernote"}):"web_login"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.webApp.title",defaultMessage:"Log in on the web"}):"desktop_login"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.desktopApp.title",defaultMessage:"Log in on the desktop app"}):"mobile_login"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.mobileApp.title",defaultMessage:"Log in on the mobile app"}):"browser_extension"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.webClipper.title",defaultMessage:"Use the Web Clipper"}):"mobile_share_sheet"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.mobileShare.title",defaultMessage:"Use the iOS or Android system share menu"}):void 0}renderCaption(){const{credit:e,intl:t}=this.props;if("invited_user"===e.type){const t=this.getUserStore(e.to_user_id).getValue();return t&&t.email}if("invited_by_user"===e.type){const t=this.getUserStore(e.from_user_id).getValue();return t&&t.email}return"import_evernote"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.evernoteImport.description",defaultMessage:"Import your notes and notebooks"}):"web_login"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.webApp.description",defaultMessage:"Sign in to Notion from any web browser"}):"desktop_login"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.desktopApp.description",defaultMessage:"Download the desktop app and sign in"}):"mobile_login"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.mobileApp.description",defaultMessage:"Download the mobile app and sign in"}):"browser_extension"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.webClipper.description",defaultMessage:"Download the Chrome extension and save a link"}):"mobile_share_sheet"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.mobileShare.description",defaultMessage:"Use the share menu to save a link into Notion"}):void 0}renderLeft(){const{credit:e}=this.props;if("invited_user"===e.type){const t=this.getUserStore(e.to_user_id);return r.a.createElement(Pn.a,{userValue:t.getValue(),style:{marginRight:8},size:24,hasTooltip:!0})}if("invited_by_user"===e.type){const t=this.getUserStore(e.from_user_id);return r.a.createElement(Pn.a,{userValue:t.getValue(),style:{marginRight:8},size:24,hasTooltip:!0})}return"import_evernote"===e.type?be.a.evernoteLogo(this.getIconStyle()):"web_login"===e.type?be.a.logInWeb(this.getIconStyle()):"desktop_login"===e.type?be.a.deviceDesktop(this.getIconStyle()):"mobile_login"===e.type?be.a.deviceMobile(this.getIconStyle()):"browser_extension"===e.type?be.a.googleChrome(this.getIconStyle()):"mobile_share_sheet"===e.type?be.a.deviceMobileShareSheet(this.getIconStyle()):void 0}renderRight(){const{credit:e,intl:t}=this.props;let a;return"import_evernote"===e.type?a={text:t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.evernoteImport.actionLink",defaultMessage:"Connect"}),onClick:this.handleImportActionClick}:"web_login"===e.type?a={text:t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.webApp.actionLink",defaultMessage:"Visit"}),onClick:this.handleWebActionClick}:"desktop_login"===e.type?a={text:t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.desktopApp.actionLink",defaultMessage:"Download"}),onClick:this.handleDesktopActionClick}:"mobile_login"===e.type?a={text:t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.mobileApp.actionLink",defaultMessage:"Download"}),onClick:this.handleMobileActionClick}:"browser_extension"===e.type?a={text:t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.webClipper.actionLink",defaultMessage:"Install"}),onClick:this.handleBrowserExtensionActionClick}:"mobile_share_sheet"===e.type&&(a={text:t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.mobileShare.actionLink",defaultMessage:"Download"}),onClick:this.handleMobileShareSheetActionClick}),r.a.createElement("div",{style:{display:"flex",alignItems:"center"}},a&&!e.activated&&r.a.createElement(en.a,{isBlue:!0,isSmall:!0,onClick:a.onClick},a.text),r.a.createElement("div",{style:Dn({minWidth:32,marginLeft:8,marginRight:8,textAlign:"right",fontWeight:Z.a.fontWeight.semibold},!e.activated&&{color:this.theme.lightTextColor})},Object(xt.b)({amount:e.amount,currency:"dollar",intl:this.props.intl})),r.a.createElement("div",{style:this.getTickStyles(e.activated)},be.a.check({fill:$.f.white,width:12,height:12,opacity:e.activated?1:0})))}getUserStore(e){const{currentSpaceStore:t}=p.default.state;if(!t)throw new Error("No current space.");return gt.a.createChildStore(t,{table:bt.a,id:e})}getWrapperStyle(){const e="1px solid ".concat(this.theme.regularDividerColor);return{display:"flex",alignItems:"center",borderTop:this.props.isFirst?e:void 0,borderBottom:e,paddingTop:8,paddingBottom:8}}getCenterStyle(){return{flex:1,fontSize:14,marginLeft:4}}getIconStyle(){return{width:24,height:24,fill:this.theme.mediumIconColor,marginRight:8}}getTickStyles(e){const t=e?void 0:"inset 0 0 0 2px ".concat(this.theme.regularDividerColor);return{display:"flex",alignItems:"center",justifyContent:"center",width:20,height:20,borderRadius:20,background:e?$.f.blue:void 0,boxShadow:t}}}var jn=Object(g.injectIntl)(Fn);function xn(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Bn(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class An extends A.a{constructor(){super(...arguments),this.storeTypes={store:On},this.renderCredit=(e,t)=>r.a.createElement(jn,{key:e.id,credit:e,isFirst:0===t}),this.handleInviteCreditsToggleShowMoreClick=()=>{const{store:e}=this.stores;e.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?xn(Object(a),!0).forEach((function(t){Bn(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):xn(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e.state,{showAllInviteCredits:!e.state.showAllInviteCredits}))},this.handleApplyCreditClick=()=>{const{data:e}=this.props;B.a.setState({open:!0,currentTab:"subscribed_admin"===e.type?"billing":"plans"}),m.n(this.environment)}}willMount(){v.e(this.environment)}renderComponent(){if(J.a.state.online){const{credits:e}=this.props.data;return this.renderSettings(e)}return this.renderOfflineMessage()}renderOfflineMessage(){return r.a.createElement(z.a,null,r.a.createElement(ue.a,{isSmall:!0,style:{textAlign:"center"}},r.a.createElement(g.FormattedMessage,{id:"userCreditSettings.offline.message",defaultMessage:"Please go online to manage your account credit."})))}renderOtherCreditWays(e){const t=this.getActionCredits(e);return t.length>0&&r.a.createElement(n.Fragment,null,r.a.createElement(H.a,{large:!0},r.a.createElement(g.FormattedMessage,{id:"userCreditSettings.otherWaysToEarnCreditSectionAlt.title",defaultMessage:"Ways to earn credit"})),r.a.createElement("div",null,t.map(this.renderCredit)))}renderReferralSection(e){const{store:t}=this.stores,{showAllInviteCredits:a}=t.state,n=this.getInviteCredits(e),i=a?n:n.slice(0,An.showInviteCreditCount);return n.length>0&&r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:this.getHeaderContainerStyles()},r.a.createElement("div",{style:this.getHeaderStyles()},r.a.createElement(g.FormattedMessage,{id:"userCreditSettings.inviteFriendsSection.title",defaultMessage:"Invite friends and earn credit"}))),r.a.createElement("div",{style:this.getInviteCreditStyles()},i.map(e=>this.renderCredit(e,1)),n.length>An.showInviteCreditCount&&r.a.createElement(ve.a,{style:{marginTop:8},onClick:this.handleInviteCreditsToggleShowMoreClick},a?r.a.createElement(g.FormattedMessage,{id:"userCreditSettings.inviteFriendsSection.showLessReferredUsers.link",defaultMessage:"Show {numberOfReferredUsers} less",values:{numberOfReferredUsers:n.length-An.showInviteCreditCount}}):r.a.createElement(g.FormattedMessage,{id:"userCreditSettings.inviteFriendsSection.showMoreReferredUsers.link",defaultMessage:"Show {numberOfReferredUsers} more",values:{numberOfReferredUsers:n.length-An.showInviteCreditCount}}))))}renderTotalCreditEarned(e){const{intl:t}=this.props,a=e.reduce((e,t)=>e+(t.activated?t.amount:0),0);return a>0&&r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-end"}},r.a.createElement(ce.a,{title:t.formatMessage({id:"userCreditSettings.helpButton.caption",defaultMessage:"Learn how to earn and apply credits"}),href:Object(je.a)("guides.referralsAndCredit"),analyticsFrom:"credit_settings"}),r.a.createElement("div",{style:{display:"flex",alignItems:"center",paddingRight:28,marginTop:16}},r.a.createElement("div",{style:{marginLeft:"auto",fontSize:14,color:this.theme.mediumTextColor}},r.a.createElement(g.FormattedMessage,{id:"userCreditSettings.otherWaysToEarnCreditSection.totalCreditSummaryText",defaultMessage:"Total credit earned"})),r.a.createElement("div",{style:{minWidth:44,fontWeight:Z.a.fontWeight.semibold,textAlign:"right"}},Object(xt.b)({amount:a,currency:"dollar",intl:t}))))}renderSettings(e){return r.a.createElement(z.a,null,this.renderCreditBalance(),this.renderReferralSection(e),this.renderOtherCreditWays(e),this.renderTotalCreditEarned(e))}renderCreditBalance(){var e=this;const{data:t,intl:a}=this.props,{availableCredit:i,totalCredit:s}=t,o=pt.default.state.data;if(!o)return;const l=fe.E(o),c=Math.floor(i/W.default.pricing.personal.monthlyPrice),d=s>=Bt.f;return r.a.createElement(n.Fragment,null,r.a.createElement(H.a,{large:!0,divider:"full"},r.a.createElement(g.FormattedMessage,{id:"userCreditSettings.creditBalanceSection.title",defaultMessage:"Credit balance"})),r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:40,fontSize:14}},r.a.createElement("div",null,r.a.createElement(g.FormattedMessage,{id:"userCreditSettings.creditBalanceSection.creditBalanceMessage",defaultMessage:"Your current credit balance is {creditBalance}.",values:{creditBalance:r.a.createElement("b",{style:{color:this.theme.regularTextColor}},Object(xt.b)({amount:i,currency:"dollar",intl:a}))}})," ",i>0&&!d&&r.a.createElement(g.FormattedMessage,{id:"userCreditSettings.creditBalanceSection.freeMonthMessage",description:"Message in sidebar letting user know how many months of free Notion they can get with their credits",defaultMessage:"{numberOfMonths, plural, one {That's equivalent to <b>{numberOfMonths} month</b> of the Personal Pro Plan.} other {That's equivalent to <b>{numberOfMonths} months</b> of the Personal Pro Plan.}}",values:{numberOfMonths:c,b:function(){for(var t=arguments.length,a=new Array(t),n=0;n<t;n++)a[n]=arguments[n];return r.a.createElement("b",{style:{color:e.theme.regularTextColor}},a)}}}),d&&r.a.createElement(g.FormattedMessage,{id:"userCreditSettings.creditBalanceSection.maximumCreditBalanceExceeded",defaultMessage:"You've exceeded the maximum amount of credit per account, {maximumCreditBalance}. Any additional credit you earn will not increase your balance.",values:{maximumCreditBalance:Object(xt.b)({amount:Bt.f,currency:"dollar",intl:a})}})),i>0&&r.a.createElement(te.a,{isLarge:!0,onClick:this.handleApplyCreditClick},l?be.a.settingsBilling(An.applyCreditButtonIconStyle):be.a.settingsUpgrade(An.applyCreditButtonIconStyle),l?a.formatMessage({id:"userCreditSettings.creditBalanceSection.applyCreditButton.label",defaultMessage:"Apply your credit"}):a.formatMessage({id:"userCreditSettings.creditBalanceSection.upgradeForFreeButton.label",defaultMessage:"Upgrade for free"}))))}getActionCredits(e){const{id:t}=this.environment.currentUser,{currentUserSettingsStore:a}=p.default.state;if(!t||!a)return[];const n=[],r=a.getValue();if(r&&Bt.e(r)){const a={id:"web_login_default",version:0,amount:Bt.a.web_login,activated:!1,created_timestamp:Date.now(),type:"web_login",user_id:t};n.push(e.find(e=>"web_login"===e.type)||a);const r={id:"desktop_login_default",version:0,amount:Bt.a.desktop_login,activated:!1,created_timestamp:Date.now(),type:"desktop_login",user_id:t};n.push(e.find(e=>"desktop_login"===e.type)||r);const i={id:"mobile_login_default",version:0,amount:Bt.a.mobile_login,activated:!1,created_timestamp:Date.now(),type:"mobile_login",user_id:t};n.push(e.find(e=>"mobile_login"===e.type)||i)}const i={id:"import_evernote_default",version:0,amount:Bt.a.import_evernote,activated:!1,created_timestamp:Date.now(),type:"import_evernote",user_id:t};n.push(e.find(e=>"import_evernote"===e.type)||i);const s={id:"browser_extension_default",version:0,amount:Bt.a.browser_extension,activated:!1,created_timestamp:Date.now(),type:"browser_extension",user_id:t};n.push(e.find(e=>"browser_extension"===e.type)||s);const o={id:"mobile_share_sheet_default",version:0,amount:Bt.a.mobile_share_sheet,activated:!1,created_timestamp:Date.now(),type:"mobile_share_sheet",user_id:t};return n.push(e.find(e=>"mobile_share_sheet"===e.type)||o),n}getInviteCredits(e){const t=e.find(e=>"invited_by_user"===e.type),a=e.filter(e=>"invited_user"===e.type&&!e.activated),n=e.filter(e=>"invited_user"===e.type&&e.activated);return s.a.compact([t,...s.a.sortBy(a,e=>-e.created_timestamp),...s.a.sortBy(n,e=>-e.created_timestamp)])}getHeaderContainerStyles(){return{borderBottom:"1px solid ".concat(this.theme.regularDividerColor),paddingBottom:4,marginBottom:12}}getHeaderStyles(){return{fontWeight:Z.a.fontWeight.medium,fontSize:18}}getInviteCreditStyles(){return{marginBottom:44}}}An.showInviteCreditCount=3,An.applyCreditButtonIconStyle={width:20,height:20,marginRight:6};var Rn=Object(g.injectIntl)(An);class Ln extends A.a{isMultipleAccounts(e){return Array.isArray(e)}isSingleAccount(e){return"string"==typeof e}isConnected(e){return this.isSingleAccount(e)||this.isMultipleAccounts(e)&&e.length>0}renderComponent(){const{account:e,intl:t}=this.props;return r.a.createElement(n.Fragment,null,r.a.createElement("div",{style:{display:"flex",alignItems:"center",fontSize:14,paddingTop:2,paddingBottom:2}},this.renderIcon(),r.a.createElement("div",{style:{marginRight:"auto"}},r.a.createElement("div",null,this.props.appName),r.a.createElement("div",{style:{fontSize:12,color:this.theme.mediumTextColor}},this.props.caption)),r.a.createElement("div",{style:Ln.buttonWrapStyle},this.renderConnectButton(this.isConnected(e)?t.formatMessage({id:"connectedAppsSettingsItem.connectAnotherAccountLink",defaultMessage:"Connect another account",description:"Link that enables user to connect another account from a 3rd-party app (like Google Drive) to Notion, assuming they've already connected an account previously"}):t.formatMessage({id:"connectedAppsSettingsItem.connectAccountLink",defaultMessage:"Connect",description:"Link that enables user to connect an account from a 3rd-party app (like Google Drive) to Notion"})))),this.isSingleAccount(e)?this.renderAccount({accountName:e,onDisconnect:this.props.onDisconnect}):this.renderMultipleAccounts(),r.a.createElement(R.a,{size:12}))}renderIcon(){const{logo:e}=this.props;return r.a.createElement("img",{style:Ln.imageIconStyle,src:e})}renderConnectButton(e){return r.a.createElement(en.a,{isBlue:!0,onClick:this.props.onConnect,style:Ln.buttonStyle},e)}renderAccount(e){const{accountName:t,onDisconnect:a,key:n}=e;return r.a.createElement("div",{key:n,style:{marginLeft:44}},r.a.createElement(R.a,{size:12}),r.a.createElement("div",{style:{display:"flex",alignItems:"center",height:32,marginBottom:2,fontSize:14}},r.a.createElement("div",{style:{marginRight:"auto"}},r.a.createElement("div",{style:{color:this.theme.mediumTextColor}},t)),r.a.createElement("div",{style:Ln.buttonWrapStyle},r.a.createElement(en.a,{isRed:!0,onClick:()=>a(),style:Ln.buttonStyle},r.a.createElement(g.FormattedMessage,{id:"connectedAppsSettingsItem.disconnectLink",defaultMessage:"Disconnect",description:"If a user has connected an account from a 3rd-party app (like Google Drive) to Notion, they can click this link to disconnect the account."})))))}renderMultipleAccounts(){const e=this.props.account;if(this.isMultipleAccounts(e))return e.map(e=>this.renderAccount({accountName:e.accountName,onDisconnect:()=>{this.props.onDisconnect(e)},key:e.accountId}))}}Ln.iconSize=32,Ln.buttonStyle={marginLeft:14,marginRight:-4},Ln.buttonWrapStyle={minWidth:80,display:"flex",justifyContent:"flex-end"},Ln.imageIconStyle={flexShrink:0,width:Ln.iconSize,height:Ln.iconSize,borderRadius:3,marginRight:12,background:$.f.white};var Un=Object(g.injectIntl)(Ln);async function _n(e){const t=await l.getConnectedAppsStatus(e,{});if("failed"===t.type){const e=t.error;return console.error(e),{drive:[],evernote:void 0,trello:void 0,asana:void 0}}return t.data}var Wn=a("cgvQ"),Nn=a("BJ/B"),qn=a("3eY8"),Vn=a("9f/M");class zn extends A.a{constructor(){super(...arguments),this.storeTypes={connectedAppsStatus:he.a}}renderComponent(){return J.a.state.online?r.a.createElement($a.a,{request:this.environment,performRequest:_n,requestStore:this.stores.connectedAppsStatus,render:(e,t)=>t?this.renderConnectedAppsSettings(t):r.a.createElement("div",{style:zn.loadingWrapStyle},r.a.createElement(V.a,null))}):this.renderOfflineMessage()}renderOfflineMessage(){return r.a.createElement(z.a,null,r.a.createElement(ue.a,{isSmall:!0,style:{textAlign:"center"}},r.a.createElement(g.FormattedMessage,{id:"connectedAppsSettings.offline.message",defaultMessage:"Please go online to manage connecting to apps."})))}renderSectionTitle(){return r.a.createElement(H.a,{large:!0,divider:"full"},r.a.createElement(g.FormattedMessage,{id:"connectedAppsSettings.connectedAppsSection.title",defaultMessage:"Connected apps"}))}renderConnectedAppsSettings(e){const{intl:t}=this.props,a=this.stores.connectedAppsStatus;return r.a.createElement("div",{style:zn.wrapStyle},r.a.createElement(It.b,{style:zn.scrollerStyle,type:It.a.Y},this.renderSectionTitle(),r.a.createElement(Un,{appName:"Google Drive",caption:t.formatMessage({id:"connectedAppsSettings.googleDrive.caption",defaultMessage:"Find and embed your files"}),logo:oa.a.images.import.googleDrivePng,account:a.state.result.drive,onConnect:()=>this.handleDriveAuth(),onDisconnect:e=>{this.handleDisconnectDrive(e)}}),r.a.createElement(Un,{appName:"Evernote",caption:t.formatMessage({id:"connectedAppsSettings.evernote.caption",defaultMessage:"Import notebooks"}),logo:oa.a.images.import.evernotePng,account:a.state.result.evernote,onConnect:()=>Nn.a({environment:this.environment,requestStore:a}),onDisconnect:()=>async function(e,t){await l.disconnectEvernote(e,{}),await t.refresh(),m.Qd(e,{name:"evernote"})}(this.environment,a)}),r.a.createElement(Un,{appName:"Trello",caption:t.formatMessage({id:"connectedAppsSettings.trello.caption",defaultMessage:"Import your boards"}),logo:oa.a.images.import.trelloPng,account:a.state.result.trello,onConnect:()=>Vn.a({environment:this.environment,requestStore:a}),onDisconnect:()=>async function(e,t){await l.disconnectTrello(e,{}),await t.refresh(),m.Qd(e,{name:"trello"})}(this.environment,a)}),r.a.createElement(Un,{appName:"Asana",caption:t.formatMessage({id:"connectedAppsSettings.asana.caption",defaultMessage:"Import tasks from boards and lists"}),logo:oa.a.images.import.asanaPng,account:a.state.result.asana,onConnect:()=>qn.a({environment:this.environment,requestStore:a}),onDisconnect:()=>async function(e,t){await l.disconnectAsana(e,{}),await t.refresh(),m.Qd(e,{name:"asana"})}(this.environment,a)}),r.a.createElement("div",{style:{marginTop:8}},r.a.createElement(ce.a,{title:t.formatMessage({id:"connectedAppsSettings.helpButton.caption",defaultMessage:"Learn more about embedding content in Notion"}),href:Object(je.a)("guides.import"),analyticsFrom:"connected_apps_settings"}))))}async handleDriveAuth(){m.Hd(this.environment,{name:"google",from:"connected_apps"}),await Wn.f(this.environment),this.stores.connectedAppsStatus.refresh()}handleDisconnectDrive(e){const{intl:t}=this.props;d.showDialog({message:t.formatMessage({id:"connectedAppsSettings.disconnectGoogleDriveModal.message",defaultMessage:"Disconnecting disables file preview on Google Drive files embedded in all of your workspaces. It would not delete your embeds from Notion, so you can re-connect at anytime."}),showCancel:!0,keepFocus:!0,items:[{label:t.formatMessage({id:"connectedAppsSettings.disconnectGoogleDriveModal.disconnectButton.label",defaultMessage:"Disconnect"}),color:"red",onAccept:async()=>{await l.disconnectDrive(this.environment,{googleUserId:e.accountId}),this.stores.connectedAppsStatus.refresh()}}]})}}zn.loadingWrapStyle={alignItems:"center",display:"flex",flexDirection:"column",flex:1,height:"100%",justifyContent:"center"},zn.wrapStyle={display:"flex",flexDirection:"column",height:"100%"},zn.scrollerStyle={height:"100%",padding:"36px 60px"};var Hn=Object(g.injectIntl)(zn),Gn=a("MeYt"),Qn=a("7M94"),Yn=a("bPtJ"),Zn=a("G+Ai"),Xn=a("VVh3"),Kn=a("FUUC"),Jn=a("g4rC");class $n extends E.a{getInitialState(){return{botName:"",botType:"space",spaceRole:"none"}}}var er=$n,tr=a("Mr7a"),ar=a("p0Ff"),nr=a("I8ZR");async function rr(e){const{environment:t,table:a,id:n,type:r}=e,i=await l.getBots(t,{table:a,id:n,type:r});return"failed"===i.type?(Object(d.showError)(i),{botIds:[]}):{botIds:i.data.botIds}}function ir(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function sr(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class or extends A.a{constructor(){super(...arguments),this.storeTypes={botCreateStore:er},this.renderModal=()=>r.a.createElement("div",null,this.renderBotNameSection(),r.a.createElement(ee.a,{isLarge:!0,style:{marginTop:24},onClick:this.handleCreateBot},"Create Bot")),this.handleChangeBotName=e=>{const t=this.stores.botCreateStore.state;this.stores.botCreateStore.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ir(Object(a),!0).forEach((function(t){sr(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ir(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},t,{botName:e.target.value}))},this.handleCreateBot=()=>{const{botName:e,spaceRole:t}=this.stores.botCreateStore.state,{userStore:a,spaceStore:n}=this.props,r=function(e){const{environment:t,name:a,spaceStore:n,spaceRole:r,userId:i}=e,s=Q.create(t),l=Object(o.b)({environment:t,table:Zn.a,value:{name:a,parent_table:Kn.a,parent_id:n.id,created_at:Date.now(),created_by_table:bt.a,created_by_id:i,alive:!0,type:"guest"},inMemoryRecordCache:ar.default,transaction:s});return tr.f({environment:t,store:n,permissionItems:[{type:"bot_permission",role:r,bot_id:l.id}],transaction:s}),Q.commit({environment:t,transaction:s}),l}({environment:this.environment,name:e,userId:a.id,spaceStore:n,spaceRole:t});this.props.onCreateBot(r)}}renderComponent(){return r.a.createElement(L.a,{open:!0,render:this.renderModal,onDismiss:this.props.onDismiss,innerStyle:{width:400,padding:24},preventHideChildrenWhileOpening:!0})}renderBotNameSection(){const{botName:e}=this.stores.botCreateStore.state;return r.a.createElement(r.a.Fragment,null,r.a.createElement(G.a,{style:{marginBottom:8}},"Bot Name"),r.a.createElement(q.b,{placeholder:"Hello World",value:e,onChange:this.handleChangeBotName}))}}var lr=Object(g.injectIntl)(or),cr=a("i3uR"),dr=a("6sah"),ur=a("3JF5");class pr extends A.a{constructor(){super(...arguments),this.storeTypes={tokenOptionsButtonPopupStore:Jn.a},this.handleViewApiTokenClick=async()=>{const e=await async function(e){const{environment:t,botId:a}=e,n=await l.getBotToken(t,{botId:a});if("failed"!==n.type)return n.data.token;Object(d.showError)(n)}({environment:this.environment,botId:this.props.botStore.id});e&&d.showDialog({message:r.a.createElement("div",{style:{width:"100%"}},r.a.createElement("header",{style:{marginBottom:8}},Object(ur.a)(this.props.botStore.getValue())),r.a.createElement(q.b,{type:"text",format:q.a.Default,value:e,disabled:!0,style:{height:32}})),showCancel:!1,keepFocus:!1,items:[{label:r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.SCIMSection.viewTokenModal.copyButton.label",defaultMessage:"Copy token"}),color:"blue",onAccept:()=>{st.c({environment:this.environment,stringValue:e})}},{label:r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.SCIMSection.viewTokenModal.dismissButton.label",defaultMessage:"Close"}),onAccept:()=>{}}],innerStyle:{width:336}})},this.handleRevokeApiTokenClick=async()=>{const e=this.props.botStore.getValue();e&&await d.confirmUserAction({message:"scim"===e.type?r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.SCIMSection.revokeTokenModal.message",defaultMessage:"Revoke SCIM token? All SCIM API requests that use this token will no longer succeed."}):r.a.createElement(g.FormattedMessage,{id:"botWithTokenSettings.revokeTokenModal.message",defaultMessage:"Revoke API token? All API requests that use this token will no longer succeed."}),acceptLabel:"scim"===e.type?r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.SCIMSection.revokeTokenModal.acceptButton.label",defaultMessage:"Revoke SCIM token"}):r.a.createElement(g.FormattedMessage,{id:"botWithTokenSettings.revokeTokenModal.acceptButton.label",defaultMessage:"Revoke API token"}),cancelLabel:r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.SCIMSection.revokeTokenModal.cancelButton.label",defaultMessage:"Cancel"})})&&await async function(e){const{environment:t,botId:a,tokenId:n}=e,r=await l.revokeBotToken(t,{botId:a,tokenId:n});if("failed"!==r.type)return!0;Object(d.showError)(r)}({environment:this.environment,botId:e.id})&&d.showMessage({message:"scim"===e.type?r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.SCIMSection.tokenRevoked.message",defaultMessage:"SCIM token revoked successfully. A new token is available."}):r.a.createElement(g.FormattedMessage,{id:"botWithTokenSettings.revokeTokenModal.tokenRevoked.message",defaultMessage:"API token revoked successfully. A new token is now available."})})},this.handleDeleteBot=async()=>{await async function(e){const t=e.getValue();return Object(d.confirmUserAction)({message:r.a.createElement("span",null,r.a.createElement(g.FormattedMessage,{id:"botActions.deleteBotConfirmationDialog.confirmationMessage",defaultMessage:"Are you sure you want to delete {bot}?",values:{bot:r.a.createElement(nr.a,{botValue:t,inline:!0})}})),acceptLabel:r.a.createElement(g.FormattedMessage,{id:"botActions.deleteBotConfirmationDialog.confirmDeleteBotButton.label",defaultMessage:"Yes"})})}(this.props.botStore)&&(!function(e,t){const a=Q.create(e);Q.addOperation({transaction:a,store:t,operation:{pointer:t.pointer,path:["alive"],command:"set",args:!1}}),Q.commit({environment:e,transaction:a})}(this.environment,this.props.botStore),this.props.onDelete&&this.props.onDelete(this.props.botStore))}}renderComponent(){const{device:e}=this.environment;let t;t=e.isMobile?{menuType:lt.b.MenuType.ActionSheet}:{menuType:lt.b.MenuType.Popup};const a=Boolean(this.props.onDelete);return r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(nr.a,{botValue:this.props.botStore.getValue(),avatarSize:24,style:{fontSize:14,flex:1}}),r.a.createElement(en.a,{onClick:()=>this.handleViewApiTokenClick(),isBlue:!0},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.SCIMSection.viewToken.label",defaultMessage:"View token"})),r.a.createElement(cr.a,{popupType:e.isMobile?cr.a.PopupType.SlideUp:cr.a.PopupType.Popup,buttonPopupStore:this.stores.tokenOptionsButtonPopupStore,renderOrigin:t=>r.a.createElement(dr.a,Object.assign({isMobile:e.isMobile},t,{style:{marginLeft:8,marginRight:8}})),render:e=>r.a.createElement(lt.b,Object.assign({},t),r.a.createElement(ct.a,{type:ct.a.Type.Vertical,sections:[{key:"token options",render:e=>r.a.createElement(ut.a,Object.assign({},e)),items:[{key:"revoke token",render:e=>r.a.createElement(dt.a,Object.assign({title:r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.SCIMSection.revokeToken.label",defaultMessage:"Revoke token"}),icon:be.a.showDeletedPages({width:18,fill:"currentColor"})},e)),action:()=>{this.handleRevokeApiTokenClick(),e.close()}},...a?[{key:"delete",action:()=>{this.handleDeleteBot(),e.close()},render:e=>r.a.createElement(dt.a,Object.assign({title:r.a.createElement(g.FormattedMessage,{id:"botWithTokenSettings.deleteBot.label",defaultMessage:"Delete bot"}),icon:be.a.trash({width:18,fill:"currentColor"})},e))}]:[]]}],initialFocus:void 0}))}))}}var mr=pr;function hr(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function gr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?hr(Object(a),!0).forEach((function(t){fr(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):hr(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function fr(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const br=r.a.Fragment;class yr extends A.a{constructor(){super(...arguments),this.storeTypes={requestStore:he.a,popupStore:Jn.a},this.renderResult=(e,t,a)=>r.a.createElement(Xn.a,{loaded:a,spinnerSize:16,showSpinnerTimeout:600},e&&r.a.createElement("div",null,"Something went wrong..."),t&&this.renderBots(t)),this.renderBots=e=>{let{spaceBotIds:t}=e;return r.a.createElement(br,null,r.a.createElement(H.a,{style:{marginTop:"2em"}},r.a.createElement(g.FormattedMessage,{id:"apiSettingsPage.bots.title",defaultMessage:"Bots",description:"Bots are the way to access the Notion API."})),r.a.createElement(ue.a,{isSmall:!0,isMultiline:!0,style:{width:"90%",marginBottom:14}},r.a.createElement(g.FormattedMessage,{id:"apiSettingsPage.bots.description",defaultMessage:"Bots can only access content shared with the current workspace. To give access to private pages, share pages with the bot from the Share menu. <learnmorelink>Learn more</learnmorelink>",values:{learnmorelink:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return r.a.createElement(we.a,{href:ea.d.publicApiGetStarted},t)}},description:"Bots are the way to access the Notion API. Inform users about what bots are and what they can do."})),r.a.createElement(ee.a,{isLarge:!0,onClick:this.handleOpenCreateBotModal},r.a.createElement(g.FormattedMessage,{id:"apiSettingsPage.bots.addBotbutton",defaultMessage:"Add bot",description:"Bots are the way to access the Notion API. Create a new bot."})),this.renderBotTable(t))},this.renderBotCreateModal=()=>{const{spaceStore:e,userStore:t}=this.props;return r.a.createElement(lr,{spaceStore:e,userStore:t,onCreateBot:this.handleCreateBot,onDismiss:this.handleCloseCreateBotModal})},this.handleDeleteBot=e=>{const t=this.stores.requestStore.state;t.result&&this.stores.requestStore.setState(gr({},t,{result:{spaceBotIds:t.result.spaceBotIds.filter(t=>t!==e.id),userBotIds:t.result.userBotIds.filter(t=>t!==e.id)}}))},this.handleCreateBot=e=>{const t=e.getValue();if(t){const e=this.stores.requestStore.state;e.result&&this.stores.requestStore.setState(gr({},e,{result:{spaceBotIds:t.parent_table===Kn.a?[...e.result.spaceBotIds,t.id]:e.result.spaceBotIds,userBotIds:t.parent_table===bt.a?[...e.result.userBotIds,t.id]:e.result.userBotIds}}))}this.handleCloseCreateBotModal()},this.handleOpenCreateBotModal=()=>{this.stores.popupStore.setState({open:!0})},this.handleCloseCreateBotModal=()=>{this.stores.popupStore.setState({open:!1})},this.fetchUserAndSpaceBots=async e=>{let{userId:t,spaceId:a}=e;const[n,r]=await Promise.all([rr({environment:this.environment,table:bt.a,id:t,type:"guest"}),rr({environment:this.environment,table:Kn.a,id:a,type:"guest"})]);return{userBotIds:n.botIds,spaceBotIds:r.botIds}}}renderComponent(){return r.a.createElement("div",{style:yr.wrapStyle},r.a.createElement(It.b,{style:yr.scrollerStyle,type:It.a.Y},r.a.createElement(ce.a,{title:"Read the Notion API documentation.",href:ea.d.publicAPISpec,analyticsFrom:"api"}),r.a.createElement(R.a,{size:32,style:{marginBottom:16}}),this.renderRequest(),this.stores.popupStore.state.open&&this.renderBotCreateModal()))}renderRequest(){const{spaceStore:e,userStore:t}=this.props;return r.a.createElement($a.a,{requestStore:this.stores.requestStore,request:{spaceId:e.id,userId:t.id},performRequest:this.fetchUserAndSpaceBots,render:this.renderResult})}renderBotTable(e){const{spaceStore:t}=this.props,a=e.map(e=>Object(Yn.c)(t,{table:Zn.a,id:e}));if(a.length>0)return r.a.createElement(br,null,r.a.createElement(R.a,{size:16,style:{marginTop:16}}),r.a.createElement("div",null,a.map(e=>r.a.createElement(br,{key:e.id},r.a.createElement(mr,{botStore:e,onDelete:this.handleDeleteBot}),r.a.createElement(R.a,{size:16})))))}}yr.wrapStyle={display:"flex",flexDirection:"column",height:"100%"},yr.scrollerStyle={height:"100%",padding:"36px 60px"};var Sr=Object(g.injectIntl)(yr),vr=a("DbeH"),Er=a("OWVv");function Mr(e,t){return"".concat(function(e){return"".concat(e||"https://www.notion.so").concat(ea.d.samlAuth)}(t),"/").concat(e)}var Cr=a("6q9u"),wr=a("L0YQ"),Or=a("+fkW"),kr=a("AXh+");function Pr(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Tr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Pr(Object(a),!0).forEach((function(t){Dr(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Pr(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Dr(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Ir extends A.a{constructor(){super(...arguments),this.storeTypes={botsRequestStore:he.a,tokenOptionsButtonPopupStore:Jn.a},this.renderScimBotTokens=(e,t,a)=>{if(!a)return r.a.createElement(V.a,null);if(t&&!e){const{botIds:e}=t,a=e[0]&&Object(Yn.c)(this.props.spaceStore,{table:Zn.a,id:e[0]});return r.a.createElement(n.Fragment,null,r.a.createElement(R.a,{size:48,style:{opacity:0}}),r.a.createElement("div",{style:this.getHeaderStyle()},r.a.createElement("span",{style:{marginRight:8}},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.SCIMSection.title",defaultMessage:"SCIM configuration"})),"enterprise"!==fe.i(this.environment)&&r.a.createElement(ht.a,{subscriptionTier:"enterprise",analyticsName:"space_saml",onClick:this.handleUpgradeClick,desktopStyle:{marginTop:-1}})),a&&r.a.createElement(mr,{botStore:a})||"enterprise"===fe.i(this.environment)&&this.renderScimContactUs(),this.renderScimHelp())}},this.handleDisablePublicAccessSwitcherClick=async()=>{const{securitySettingsStore:e}=this.props,t=e.state.disablePublicAccess;if(!t){if(!(await d.confirmUserAction({message:r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.preventPublicSharing.confirmationModal.message",defaultMessage:"Are you sure? This will remove access for anyone who is not a member or guest of the workspace from all pages in this workspace."}),acceptLabel:r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.preventPublicSharing.confirmationModal.confirmButton.label",defaultMessage:"Yes"})})))return}e.setState(Tr({},e.state,{disablePublicAccess:!t}))},this.handleAllowDisableGuestsSwitcherClick=async()=>{const{securitySettingsStore:e}=this.props,t=e.state.disableGuests;if(!t){if(!(await d.confirmUserAction({message:r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.disableGuests.confirmationModal.message",defaultMessage:"Are you sure? All guests in this workspace will be removed."}),acceptLabel:r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.disableGuests.confirmationModal.confirmButton.label",defaultMessage:"Yes"})})))return}e.setState(Tr({},e.state,{disableGuests:!t}))},this.handleDisableMoveToSwitcherClick=()=>{const{securitySettingsStore:e}=this.props;e.setState(Tr({},e.state,{disableMoveToSpace:!e.state.disableMoveToSpace}))},this.handleAllowDisableWorkspaceTopLevelSwitcherClick=()=>{const{securitySettingsStore:e}=this.props;e.setState(Tr({},e.state,{disableSpacePageEdits:!e.state.disableSpacePageEdits}))},this.handleDisableExportClick=()=>{const{securitySettingsStore:e}=this.props;e.setState(Tr({},e.state,{disableExport:!e.state.disableExport}))},this.handleDisablePublicAccessRequestsClick=()=>{const{securitySettingsStore:e}=this.props;e.setState(Tr({},e.state,{disablePublicAccessRequests:!e.state.disablePublicAccessRequests}))},this.handleUpdateClick=async()=>{await Promise.all([this.saveSecuritySettings(),this.saveSamlConfig()]),this.props.securitySettingsStore.state.error?d.showError(this.props.securitySettingsStore.state.error):this.closeSettings()},this.handleCancelClick=()=>{this.closeSettings()},this.handleEnableSamlToggle=()=>{if(!this.isSamlEditable())return;const{state:e}=this.props.samlConfigStore,t=!this.isInvalidSamlConfig(e);"unconfigured"===e.status||"disabled"===e.status?t&&this.props.samlConfigStore.setState(Tr({},e,{status:"configured"})):this.props.samlConfigStore.setState(Tr({},e,{status:t?"disabled":"unconfigured"}))},this.handleIdpMetadataUrlChange=e=>{this.props.samlConfigStore.setState(Tr({},this.props.samlConfigStore.state,{idpMetadataUrl:e.target.value}))},this.handleIdpMetadataUrlBlur=e=>{Boolean(e.target.value)&&this.setUseMetadataUrl(!0)},this.handleIdpMetadataChange=e=>{this.props.samlConfigStore.setState(Tr({},this.props.samlConfigStore.state,{idpMetadata:e.target.value}))},this.handleIdpMetadataBlur=e=>{Boolean(e.target.value)&&this.setUseMetadataUrl(!1)},this.handleEnforceSamlToggle=()=>{const{state:e}=this.props.samlConfigStore;if(this.isSamlEditable()&&!this.isInvalidSamlConfig(e)){const t="enforced"===e.status?"configured":"enforced";this.props.samlConfigStore.setState(Tr({},e,{status:t}))}},this.handleCreateAccountToggle=()=>{const{state:e}=this.props.samlConfigStore;this.isSamlEditable()&&this.props.samlConfigStore.setState(Tr({},e,{createAccount:!e.createAccount}))},this.handleEmailDomainContactUsClick=()=>{Ee.a({environment:this.environment,from:"saml_settings",prepopulatedContent:"Request to add or change an email domain for SAML Single Sign-on on workspace ".concat(this.props.spaceStore.id,".")})},this.handleWorkspaceContactUsClick=()=>{Ee.a({environment:this.environment,from:"saml_settings",prepopulatedContent:"Request to add or remove a workspace for SAML Single Sign-on on workspace ".concat(this.props.spaceStore.id,".")})},this.handleUpgradeClick=()=>{vr.a(this.environment,{from:"space_saml",for:"enterprise"})},this.handleScimTokenContactUsClick=()=>{Ee.a({environment:this.environment,from:"saml_settings",prepopulatedContent:"Request to generate a SCIM API token for workspace ".concat(this.props.spaceStore.id,".")})},this.setUseMetadataUrl=e=>{this.props.samlConfigStore.setState(Tr({},this.props.samlConfigStore.state,{useMetadataUrl:e}))}}renderComponent(){return J.a.state.online?r.a.createElement(z.a,{controlRow:this.renderControlRow()},this.renderSecuritySettings(),this.renderSamlSettings(),this.renderScimSettings()):this.renderOfflineMessage()}renderUpsell(){if(!this.isSecuritySubscribed())return r.a.createElement("div",{style:{border:"1px solid ".concat(this.theme.regularDividerColor),borderRadius:3,padding:16,marginTop:Object(kr.f)(this.environment)?void 0:24,marginBottom:24}},r.a.createElement(wr.a,{for:"enterprise",from:"space_saml",icon:be.a.key,title:r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.upsell.title",defaultMessage:"Upgrade for advanced security, SAML & SCIM"}),caption:r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.upsell.caption",defaultMessage:"Upgrade to the Enterprise Plan for advanced security settings, SAML single sign-on, and automated user and group provisioning."}),learnMoreRoute:"guides.securitySettings"}))}renderSecuritySettings(){const{securitySettingsStore:e}=this.props,t=r.a.createElement(ht.a,{subscriptionTier:"enterprise",analyticsName:"space_saml",onClick:this.handleUpgradeClick,desktopStyle:{display:"inline-block",marginLeft:8,marginTop:-3}}),a=a=>r.a.createElement("div",null,r.a.createElement("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:a?this.handleDisablePublicAccessSwitcherClick:this.handleUpgradeClick},r.a.createElement("div",{style:this.getTitleStyle()},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.securitySection.preventPublicSharing.label",defaultMessage:"Prevent members from sharing pages publicly"}),!a&&t,r.a.createElement(ue.a,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"80%"}},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.securitySection.preventPublicSharing.caption",defaultMessage:"This will disable the Share to web option in the Share menu on every page in this workspace."}))),r.a.createElement("div",{style:{marginTop:5,opacity:a?void 0:.5}},r.a.createElement(ua.a,{on:e.state.disablePublicAccess,disabled:!a}))),r.a.createElement(R.a,{size:24,style:{opacity:0}})),i=a=>r.a.createElement("div",null,r.a.createElement("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:a?this.handleAllowDisableWorkspaceTopLevelSwitcherClick:this.handleUpgradeClick},r.a.createElement("div",{style:this.getTitleStyle()},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.securitySection.disableSpacePageEdits.label",defaultMessage:"Prevent members from changing the Workspace section"}),!a&&t,r.a.createElement(ue.a,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"85%"}},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.securitySection.disableSpacePageEdits.caption",defaultMessage:"This disables the ability for members to create, move, reorder, and delete top-level Workspace pages."}))),r.a.createElement("div",{style:{marginTop:5,opacity:a?void 0:.5}},r.a.createElement(ua.a,{on:e.state.disableSpacePageEdits,disabled:!a}))),r.a.createElement(R.a,{size:24,style:{opacity:0}})),s=a=>r.a.createElement("div",null,r.a.createElement("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:a?this.handleAllowDisableGuestsSwitcherClick:this.handleUpgradeClick},r.a.createElement("div",{style:this.getTitleStyle()},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.securitySection.disableGuests.label",defaultMessage:"Disable guests"}),!a&&t,r.a.createElement(ue.a,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"80%"}},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.securitySection.disableGuests.caption",defaultMessage:"This prevents anyone from inviting people outside the workspace to any page."}))),r.a.createElement("div",{style:{marginTop:5,opacity:a?void 0:.5}},r.a.createElement(ua.a,{on:e.state.disableGuests,disabled:!a}))),r.a.createElement(R.a,{size:24,style:{opacity:0}})),o=a=>r.a.createElement("div",null,r.a.createElement("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:a?this.handleDisableMoveToSwitcherClick:this.handleUpgradeClick},r.a.createElement("div",{style:this.getTitleStyle()},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.securitySection.disableMovingPages.label",defaultMessage:"Disable moving or duplicating pages to other workspaces"}),!a&&t,r.a.createElement(ue.a,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"80%"}},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.securitySection.disableMovingPages.caption",defaultMessage:"This prevents anyone from moving or duplicating pages to other workspaces via the Move To or Duplicate To action."}))),r.a.createElement("div",{style:{marginTop:5,opacity:a?void 0:.5}},r.a.createElement(ua.a,{on:e.state.disableMoveToSpace,disabled:!a}))),r.a.createElement(R.a,{size:24,style:{opacity:0}})),{state:l}=e,c=a=>r.a.createElement("div",null,r.a.createElement("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:a?this.handleDisableExportClick:this.handleUpgradeClick},r.a.createElement("div",{style:this.getTitleStyle()},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.securitySection.disableExport.label",defaultMessage:"Disable export"}),!a&&t,r.a.createElement(ue.a,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"80%"}},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.securitySection.disableExport.caption",defaultMessage:"This prevents anyone from exporting as Markdown, CSV, or PDF."}))),r.a.createElement("div",{style:{marginTop:5,opacity:a?void 0:.5}},r.a.createElement(ua.a,{on:e.state.disableExport,disabled:!a}))),r.a.createElement(R.a,{size:24,style:{opacity:0}})),d=a=>{if(Object(kr.f)(this.environment))return r.a.createElement("div",null,r.a.createElement("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:a?this.handleDisablePublicAccessRequestsClick:this.handleUpgradeClick},r.a.createElement("div",{style:this.getTitleStyle()},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.securitySection.disablePublicAccessRequests.label",defaultMessage:"Disable page access requests from non-members"}),!a&&t,r.a.createElement(ue.a,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"80%"}},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.securitySection.disablePublicAccessRequests.caption",defaultMessage:"This prevents anyone with the link to a page from requesting access. Workspace members can always request access."}))),r.a.createElement("div",{style:{marginTop:5,opacity:a?void 0:.5}},r.a.createElement(ua.a,{on:e.state.disablePublicAccessRequests,disabled:!a}))),r.a.createElement(R.a,{size:24,style:{opacity:0}}))};return this.isSecuritySubscribed()?r.a.createElement(n.Fragment,null,r.a.createElement(H.a,{large:!0,divider:"full"},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.securitySection.title",defaultMessage:"Security"})),d(!0),a(!0),i(!0),s(!0),o(!0),c(!0),r.a.createElement("div",{style:{height:36}})):r.a.createElement(n.Fragment,null,this.renderUpsell(),r.a.createElement("div",{style:this.getHeaderStyle()},r.a.createElement("span",{style:{marginRight:8}},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.securitySection.title",defaultMessage:"Security"}))),d(!0),a(l.disablePublicAccess),i(l.disableSpacePageEdits),s(l.disableGuests),o(l.disableMoveToSpace),c(l.disableExport),r.a.createElement("div",{style:{height:32}}))}renderSamlSettings(){return r.a.createElement($a.a,{request:{environment:this.environment,spaceId:this.props.spaceStore.id,store:this.props.samlConfigStore},performRequest:F,render:(e,t,a)=>a?t&&!e?this.isSamlAvailable()?this.renderSamlConfig():this.renderUpgradeSamlPrompt():void 0:r.a.createElement(V.a,null)})}renderSamlHelp(){return r.a.createElement("div",{style:{marginTop:18,marginBottom:24}},r.a.createElement(ce.a,{title:r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.SAMLSection.helpButton.label",defaultMessage:"Learn about SAML and single sign-on"}),href:Object(je.a)("guides.samlSettings"),analyticsFrom:"saml_settings"}))}renderSamlUneditable(e){if(this.isSamlEditable()||!e)return;const t=Or.a.getPublicSpaceData(this.environment,e);return t?r.a.createElement("div",{style:{marginBottom:24}},r.a.createElement(ue.a,{isMultiline:!0},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.SAMLSection.uneditableMessage",defaultMessage:"SAML is being managed by the workspace <bold>{workspaceName}</bold>. Please go there to change any SAML settings.",values:{workspaceName:t.name,bold:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return r.a.createElement("span",{style:{fontWeight:Z.a.fontWeight.semibold}},t)}}}))):void 0}renderUpgradeSamlPrompt(){return r.a.createElement("div",null,r.a.createElement(n.Fragment,null,r.a.createElement("div",{style:this.getHeaderStyle()},r.a.createElement("span",{style:{marginRight:8}},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.title",defaultMessage:"SAML single sign-on"})),r.a.createElement(ht.a,{subscriptionTier:"enterprise",analyticsName:"space_saml",onClick:this.handleUpgradeClick,desktopStyle:{marginTop:-1}})),this.renderSamlHelp()))}renderEmailDomains(e){var t=this;return r.a.createElement(n.Fragment,null,r.a.createElement(H.a,{smallMarginBottom:!0},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.emailDomainsSection.title",defaultMessage:"Email domains"})),r.a.createElement(ue.a,{isSmall:!0,isMultiline:!0,style:Tr({},Ir.captionStyle,{marginBottom:12,marginTop:2})},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.emailDomainsSection.emailInput.caption",defaultMessage:"Once you enable SAML, anyone using an email address with the domains below will be able to log in using SAML SSO. <contactlink>Contact support</contactlink> to add or remove a domain.",values:{contactlink:function(){for(var e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];return r.a.createElement(we.a,{onClick:t.handleEmailDomainContactUsClick},a)}}})),r.a.createElement("div",{style:{height:32}},r.a.createElement(nt,{placeholder:this.props.intl.formatMessage({id:"securitySAMLSettings.emailDomainsSection.emailInput.placeholder",defaultMessage:"No email domains configured"}),value:"",onChange:()=>{},onRemoveLastToken:()=>{},readOnly:!0,tokens:e.map(e=>r.a.createElement(rt.b,{showRemoveButton:!1,isSingle:!1,format:rt.b.Format.Medium,key:e,value:e}))})),r.a.createElement(R.a,{size:40}))}renderSpaceNames(e){var t=this;if(!this.isSamlEditable())return;const a=e.map(e=>Or.a.getPublicSpaceData(this.environment,e)).filter(e=>Boolean(e));return a.length<=1?void 0:r.a.createElement(n.Fragment,null,r.a.createElement(H.a,{smallMarginBottom:!0},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.spaceNamesSection.title",defaultMessage:"Workspaces"})),r.a.createElement(ue.a,{isSmall:!0,isMultiline:!0,style:Tr({},Ir.captionStyle,{marginBottom:12,marginTop:2})},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.spaceNamesSection.spaceNameInput.caption",defaultMessage:"The SAML settings here apply to multiple workspaces. <contactlink>Contact support</contactlink> to add or remove a workspace.",values:{contactlink:function(){for(var e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];return r.a.createElement(we.a,{onClick:t.handleWorkspaceContactUsClick},a)}}})),r.a.createElement("div",{style:{height:32}},r.a.createElement(nt,{placeholder:"",value:"",onChange:()=>{},onRemoveLastToken:()=>{},readOnly:!0,tokens:a.map(e=>r.a.createElement(rt.b,{showRemoveButton:!1,isSingle:!1,format:rt.b.Format.Medium,key:e.id,value:e.name}))})),r.a.createElement(R.a,{size:40}))}renderSingleSignOnUrl(){const e=Mr(this.props.spaceStore.id),t=r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.singleSignOnURLSettings.url.tooltip",defaultMessage:"Copy link"});return r.a.createElement(n.Fragment,null,r.a.createElement(H.a,null,r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.singleSignOnURLSettings.title",defaultMessage:"Single sign-on URL"})),r.a.createElement(ue.a,{isSmall:!0,isMultiline:!0,style:Tr({},Ir.captionStyle,{marginTop:2})},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.singleSignOnURLSettings.url.caption",defaultMessage:"Enter this in your Identity Provider's SAML configuration."})),r.a.createElement("div",null,r.a.createElement("div",{style:{display:"flex",alignItems:"flex-start",marginTop:12,marginBottom:6}},r.a.createElement(q.b,{type:"text",format:q.a.Default,value:e,disabled:!0,style:{borderTopRightRadius:0,borderBottomRightRadius:0,width:"calc(100% - 90px)",height:32}}),r.a.createElement(ee.a,{onClick:()=>{st.c({environment:this.environment,stringValue:e})},style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,width:90},isLarge:!0},t))))}renderIdpSettings(e){return r.a.createElement(n.Fragment,null,r.a.createElement(en.a,{style:this.getRadioTitleStyle(),onClick:e=>{this.setUseMetadataUrl(!0)},disabled:!this.isSamlEditable()},r.a.createElement(Cr.a,{isSelected:Boolean(e.useMetadataUrl)})," ",r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.singleSignOnURLSettings.IdentityProviderMetadataURLOption.label",defaultMessage:"IDP metadata URL"})),r.a.createElement("div",{style:{maxWidth:"100%",marginLeft:32}},r.a.createElement(q.b,{value:e.idpMetadataUrl,onChange:this.handleIdpMetadataUrlChange,onBlur:this.handleIdpMetadataUrlBlur,placeholder:"https://...",style:{height:32},readOnly:!this.isSamlEditable()})),r.a.createElement(en.a,{style:this.getRadioTitleStyle(),onClick:e=>{this.setUseMetadataUrl(!1)},disabled:!this.isSamlEditable()},r.a.createElement(Cr.a,{isSelected:!e.useMetadataUrl})," ",r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.singleSignOnURLSettings.IdentityProviderMetadataXMLOption.label",defaultMessage:"IDP metadata XML"})),r.a.createElement("div",{style:{maxWidth:"100%",marginLeft:32}},r.a.createElement(q.b,{textarea:!0,value:e.idpMetadata,onChange:this.handleIdpMetadataChange,onBlur:this.handleIdpMetadataBlur,placeholder:this.props.intl.formatMessage({id:"securitySAMLSettings.SAMLSingleSignOnSection.singleSignOnURLSettings.IdentityProviderMetadataXMLOption.input.placeholder",defaultMessage:"IDP metadata XML"}),readOnly:!this.isSamlEditable()}),r.a.createElement(ue.a,{isSmall:!0,isMultiline:!0,style:Ir.captionStyle},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.singleSignOnURLSettings.IdentityProviderMetadataXMLOption.caption",defaultMessage:"Enter the value provided by your Identity Provider (IDP)."}))))}renderCreateAccountToggle(e){const t=!this.isSamlEditable();return r.a.createElement("div",null,r.a.createElement(R.a,{size:24,style:{marginTop:12}}),r.a.createElement("div",{style:Ir.settingOptionStyle(t),onClick:this.handleCreateAccountToggle},r.a.createElement("div",{style:this.getTitleStyle()},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.automaticallyCreateAccounts.label",defaultMessage:"Automatically create accounts on sign-in"}),r.a.createElement(ue.a,{isSmall:!0,isMultiline:!0,style:Ir.captionStyle},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.automaticallyCreateAccounts.caption",defaultMessage:"Allow users to create Notion accounts without provisioning from the IDP."}))),r.a.createElement(ua.a,{on:e,disabled:t})),r.a.createElement(R.a,{size:24}))}renderEnableSamlToggle(e,t){return r.a.createElement("div",null,r.a.createElement("div",{style:Ir.settingOptionStyle(t||!this.isSamlEditable()),onClick:this.handleEnableSamlToggle},r.a.createElement("div",{style:this.getTitleStyle()},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.enableSAML.label",defaultMessage:"Enable SAML"}),r.a.createElement(ue.a,{isSmall:!0,isMultiline:!0,style:Ir.captionStyle},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.enableSAML.caption",defaultMessage:"This allows users with emails on the configured domains to log in with SAML. SAML authentication can be enforced below."}))),r.a.createElement("div",null,t?r.a.createElement(it.a,{delayThreshold:0,renderTooltip:()=>r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.enableSAML.tooltip",defaultMessage:"SAML can be enabled once it is fully configured."}),alignment:Er.a.End,render:e=>r.a.createElement("div",Object.assign({},e),r.a.createElement(ua.a,{on:!1,disabled:!0}))}):r.a.createElement(ua.a,{on:"disabled"!==e&&"unconfigured"!==e,disabled:!this.isSamlEditable()}))),r.a.createElement(R.a,{size:24}))}renderEnforceSamlToggle(e,t){return r.a.createElement("div",{style:Ir.settingOptionStyle(t||!this.isSamlEditable()),onClick:this.handleEnforceSamlToggle},r.a.createElement("div",{style:this.getTitleStyle()},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.enforceSAML.label",defaultMessage:"Enforce SAML"}),r.a.createElement(ue.a,{isSmall:!0,isMultiline:!0,style:Ir.captionStyle},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.enforceSAML.captionMulti",defaultMessage:"Once enforced, workspace members with an email on the domains configured above can only use SAML SSO to log in. Administrator accounts can still log in using email."}))),r.a.createElement("div",null,t?r.a.createElement(it.a,{delayThreshold:0,renderTooltip:()=>r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.enforceSAML.tooltip",defaultMessage:"Enable SAML to access this option."}),alignment:Er.a.End,render:e=>r.a.createElement("div",Object.assign({},e),r.a.createElement(ua.a,{on:!1,disabled:!0}))}):r.a.createElement(ua.a,{on:"enforced"===e,disabled:!this.isSamlEditable()})))}renderSamlConfig(){const e=this.props.samlConfigStore.state,t=this.isInvalidSamlConfig(e);return r.a.createElement(n.Fragment,null,r.a.createElement("div",{style:this.getHeaderStyle()},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.title",defaultMessage:"SAML single sign-on"})),this.renderSamlHelp(),this.renderSamlUneditable(e.id),this.renderEmailDomains(e.emailDomains),this.renderSpaceNames(e.spaceIds),this.renderSingleSignOnUrl(),this.renderIdpSettings(e),this.renderCreateAccountToggle(e.createAccount),this.renderEnableSamlToggle(e.status,t),this.renderEnforceSamlToggle(e.status,t))}renderScimSettings(){return r.a.createElement($a.a,{requestStore:this.stores.botsRequestStore,request:{environment:this.environment,table:Kn.a,id:this.props.spaceStore.id,type:"scim"},performRequest:rr,render:this.renderScimBotTokens})}renderScimContactUs(){var e=this;return r.a.createElement(ue.a,{isSmall:!0,isMultiline:!0,style:Ir.captionStyle},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.SCIMSection.contactUs",defaultMessage:"To generate a SCIM API token, please <contactlink>contact support</contactlink>.",values:{contactlink:function(){for(var t=arguments.length,a=new Array(t),n=0;n<t;n++)a[n]=arguments[n];return r.a.createElement(we.a,{onClick:e.handleScimTokenContactUsClick},a)}}}))}renderScimHelp(){return r.a.createElement("div",{style:{marginTop:18,marginBottom:24}},r.a.createElement(ce.a,{title:r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.SCIMSection.helpButton.label",defaultMessage:"Learn about SCIM"}),href:Object(je.a)("guides.scim"),analyticsFrom:"scim_settings"}))}renderControlRow(){if(this.isSecuritySubscribed()||Object(kr.f)(this.environment))return r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(ee.a,{isLarge:!0,onClick:this.handleUpdateClick},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.updateButton.label",defaultMessage:"Update"})),r.a.createElement(te.a,{isLarge:!0,style:{marginLeft:12},onClick:this.handleCancelClick},r.a.createElement(g.FormattedMessage,{id:"securitySAMLSettings.cancelButton.label",defaultMessage:"Cancel"})))}renderOfflineMessage(){return r.a.createElement(z.a,null,r.a.createElement(ue.a,{isSmall:!0,isMultiline:!0,style:{textAlign:"center"}},r.a.createElement(g.FormattedMessage,{defaultMessage:"Please go online to manage security settings.",id:"securitySAMLSettings.offline.message"})))}closeSettings(){B.a.setState(Tr({},B.a.state,{open:!1}))}isSamlAvailable(){return this.props.samlConfigStore.state.emailDomains.length>0||"enterprise"===fe.i(this.environment)}isSamlEditable(){const e=this.props.samlConfigStore.state;return this.isSamlAvailable()&&(!e.id||e.id===this.props.spaceStore.id)}isSecuritySubscribed(){const e=fe.i(this.environment);if("enterprise"===e)return!0;if("team"===e||"team_free"===e){const{data:e}=pt.default.state,t=fe.p(e);return e&&t&&"subscribed_admin"===e.type&&t.created<M.d}return!1}isInvalidSamlConfig(e){return 0===e.emailDomains.length||e.useMetadataUrl&&!e.idpMetadataUrl||!e.useMetadataUrl&&!e.idpMetadata}saveSecuritySettings(){const{securitySettingsStore:e,spaceStore:t}=this.props,{disablePublicAccess:a,disableGuests:n,disableMoveToSpace:r,disableExport:i,disableSpacePageEdits:s,disablePublicAccessRequests:o}=e.state;return Q.createAndCommit(this.environment,e=>{S.y({environment:this.environment,transaction:e,spaceStore:t,disablePublicAccess:a,disableGuests:n,disableMoveToSpace:r,disableExport:i,disableSpacePageEdits:s,disablePublicAccessRequests:o})})}async saveSamlConfig(){if(this.isSamlAvailable()){const e=this.props.samlConfigStore.state,t=await l.addSamlConfigToSpace(this.environment,{spaceId:this.props.spaceStore.id,status:e.status,useMetadataUrl:e.useMetadataUrl,idpMetadataUrl:e.idpMetadataUrl,idpMetadata:e.idpMetadata,createAccount:e.createAccount});"failed"===t.type&&this.props.securitySettingsStore.setState(Tr({},this.props.securitySettingsStore.state,{error:t}))}}static settingOptionStyle(){return{display:"flex",alignItems:"center",width:"100%",cursor:arguments.length>0&&void 0!==arguments[0]&&arguments[0]?"default":"pointer"}}getHeaderStyle(){return{fontWeight:Z.a.fontWeight.medium,fontSize:18,borderBottom:"1px solid ".concat(this.theme.regularDividerColor),paddingBottom:6,marginBottom:12,display:"flex",alignItems:"center"}}getTitleStyle(){return{fontSize:14,marginRight:8,flexGrow:1}}getRadioTitleStyle(){return{marginTop:8,marginBottom:4}}}Ir.captionStyle={marginTop:4,width:"85%"};var Fr=Object(g.injectIntl)(Ir),jr=a("gND8"),xr=a("KWgd"),Br=a("RBMm");function Ar(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Rr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ar(Object(a),!0).forEach((function(t){Lr(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ar(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Lr(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Ur extends A.a{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:Jn.a},this.handleSelectChange=e=>{const{label:t}=this.getItemLabelAndCaption(e);if(this.props.confirm){const a=()=>{this.props.onChange(e)};d.showDialog({showCancel:!0,keepFocus:!1,message:r.a.createElement(g.FormattedMessage,{id:"languagePicker.changeLanguage.confirmationMessage",defaultMessage:"Are you sure you want to update the language to {language}?",values:{language:t}}),items:[{label:r.a.createElement(g.FormattedMessage,{id:"languagePicker.changeLanguage.updateButton.label",defaultMessage:"Update"}),color:"red",onAccept:a}]})}else this.props.onChange(e)}}renderComponent(){const{device:e}=this.environment;if(!e.isMobile)return r.a.createElement(cr.a,{popupType:cr.a.PopupType.Popup,buttonPopupStore:this.stores.buttonPopupStore,renderOrigin:e=>r.a.createElement(en.a,Object.assign({style:{marginLeft:-8,paddingLeft:8,paddingRight:8}},e),this.getItemLabelAndCaption(this.props.currentLocale).label,be.a.chevronDown({width:10,marginLeft:4,fill:this.theme.lightIconColor})),placementToOrigin:Br.b.Bottom,alignmentToOrigin:Br.a.Start,render:e=>{let t;t="on"===Fe.default.getGroup(this.environment,"polyglot")?[...xr.a,...xr.b]:xr.a;const a=[{key:"languages",render:e=>r.a.createElement(ut.a,Object.assign({},e,{topBorder:0!==e.index})),items:t.map(t=>({key:t,render:e=>this.getItem(t,e.focused,e),action:()=>{this.handleSelect(t),e.close()}}))}],n={menuType:lt.b.MenuType.Popup,width:216};return r.a.createElement(lt.b,Object.assign({className:Qn.D},n),r.a.createElement(ct.a,{type:ct.a.Type.Vertical,initialFocus:void 0,sections:a}))}})}renderItem(e){return r.a.createElement(dt.a,Object.assign({},e.props,{title:r.a.createElement("div",{style:{display:"flex",alignItems:"center"}},r.a.createElement("div",{style:Rr({},e.style,{marginRight:0})},e.label)),caption:e.caption&&r.a.createElement("span",{style:{color:this.theme.mediumTextColor}},e.caption),shouldWrapCaption:!0}))}handleSelect(e){this.props.currentLocale!==e&&this.handleSelectChange(e)}getItemLabelAndCaption(e){var t;return{"en-US":{label:"English",caption:(t=this.props.intl).formatMessage({defaultMessage:"English (US)",id:"languagePicker.captions.englishUS"})},"ko-KR":{label:"한국어",caption:t.formatMessage({defaultMessage:"Korean",id:"languagePicker.captions.koreanKo"})},"zh-CN":{label:"简体中文",caption:t.formatMessage({defaultMessage:"Simplified Chinese",id:"languagePicker.captions.chineseS"})},"zh-TW":{label:"繁體中文",caption:t.formatMessage({defaultMessage:"Traditional Chinese",id:"languagePicker.captions.chineseT"})},"ja-JP":{label:"日本語",caption:t.formatMessage({defaultMessage:"Japanese",id:"languagePicker.captions.japaneseJa"})},"es-ES":{label:"Español",caption:t.formatMessage({defaultMessage:"Spanish (Spain)",id:"languagePicker.captions.spanishEs"})},"es-419":{label:"Español (Latinoamérica)",caption:t.formatMessage({defaultMessage:"Spanish (Latin America)",id:"languagePicker.captions.spanishLatam"})},"pt-BR":{label:"Português",caption:t.formatMessage({defaultMessage:"Portuguese (Brazil)",id:"languagePicker.captions.portugueseBr"})},"fr-FR":{label:"Français",caption:t.formatMessage({defaultMessage:"French",id:"languagePicker.captions.frenchFr"})}}[e]}getItem(e,t,a){return this.renderItem(Rr({},this.getItemLabelAndCaption(e),{focused:t,props:a}))}}var _r=Object(g.injectIntl)(Ur),Wr=a("h2IJ");class Nr extends A.a{renderComponent(){return r.a.createElement("div",{style:this.getSettingsOptionStyle()},r.a.createElement("div",{style:{display:"flex",alignItems:"flex-start",width:"100%"}},r.a.createElement("div",{style:{flex:1}},r.a.createElement(_r,{confirm:!0,onChange:async e=>{const t=await l.setLocale(this.environment,{locale:e});"success"===t.type?(Wr.a.set("preferredLocale",e),await h.transactionQueue.drain(),window.location.reload(!0)):d.showError(t)},currentLocale:this.props.locale}),r.a.createElement(ue.a,{isSmall:!0,isMultiline:!0,style:{width:"80%"}},r.a.createElement(g.FormattedMessage,{id:"languageSettings.languageSwitcher.subtitle",defaultMessage:"Choose a language you'd like to use with Notion."})))))}getSettingsOptionStyle(){const{device:e,WindowSizeStore:t}=this.environment;return{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%",height:"auto",paddingLeft:e.isMobile?t.state.paddingLeftCSS:0,paddingRight:e.isMobile?t.state.paddingRightCSS:0}}}var qr=Nr,Vr=a("Agvv");class zr extends A.a{constructor(){super(...arguments),this.handleStartOfWeekToggle=()=>{const e=this.getLanguageRegionSettingsState();if(!e)return;const{startDayOfWeek:t}=e;(1===t?_.e:_.d)(this.environment)}}renderComponent(){return J.a.state.online?this.renderSettings():this.renderOfflineMessage()}renderOfflineMessage(){return r.a.createElement(z.a,null,r.a.createElement(ue.a,{isSmall:!0,style:{textAlign:"center"}},r.a.createElement(g.FormattedMessage,{defaultMessage:"Please go online to manage your language and region.",id:"languageSettings.offline.message"})))}renderSettings(){const{currentUserSettingsStore:e}=p.default.state;if(!e)return;const t=this.getLanguageRegionSettingsState();if(!t)return;const{locale:a,startDayOfWeek:n}=t;return r.a.createElement(z.a,null,r.a.createElement(H.a,{large:!0,divider:"full"},r.a.createElement(g.FormattedMessage,{id:"languageSettings.languageSection.title",defaultMessage:"Language & region"})),r.a.createElement(qr,{locale:a,userSettingsStore:e}),r.a.createElement(R.a,{size:24}),r.a.createElement(ge.a,{onClick:this.handleStartOfWeekToggle,startDayOfWeek:n}))}getLanguageRegionSettingsState(){const{currentUserSettingsStore:e}=p.default.state;if(!e)return;const t=e.getValue();if(!t||!t.settings)return;const{settings:a}=t;return{locale:a.preferred_locale||Vr.a,startDayOfWeek:void 0===a.start_day_of_week?Object(M.H)():a.start_day_of_week}}}var Hr=Object(g.injectIntl)(zr),Gr=a("ty0h"),Qr=a("IoOo");function Yr(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Zr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Yr(Object(a),!0).forEach((function(t){Xr(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Yr(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Xr(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Kr extends A.a{constructor(){super(...arguments),this.lastSpaceSettingsModalStoreOpen=!1,this.storeTypes={spaceBasicSettingsStore:k,spaceProfileSettingsStore:w,securitySettingsStore:T,spaceSecuritySamlSettingsStore:x},this.renderContent=()=>{const e={profile:this.renderProfile,notifications:this.renderNotifications,settings:this.renderSettings,members:this.renderMembers,plans:this.renderPlans,billing:this.renderBilling,appearance:this.renderAppearance,subscription:this.renderSubscription,credit:this.renderCredit,connected_apps:this.renderConnectedApps,bots:this.renderBotSettings,security_saml:this.renderSecuritySaml,language_and_region:this.renderLanguageAndRegion};return r.a.createElement(Tt.a,{capture:!0,allowEsc:!0,render:t=>r.a.createElement(Pt.a,{capture:!0,ignoreBlockSelection:!0,restoreSelection:!0,focusOffscreenInput:!1,render:()=>r.a.createElement(Xe,Object.assign({sidebar:this.renderSidebar(),sidebarStyle:{width:200}},t),e[B.a.state.currentTab]())})})},this.renderProfile=()=>r.a.createElement(Ge,{isEducationPlan:fe.y(pt.default.state.data),spaceProfileSettingsStore:this.stores.spaceProfileSettingsStore}),this.renderLanguageAndRegion=()=>r.a.createElement(Hr,null),this.renderNotifications=()=>r.a.createElement(z.a,null,r.a.createElement(kt.a,null)),this.renderSettings=()=>r.a.createElement(wt,{spaceStore:this.props.spaceStore,spaceBasicSettingsStore:this.stores.spaceBasicSettingsStore}),this.renderMembers=()=>r.a.createElement(Ot.a,{store:this.props.spaceStore}),this.renderPlans=()=>{const{data:e}=pt.default.state;if(e)return r.a.createElement(za,{spaceStore:this.props.spaceStore,data:e})},this.renderBilling=()=>{const{data:e}=pt.default.state,t=fe.p(e);return e&&"subscribed_admin"===e.type&&t?r.a.createElement(En,{spaceStore:this.props.spaceStore,subscriptionData:e,customerData:t}):e&&"unsubscribed_admin"===e.type?r.a.createElement(Cn,{spaceStore:this.props.spaceStore,data:e}):void 0},this.renderAppearance=()=>r.a.createElement(z.a,null,r.a.createElement(Gr.a,null)),this.renderSubscription=()=>r.a.createElement(z.a,null,r.a.createElement(Qr.a,null)),this.renderCredit=()=>{const{data:e}=pt.default.state;if(e)return r.a.createElement(Rn,{data:e})},this.renderConnectedApps=()=>r.a.createElement(Hn,null),this.renderBotSettings=()=>{const{spaceStore:e,userStore:t}=this.props;return r.a.createElement(Sr,{spaceStore:e,userStore:t})},this.renderSecuritySaml=()=>r.a.createElement(Fr,{spaceStore:this.props.spaceStore,securitySettingsStore:this.stores.securitySettingsStore,samlConfigStore:this.stores.spaceSecuritySamlSettingsStore}),this.handleModalOpen=()=>{v.e(this.environment)},this.handleModalDismiss=()=>this.attemptCloseCurrentTab(()=>{B.a.setState(Zr({},B.a.state,{open:!1}))})}willMount(e){super.willMount(e);const{spaceStore:t}=this.props,{securitySettingsStore:a}=this.stores,n=a.getValueForSpace(t);n&&a.setState(n)}willMountOrUpdate(e){super.willMountOrUpdate(e);const{open:t}=B.a.state,a=B.a.state;this.lastSpaceSettingsModalStoreOpen===t&&s.a.isEqual(this.lastSpaceSettingsStoreState,a)||t&&m.jd(this.environment,{tab:a.currentTab}),this.lastSpaceSettingsModalStoreOpen=t,this.lastSpaceSettingsStoreState=s.a.clone(a)}renderComponent(){const{open:e}=B.a.state;return r.a.createElement(L.a,{open:e,innerStyle:{width:960,maxWidth:"calc(100vw - 100px)",height:"calc(100vh - 100px)",overflow:"hidden",borderRadius:3,maxHeight:695},onOpen:this.handleModalOpen,onDismiss:this.handleModalDismiss,render:this.renderContent,className:Qn.Ab})}renderSidebar(){const{spaceStore:e}=this.props,{data:t}=pt.default.state,a=Object(pe.g)(this.environment),n=e.canAdmin()&&"has-alpha-api"===Fe.default.getGroup(this.environment,"alpha-api"),i="on"===Fe.default.getGroup(this.environment,"lion-tamer"),s=fe.z(t);return r.a.createElement("div",{style:Kr.sidebarStyle},r.a.createElement("div",null,r.a.createElement("div",{style:this.getSidebarHeader()},a&&a.email||r.a.createElement(g.FormattedMessage,{id:"spaceSettings.sidebar.personalSettingsSection.title",defaultMessage:"Me"})),this.renderTabButton("profile"),this.renderTabButton("notifications"),this.renderTabButton("connected_apps"),i&&this.renderTabButton("language_and_region"),this.renderTabButton("appearance"),t&&t.creditEnabled&&this.renderTabButton("credit"),r.a.createElement(R.a,{size:18,isHidden:!0}),r.a.createElement("div",{style:this.getSidebarHeader()},r.a.createElement(g.FormattedMessage,{id:"spaceSettings.sidebar.workspaceSettingsSection.title",defaultMessage:"Workspace"})),this.renderTabButton("settings"),e.canRead()&&this.renderTabButton("members"),e.canRead()&&this.renderTabButton("plans"),e.canAdmin()&&t&&("subscribed_admin"===t.type||"unsubscribed_admin"===t.type)&&!s&&this.renderTabButton("billing"),s&&this.renderTabButton("subscription"),e.canAdmin()&&this.renderTabButton("security_saml"),n&&this.renderTabButton("bots"),r.a.createElement(R.a,{size:21,style:Kr.dividerStyle}),e.canRead()&&r.a.createElement(jr.a,{source:"settings"})))}renderTabButton(e){const t=B.a.state.currentTab===e,a=B.b[e](this.environment),n=B.c[e]();return r.a.createElement(Gn.a,{hovered:t,style:Zr({display:"flex",alignItems:"center",padding:"5px 15px"},t&&{fontWeight:Z.a.fontWeight.semibold}),onClick:t=>{this.attemptCloseCurrentTab(()=>{B.a.setState(Zr({},B.a.state,{currentTab:e})),m.Te(this.environment,{tab:e})})}},r.a.createElement("div",{style:this.getIconWrapStyle()},a),r.a.createElement(ue.a,null,n))}async attemptCloseCurrentTab(e){const{spaceStore:t}=this.props,{spaceProfileSettingsStore:a}=this.stores,{currentUserStore:n,currentUserSettingsStore:i}=p.default.state;if(!n||!i)throw new Error("No user or settings store.");const o=r.a.createElement(g.FormattedMessage,{id:"spaceSettings.closeSettingsDialog.confirmationMessage",defaultMessage:"Do you want to update your changes?"}),c=r.a.createElement(g.FormattedMessage,{id:"spaceSettings.closeSettingsDialog.confirmationButton.label",defaultMessage:"Yes",description:"Label for button that appears below the question, 'Do you want to update your changes?' to confirm that the user would like to apply updates."}),{currentTab:u}=B.a.state;if("profile"===u){if(!s.a.isEqual(a.state,a.getValueForUser(n,i))){const{givenName:t,familyName:n,profilePhoto:s,startDayOfWeek:l}=a.state;return d.showDialog({message:o,showCancel:!0,keepFocus:!0,items:[{label:r.a.createElement(g.FormattedMessage,{id:"spaceSettings.closeSettingsDialog.updateSettingsButton.label",defaultMessage:"Update"}),color:"blue",onAccept:()=>{Q.createAndCommit(this.environment,e=>{const{currentUserStore:a}=p.default.state;if(a&&y({userStore:a,data:{givenName:t,familyName:n,profilePhoto:s},transaction:e}),i){i.getSettings().start_day_of_week!==l&&Object(_.f)({userSettingsStore:i,data:{start_day_of_week:l},transaction:e})}}),e()}}],handleCancel:()=>{e()}}),!0}e()}else if("settings"===u&&t.canEdit()){const{spaceBasicSettingsStore:a}=this.stores;if(!s.a.isEqual(a.state,a.getValueForSpace(t))){return await d.confirmUserAction({message:o,acceptLabel:c})?(S.A({environment:this.environment,spaceStore:this.props.spaceStore,spaceBasicSettingsStore:a}),e()):e(),!0}e()}else if("security_saml"===u&&t.canAdmin()){const{securitySettingsStore:a,spaceSecuritySamlSettingsStore:n}=this.stores,r=!s.a.isEqual(a.state,a.getValueForSpace(t)),i=await n.getValueForSpace(this.environment,t),u=(n.state.emailDomains.length>0||"enterprise"===fe.i(this.environment))&&(!n.state.id||n.state.id===t.id)&&!s.a.isEqual(n.state,i);if(r||u){if(await d.confirmUserAction({message:o,acceptLabel:c})){const{disablePublicAccess:t,disableGuests:i,disableMoveToSpace:s,disableExport:o,disableSpacePageEdits:c,disablePublicAccessRequests:p}=a.state;if(r&&Q.createAndCommit(this.environment,e=>{S.y({environment:this.environment,disablePublicAccess:t,disableGuests:i,disableMoveToSpace:s,disableExport:o,disableSpacePageEdits:c,disablePublicAccessRequests:p,transaction:e,spaceStore:this.props.spaceStore})}),u){const{state:e}=n,t=await l.addSamlConfigToSpace(this.environment,{spaceId:this.props.spaceStore.id,status:e.status,useMetadataUrl:e.useMetadataUrl,idpMetadataUrl:e.idpMetadataUrl,idpMetadata:e.idpMetadata,createAccount:e.createAccount});"failed"===t.type&&d.showError(t)}e()}else e();return!0}e()}else e();return!1}getSidebarHeader(){return{letterSpacing:"0.03em",textTransform:"uppercase",fontSize:11,lineHeight:1,marginBottom:1,color:this.theme.mediumTextColor,fontWeight:Z.a.fontWeight.medium,padding:"5px 15px",textOverflow:"ellipsis",overflow:"hidden"}}getIconWrapStyle(){return{width:20,height:20,marginRight:8,color:this.theme.regularIconColor,fill:this.theme.regularIconColor}}}Kr.dividerStyle={paddingLeft:14,paddingRight:14},Kr.sidebarStyle={display:"flex",flexDirection:"column",height:"100%",paddingTop:10,paddingBottom:12,justifyContent:"space-between"};t.default=Kr},KEFq:function(e,t,a){"use strict";a.r(t);a("ioFf"),a("rGqo");var n=a("q1tI"),r=a.n(n),i=a("wldR"),s=a("w4oV"),o=a("/6eU"),l=a("MeYt"),c=a("mF3+"),d=a("gyLq"),u=a("Sb6f"),p=a("zmp8"),m=a("yNyh"),h=a("d9nj"),g=a("Ng05"),f=a("J9+s"),b=a("5zFd"),y=a("SR/M"),S=a("IULH");function v(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function E(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?v(Object(a),!0).forEach((function(t){M(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):v(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function M(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class C extends i.a{renderComponent(){const{intl:e,question:t}=this.props,a={setup_trial:r.a.createElement(f.FormattedMessage,{id:"enterpriseContactModalQuestionSelect.question.setup_trial",defaultMessage:"Setup an enterprise trial"}),live_demo:r.a.createElement(f.FormattedMessage,{id:"enterpriseContactModalQuestionSelect.question.live_demo",defaultMessage:"Schedule a live demo"}),plan_help:r.a.createElement(f.FormattedMessage,{id:"enterpriseContactModalQuestionSelect.question.plan_help",defaultMessage:"Need help choosing a plan"}),other:r.a.createElement(f.FormattedMessage,{id:"enterpriseContactModalQuestionSelect.question.other",defaultMessage:"Other"})},n={menuTitle:e.formatMessage({defaultMessage:"Your question",id:"enterpriseContactModal.yourQuestion.title"}),items:["setup_trial","live_demo","plan_help","other"],width:280,getKey:e=>e,selectedItem:t,originGap:4,onSelect:e=>{this.props.onSelect(e)},renderItem:e=>r.a.createElement(y.a,Object.assign({title:a[e.key]},e)),renderOrigin:e=>r.a.createElement(S.a,{isLarge:!0,onClick:t=>e.onClick(t),style:E({},this.getInputStyle(),{},this.props.invalid&&{border:"1px solid ".concat(p.f.red)})},r.a.createElement("div",{style:{display:"flex",alignItems:"center",color:t?this.theme.regularTextColor:this.theme.lightTextColor}},t?a[t]:r.a.createElement(f.FormattedMessage,{defaultMessage:"Select question",id:"enterpriseContactModal.selectQuestion.label"})),c.a.expand({width:10,fill:this.theme.lightIconColor}))};return r.a.createElement(b.a,Object.assign({key:"onboarding"},n))}getInputStyle(){const{device:e}=this.environment;return E({backgroundColor:this.theme.whiteButtonBackground,height:31},e.isMobile&&{height:42},{padding:"2px 10px",display:"flex",alignItems:"center",justifyContent:"space-between",borderRadius:3,border:0,transition:"box-shadow 0.3s ease",boxShadow:"0 0 0 1px ".concat(this.theme.outlineButtonBorder),background:this.theme.buttonBackground})}}var w=Object(f.injectIntl)(C),O=a("LEzx");class k extends O.a{getInitialState(){return{step:"initial"}}}var P=k,T=a("5Nka"),D=a("NOLh"),I=a("VyA+"),F=a("LvDl"),j=a.n(F),x=a("vl8/"),B=a("y6Dp"),A=a("GVKY");function R(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function L(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?R(Object(a),!0).forEach((function(t){U(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):R(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function U(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const _=Object(f.defineMessages)({additionalFeedbackPlaceholder:{id:"enterpriseContactModal.additionalFeedback.placeholder",defaultMessage:"What would you like to learn more about?"}});class W extends i.a{constructor(){super(...arguments),this.storeTypes={store:P},this.renderMenu=()=>r.a.createElement("div",{style:this.getContainerStyle()},this.renderCancel(),r.a.createElement(d.a,{style:this.getInnerContainerStyle(),alignItems:"center",alignContent:"center"},this.renderStep())),this.renderInitial=()=>{const{invalidField:e}=this.stores.store.state;if(s.a.state.open)return r.a.createElement("div",{style:L({},this.getSlideUpStyle(),{padding:20})},c.a.speechBubbleThin({width:"100%",height:24}),r.a.createElement("div",{style:{fontSize:14,fontWeight:u.a.fontWeight.semibold,paddingTop:6,paddingBottom:4}},r.a.createElement(f.FormattedMessage,{id:"enterpriseContactModal.initial.header",defaultMessage:"Get in touch with sales"})),r.a.createElement("div",{style:{fontSize:12,color:this.theme.mediumTextColor,width:200,margin:"0 auto"}},r.a.createElement(f.FormattedMessage,{id:"enterpriseContactModal.initial.caption",defaultMessage:"We'll work with you on your setup and help you land on the best plan."})),r.a.createElement("div",{style:L({},this.getLabelStyle(),{marginTop:24})},r.a.createElement(f.FormattedMessage,{id:"enterpriseContactModal.initial.nameLabel",defaultMessage:"Your name"})),r.a.createElement(m.b,{focusInitial:!0,value:this.getName(),placeholder:"Ada Lovelace",style:L({marginRight:4},this.getInputStyle(),{},"name"===e&&this.getInvalidInputStyle()),onChange:e=>{s.a.setState(L({},s.a.state,{open:!0,name:void 0})),this.stores.store.setState(L({},this.stores.store.state,{name:e.target.value}))}}),r.a.createElement("div",{style:this.getLabelStyle()},r.a.createElement(f.FormattedMessage,{id:"enterpriseContactModal.initial.emailLabel",defaultMessage:"Your work email"})),r.a.createElement(m.b,{value:this.getEmail(),placeholder:"ada@lovelace.app",type:"email",style:L({marginRight:4},this.getInputStyle(),{},"email"===e&&this.getInvalidInputStyle()),onChange:e=>{s.a.setState(L({},s.a.state,{open:!0,email:void 0})),this.stores.store.setState(L({},this.stores.store.state,{email:e.target.value}))}}),r.a.createElement("div",{style:this.getLabelStyle()},r.a.createElement(f.FormattedMessage,{id:"enterpriseContactModal.initial.companySizeLabel",defaultMessage:"Company size"})),r.a.createElement(d.a,null,this.getCompanySizeButtonData().map(e=>{let{type:t,message:a,style:n}=e;return r.a.createElement(h.a,{isLightGray:!0,isLarge:!0,style:L({},this.getBaseButtonStyle(),{},this.stores.store.state.companySize===t&&this.getSelectedButtonStyle(),{},n),onClick:()=>{this.stores.store.setState(L({},this.stores.store.state,{companySize:t}))}},a)})),r.a.createElement("div",{style:this.getLabelStyle()},r.a.createElement(f.FormattedMessage,{id:"enterpriseContactModal.initial.questionLabel",defaultMessage:"Your question"})),r.a.createElement(w,{question:this.stores.store.state.question,invalid:"question"===e,onSelect:e=>{this.stores.store.setState(L({},this.stores.store.state,{question:e,step:"other"===e?"additional_input":"initial"}))}}),r.a.createElement(m.b,{textarea:!0,style:this.getTextAreaStyle(),focus:"additional_input"===this.stores.store.state.step,value:this.stores.store.state.additionalFeedback,placeholder:x.default.formatMessage(_.additionalFeedbackPlaceholder),onChange:e=>{this.stores.store.setState(L({},this.stores.store.state,{additionalFeedback:e.target.value}))}}))},this.renderCancel=()=>r.a.createElement(l.a,{onClick:this.handleCancel,style:this.getCancelStyle(),hoveredStyle:{background:this.theme.buttonPressedBackground}},c.a.closeSmall({width:14,fill:this.theme.mediumTextColor})),this.renderThanks=()=>r.a.createElement("div",null,r.a.createElement("img",{style:{width:165,height:80},src:T.a.images.feedbackThankYouPng}),r.a.createElement("div",{style:this.getThanksHeaderStyle()},r.a.createElement(f.FormattedMessage,{id:"enterpriseContactModal.thanks.caption",defaultMessage:"We've received your inquiry and will be contacting you via email shortly."}))),this.handleCancel=()=>{s.a.setState({open:!1})}}renderComponent(){return r.a.createElement(o.a,{preventHideChildrenWhileOpening:!0,open:s.a.state.open,render:this.renderMenu,onDismiss:this.handleCancel})}renderStep(){const{step:e}=this.stores.store.state;return r.a.createElement(r.a.Fragment,null,r.a.createElement(D.a,{isVisible:"initial"===e||"additional_input"===e,enterAnimationStyle:{opacity:1},exitAnimationStyle:{opacity:0},render:()=>r.a.createElement(I.a,{capture:!0,onBackspace:j.a.identity,onLeft:j.a.identity,onRight:j.a.identity,onSelectAll:j.a.identity,onRedo:j.a.identity,onUndo:j.a.identity,onCut:j.a.identity,onCopy:j.a.identity,onPaste:j.a.identity,onKeypress:j.a.identity,onDelete:j.a.identity,onTab:j.a.identity},this.renderInitial())}),r.a.createElement(D.a,{isVisible:"thanks"===e,animationStyle:this.getAnimationStyle("thanks"===e),enterAnimationStyle:this.getEnterExitAnimationStyle(),exitAnimationStyle:this.getEnterExitAnimationStyle(),render:this.renderThanks}),r.a.createElement(D.a,{isVisible:"initial"===e||"additional_input"===e,enterAnimationStyle:{opacity:1},exitAnimationStyle:{opacity:0},render:()=>r.a.createElement(g.a,{isLarge:!0,style:{marginTop:17,width:284,position:"absolute",bottom:20},onClick:()=>{const e=this.getInvalidField();if(e){const{question:t}=this.stores.store.state;this.stores.store.setState(L({},this.stores.store.state,{step:"initial",invalidField:e,question:"other"===t?void 0:t}))}else this.stores.store.setState(L({},this.stores.store.state,{invalidField:void 0,step:"thanks"})),s.a.state.open&&B.Lb(this.environment,L({email:s.a.state.email,name:s.a.state.name},this.stores.store.state)),j.a.delay(()=>{s.a.reset(),j.a.delay(()=>{this.stores.store.reset()},1e3)},2e3)}},r.a.createElement(f.FormattedMessage,{id:"enterpriseContactModal.initial.sendLabel",defaultMessage:"Send"}))}))}getName(){if(s.a.state.open)return this.stores.store.state.name||s.a.state.name}getEmail(){if(s.a.state.open)return this.stores.store.state.email||s.a.state.email}getInvalidField(){const e=this.getEmail(),t=this.getName(),{question:a,companySize:n}=this.stores.store.state;return t?e&&A.b(e,"email")?n?a?void 0:"question":"company_size":"email":"name"}getCompanySizeButtonData(){return[{type:"1_100",message:r.a.createElement(f.FormattedMessage,{id:"enterpriseContactModal.initial.1_100Label",defaultMessage:"1-100"})},{type:"101_1000",message:r.a.createElement(f.FormattedMessage,{id:"enterpriseContactModal.initial.101_1000Label",defaultMessage:"101-1,000"}),style:{marginLeft:8,marginRight:8}},{type:"1001+",message:r.a.createElement(f.FormattedMessage,{id:"enterpriseContactModal.initial.1000PlusLabel",defaultMessage:"1,001+"})}]}getThanksHeaderStyle(){return{color:this.theme.regularTextColor,fontWeight:u.a.fontWeight.semibold,fontSize:14}}getContainerStyle(){return{background:this.theme.popoverBackground,borderRadius:5,boxShadow:this.theme.mediumBoxShadow}}getCancelStyle(){return{position:"absolute",top:"10px",right:"10px",background:this.theme.buttonHoveredBackground,borderRadius:"100%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",zIndex:10}}getInnerContainerStyle(){return{width:320,height:470,overflow:"hidden",position:"relative",padding:20,cursor:"default",textAlign:"center",justifyContent:"center"}}getLabelStyle(){return{marginTop:17,fontSize:12,color:this.theme.mediumTextColor,fontWeight:u.a.fontWeight.medium,lineHeight:"135%",marginBottom:4,textAlign:"left"}}getInputStyle(){return{backgroundColor:this.theme.whiteButtonBackground,height:31}}getInvalidInputStyle(){return{border:"1px solid ".concat(p.f.red)}}getAnimationStyle(e){return{opacity:e?1:0,scale:e?1:.96}}getEnterExitAnimationStyle(){return{opacity:0,scale:.96}}getBaseButtonStyle(){return{border:"1px solid #E7E6E5",flexGrow:1,justifyContent:"center"}}getSelectedButtonStyle(){return{color:p.f.blue,border:"1px solid ".concat(p.f.blue)}}getSlideUpStyle(){const{step:e}=this.stores.store.state;return{position:"absolute",transition:"transform 200ms ease",transform:"initial"===e?"translateY(153px)":"translateY(-180px)"}}getTextAreaStyle(){return{width:"100%",background:this.theme.popoverBackground,display:"block",padding:"7px 10px",height:310,marginTop:17,marginBottom:17,transition:"opacity 200ms ease-in",opacity:"additional_input"===this.stores.store.state.step?1:.001}}}t.default=W},NcKA:function(e,t,a){"use strict";a.r(t);var n=a("q1tI"),r=a.n(n),i=a("wldR"),s=a("RuPz"),o=a("Ripq"),l=a("gbGO"),c=a("WgIs"),d=a("2Y+N"),u=a("HTHG"),p=a("SR/M"),m=a("Oy36"),h=a("i3uR"),g=a("wXH4"),f=a("frzs"),b=a("QcDD"),y=a("nPEg"),S=a("J9+s"),v=a("qX+M");class E extends i.a{constructor(){super(...arguments),this.renderPopup=()=>{const{device:e}=this.environment,t=s.a.state;if(!t.open)return;const{currentUserRootStore:a}=b.default.state;if(!a)return;const n=u.j(a),i=[];for(const s of n){const a=s.getSpaceStore();if(a){const n=Object(v.getSpaceName)(this.environment,a),l=Object(v.getSpaceIcon)(this.environment,a);i.push({key:s.id,action:async()=>{await o.c({environment:this.environment,store:t.store,spaceStore:a,spaceViewStore:s,isPrivate:!0})},render:t=>r.a.createElement(p.a,Object.assign({title:n,icon:r.a.createElement(m.a,{icon:l,isEmptyPage:!1,title:n,size:e.isMobile?24:20,disabled:!0})},t))})}}const h=[{key:"spaces",render:t=>r.a.createElement(d.a,Object.assign({title:e.isMobile?void 0:r.a.createElement(S.FormattedMessage,{defaultMessage:"Choose a workspace",id:"duplicatePagePopup.chooseWorkspace.menuItem.title"}),isTitleUppercase:!0},t)),items:i},{key:"logout",render:e=>r.a.createElement(d.a,Object.assign({},e,{topBorder:!0})),items:[{key:"logout",action:()=>f.logout(this.environment),render:e=>{const{currentUserStore:t}=b.default.state;let a="";if(t){const e=t.getValue();e&&(a=e.email)}return r.a.createElement(p.a,Object.assign({caption:r.a.createElement(S.FormattedMessage,{defaultMessage:"Log out ({email})",id:"duplicatePagePopup.buttonMenuItem.logoutButton.label",values:{email:a}})},e))}}]}];let g;return g=e.isMobile?{menuType:l.b.MenuType.Modal,title:r.a.createElement(S.FormattedMessage,{defaultMessage:"Choose a workspace",id:"duplicatePagePopup.choooseWorkspaceMobileMenu.title"}),right:r.a.createElement(y.CancelMenuText,null),onClickRight:o.a}:{menuType:l.b.MenuType.Popup},r.a.createElement(l.b,Object.assign({},g),r.a.createElement(c.a,{type:c.a.Type.Vertical,sections:h,initialFocus:1}))}}renderComponent(){const{device:e}=this.environment;return r.a.createElement(g.c,{popupType:e.isMobile?h.a.PopupType.SlideUp:h.a.PopupType.Popup,open:s.a.state.open,render:this.renderPopup,originGap:8,onDismiss:o.a,originRect:s.a.state.originRect,enableRounding:!0})}}t.default=E},P9PB:function(e,t,a){"use strict";a.r(t);a("ioFf"),a("rGqo");var n=a("q1tI"),r=a.n(n),i=a("LvDl"),s=a.n(i),o=a("wldR"),l=a("D2XV"),c=(a("UNSI"),a("DUpR"),a("BFWj")),d=a.n(c),u=a("mKX5"),p=a("5zFd"),m=a("lEhh"),h=(a("pIFo"),a("Vd3H"),a("hfHo"));const g=h.default.tz.names().map(e=>{const t=h.default.tz(e);return{name:e,displayName:"GMT".concat(t.format("Z")," - ").concat(e.replace(/_/g," ")," (").concat(t.format("z"),")"),utcOffset:t.utcOffset()}}).sort((e,t)=>e.utcOffset-t.utcOffset);g.map(e=>e.displayName),s.a.memoize(e=>{if(0===e)return h.default.utc("1990-12-28").zoneAbbr();const t=g.find(t=>e===t.utcOffset);return t?t.name:void 0});var f,b,y=a("LEzx");!function(e){e.StartDate="startDate",e.StartTime="startTime",e.EndDate="endDate",e.EndTime="endTime"}(f||(f={})),function(e){e.InvalidDate="Invalid date",e.InvalidTime="Invalid time",e.InvalidRange="Invalid range"}(b||(b={}));class S extends y.a{getInitialState(){return{focus:f.StartDate,inputIsFocused:!1,inputTemporaryValue:{startDate:void 0,startTime:void 0,endDate:void 0,endTime:void 0},error:{startDate:void 0,startTime:void 0,endDate:void 0,endTime:void 0}}}}var v=S,E=a("i3uR"),M=a("yNyh"),C=a("LeVO"),w=a("nFzZ"),O=a("mjq6"),k=a("D8Ld"),P=a("SR/M"),T=a("2Y+N"),D=a("hU3F"),I=a("gbGO"),F=a("dXb3"),j=a("WgIs"),x=a("zTdN"),B=a("mF3+"),A=a("ikHm"),R=a("MHAS"),L=a("awNq"),U=a("O+wX"),_=a("rGsA"),W=a("y6Dp"),N=a("zmp8"),q=a("lCCU"),V=a("KTXS"),z=a("7KuZ"),H=a("aEEb"),G=a("J9+s"),Q=a("nPEg"),Y=a("0CAA"),Z=a("lpTC"),X=a("T8dS"),K=a("QgQJ");function J(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function $(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?J(Object(a),!0).forEach((function(t){ee(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):J(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function ee(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class te extends o.a{constructor(){super(...arguments),this.storeTypes={store:v,timezoneQuery:D.a.of("")},this.renderNavbarElement=e=>{let{onPreviousClick:t,onNextClick:a}=e;const{device:n}=this.environment;return r.a.createElement("div",{style:n.isMobile?te.mobileNavStyle:te.desktopNavStyle},r.a.createElement(q.a,{mobileFeedback:n.isMobile,icon:B.a.chevronLeft,onClick:()=>t()}),r.a.createElement(q.a,{mobileFeedback:n.isMobile,icon:B.a.chevronRight,onClick:()=>a()}))},this.handleDateFormatChange=e=>{this.props.onChangeDateFormat(e)},this.handleTimeFormatChange=e=>{const t=this.getTimeFormatOptions()[e];this.props.onChangeTimeFormat(t)},this.handleChangeReminder=e=>{const t=this.getDateValue();e?l.X(e)?this.props.onChangeValue($({},t,{reminder:e})):"datetime"!==t.type&&"datetimerange"!==t.type||this.props.onChangeValue($({},t,{reminder:e})):this.props.onChangeValue($({},t,{reminder:e})),W.ke(this.environment,{date:t,reminder:e})},this.handleInputChange=e=>{const{device:t}=this.environment,{store:a}=this.stores;a.setState($({},a.state,{inputTemporaryValue:$({},a.state.inputTemporaryValue,{[a.state.focus]:e.target.value||""})})),t.isAndroid&&this.handleInputBlur()},this.handleStartDateInputChange=()=>{const{inputTemporaryValue:e}=this.stores.store.state,t=e.startDate;if(!t)return;const a=this.parseInputDateValue(t);if(!a)return b.InvalidDate;const n=this.getDateValue();if(l.W(n)||l.Y(n)){const{newDate:e,currentMonth:t}=l.N({previous:n,updatedStartDate:a});this.applyValidDateState({newDate:e,currentMonth:t,resetField:f.StartDate})}else{const e=$({},n,{start_date:a}),t=l.L(e);this.applyValidDateState({newDate:e,currentMonth:t.start,resetField:f.StartDate})}},this.handleStartTimeInputChange=()=>{const{inputTemporaryValue:e}=this.stores.store.state,t=e.startTime;if(!t)return;const a=this.parseInputTimeValue(t);if(!a)return b.InvalidTime;const n=this.getDateValue();if(l.Y(n)){const{newDate:e,currentMonth:t}=l.O({previous:n,updatedStartTime:a});this.applyValidDateState({newDate:e,currentMonth:t,resetField:f.StartTime}),this.resetInputState(f.EndDate),this.resetInputState(f.EndTime)}else{const e=$({},n,{start_time:a}),t=l.L(e);this.applyValidDateState({newDate:e,currentMonth:t.start,resetField:f.StartTime})}},this.handleEndDateInputChange=()=>{const{inputTemporaryValue:e}=this.stores.store.state,t=e.endDate;if(!t)return;const a=this.parseInputDateValue(t);if(!a)return b.InvalidDate;const n=$({},this.getDateValue(),{end_date:a}),r=l.L(n);if(!r)return b.InvalidRange;this.applyValidDateState({newDate:n,currentMonth:r.end,resetField:f.EndDate})},this.handleEndTimeInputChange=()=>{const{inputTemporaryValue:e}=this.stores.store.state,t=e.endTime;if(!t)return;const a=this.parseInputTimeValue(t);if(!a)return b.InvalidTime;const n=$({},this.getDateValue(),{end_time:a}),r=l.L(n);if(!r)return b.InvalidRange;this.applyValidDateState({newDate:n,currentMonth:r.end,resetField:f.EndTime})},this.handleInputBlur=e=>{const{focus:t}=this.stores.store.state;let a=void 0;t===f.StartDate?a=this.handleStartDateInputChange():t===f.StartTime?a=this.handleStartTimeInputChange():t===f.EndDate?a=this.handleEndDateInputChange():t===f.EndTime&&(a=this.handleEndTimeInputChange()),a?this.stores.store.setState($({},this.stores.store.state,{error:$({},this.stores.store.state.error,{[t]:a})})):this.stores.store.setState($({},this.stores.store.state,{inputTemporaryValue:{startDate:void 0,startTime:void 0,endDate:void 0,endTime:void 0},inputIsFocused:!1,error:{startDate:void 0,startTime:void 0,endDate:void 0,endTime:void 0}}))},this.handleInputSubmit=()=>{const{focus:e}=this.stores.store.state;let t=void 0;e===f.StartDate?t=this.handleStartDateInputChange():e===f.StartTime?t=this.handleStartTimeInputChange():e===f.EndDate?t=this.handleEndDateInputChange():e===f.EndTime&&(t=this.handleEndTimeInputChange()),t?this.stores.store.setState($({},this.stores.store.state,{error:$({},this.stores.store.state.error,{[e]:t})})):this.stores.store.setState($({},this.stores.store.state,{inputTemporaryValue:{startDate:void 0,startTime:void 0,endDate:void 0,endTime:void 0},error:{startDate:void 0,startTime:void 0,endDate:void 0,endTime:void 0}}))},this.handleDayPickerDayClick=e=>{if(this.props.disabled)return;const t=s.a.cloneDeep(this.getDateValue()),{focus:a}=this.stores.store.state,n=Object(u.a)(e).locale(l.jb).format(l.ib);if("daterange"===t.type||"datetimerange"===t.type){const e=a===f.StartDate||a===f.StartTime?f.EndDate:f.StartDate;if(n===t[e===f.StartDate?"start_date":"end_date"])return void this.stores.store.setState($({},this.stores.store.state,{focus:e}));a===f.StartDate||a===f.StartTime?t.start_date=n:a!==f.EndDate&&a!==f.EndTime||(t.end_date=n);const r=l.K(t,l.m);if(r.end&&r.end.isBefore(r.start)){if("datetimerange"===t.type){const{start_date:e,start_time:a,end_date:n,end_time:r}=t;t.start_date=n,t.start_time=r,t.end_date=e,t.end_time=a}else{const{start_date:e,end_date:a}=t;t.start_date=a,t.end_date=e}this.stores.store.setState($({},this.stores.store.state,{focus:a===f.StartDate||a===f.StartTime?f.EndDate:f.StartDate}))}this.props.onChangeValue(t),this.resetInputState(a)}else t.start_date=n,this.props.onChangeValue(t),this.resetInputState(a)},this.handleDayPickerMonthChange=e=>{this.stores.store.setState($({},this.stores.store.state,{currentMonth:Object(u.a)(e)}))},this.handleEndDateControlChange=()=>{const e=this.getDateValue();if("datetimerange"===e.type){const t={type:"datetime",start_date:e.start_date,start_time:e.start_time,time_zone:e.time_zone,reminder:e.reminder};this.props.onChangeValue(t)}else if("daterange"===e.type){const t={type:"date",start_date:e.start_date,reminder:e.reminder};this.props.onChangeValue(t)}else if("datetime"===e.type){const t={type:"datetimerange",start_date:e.start_date,start_time:e.start_time,end_date:e.start_date,end_time:e.start_time,time_zone:e.time_zone,reminder:e.reminder};this.props.onChangeValue(t),this.stores.store.setState($({},this.stores.store.state,{focus:f.EndDate}))}else{const t={type:"daterange",start_date:e.start_date,end_date:e.start_date,reminder:e.reminder};this.props.onChangeValue(t),this.stores.store.setState($({},this.stores.store.state,{focus:f.EndDate}))}},this.handleAllDayChange=()=>{const e=this.getDateValue();if("date"===e.type){const t={type:"datetime",start_date:e.start_date,start_time:"00:00",time_zone:l.m,reminder:e.reminder&&l.k(e.reminder)};this.props.onChangeValue(t)}else if("daterange"===e.type){const t={type:"datetimerange",start_date:e.start_date,start_time:"00:00",end_date:e.end_date,end_time:"00:00",time_zone:l.m,reminder:e.reminder&&l.k(e.reminder)};this.props.onChangeValue(t)}else if("datetime"===e.type){const t={type:"date",start_date:e.start_date,reminder:e.reminder&&l.j(e.reminder)};this.props.onChangeValue(t)}else{const t={type:"daterange",start_date:e.start_date,end_date:e.end_date,reminder:e.reminder&&l.j(e.reminder)};this.props.onChangeValue(t)}},this.handleTimeZoneChange=e=>{const t=g.find(t=>t.displayName===e);if(!t)return;const a=t.name,n=this.getDateValue();if("datetime"===n.type||"datetimerange"===n.type){const e=$({},n,{time_zone:a});this.props.onChangeValue(e)}},this.handleStartInputDateFocus=()=>{const e=this.getDateValue(),t=l.K(e,l.m);this.stores.store.setState($({},this.stores.store.state,{focus:f.StartDate,inputIsFocused:!0,currentMonth:t.start}))},this.handleStartInputTimeFocus=()=>{const e=this.getDateValue(),t=l.K(e,l.m);this.stores.store.setState($({},this.stores.store.state,{focus:f.StartTime,inputIsFocused:!0,currentMonth:t.start}))},this.handleEndInputDateFocus=()=>{const e=this.getDateValue(),t=l.K(e,l.m);t.end&&this.stores.store.setState($({},this.stores.store.state,{focus:f.EndDate,inputIsFocused:!0,currentMonth:t.end}))},this.handleEndInputTimeFocus=()=>{const e=this.getDateValue(),t=l.K(e,l.m);t.end&&this.stores.store.setState($({},this.stores.store.state,{focus:f.EndTime,inputIsFocused:!0,currentMonth:t.end}))},this.handleClearClick=()=>{this.props.onChangeValue(void 0)},this.getTimeFormatOptions=()=>Object(Z.a)(X.a).time,this.getSelectedTimeFormatType=()=>{const e=this.getTimeFormat(),t=this.getTimeFormatOptions();for(const a in t)if(t[a]===e)return a;return"12h"},this.getTimeZoneItemsSync=e=>Object(O.b)(e,g,e=>e.displayName).map((e,t)=>({key:e.displayName,render:t=>r.a.createElement(P.a,Object.assign({},t,{title:e.displayName})),action:()=>{this.handleTimeZoneChange(e.displayName)}})),this.tooltipOriginGap=12}willMount(e){super.willMount(e),this.openTimeFormat=l.nb(l.m)}renderComponent(){const{device:e,WindowSizeStore:t}=this.environment,{disabled:a,locked:n,shouldShowReminder:i}=this.props,{inputIsFocused:s}=this.stores.store.state,o=this.getDateValue(),l="datetime"===o.type||"datetimerange"===o.type,c="daterange"===o.type||"datetimerange"===o.type,d=r.a.createElement("div",{style:$({paddingTop:e.isMobile?16:8,paddingBottom:e.isMobile?16:8,paddingLeft:e.isMobile?t.getSafePaddingLeftCSS(16):14,paddingRight:e.isMobile?t.getSafePaddingRightCSS(16):14,display:l?"block":"flex"},e.isMobile&&{boxShadow:"\n\t\t\t\t\t\t\t0 1px 0 ".concat(this.theme.regularDividerColor,"\n\t\t\t\t\t\t"),position:"relative",zIndex:2},{background:e.isMobile?this.theme.popoverBackground:void 0})},this.renderStartInput(),c&&r.a.createElement("div",{style:{width:12,height:8}}),this.renderEndInput(),this.renderTimeZone());let u;return u=e.isMobile?{menuType:I.b.MenuType.Modal,title:r.a.createElement(G.FormattedMessage,{defaultMessage:"Date",id:"datePropertyMenu.mobileDate.title"}),right:r.a.createElement(G.FormattedMessage,{defaultMessage:"Done",id:"datePropertyMenu.mobileDoneButton.label"}),left:i?this.renderRemindersHelp():void 0,onClickRight:this.props.onDismiss,header:d}:{menuType:I.b.MenuType.Popup,maxHeight:"none",width:270},r.a.createElement(k.a,{capture:s,allowEsc:!0,allowTabUntab:!1},r.a.createElement(k.a,{capture:!0,allowUndo:!0,allowEsc:!0,allowTabUntab:!1},r.a.createElement(I.b,Object.assign({},u),r.a.createElement(_.a,{show:s}),r.a.createElement(T.a,null,!e.isMobile&&d,r.a.createElement("div",{style:$({padding:e.isMobile?"16px 14px 16px":"4px 0 4px",textAlign:"center"},e.isMobile&&{borderBottom:"1px solid ".concat(this.theme.regularDividerColor),background:this.theme.popoverBackground})},this.renderCalendar())),!a&&this.renderControls(),!a&&!n&&r.a.createElement(T.a,{topBorder:!0},this.renderFormatPopup()),!a&&r.a.createElement(T.a,{topBorder:!0},this.renderClearButton()),!a&&!e.isMobile&&i&&r.a.createElement(T.a,{topBorder:!0},this.renderRemindersHelp()))))}renderStartInput(){const{device:e}=this.environment,{disabled:t}=this.props,{focus:a,inputTemporaryValue:n,error:i}=this.stores.store.state,s=this.getDateValue(),o=l.K(s,l.m),c=Boolean(i.startDate||i.startTime),d="datetime"===s.type||"datetimerange"===s.type,u="daterange"===s.type||"datetimerange"===s.type,p=a===f.StartDate||a===f.StartTime,m=Object(w.h)(n.startDate)?o.start.locale(!1).format(this.getDateDisplayFormat()):n.startDate,h=Object(w.h)(n.startTime)?o.start.locale(!1).format(this.getTimeFormat()):n.startTime,g=Object(w.h)(n.startDate)?o.start.format(l.ib):n.startDate,b=Object(w.h)(n.startTime)?o.start.format(l.kb):n.startTime;return r.a.createElement("div",{style:$({},c?this.getInputWrapErrorStyle():p&&u?this.getInputWrapActiveStyle():this.getInputWrapInactiveStyle(),{fontSize:e.isMobile?16:14})},r.a.createElement(C.a,{renderTooltip:()=>this.getInputErrorMessage(i.startDate),originGap:this.tooltipOriginGap,forceVisibleState:Boolean(i.startDate),placement:C.a.Placement.Left,render:()=>e.isMobile?r.a.createElement(M.b,{type:"date",format:M.a.Transparent,value:g,onChange:this.handleInputChange,onFocus:this.handleStartInputDateFocus,onBlur:this.handleInputBlur,onSubmit:this.handleInputSubmit,disabled:t,size:1}):r.a.createElement(M.b,{format:M.a.Transparent,value:m,focusInitial:a===f.StartDate,onChange:this.handleInputChange,onFocus:this.handleStartInputDateFocus,onBlur:this.handleInputBlur,onSubmit:this.handleInputSubmit,disabled:t,size:1})}),d&&this.getInputSeparator(),d&&r.a.createElement(C.a,{renderTooltip:()=>this.getInputErrorMessage(i.startTime),originGap:this.tooltipOriginGap,forceVisibleState:Boolean(i.startTime),placement:C.a.Placement.Right,render:()=>e.isMobile?r.a.createElement(M.b,{type:"time",format:M.a.Transparent,value:b,onChange:this.handleInputChange,onFocus:this.handleStartInputTimeFocus,onBlur:this.handleInputBlur,onSubmit:this.handleInputSubmit,size:1,disabled:t}):r.a.createElement(M.b,{format:M.a.Transparent,value:h,focusInitial:a===f.StartTime,onChange:this.handleInputChange,onFocus:this.handleStartInputTimeFocus,onBlur:this.handleInputBlur,onSubmit:this.handleInputSubmit,size:1,disabled:t})}))}renderEndInput(){const{device:e}=this.environment,{disabled:t}=this.props,a=this.getDateValue(),n=l.K(a,l.m),i="datetime"===a.type||"datetimerange"===a.type;if(n.end){const{focus:a,error:s,inputTemporaryValue:o}=this.stores.store.state,c=Boolean(s.endDate||s.endTime),d=a===f.EndDate||a===f.EndTime,u=Object(w.h)(o.endDate)?n.end.locale(!1).format(this.getDateDisplayFormat()):o.endDate,p=Object(w.h)(o.endTime)?n.end.locale(!1).format(this.getTimeFormat()):o.endTime,m=Object(w.h)(o.endDate)?n.end.format(l.ib):o.endDate,h=Object(w.h)(o.endTime)?n.end.format(l.kb):o.endTime,g=this.getDateRangeBounds(),b=g&&g.earliestValidEnd;return r.a.createElement("div",{style:$({},c?this.getInputWrapErrorStyle():d?this.getInputWrapActiveStyle():this.getInputWrapInactiveStyle(),{fontSize:e.isMobile?16:14})},r.a.createElement(C.a,{renderTooltip:()=>this.getInputErrorMessage(s.endDate),originGap:this.tooltipOriginGap,forceVisibleState:Boolean(s.endDate),placement:C.a.Placement.Left,render:()=>e.isMobile?r.a.createElement(M.b,{type:"date",format:M.a.Transparent,value:m,onChange:this.handleInputChange,onFocus:this.handleEndInputDateFocus,onBlur:this.handleInputBlur,onSubmit:this.handleInputSubmit,size:1,disabled:t,inputElementAttributes:{min:b}}):r.a.createElement(M.b,{format:M.a.Transparent,value:u,focusInitial:a===f.EndDate,onChange:this.handleInputChange,onFocus:this.handleEndInputDateFocus,onBlur:this.handleInputBlur,onSubmit:this.handleInputSubmit,size:1,disabled:t})}),i&&this.getInputSeparator(),i&&r.a.createElement(C.a,{renderTooltip:()=>this.getInputErrorMessage(s.endTime),originGap:this.tooltipOriginGap,forceVisibleState:Boolean(s.endTime),placement:C.a.Placement.Right,render:()=>e.isMobile?r.a.createElement(M.b,{type:"time",format:M.a.Transparent,value:h,onChange:this.handleInputChange,onFocus:this.handleEndInputTimeFocus,onBlur:this.handleInputBlur,onSubmit:this.handleInputSubmit,size:1,disabled:t}):r.a.createElement(M.b,{format:M.a.Transparent,value:p,focusInitial:a===f.EndTime,onChange:this.handleInputChange,onFocus:this.handleEndInputTimeFocus,onBlur:this.handleInputBlur,onSubmit:this.handleInputSubmit,size:1,disabled:t})}))}}renderTimeZone(){const{device:e}=this.environment,t=this.getDateValue(),a=l.K(t,l.m),n=u.a.tz(a.start,l.m);if(("datetime"===t.type||"datetimerange"===t.type)&&n.utcOffset()!==a.start.utcOffset()){const a=g.find(e=>e.name===t.time_zone);if(a)return r.a.createElement(H.a,{isSmall:!0,isMobile:e.isMobile,style:{marginTop:8}},a.displayName)}}renderCalendar(){const{firstDayOfWeek:e}=this.props,t=this.getDateValueForceCurrentTimeZone(),a=l.K(t,l.m),n=this.stores.store.state.currentMonth||a.start,{focus:i}=this.stores.store.state;if(a.end){const t=a.start.toDate(),s=a.end.toDate(),o=i===f.StartDate||i===f.StartTime;return r.a.createElement(d.a,{className:"notion-calendar-picker notranslate",firstDayOfWeek:e,numberOfMonths:1,initialMonth:n.toDate(),month:n.toDate(),locale:X.a,localeUtils:K.a,modifiers:$({range:{from:t,to:s}},o?{end:s,start:t}:{start:t,end:s}),modifiersStyles:{range:te.dayPickerRangeDayStyle,start:o?this.getDayPickerActiveDayStyle():this.getDayPickerInactiveDayStyle(),end:o?this.getDayPickerInactiveDayStyle():this.getDayPickerActiveDayStyle()},showOutsideDays:!0,fixedWeeks:!0,onDayClick:this.handleDayPickerDayClick,navbarElement:this.renderNavbarElement,onMonthChange:this.handleDayPickerMonthChange})}{const t=a.start.toDate();return r.a.createElement(d.a,{className:"notion-calendar-picker notranslate",numberOfMonths:1,firstDayOfWeek:e,initialMonth:n.toDate(),month:n.toDate(),locale:X.a,localeUtils:K.a,selectedDays:[t],modifiers:{start:t},modifiersStyles:{start:this.getDayPickerActiveDayStyle()},showOutsideDays:!0,fixedWeeks:!0,navbarElement:this.renderNavbarElement,onDayClick:this.handleDayPickerDayClick,onMonthChange:this.handleDayPickerMonthChange})}}renderControls(){const{device:e}=this.environment,{shouldShowReminder:t}=this.props;return e.isMobile?r.a.createElement(T.a,{topBorder:!0},t&&this.renderReminderControl(),this.renderEndDateControl(),this.renderAllDayControl()):r.a.createElement(n.Fragment,null,t&&r.a.createElement(T.a,{topBorder:!0},this.renderReminderControl()),r.a.createElement(T.a,{topBorder:!0},this.renderEndDateControl(),this.renderAllDayControl()))}renderEndDateControl(){const{device:e}=this.environment,t=this.getDateValue();return r.a.createElement(P.a,{focused:!1,onClick:this.handleEndDateControlChange,title:r.a.createElement(G.FormattedMessage,{defaultMessage:"End date",id:"datePropertyMenu.menuItem.endDate.label"}),right:r.a.createElement(m.a,{on:"daterange"===t.type||"datetimerange"===t.type,onClick:this.handleEndDateControlChange,isAndroid:e.isAndroid})})}renderAllDayControl(){const{device:e}=this.environment,t=this.getDateValue();return r.a.createElement(P.a,{focused:!1,onClick:this.handleAllDayChange,title:r.a.createElement(G.FormattedMessage,{defaultMessage:"Include time",id:"datePropertyMenu.menuItem.includeTime.label",description:"Shown in the date property menu as an option for whether this date includes a time."}),right:r.a.createElement(m.a,{on:"date"!==t.type&&"daterange"!==t.type,onClick:this.handleAllDayChange,isAndroid:e.isAndroid})})}renderReminderControl(){const{device:e}=this.environment,{intl:t}=this.props,a=this.getDateValue();return r.a.createElement(E.a,{popupType:e.isMobile?E.a.PopupType.SlideUp:E.a.PopupType.Popup,placementToOrigin:E.a.Placement.Right,renderOrigin:n=>r.a.createElement(R.a,Object.assign({},n,{icon:B.a.alarmClock({width:14}),title:r.a.createElement(G.FormattedMessage,{defaultMessage:"Remind",id:"datePropertyMenu.menuItem.remind.label"}),focused:!1,showExtensionArrow:e.isMobile,right:Object(U.b)({reminder:a.reminder,intl:t})})),render:n=>{let i;i=e.isMobile?{menuType:I.b.MenuType.Modal,title:r.a.createElement(G.FormattedMessage,{defaultMessage:"Remind",id:"datePropertyMenu.mobileRemindModal.title"}),right:r.a.createElement(G.FormattedMessage,{defaultMessage:"Done",id:"datePropertyMenu.mobileDoneReminderButton.label"}),onClickRight:n.close}:{menuType:I.b.MenuType.Popup,width:250};const s=("date"===a.type||"daterange"===a.type?l.q:l.t).map(e=>{const a=Object(U.b)({reminder:e,shouldShowTime:!0,intl:t});return{key:a,action:t=>{this.handleChangeReminder(e),n.close()},render:(e,t)=>r.a.createElement(P.a,Object.assign({},e,{title:a}))}});return r.a.createElement(I.b,Object.assign({},i),r.a.createElement(j.a,{type:j.a.Type.Vertical,sections:[{key:"reminder section",render:e=>r.a.createElement(T.a,Object.assign({},e)),items:s}],initialFocus:void 0}))}})}renderFormatPopup(){const{device:e}=this.environment;return r.a.createElement(E.a,{popupType:e.isMobile?E.a.PopupType.SlideUp:E.a.PopupType.Popup,placementToOrigin:E.a.Placement.Right,renderOrigin:t=>r.a.createElement(P.a,Object.assign({},t,{icon:B.a.sidebarSettings({width:14}),title:r.a.createElement(G.FormattedMessage,{defaultMessage:"Date format & timezone",id:"datePropertyMenu.menuItem.formatAndTimezone.label"}),focused:!1,showExtensionArrow:e.isMobile})),render:t=>{let a;return a=e.isMobile?{menuType:I.b.MenuType.Modal,title:r.a.createElement(G.FormattedMessage,{defaultMessage:"Date format",id:"datePropertyMenu.mobileDateFormatModal.title"}),right:r.a.createElement(G.FormattedMessage,{defaultMessage:"Done",id:"datePropertyMenu.mobileDoneButton.label"}),onClickRight:t.close}:{menuType:I.b.MenuType.Popup,width:250},r.a.createElement(I.b,Object.assign({},a),r.a.createElement(T.a,null,this.renderDateFormatControl(),this.renderTimeFormatControl(),this.renderTimeZoneControl()))}})}renderDateFormatControl(){const e=this.props.dateFormat||l.v,{intl:t}=this.props,a={menuTitle:t.formatMessage({defaultMessage:"Date format",id:"datePropertyMenu.dateFormatDropdownButton.label"}),items:l.c,getKey:e=>e,selectedItem:e,onSelect:this.handleDateFormatChange,renderItem:e=>r.a.createElement(P.a,Object.assign({},e,{title:t.formatMessage(l.b[e.value])})),renderOrigin:a=>r.a.createElement(R.a,Object.assign({focused:!1,title:r.a.createElement(G.FormattedMessage,{defaultMessage:"Date format",id:"datePropertyMenu.menuItem.format.label"}),right:e?t.formatMessage(l.b[e]):r.a.createElement(G.FormattedMessage,{defaultMessage:"Empty",id:"datePropertyMenu.formatMenu.emptyButton.label"})},a))};return r.a.createElement(p.a,Object.assign({},a))}renderTimeFormatControl(){const e=this.getDateValue(),t="date"===e.type||"daterange"===e.type,a=this.getTimeFormat(),{intl:n}=this.props,i=this.getSelectedTimeFormatType(),s={menuTitle:n.formatMessage({defaultMessage:"Time format",id:"datePropertyMenu.timeFormatMenu.title"}),items:l.e,getKey:e=>e,selectedItem:i,onSelect:this.handleTimeFormatChange,renderItem:e=>r.a.createElement(P.a,Object.assign({},e,{title:n.formatMessage(l.a[e.value])})),disabled:t,renderOrigin:e=>r.a.createElement(R.a,Object.assign({focused:!1,title:r.a.createElement(G.FormattedMessage,{defaultMessage:"Time format",id:"datePropertyMenu.menuItem.timeFormat.label"}),disabled:t,right:!t&&(a?n.formatMessage(l.a[i]):r.a.createElement(G.FormattedMessage,{defaultMessage:"Empty",id:"datePropertyMenu.timeFormatMenu.emptyButton.label"}))},e))};return r.a.createElement(p.a,Object.assign({},s))}renderTimeZoneControl(){const{device:e}=this.environment,t=this.getDateValue(),a="date"===t.type||"daterange"===t.type,n=this.getCurrentTimeZone(),i=g.find(e=>e.name===n),{intl:s}=this.props;if(i)return r.a.createElement(E.a,{popupType:e.isMobile?E.a.PopupType.SlideUp:E.a.PopupType.Popup,disabled:a,onClick:()=>this.stores.timezoneQuery.set(""),renderOrigin:e=>r.a.createElement(R.a,Object.assign({focused:!1,title:r.a.createElement(G.FormattedMessage,{defaultMessage:"Timezone",id:"datePropertyMenu.menuItem.time.label"}),disabled:a,right:!a&&u.a.tz.zone(i.name).abbr(Date.now())},e)),render:t=>{const a=this.stores.timezoneQuery.get(),n=this.getTimeZoneItemsSync(a),i=r.a.createElement(T.a,{isInput:!0},r.a.createElement(F.a,{focus:!e.isMobile||void 0,focusAfterAnimation:!0,value:this.stores.timezoneQuery.get(),onChange:e=>this.stores.timezoneQuery.set(e.target.value),placeholder:s.formatMessage({defaultMessage:"Search for a timezone…",id:"datePropertyMenu.timeSearch.placeholder"})}));let o;return o=e.isMobile?{menuType:I.b.MenuType.Modal,title:r.a.createElement(G.FormattedMessage,{defaultMessage:"Timezone",id:"datePropertyMenu.mobileTimezoneMenu.title"}),right:r.a.createElement(Q.CancelMenuText,null),onClickRight:t.close,header:i}:{menuType:I.b.MenuType.Popup,header:i},r.a.createElement(I.b,Object.assign({},o),0===n.length?r.a.createElement(T.a,{title:r.a.createElement(G.FormattedMessage,{defaultMessage:"Select a timezone",id:"datePropertyMenu.timezoneMenu.select.placeholder"})},r.a.createElement(x.a,{title:r.a.createElement(G.FormattedMessage,{defaultMessage:"No results",id:"datePropertyMenu.timezoneMenu.noResults"})})):r.a.createElement(j.a,{type:j.a.Type.Vertical,initialFocus:0,sections:[{key:"timezone section",render:e=>r.a.createElement(T.a,Object.assign({},e,{title:r.a.createElement(G.FormattedMessage,{defaultMessage:"Select a timezone",id:"datePropertyMenu.menuItem.select.title"})})),items:n}],onAccept:t.close}))}})}renderClearButton(){return r.a.createElement(P.a,{focused:!1,onClick:this.handleClearClick,title:r.a.createElement(G.FormattedMessage,{defaultMessage:"Clear",id:"datePropertyMenu.clearButton.label"})})}renderRemindersHelp(){const{device:e}=this.environment;return e.isMobile?r.a.createElement(z.a,{href:Object(Y.a)("guides.reminders"),analyticsFrom:"date_selector"}):r.a.createElement(V.a,{title:r.a.createElement(G.FormattedMessage,{defaultMessage:"Learn about reminders",id:"datePropertyMenu.learnMore.helpButton.label"}),href:Object(Y.a)("guides.reminders"),analyticsFrom:"date_selector"})}getDateValue(){const{value:e}=this.props;return e&&!s.a.isNaN(e)?e:this.openTimeFormat}getDateRangeBounds(){const e=this.getDateValue();if(l.W(e)||l.Y(e)){const t=l.K(e,l.m);return{earliestValidEnd:t.start.format(l.ib),latestValidStart:t.end.format(l.ib)}}}getDateValueForceCurrentTimeZone(){const{value:e}=this.props;return e&&!s.a.isNaN(e)?"datetime"===e.type||"datetimerange"===e.type?$({},e,{time_zone:l.m}):e:this.openTimeFormat}getDateDisplayFormat(){const e=this.props.dateFormat||l.v;return"relative"===e?l.v:e}getTimeFormat(){return this.props.timeFormat||l.x}getCurrentTimeZone(){const e=this.getDateValue();return"datetime"===e.type||"datetimerange"===e.type?e.time_zone:l.m}parseInputDateValue(e){const{intl:t}=this.props;return this.environment.device.isMobile?Object(L.b)(e,l.ib,t):Object(L.b)(e,this.getDateDisplayFormat(),t)}parseInputTimeValue(e){const t=Object(u.a)(e,this.getTimeFormat(),!0);return t.isValid()?t.locale(l.jb).format(l.kb):Object(L.f)(e,this.props.intl)}applyValidDateState(e){const{newDate:t,currentMonth:a,resetField:n}=e;this.props.onChangeValue(t),this.stores.store.setState($({},this.stores.store.state,{currentMonth:a})),this.resetInputState(n)}resetInputState(e){const{state:t}=this.stores.store;this.stores.store.setState($({},t,{error:$({},t.error,{[t.focus]:void 0}),inputTemporaryValue:$({},t.inputTemporaryValue,{[t.focus]:void 0})}))}getInputErrorMessage(e){const{intl:t}=this.props;switch(e){case b.InvalidDate:return t.formatMessage({id:"datePropertyMenu.invalidDateError.tooltip",defaultMessage:"Invalid date"});case b.InvalidRange:return t.formatMessage({id:"datePropertyMenu.invalidDateOrTimeRangeError.tooltip",defaultMessage:"Invalid range"});case b.InvalidTime:return t.formatMessage({id:"datePropertyMenu.invalidTimeError.tooltip",defaultMessage:"Invalid time"});default:return}}getInputSeparator(){return r.a.createElement("div",{style:{height:14,width:1,background:this.theme.regularDividerColor,marginLeft:6,marginRight:12,flexShrink:0}})}getInputWrapStyle(){return{display:"flex",alignItems:"center",borderRadius:3,height:28,lineHeight:1.2,background:this.theme.inputBackground,paddingLeft:8,paddingRight:8,flexBasis:"50%"}}getInputWrapInactiveStyle(){return $({},this.getInputWrapStyle(),{boxShadow:this.theme.inputBoxShadow,flexGrow:1})}getInputWrapErrorStyle(){return $({},this.getInputWrapStyle(),{boxShadow:"inset 0 0 0 2px ".concat(N.f.red),background:N.f.redWithAlpha(.15),flexGrow:1})}getInputWrapActiveStyle(){return $({},this.getInputWrapStyle(),{boxShadow:"inset 0 0 0 2px ".concat(N.f.blue),background:N.f.blueWithAlpha(.15),flexGrow:1})}getDayPickerActiveDayStyle(){return{backgroundColor:N.f.blue,color:N.f.white}}getDayPickerInactiveDayStyle(){return{backgroundColor:N.f.blueWithAlpha(.5)}}}te.dayPickerRangeDayStyle={backgroundColor:N.f.blueWithAlpha(.15)},te.desktopNavStyle={display:"flex",position:"absolute",top:0,right:4,zIndex:A.m},te.mobileNavStyle={display:"flex",position:"absolute",top:-2,right:4,zIndex:A.m};t.default=Object(G.injectIntl)(te)},Q2G9:function(e,t,a){"use strict";a.r(t);var n=a("q1tI"),r=a.n(n),i=a("wldR"),s=a("/6eU"),o=a("naZa"),l=a("Rd/G"),c=a("Ma8p"),d=a("Na01"),u=a("8fuX"),p=a("Sb6f"),m=a("30UQ"),h=a("MBf9"),g=a("wlCD"),f=a("y6Dp"),b=a("nPEg"),y=a("wXH4"),S=a("Cm2F"),v=a("VBxf"),E=a("QcDD"),M=a("vJXr"),C=a("cy36"),w=a("Ng05"),O=a("MeYt"),k=a("7M94"),P=(a("ioFf"),a("rGqo"),a("mF3+")),T=a("bFnu");function D(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function I(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?D(Object(a),!0).forEach((function(t){F(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):D(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function F(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class j extends i.a{constructor(){super(...arguments),this.storeTypes={mouseStore:T.a,labelMouseStore:T.a},this.handleToggleClick=()=>{const{section:e}=this.props;this.isOpen()?m.e(e.sectionName):m.h(e.sectionName)},this.handleMouseMove=()=>this.stores.mouseStore.setState(I({},this.stores.mouseStore.state,{mouseEntered:!0})),this.handleMouseLeave=()=>this.stores.mouseStore.setState(I({},this.stores.mouseStore.state,{mouseEntered:!1})),this.handleLabelMouseMove=()=>{const{labelMouseStore:e}=this.stores;e.setState(I({},e.state,{mouseEntered:!0}))},this.handleLabelMouseLeave=()=>{const{labelMouseStore:e}=this.stores;e.setState(I({},e.state,{mouseEntered:!1}))}}renderComponent(){const{renderSection:e}=this.props,t=!this.isOpen();return r.a.createElement("div",{onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,style:this.getButtonContainerStyle()},this.renderLabel(),!t&&e())}renderLabel(){const e=!this.isOpen();return r.a.createElement(d.a,{isMobile:this.props.isMobile,disableMobileBorder:e,shouldShowMobileMarginBotton:e,style:this.getSectionSidebarItemStyle(),childrenStyle:{overflow:"visible"}},r.a.createElement("div",{style:{display:"flex",alignItems:"center"}},r.a.createElement(O.a,{onClick:this.handleToggleClick,onMouseMove:this.handleLabelMouseMove,onMouseLeave:this.handleLabelMouseLeave,style:this.getLabelButtonStyle()},!Boolean(this.props.forceOpen)&&P.a.triangle(this.getArrowStyle()),r.a.createElement("span",{style:this.getToggleButtonStyle()},this.props.icon&&r.a.createElement("span",{style:{paddingRight:4,display:"inline-block"}},this.props.icon),this.props.section.name))))}isOpen(){const{section:e,expandedSections:t}=this.props;return!!t&&-1!==t.indexOf(e.sectionName)}getSectionSidebarItemStyle(){return{minHeight:24,padding:0}}getSectionLabelStyle(){return{lineHeight:1,marginBottom:1,color:this.theme.sidebarTextColor,fontWeight:p.a.fontWeight.semibold,marginLeft:9}}getMobileSectionLabelStyle(){return{lineHeight:1,color:this.theme.sidebarTextColor,fontWeight:p.a.fontWeight.semibold,marginLeft:9}}getLabelButtonStyle(){return I({display:"flex",alignItems:"center",paddingBottom:12,paddingTop:12,paddingLeft:25},this.props.isMobile&&{marginBottom:8},{width:"100%"})}getToggleButtonStyle(){const{labelMouseStore:e}=this.stores,{mouseEntered:t}=e.state;return I({},this.props.isMobile?this.getMobileSectionLabelStyle():this.getSectionLabelStyle(),{color:t?this.theme.regularTextColor:this.theme.mediumTextColor,transition:"color 100ms ease-out"})}getButtonContainerStyle(){const e=!this.isOpen(),{first:t}=this.props;return I({},t?{borderTop:"1px solid ".concat(this.theme.regularDividerColor)}:{},{borderBottom:"1px solid ".concat(this.theme.regularDividerColor),width:"100%",paddingBottom:e?0:10})}getArrowStyle(){return{width:"0.6875em",height:"0.6875em",transition:"transform 200ms ease-out",transform:"rotateZ(".concat(this.isOpen()?180:90,"deg)"),fill:this.theme.regularIconColor}}}var x=j,B=a("H4VD"),A=a("qqdV"),R=a("J9+s"),L=a("2ZkR"),U=a("szb2"),_=a("pIip");class W extends i.a{constructor(){super(...arguments),this.storeTypes={templateRecordCacheStore:_.a},this.renderMobilePopup=()=>{const e=C.a.state;if(e.open)return r.a.createElement(b.default,{title:r.a.createElement(R.FormattedMessage,{defaultMessage:"Try this template",id:"pageTemplateModal.mobileModal.title"}),left:r.a.createElement(b.CancelMenuText,null),onClickLeft:this.handleDismiss,right:e.isLoading?r.a.createElement(g.a,null):r.a.createElement(R.FormattedMessage,{defaultMessage:"Use",id:"pageTemplateModal.mobileModal.useButton.label",description:"'Use' is utilized as a verb for a button label on the top right of a mobile menu, indicating to the user to click on the button to use the template they are previewing."}),onClickRight:this.handleUseTemplateClick,forceFullScreenSlideUp:!0},this.renderPreview(e))},this.renderModal=()=>{const e=C.a.state;if(e.open)return r.a.createElement("div",{style:W.modalStyle,className:k.jb},this.renderPreview(e),this.renderSidebar(e))},this.handleDismiss=async()=>{const{inMemoryRecordCache:e}=this.stores.templateRecordCacheStore.state;if(e.appliedTransaction){await this.showEditConfirmDialog()?this.accept(!0):this.close()}else this.close()},this.handleUseTemplateClick=async()=>{const{inMemoryRecordCache:e}=this.stores.templateRecordCacheStore.state;if(e.appliedTransaction){await this.showEditConfirmDialog()?this.accept(!0):this.accept(!1)}else this.accept(!1)},this.handleItemClick=async e=>{const{inMemoryRecordCache:t}=this.stores.templateRecordCacheStore.state;if(t.appliedTransaction){await this.showEditConfirmDialog()?this.accept(!0):this.setCurrentItem(e)}else this.setCurrentItem(e);f.Ce(this.environment,{name:e.name})}}willMountOrUpdate(){const e=C.a.state,{currentSpaceViewStore:t}=E.default.state;e.open&&t&&h.createAndCommit(this.environment,a=>{m.k({item:e.item,spaceViewStore:t,transaction:a})})}renderComponent(){const{device:e}=this.environment,t=C.a.state;return e.isMobile?r.a.createElement(y.a,{open:t.open,render:this.renderMobilePopup,forceFullScreenSlideUp:!0,onDismiss:this.handleDismiss,popupType:e.isMobile?y.a.PopupType.SlideUp:y.a.PopupType.Popup}):r.a.createElement(s.a,{open:t.open,render:this.renderModal,onDismiss:this.handleDismiss})}renderSidebar(e){const{currentSpaceViewStore:t,currentSpaceStore:a}=E.default.state;if(!t||!a)return;const i=m.d(),s=Object(l.a)(this.props.intl),o="on"===L.default.getGroup(this.environment,"suggested-templates");return r.a.createElement("div",{style:this.getSidebarStyle()},r.a.createElement(w.a,{isLarge:!0,onClick:this.handleUseTemplateClick,style:W.useTemplateButtonStyle,disabled:e.isLoading||!M.a.state.online},e.isLoading&&r.a.createElement(g.a,{isWhite:!0,style:{marginRight:6}}),r.a.createElement(R.FormattedMessage,{defaultMessage:"Use this template",id:"pageTemplateModal.useTemplateButton.label"})),r.a.createElement(u.b,{style:W.scrollerStyle,type:u.a.Y},o&&r.a.createElement(x,{isMobile:!1,key:"suggested",section:s,expandedSections:[...i||[],"suggested"],spaceStore:a,spaceViewStore:t,showAddPageButton:!1,first:!0,forceOpen:!0,icon:P.a.sparkles({width:12}),renderSection:()=>r.a.createElement(n.Fragment,null,s.items.map((t,a)=>{const n=e.item.rootId===t.rootId,i=n?this.hoveredButtonStyle():{};return r.a.createElement(O.a,Object.assign({hovered:n,style:i,key:a},this.props,{onClick:()=>this.handleItemClick(t)}),this.renderSidebarItem(t))}))}),e.sections.map((s,l)=>r.a.createElement(x,{isMobile:!1,key:s.sectionName,section:s,expandedSections:i,spaceStore:a,spaceViewStore:t,showAddPageButton:!1,first:!o&&0===l,renderSection:()=>r.a.createElement(n.Fragment,null,s.items.map((t,a)=>{const n=e.item.rootId===t.rootId,i=n?this.hoveredButtonStyle():{};return r.a.createElement(O.a,Object.assign({hovered:n,style:i,key:a},this.props,{onClick:()=>this.handleItemClick(t)}),this.renderSidebarItem(t))}))})),r.a.createElement(O.a,{onClick:()=>Object(B.navigateToExternalURL)({environment:this.environment,url:A.d.templates}),style:this.fixedLinkStyle(),hoveredStyle:{background:this.theme.sidebarHideButtonHoveredBackground},pressedStyle:{background:this.theme.sidebarHideButtonPressedBackground}},P.a.typesRelation(this.fixedLinkIconStyle()),r.a.createElement(R.FormattedMessage,{defaultMessage:"Browse more templates",id:"pageTemplateModal.goToFullTemplateGalleryButton.label"}))))}renderSidebarItem(e){return r.a.createElement(d.a,{style:{paddingLeft:30,fontWeight:p.a.fontWeight.semibold},isMobile:!1,icon:r.a.createElement("div",{style:this.getIconWrapStyle()},r.a.createElement(c.a,{size:20,emoji:e.emoji}))},e.name)}renderPreview(e){const{device:t}=this.environment;return r.a.createElement(o.a,{key:e.item.previewRootId,previewRootId:e.item.previewRootId,isFrontPage:!1,style:t.isMobile?W.previewMobileStyle:W.previewStyle,templateRecordCacheStore:this.stores.templateRecordCacheStore,disabled:!1})}accept(e){const{inMemoryRecordCache:t}=this.stores.templateRecordCacheStore.state,a=C.a.state,{currentSpaceViewStore:n,currentSpaceStore:r,currentBlockStore:i}=E.default.state;if(a.open&&n&&r){const s=i&&i.isEmptyPage()?i:void 0,o=U.c.state.open&&U.c.state.target&&U.c.state.target.isEmptyPage()?U.c.state.target:void 0;m.a({environment:this.environment,item:a.item,spaceStore:r,spaceViewStore:n,useRecordCache:e?t:void 0,initializeStore:a.createNewPage?void 0:s||o,isPrivate:a.isPrivate})}}close(){m.b(this.environment),S.a()}setCurrentItem(e){C.a.state.open&&m.j({templateItem:e,currentUserId:this.environment.currentUser.id})}showEditConfirmDialog(){return new Promise((e,t)=>{v.showDialog({message:r.a.createElement(R.FormattedMessage,{id:"pageTemplateModal.modifiedTemplateDialog.prompt",defaultMessage:"It looks like you've modified the template. Would you like to save your edits?"}),showCancel:!1,keepFocus:!0,items:[{label:r.a.createElement(R.FormattedMessage,{id:"pageTemplateModal.modifiedTemplateDialog.saveButton.label",defaultMessage:"Save edits"}),onAccept:()=>{e(!0)}},{label:r.a.createElement(R.FormattedMessage,{id:"pageTemplateModal.modifiedTemplateDialog.discardEditsButton.label",defaultMessage:"Discard"}),color:"red",onAccept:()=>{e(!1)}}]})})}getSidebarStyle(){return{width:W.sidebarWidth,color:this.theme.mediumTextColor,background:this.theme.sidebarBackground,display:"flex",flexDirection:"column",borderTopRightRadius:W.borderRadius,borderBottomRightRadius:W.borderRadius}}getIconWrapStyle(){return{color:this.theme.regularTextColor,position:"relative"}}hoveredButtonStyle(){return{color:this.theme.regularTextColor,fontWeight:p.a.fontWeight.medium}}fixedLinkStyle(){return{padding:12,color:this.theme.mediumTextColor,background:this.theme.sidebarBackground,fontSize:13,fontWeight:p.a.fontWeight.medium,display:"flex",alignItems:"center",position:"absolute",bottom:0,right:0,height:45,width:W.sidebarWidth,borderTop:"1px solid ".concat(this.theme.regularDividerColor)}}fixedLinkIconStyle(){return{width:12,height:12,marginLeft:8,marginRight:10,marginBottom:0,fill:this.theme.regularIconColor,fontWeight:p.a.fontWeight.medium}}}W.sidebarWidth=240,W.borderRadius=3,W.modalStyle={display:"flex",width:"85vw",height:"85vh",borderRadius:W.borderRadius},W.useTemplateButtonStyle={position:"relative",marginTop:16,marginLeft:20,marginRight:20,marginBottom:16,whiteSpace:"nowrap"},W.previewStyle={width:"calc(100% - ".concat(W.sidebarWidth,"px)"),flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column",overflow:"hidden"},W.previewMobileStyle={width:"100%",flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column",overflow:"hidden"},W.scrollerStyle={flexGrow:1,flexShrink:1,paddingBottom:44};t.default=Object(R.injectIntl)(W)},QgQJ:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a("mKX5"),r=a("lpTC"),i=a("T8dS");const s={getMonths:function(){for(var e=[],t=0;t<12;)e.push(Object(n.a)().month(t).format("MMMM")),t+=1;return e},formatDay:function(e){return Object(n.a)(e).format("ddd ll")},formatMonthTitle:function(e){const t=Object(r.a)(i.a).month;return Object(n.a)(e).format(t)},formatWeekdayShort:function(e){return n.a.weekdaysMin()[e]},formatWeekdayLong:function(e){return n.a.weekdays()[e]},getFirstDayOfWeek:function(){return n.a.localeData().firstDayOfWeek()}}},QmC8:function(e,t,a){"use strict";var n=a("LEzx");class r extends n.a{getInitialState(){return{open:!1}}}t.a=new r},"VcB+":function(e,t,a){"use strict";var n=a("g4rC");t.a=new n.a},Wyaw:function(e,t,a){"use strict";a.r(t);a("ioFf"),a("rGqo");var n=a("q1tI"),r=a.n(n),i=a("wldR"),s=a("/6eU"),o=a("+U1l"),l=a("J9+s"),c=a("mF3+"),d=a("Sb6f"),u=a("LeVO"),p=a("Ggib"),m=a("toub"),h=a("7Vnh"),g=a("Cycz"),f=a("zmp8"),b=a("A9TN");function y(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function S(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?y(Object(a),!0).forEach((function(t){v(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):y(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function v(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class E extends i.a{renderComponent(){return r.a.createElement(r.a.Fragment,null,c.a.notionLogoStroked({width:34,height:34,marginBottom:18}),r.a.createElement("div",{style:S({},this.getPrimaryTextStyle(),{marginBottom:6})},this.getPlanTitle()),r.a.createElement("div",{style:this.getSecondaryTextStyle()},this.getOneLiner()),this.renderPriceAndTerms(),this.renderBlockLimit(),this.renderPlanFeatures(),this.renderLearnMore())}renderBlockLimit(){const{planInfo:e}=this.props;if("team_free"===e.subscriptionTier)return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{fontWeight:d.a.fontWeight.semibold,fontSize:24}},r.a.createElement(l.FormattedMessage,{id:"spaceSubscriptionUpgradePlanFeatures.blockLimit.title",defaultMessage:"Free"})),r.a.createElement("div",{style:this.getSecondaryTextStyle()},r.a.createElement(l.FormattedMessage,{id:"spaceSubscriptionUpgradePlanFeatures.blockLimit.description",defaultMessage:"For the first 1,000 blocks"}),r.a.createElement(u.a,{renderTooltip:()=>r.a.createElement(l.FormattedMessage,{id:"spaceSubscriptionUpgradePlanFeatures.blockLimit.tooltip",defaultMessage:"Blocks are pieces of content you add to a page, like a paragraph or to-do item.{br}Some features on the Team Plan are not available on the Team Trial.",values:{br:r.a.createElement("br",null)}}),placement:u.a.Placement.Top,render:e=>r.a.createElement("span",Object.assign({},e),c.a.help({marginLeft:6,width:14,fill:f.f.mediumIconColor,verticalAlign:"middle",display:"inline-block"}))})))}renderPriceAndTerms(){const{planInfo:e,intl:t}=this.props;if("team_free"!==e.subscriptionTier)return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:this.getPrimaryTextStyle()},r.a.createElement(l.FormattedMessage,{id:"subscriptionUpgradeDetails.price",defaultMessage:"{price}",description:"Price is already formatted, e.g. $10",values:{price:Object(g.j)({subscriptionTier:e.subscriptionTier,billingInterval:e.billingInterval,intl:t})}})),r.a.createElement("div",{style:this.getSecondaryTextStyle()},this.getFormattedTerm()))}getFormattedTerm(){const{planInfo:e,intl:t}=this.props,a=Object(h.d)(b.default,t),n={personal:a.terms.pro,team:a.terms.team,enterprise:a.terms.enterprise}[e.subscriptionTier];return{per_month:r.a.createElement(l.FormattedMessage,{id:"subscriptionUpgradeDetails.perMonthPricing.label",defaultMessage:"per month",description:"Appears after the price per month for a given plan, e.g. $10 per month"}),per_member_per_month:r.a.createElement(l.FormattedMessage,{id:"subscriptionUpgradeDetails.perUserPerMonthPricing.label",defaultMessage:"per member, per month",description:"Appears after the price per member, per month for a given plan, e.g. $10 per member, per month"})}[n]}renderPlanFeatures(){var e=this;const{planInfo:t}=this.props;return r.a.createElement(r.a.Fragment,null,r.a.createElement(u.a,{delayThreshold:0,placement:u.a.Placement.Left,renderTooltip:()=>this.renderPreviousPlanTierFeatures(),render:t=>r.a.createElement("span",Object.assign({},t,{style:{cursor:"help",fontSize:14}}),r.a.createElement(l.FormattedMessage,{id:"subscriptionUpgradeDetails.features",defaultMessage:"<span>Everything in {planName},</span> plus:",description:"Shown when comparing plan tier features in upgrade modal; 'planName' will be Personal, Team Trial, or Team",values:{span:function(){for(var t=arguments.length,a=new Array(t),n=0;n<t;n++)a[n]=arguments[n];return r.a.createElement("span",{style:{paddingBottom:1,borderBottom:"1px dotted ".concat(e.theme.lightTextColor)}},a)},planName:this.getPreviousPlanName()}}))}),this.getFeaturesByPlanKey(t.subscriptionTier).map((e,a)=>r.a.createElement("div",{key:"".concat(t.subscriptionTier,"-feature-").concat(a),style:{display:"flex",alignItems:"center",padding:"4px 0px",fontSize:14}},c.a.thinCheck({width:14,height:14,marginRight:5,color:this.theme.lightTextColor}),e.label,e.isComingSoon&&r.a.createElement("div",{style:{background:this.theme.buttonHoveredBackground,fontSize:10,fontWeight:500,letterSpacing:"0.015em",color:this.theme.mediumTextColor,display:"inline",textTransform:"uppercase",padding:"2px 4px",marginLeft:6,borderRadius:3,whiteSpace:"nowrap"}},h.b))))}renderPreviousPlanTierFeatures(){const e=this.getTierBelowKey();return this.getFeaturesByPlanKey(e).map((t,a)=>r.a.createElement("div",{key:"".concat(e,"-feature-").concat(a),style:{display:"flex",alignItems:"center",padding:"4px 0px",fontSize:14}},c.a.thinCheck({width:14,height:14,marginRight:5,color:this.theme.regularInvertedTextColor}),t.label))}renderLearnMore(){return r.a.createElement("div",{style:{fontWeight:d.a.fontWeight.regular,fontSize:14,marginBottom:16,color:this.theme.mediumTextColor,textDecoration:"underline",marginTop:8,cursor:"pointer"},onClick:()=>{p.a.reset(),o.a.reset(),m.a.setState({open:!0,currentTab:"plans"})}},r.a.createElement(l.FormattedMessage,{id:"subscriptionUpgradeDetails.learnMore",defaultMessage:"Learn more"}))}getPlanTitle(){const{planInfo:e}=this.props;return{personal:r.a.createElement(l.FormattedMessage,{id:"subscriptionUpgradeDetails.title.personal",defaultMessage:"Upgrade to Personal Pro"}),team:r.a.createElement(l.FormattedMessage,{id:"subscriptionUpgradeDetails.title.team",defaultMessage:"Upgrade to Team"}),enterprise:r.a.createElement(l.FormattedMessage,{id:"subscriptionUpgradeDetails.title.enterprise",defaultMessage:"Upgrade to Enterprise"}),team_free:r.a.createElement(l.FormattedMessage,{id:"subscriptionUpgradeDetails.title.teamFree",defaultMessage:"Upgrade to Team Trial"})}[e.subscriptionTier]}getOneLiner(){const{planInfo:e}=this.props;switch(e.subscriptionTier){case"personal":return r.a.createElement(l.FormattedMessage,{id:"subscriptionUpgradeDetails.oneLiner.personal",defaultMessage:"For power users who want to do even more."});case"team":case"team_free":return r.a.createElement(l.FormattedMessage,{id:"subscriptionUpgradeDetails.oneLiner.team",defaultMessage:"For teams to write, plan, and work together in one spot."});case"enterprise":return r.a.createElement(l.FormattedMessage,{id:"subscriptionUpgradeDetails.oneLiner.enterprise",defaultMessage:"Controls and support to run your company."})}}getPreviousPlanName(){return{personal:r.a.createElement(l.FormattedMessage,{id:"subscriptionUpgradeDetails.planName.personal",defaultMessage:"Pro"}),personal_free:r.a.createElement(l.FormattedMessage,{id:"subscriptionUpgradeDetails.planName.free",defaultMessage:"Personal"}),team_free:r.a.createElement(l.FormattedMessage,{id:"subscriptionUpgradeDetails.planName.teamTrial",defaultMessage:"Team Trial"}),team:r.a.createElement(l.FormattedMessage,{id:"subscriptionUpgradeDetails.planName.team",defaultMessage:"Team"})}[this.getTierBelowKey()]}getTierBelowKey(){const{planInfo:e}=this.props;return{personal:"personal_free",team:"team_free",team_free:"personal",enterprise:"team"}[e.subscriptionTier]}getFeaturesByPlanKey(e){return{personal_free:[h.a.unlimitedBlocks,h.a.shareWithLimitedGuests,h.a.syncAcrossDevices],personal:[h.a.unlimitedFileUploads,h.a.unlimitedGuests,h.a.versionHistory,h.a.contentApi],team_free:[h.a.unlimitedTeamMembers,h.a.collaborativeWorkspace,h.a.adminTools],team:[h.a.unlimitedBlocks,h.a.unlimitedFileUploads,h.a.versionHistory,h.a.advancedPermissions],enterprise:[h.a.sso,h.a.scimApi,h.a.advancedSecurity,h.a.dedicatedManager,h.a.customContract]}[e]}getPrimaryTextStyle(){return{fontWeight:d.a.fontWeight.bold,fontSize:22,lineHeight:1.1,marginBottom:2}}getSecondaryTextStyle(){return{fontWeight:d.a.fontWeight.regular,fontSize:14,lineHeight:1.4,marginBottom:22,color:this.theme.mediumTextColor}}}var M=Object(l.injectIntl)(E),C=a("Ng05"),w=a("IULH"),O=a("nM47"),k=a("QcDD");function P(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function T(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class D extends i.a{constructor(){super(...arguments),this.storeTypes={},this.renderModal=()=>r.a.createElement("div",{style:this.getModalStyle()},r.a.createElement(M,{planInfo:{subscriptionTier:"team_free"}}),r.a.createElement("div",{style:this.getButtonContainerStyle()},r.a.createElement(w.a,{isLarge:!0,style:{marginLeft:"auto",marginRight:12},onClick:this.handleModalClose},r.a.createElement(l.FormattedMessage,{id:"spacePermissionSettingsTrialModal.cancel.label",defaultMessage:"Cancel"})),r.a.createElement(C.a,{onClick:this.handleTrialAccept,isLarge:!0},r.a.createElement(l.FormattedMessage,{id:"spacePermissionSettingsTrialModal.tryItFree.label",defaultMessage:"Try it free"})))),this.handleTrialAccept=async()=>{const{currentSpaceStore:e}=k.default.state;e&&(await O.a({environment:this.environment,spaceStore:e,planType:"team"}),this.handleModalClose())},this.handleModalClose=()=>{o.a.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?P(Object(a),!0).forEach((function(t){T(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):P(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},o.a.state,{open:!1}))}}renderComponent(){return r.a.createElement(s.a,{open:o.a.state.open,render:this.renderModal,onDismiss:this.handleModalClose})}getButtonContainerStyle(){return{display:"flex",marginTop:40}}getModalStyle(){return{background:this.theme.popoverBackground,borderRadius:3,width:349,padding:24}}}t.default=D},XOx9:function(e,t,a){"use strict";a.r(t);a("ioFf"),a("rGqo");var n=a("q1tI"),r=a.n(n),i=a("G414"),s=a("wldR"),o=a("wXH4"),l=a("MBf9"),c=a("ov3o"),d=a("J9+s"),u=a("wFTq");function p(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function m(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class h extends s.a{constructor(){super(...arguments),this.renderModal=()=>{const e=c.a.state;if(e.isOpen)return r.a.createElement(u.a,{captureSelection:!0,restoreSelection:!this.environment.device.isMobile,autocompleteQuery:e.autocompleteQuery,targets:e.targets,onAutocompleteQueryChange:this.handleAutocompleteQueryChange,onAccept:this.handleAccept,onCancel:this.handleCancel,desktopWidth:220,isAddTo:e.isAddTo,isCreateIn:!1})},this.handleAccept=async e=>{const t=l.create(this.environment);await i.a({environment:this.environment,value:e,transaction:t}),l.commit({environment:this.environment,transaction:t})},this.handleCancel=()=>{i.c(this.environment)},this.handleAutocompleteQueryChange=e=>{c.a.state.isOpen&&c.a.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?p(Object(a),!0).forEach((function(t){m(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},c.a.state,{autocompleteQuery:e}))}}renderComponent(){const{device:e}=this.environment,t=c.a.state;return r.a.createElement(o.c,{popupType:e.isMobile?o.c.PopupType.SlideUp:o.c.PopupType.Popup,alignmentToOrigin:o.c.Alignment.Start,open:t.isOpen,render:this.renderModal,originRect:t.isOpen?t.rect:void 0,onDismiss:()=>i.c(this.environment)})}}t.default=Object(d.injectIntl)(h)},YqZh:function(e,t,a){"use strict";a.r(t);a("ioFf"),a("rGqo");var n=a("LvDl"),r=a.n(n),i=a("q1tI"),s=a.n(i),o=a("wldR"),l=a("0/0S"),c=a("vJXr"),d=a("d9nj"),u=a("2Y+N"),p=a("T4gQ"),m=a("gbGO"),h=a("WgIs"),g=a("SR/M"),f=a("lEhh"),b=a("VPSe"),y=a("622O"),S=a("g4rC"),v=a("Ng05"),E=a("lODM"),M=a("FUUC"),C=a("DbeH"),w=a("PEWV"),O=a("J9+s"),k=a("uSCg"),P=a("LeVO"),T=a("Pqcg"),D=a("5Nka"),I=a("aEEb"),F=a("6BTz"),j=a("yNyh"),x=a("D8Ld"),B=a("ttM1"),A=a("64mo");function R(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function L(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?R(Object(a),!0).forEach((function(t){U(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):R(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function U(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}const W=["pdf","html","markdown"],N=e=>e>.1&&e<2;class q extends o.a{constructor(){super(...arguments),this.storeTypes={exportTypePopupStore:S.a,pdfFormatPopupStore:S.a},this.renderMenu=()=>{const{device:e}=this.environment;if(!c.a.state.online)return this.renderOffline();const t=l.a.state;if(t.open&&e.isMobile){const e={menuType:m.a.Modal,title:s.a.createElement(O.FormattedMessage,{id:"exportModal.title",defaultMessage:"Export"}),right:s.a.createElement(O.FormattedMessage,{id:"exportModal.closeButton.label",defaultMessage:"Close"}),onClickRight:this.handleCancel};return s.a.createElement(m.b,Object.assign({},e),s.a.createElement(h.a,{type:h.a.Type.Vertical,initialFocus:void 0,sections:[{key:"exportOptions",render:e=>s.a.createElement(u.a,Object.assign({},e)),items:this.getExportOptionsMenuItems(t)},{key:"actions",render:e=>{let{children:t}=e,a=_(e,["children"]);return s.a.createElement(u.a,Object.assign({isSubmitButton:!0},a),t)},items:[{key:"submit",render:e=>{const{onClick:t}=e,a=_(e,["onClick"]);return s.a.createElement(p.a,Object.assign({},a,{onClick:t||this.handleSubmit,disabled:!this.canSubmit(),title:s.a.createElement(O.FormattedMessage,{id:"exportModal.exportButton.label",defaultMessage:"Export"})}))},action:this.handleSubmit}]}]}))}return t.open?this.renderDesktopModal(t):void 0},this.handleSelectExportType=(e,t)=>{const a=l.a.state;if(!a.open)return;const{exportOptions:n}=a;if(e===n.exportType)return;let r;r=L({},n,"pdf"===e?{exportType:"pdf",pdfFormat:E.g(t)}:{exportType:e}),E.b(this.environment,L({},a,{exportOptions:r}))},this.handleSelectPaperFormat=e=>{const t=l.a.state;t.open&&l.c(t)&&E.b(this.environment,L({},t,{exportOptions:L({},t.exportOptions,{pdfFormat:e})}))},this.handleToggleRecursive=()=>{const e=l.a.state;if(e.open){if(l.c(e)&&!E.a(this.environment))return C.a(this.environment,{from:"export_modal",for:"enterprise"}),void this.handleUpgrade();E.b(this.environment,L({},e,{recursive:!e.recursive}))}},this.handleSetScalePercent=e=>{const t=l.a.state;t.open&&l.c(t)&&E.b(this.environment,L({},t,{exportOptions:L({},t.exportOptions,{scale:e})}))},this.handleCancel=()=>{E.c()},this.handleSubmit=()=>{if(!this.canSubmit())return;const e=l.a.state;e.open&&(E.c(),e.root.table===M.a?E.f(this.environment,{spaceId:e.root.id,exportOptions:e.exportOptions}):E.d(this.environment,{blockId:e.root.id,recursive:e.recursive,exportOptions:e.exportOptions}))},this.handleUpgrade=()=>{E.c()}}renderComponent(){return s.a.createElement(A.a,{onDismiss:this.handleCancel,render:this.renderMenu,requireOnline:!0,modalStore:l.a})}renderOffline(){return s.a.createElement("div",{style:this.getOfflineStyle()},s.a.createElement(O.FormattedMessage,{defaultMessage:"Please go online to export.",id:"exportModal.offlineMessage.description"}))}renderDesktopModal(e){const{device:t,currentUser:a}=this.environment,n=l.c(e)&&!E.a(this.environment);return s.a.createElement("div",{style:this.getModalWrapStyle()},s.a.createElement(b.a,{isMenuItem:t.isMobile,buttonPopupStore:this.stores.exportTypePopupStore,label:s.a.createElement(O.FormattedMessage,{id:"exportModal.exportFormat.description",defaultMessage:"Export format"}),selectedTitle:this.getBlockExportTypeTitle(e.exportOptions.exportType),renderMenuSections:e=>[{key:"exportType",render:e=>s.a.createElement(u.a,Object.assign({},e)),items:W.map(t=>this.getBlockExportTypeMenuListItem(t,e,a.id))}]}),l.c(e)&&s.a.createElement(s.a.Fragment,null,s.a.createElement(b.a,{isMenuItem:t.isMobile,buttonPopupStore:this.stores.pdfFormatPopupStore,label:s.a.createElement(O.FormattedMessage,{id:"exportModal.pageFormat.description",defaultMessage:"Page format"}),selectedTitle:this.getPDFFormatTitle(e.exportOptions.pdfFormat),renderMenuSections:e=>[{key:"isoPaperFormats",render:e=>s.a.createElement(u.a,Object.assign({},e)),items:y.a.map(t=>this.getPaperFormatMenuListItem(t,e))},{key:"otherPaperFormats",render:e=>s.a.createElement(u.a,Object.assign({topBorder:!0},e)),items:y.b.map(t=>this.getPaperFormatMenuListItem(t,e))}]}),this.renderScalePercent()),"space"!==e.root.table&&s.a.createElement(w.a,{requireUpgradeToTier:n&&"enterprise",analyticsName:"export_modal",onClick:this.handleToggleRecursive,render:(a,r)=>s.a.createElement("div",Object.assign({},a,{style:{display:"flex",alignItems:"center",height:32}}),s.a.createElement("div",{style:{display:"flex",alignItems:"center",marginRight:"auto",color:this.theme.lightTextColor,fontSize:14}},s.a.createElement(O.FormattedMessage,{defaultMessage:"Include subpages",id:"exportModal.includeSubpages.label"})," ",r&&s.a.createElement("div",{style:{marginLeft:8}},r)),s.a.createElement(f.a,{on:e.recursive,isAndroid:t.isAndroid,disabled:n})),renderUpgradeTooltip:()=>s.a.createElement(T.a,{imageURL:D.a.images.tooltips.upsells.exportPdfSubpagesPng,imageWidth:240,imageHeight:100,title:s.a.createElement(O.FormattedMessage,{defaultMessage:"Upgrade to include subpages in PDF exports",id:"exportModal.pdfSubpageUpgradeTooltip.title"}),caption:s.a.createElement(O.FormattedMessage,{defaultMessage:"Creates a zip file containing all the pages nested inside the current page as PDF files.",id:"exportModal.pdfSubpageUpgradeTooltip.caption"})}),tooltipPlacement:P.a.Placement.Left,upgradeButtonDesktopStyle:{marginTop:2},onUpgradeClick:this.handleUpgrade}),s.a.createElement("div",{style:{display:"flex",alignItems:"center",marginTop:16}},s.a.createElement(d.a,{isGray:!0,style:{marginLeft:"auto",marginRight:8},onClick:this.handleCancel},s.a.createElement(O.FormattedMessage,{defaultMessage:"Cancel",id:"exportModal.cancelButton.label"})),s.a.createElement(v.a,{onClick:this.handleSubmit,disabled:!this.canSubmit()},s.a.createElement(O.FormattedMessage,{defaultMessage:"Export",id:"exportModal.exportButton.label"}))))}renderScalePercent(){const e=this.getScalePercent();return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",height:32}},s.a.createElement(I.a,{style:{color:this.theme.lightTextColor}},s.a.createElement(O.FormattedMessage,{id:"exportModal.pageScale.description",defaultMessage:"Scale percent"})),s.a.createElement(V,{value:e,onChange:this.handleSetScalePercent})),!N(e)&&s.a.createElement(B.a,{show:!0,showDelay:500,showHold:100,render:e=>e&&s.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",minHeight:32,padding:"4px 0"}},s.a.createElement(I.a,{isSmall:!0,isMultiline:!0,style:{color:this.theme.errorText}},s.a.createElement(O.FormattedMessage,{id:"exportModal.pageScale.invalidScaleError",defaultMessage:"Scale percent must be a number between 10 and 200",description:"Shown if the scale percent for pdf export is outside of range."})))}))}getExportOptionsMenuItems(e){const{currentUser:t,device:a}=this.environment;return r.a.compact([{key:"export type",render:n=>s.a.createElement(b.a,Object.assign({},n,{isMenuItem:a.isMobile,buttonPopupStore:this.stores.exportTypePopupStore,label:s.a.createElement(O.FormattedMessage,{defaultMessage:"Export format",id:"exportModal.exportFormat.description"}),selectedTitle:this.getBlockExportTypeTitle(e.exportOptions.exportType),renderMenuSections:e=>[{key:"exportType",render:e=>s.a.createElement(u.a,Object.assign({},e)),items:W.map(a=>this.getBlockExportTypeMenuListItem(a,e,t.id))}]})),action:()=>{this.stores.exportTypePopupStore.setState({open:!0})}},l.c(e)&&{key:"pdf format",render:t=>s.a.createElement(b.a,Object.assign({},t,{isMenuItem:a.isMobile,buttonPopupStore:this.stores.pdfFormatPopupStore,label:s.a.createElement(O.FormattedMessage,{defaultMessage:"Page format",id:"exportModal.pageFormat.description"}),selectedTitle:this.getPDFFormatTitle(e.exportOptions.pdfFormat),renderMenuSections:e=>[{key:"isoPaperFormats",render:e=>s.a.createElement(u.a,Object.assign({},e)),items:y.a.map(t=>this.getPaperFormatMenuListItem(t,e))},{key:"otherPaperFormats",render:e=>s.a.createElement(u.a,Object.assign({topBorder:!0},e)),items:y.b.map(t=>this.getPaperFormatMenuListItem(t,e))}]})),action:()=>{this.stores.pdfFormatPopupStore.setState({open:!0})}},"space"!==e.root.table&&{key:"recursive",render:t=>{let{onClick:n,key:r}=t,i=_(t,["onClick","key"]);const o=l.c(e)&&!E.a(this.environment);return s.a.createElement(w.a,{key:r,requireUpgradeToTier:o&&"enterprise",analyticsName:"export_modal",onClick:n,render:(t,n)=>s.a.createElement(g.a,Object.assign({},Object(k.a)(i,t),{title:s.a.createElement("div",{style:{display:"flex",alignItems:"center"}},s.a.createElement(O.FormattedMessage,{defaultMessage:"Include subpages",id:"exportModal.includeSubpages.label"})," ",n&&s.a.createElement("div",{style:{marginLeft:8}},n)),right:s.a.createElement(f.a,Object.assign({},a.isMobile?{}:Object(k.a)(i,t),{on:e.recursive,isAndroid:a.isAndroid,disabled:o}))})),renderUpgradeTooltip:()=>s.a.createElement(T.a,{imageURL:D.a.images.tooltips.upsells.exportPdfSubpagesPng,imageWidth:240,imageHeight:100,title:s.a.createElement(O.FormattedMessage,{defaultMessage:"Upgrade to include subpages in PDF exports",id:"exportModal.pdfSubpageUpgradeTooltip.title"}),caption:s.a.createElement(O.FormattedMessage,{defaultMessage:"Creates a zip file containing all the pages nested inside the current page as PDF files.",id:"exportModal.pdfSubpageUpgradeTooltip.caption"})}),tooltipPlacement:P.a.Placement.Left,upgradeButtonDesktopStyle:{marginTop:2},onUpgradeClick:this.handleUpgrade})},action:this.handleToggleRecursive}])}getBlockExportTypeTitle(e){switch(e){case"pdf":return s.a.createElement(O.FormattedMessage,{id:"exportModal.exportFormatButton.pdf.label",defaultMessage:"PDF"});case"markdown":return s.a.createElement(O.FormattedMessage,{id:"exportModal.exportFormatButton.markdownAndCSV.label",defaultMessage:"Markdown & CSV"});case"html":return s.a.createElement(O.FormattedMessage,{id:"exportModal.exportFormatButton.html.label",defaultMessage:"HTML"})}}getPDFFormatTitle(e){switch(e){case"Letter":return s.a.createElement(O.FormattedMessage,{id:"exportModal.pageFormatButton.letter.label",defaultMessage:"Letter"});case"A3":return s.a.createElement(O.FormattedMessage,{id:"exportModal.pageFormatButton.a3.label",defaultMessage:"A3"});case"A4":return s.a.createElement(O.FormattedMessage,{id:"exportModal.pageFormatButton.a4.label",defaultMessage:"A4"});case"Legal":return s.a.createElement(O.FormattedMessage,{id:"exportModal.pageFormatButton.legal.label",defaultMessage:"Legal"});case"Tabloid":return s.a.createElement(O.FormattedMessage,{id:"exportModal.pageFormatButton.tabloid.label",defaultMessage:"Tabloid"})}}getBlockExportTypeMenuListItem(e,t,a){const n=l.a.state,r=n.open&&"pdf"===e&&"space"===n.root.table&&!E.a(this.environment);return{key:e,action:()=>{if(t.close(),r)return C.a(this.environment,{from:"export_modal",for:"enterprise"}),void this.handleUpgrade();this.handleSelectExportType(e,a)},render:a=>{let{onClick:n,key:i}=a,o=_(a,["onClick","key"]);return s.a.createElement(w.a,{key:i,requireUpgradeToTier:r&&"enterprise",analyticsName:"export_modal",onClick:n,onUpgradeClick:()=>{t.close(),this.handleUpgrade()},render:(t,a)=>s.a.createElement(g.a,Object.assign({},Object(k.a)(o,t),{title:this.getBlockExportTypeTitle(e),right:a})),renderUpgradeTooltip:()=>s.a.createElement(T.a,{imageURL:D.a.images.tooltips.upsells.exportPdfSubpagesPng,imageWidth:240,imageHeight:100,title:s.a.createElement(O.FormattedMessage,{defaultMessage:"Upgrade to export the workspace as PDFs",id:"exportModal.workspacePdfUpgradeTooltip.title"}),caption:s.a.createElement(O.FormattedMessage,{defaultMessage:"Creates a zip file containing all pages in the workspace as PDF files.",id:"exportModal.workspacePdfUpgradeTooltip.caption"})}),tooltipPlacement:P.a.Placement.Left,upgradeButtonDesktopStyle:{marginTop:2}})}}}getPaperFormatMenuListItem(e,t){return{key:e,action:()=>{t.close(),this.handleSelectPaperFormat(e)},render:t=>s.a.createElement(g.a,Object.assign({},t,{title:this.getPDFFormatTitle(e)}))}}getScalePercent(){const e=l.a.state;return e.open&&l.c(e)?void 0===e.exportOptions.scale?1:e.exportOptions.scale:1}canSubmit(){return N(this.getScalePercent())}getModalWrapStyle(){return{width:320,padding:24,fontSize:14}}getOfflineStyle(){return L({},this.getModalWrapStyle(),{color:this.theme.mediumTextColor})}}function V(e){let{value:t,onChange:a}=e;const n=Object(O.useIntl)(),r=s.a.useCallback(e=>{const t=e.target.value,n=Object(F.f)(t)||Object(F.e)(t);let r=void 0;"object"==typeof n?r="percent"===n.format?n.value:n.value/100:"number"==typeof n&&(r=n/100),void 0!==r&&a(r)},[a]),[i,o]=s.a.useState(!1),l=s.a.useMemo(()=>Object(F.c)(100*t,"number",n),[t,n]);return s.a.createElement(x.a,{capture:i},s.a.createElement(j.b,{value:l,onChange:r,onFocus:()=>o(!0),onBlur:()=>o(!1),style:{width:60},inputStyle:{textAlign:"right"}}))}t.default=q},b1fY:function(e,t,a){"use strict";a.r(t);var n=a("q1tI"),r=a.n(n),i=a("wldR"),s=a("Vq6f"),o=a("/6eU"),l=a("Sb6f"),c=a("Ng05"),d=a("5Nka"),u=a("WPWl"),p=a("iqZH"),m=a("bxQm"),h=a("J9+s");class g extends i.a{constructor(){super(...arguments),this.handleModalDismiss=()=>{s.a.state.open&&s.a.state.onDecline&&s.a.state.onDecline(),s.a.setState({open:!1})},this.handleConnectClick=()=>{s.a.state.open&&s.a.state.onConfirm(),s.a.setState({open:!1})},this.handleConnectedAppsClick=()=>{this.handleModalDismiss(),p.a({currentTab:"connected_apps"})}}renderComponent(){const{device:e}=this.environment,t=s.a.state;return r.a.createElement(o.a,{open:t.open,innerStyle:g.wrapStyle,preventHideChildrenWhileOpening:!0,render:()=>r.a.createElement(n.Fragment,null,r.a.createElement("div",{style:g.modalHeaderWrapStyle},r.a.createElement("img",{src:d.a.images.googleDriveLogoPng,style:{width:50,display:"inline-block"}}),r.a.createElement("div",{style:this.getModalMessageStyle()},r.a.createElement(h.FormattedMessage,{defaultMessage:"Notion cannot access the Google Drive file you are trying to embed.",id:"googleAuthPromptModal.noAccessFile.errorMessage"})),e.isReactNative?r.a.createElement("div",{style:this.getModalMessageStyle()},r.a.createElement(h.FormattedMessage,{defaultMessage:"Please use Notion on desktop to connect a new account.",id:"googleAuthPromptModal.mobileUseDesktopPrompt.errorMessage"})):r.a.createElement(c.a,{isLarge:!0,onClick:this.handleConnectClick},r.a.createElement(h.FormattedMessage,{defaultMessage:"Connect to Google",id:"googleAuthPromptModal.connectToGoogleButton.label"})),!e.isMobile&&this.renderConnectedAccountsLink())),onDismiss:this.handleModalDismiss})}renderConnectedAccountsLink(){return r.a.createElement("div",{style:{display:"block",marginTop:u.a.vertical.tiny}},r.a.createElement(m.a,{underlined:!0,onClick:this.handleConnectedAppsClick},r.a.createElement(h.FormattedMessage,{defaultMessage:"See my connected accounts",id:"googleAuthPromptModal.seeConnectedAccountsButton.label"})))}getModalMessageStyle(){return{fontSize:16,lineHeight:1.5,fontWeight:l.a.fontWeight.medium,marginTop:15,marginBottom:20,color:this.theme.mediumTextColor}}}g.wrapStyle={padding:"24px 36px 24px",minWidth:300,maxWidth:400},g.modalHeaderWrapStyle={textAlign:"center",marginTop:8,marginBottom:18,justifyContent:"space-between"},t.default=g},cw0H:function(e,t,a){"use strict";var n=a("g4rC");t.a=new n.a},e3h8:function(e,t,a){"use strict";a.r(t);a("ioFf"),a("rGqo");var n=a("q1tI"),r=a.n(n),i=a("bkwR"),s=a("zmp8"),o=a("Sb6f"),l=a("toub"),c=a("re9x"),d=a("G4GV"),u=a("hU3F"),p=a("wldR"),m=a("/6eU"),h=a("yNyh"),g=a("Ng05"),f=a("IYZQ"),b=a("mF3+"),y=a("HTHG"),S=a("J9+s"),v=a("qqdV");function E(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function M(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?E(Object(a),!0).forEach((function(t){C(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):E(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function C(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class w extends p.a{constructor(){super(...arguments),this.storeTypes={promoCodeStore:d.a,promoError:u.a.of(void 0)},this.handleModalDismiss=()=>{c.a.setState({open:!1})},this.handleChangeEmail=()=>{this.handleModalDismiss(),l.a.setState(M({},l.a.state,{open:!0,currentTab:"profile"}))},this.handleInputChange=e=>{this.stores.promoCodeStore.setState(M({},this.stores.promoCodeStore.state,{inputValue:e.target.value.toUpperCase()})),this.stores.promoError.set(void 0)},this.handleSubmitPromoCode=async()=>{const e=this.stores.promoCodeStore.state.inputValue;if(e){const t=await i.getPromoCode(this.environment,{code:e});"failed"!==t.type&&t.data.promo?c.a.state.open&&(await c.a.state.handlePromoCode(this.stores.promoCodeStore.state.inputValue),this.handleModalDismiss()):this.stores.promoError.set(this.props.intl.formatMessage({defaultMessage:"Promo code {code} does not exist",id:"studentNotEligibleModal.numberedList.item2.promocode.errorMessage"},{code:e}))}}}renderComponent(){const{open:e}=c.a.state;return r.a.createElement(m.a,{open:e,innerStyle:w.wrapStyle,preventHideChildrenWhileOpening:!0,render:()=>this.renderModalContents(),onDismiss:this.handleModalDismiss})}renderModalContents(){return r.a.createElement("div",{style:{fontSize:14}},r.a.createElement("div",null,r.a.createElement(S.FormattedMessage,{defaultMessage:"<p>Unfortunately you are not eligible for a free Personal Pro plan if you use this email address.</p><p>K-12 students, K-12 educators, and personal email addresses such as Gmail and Outlook are not eligible to receive the <pricinglink>Personal Pro Plan</pricinglink> for free, but anyone is welcome to use the <pricinglink>Personal Plan</pricinglink> for free with unlimited storage.</p>",id:"studentNotEligibleModal.header",values:{br:r.a.createElement("br",null),p:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return r.a.createElement("p",{style:{marginTop:0,marginBottom:8}},1===t.length?t[0]:r.a.Children.toArray(t))},pricinglink:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return r.a.createElement(f.a,{external:!0,href:v.c.pricing},t)}}})),this.renderSchoolEmailCodePrompt(),this.renderPromoCode(),this.renderContactUs())}renderSchoolEmailCodePrompt(){const e=Object(y.g)(this.environment);return r.a.createElement("div",{style:{display:"flex",marginTop:16}},r.a.createElement("div",{style:{width:18,flexShrink:0,color:this.theme.mediumTextColor}},r.a.createElement(S.FormattedMessage,{defaultMessage:"1.",id:"studentNotEligibleModal.numberedList.firstItem"})),r.a.createElement("div",{style:{flexGrow:1}},r.a.createElement("div",{style:{color:this.theme.mediumTextColor}},r.a.createElement(S.FormattedMessage,{defaultMessage:"Your current email is:",id:"studentNotEligibleModal.numberedList.changeEmailItem.message"})),r.a.createElement("div",{style:{fontWeight:o.a.fontWeight.medium,marginTop:0}},e&&e.email),r.a.createElement("div",{style:{color:this.theme.mediumTextColor,marginTop:4}},r.a.createElement(S.FormattedMessage,{defaultMessage:"Thousands of university, college, and post-secondary school domains are already eligible, not just .edu emails!",id:"studentNotEligibleModal.numberedList.changeEmailItem.message2"})),r.a.createElement(g.a,{style:{marginTop:12},onClick:this.handleChangeEmail,isLarge:!0},r.a.createElement(S.FormattedMessage,{defaultMessage:"Change email",id:"studentNotEligibleModal.numberedList.changeEmailItem.button.label"}))))}renderPromoCode(){const e=this.stores.promoError.get(),t=this.props.intl.formatMessage({defaultMessage:"Enter student promo code…",id:"studentNotEligibleModal.numberedList.item2.promocodePlaceholder"});return r.a.createElement("div",{style:{display:"flex",marginTop:16}},r.a.createElement("div",{style:{width:18,flexShrink:0,color:this.theme.mediumTextColor}},r.a.createElement(S.FormattedMessage,{defaultMessage:"2.",id:"studentNotEligibleModal.numberedList.secondItem"})),r.a.createElement("div",{style:{flexGrow:1}},r.a.createElement("div",{style:{color:this.theme.mediumTextColor}},r.a.createElement(S.FormattedMessage,{defaultMessage:"Have a student promo code?",id:"studentNotEligibleModal.numberedList.promoCodeItem.message"})),r.a.createElement("div",{style:{display:"flex",marginTop:12}},r.a.createElement(h.b,{style:{marginRight:8,height:32},value:this.stores.promoCodeStore.state.inputValue,onChange:this.handleInputChange,onSubmit:this.handleSubmitPromoCode,placeholder:t}),r.a.createElement(g.a,{onClick:this.handleSubmitPromoCode,disabled:!this.stores.promoCodeStore.state.inputValue,isLarge:!0},r.a.createElement(S.FormattedMessage,{defaultMessage:"Submit",id:"studentNotEligibleModal.numberedList.promoCodeItem.submitButton"}))),r.a.createElement("div",{style:{color:s.f.red,fontSize:12,marginTop:4,marginLeft:8,height:20}},e)))}renderContactUs(){return r.a.createElement("div",{style:{display:"flex",alignItems:"center",color:this.theme.lightTextColor,borderTop:"1px solid ".concat(this.theme.regularDividerColor),paddingTop:14}},b.a.help({width:14,marginTop:1,marginRight:6,fill:this.theme.lightIconColor})," ",r.a.createElement("div",null,r.a.createElement(S.FormattedMessage,{defaultMessage:"Have questions about this? <inlinelink>More info & FAQs</inlinelink>.",id:"studentNotEligibleModal.contactUsSection.message",values:{inlinelink:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return r.a.createElement(f.a,{href:"https://www.notion.so/Notion-for-students-teachers-adc631df15ee4ab9a7a33dd50f4c16fe",external:!0},t)}}})))}}w.wrapStyle={padding:"24px 36px 24px",minWidth:300,maxWidth:400},t.default=Object(S.injectIntl)(w)},gbUl:function(e,t,a){"use strict";a.r(t);a("ioFf"),a("rGqo"),a("Vd3H");var n=a("LvDl"),r=a.n(n),i=a("q1tI"),s=a.n(i),o=a("y6Dp"),l=a("4HCU"),c=a("QcDD"),d=a("wpmu"),u=a("HRSx"),p=a("7M94"),m=a("mF3+"),h=a("Z1H8"),g=a("2HDO"),f=a("zTdN"),b=a("gbGO"),y=a("WgIs"),S=a("RQ1t"),v=a("xRf7"),E=a("hbKx"),M=a("AXh+"),C=a("4aFz"),w=a("SR/M"),O=a("RgmA"),k=a("OxuQ"),P=a("24Pt"),T=a("wldR"),D=a("Sb6f"),I=a("tvfY"),F=a("5/h/"),j=a("J9+s");function x(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function B(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?x(Object(a),!0).forEach((function(t){A(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):x(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function A(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function R(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}class L extends T.a{constructor(){super(...arguments),this.createBlockStore=e=>{const{parentStore:t}=this.props;return d.a.createChildStore(t,{table:u.b,id:e})},this.createUserStore=e=>{const{parentStore:t}=this.props;return I.a.createChildStore(t,{table:F.a,id:e})},this.getUserValue=e=>this.createUserStore(e).getValue(),this.getCreatedTimeDetail=e=>{const{intl:t}=this.props,{starting:a,ending:n}=e;return a&&n?s.a.createElement(j.FormattedMessage,{defaultMessage:"Created {startDate} to {endDate}",id:"search.recentMenuItem.createdDateWithRange.subtitle",description:"Shown as part of the subtitle if the recent search involved searching for content created in a specific date range. {startDate} and {endDate} are dates including the month, day, and year.",values:{startDate:P.c(a,t),endDate:P.c(n,t)}}):a?s.a.createElement(j.FormattedMessage,{defaultMessage:"Created after {startDate}",id:"search.recentMenuItem.createdDateAfter.subtitle",description:"Shown as part of the subtitle if the recent search involved searching for content created after a specific date. {startDate} is a date including the month, day, and year.",values:{startDate:P.c(a,t)}}):n?s.a.createElement(j.FormattedMessage,{defaultMessage:"Created before {endDate}",description:"Shown as part of the subtitle if the recent search involved searching for content created before a specific date. {endDate} is a date including the month, day, and year.",id:"search.recentMenuItem.createdDateBefore.subtitle",values:{endDate:P.c(n,t)}}):void 0},this.getLastEditedTimeDetail=e=>{const{intl:t}=this.props,{starting:a,ending:n}=e;return a&&n?s.a.createElement(j.FormattedMessage,{defaultMessage:"Last edited {startDate} to {endDate}",id:"search.recentMenuItem.lastEditedDateWithRange.subtitle",description:"Shown as part of the subtitle if the recent search involved searching for content last edited in a specific date range. {startDate} and {endDate} are dates including the month, day, and year.",values:{startDate:P.c(a,t),endDate:P.c(n,t)}}):a?s.a.createElement(j.FormattedMessage,{defaultMessage:"Last edited after {startDate}",id:"search.recentMenuItem.lastEditedDateAfter.subtitle",description:"Shown as part of the subtitle if the recent search involved searching for content last edited after a specific date. {startDate} is a date including the month, day, and year.",values:{startDate:P.c(a,t)}}):n?s.a.createElement(j.FormattedMessage,{defaultMessage:"Last edited before {endDate}",description:"Shown as part of the subtitle if the recent search involved searching for content last edited before a specific date. {endDate} is a date including the month, day, and year.",id:"search.recentMenuItem.lastEditedDateBefore.subtitle",values:{endDate:P.c(n,t)}}):void 0},this.styles={recentSearchItem:()=>{const{device:e}=this.environment;return{minHeight:void 0,paddingTop:e.isMobile?12:8,paddingBottom:e.isMobile?12:8}},inlineCaption:{display:"block",marginTop:1},queryText:{flexShrink:0},detailEmphasis:{fontWeight:D.a.fontWeight.medium},enterIcon:{height:14,width:14},textWrapper:{marginLeft:8},iconWrapper:{height:19,width:19,display:"flex",alignItems:"center"}}}renderComponent(){const{device:e}=this.environment,t=this.props,{query:a}=t,n=R(t,["query"]),r=this.styles,i=this.getThemeColors(),o=s.a.createElement("div",{style:r.queryText},a.text.trim()),l=B({},r.recentSearchItem(),{},this.environment.device.isMobile&&i.menuItemMobile),c=!e.isMobile;return s.a.createElement(w.a,Object.assign({},n,{style:l,inline:c,icon:this.renderIcon(),title:o,caption:this.renderRecentSearchCaption(),captionStyle:c?r.inlineCaption:void 0,right:this.renderEnterIcon(),disableTransition:!0,dontShrinkRight:!0,textWrapperStyle:r.textWrapper,className:"notranslate"}))}renderRecentSearchCaption(){const{query:e}=this.props,{isNavigableOnly:t,ancestors:a,createdBy:n,editedBy:r,lastEditedTime:i,createdTime:o}=e.filters,l=[];if(t&&l.push(s.a.createElement(j.FormattedMessage,{defaultMessage:"Only match titles",id:"search.recentMenuItem.onlyMatchTitles.subtitle"})),a.length>0){const e=this.renderRecentSearchAncestors(a);l.push(s.a.createElement(j.FormattedMessage,{defaultMessage:"In {pages}",id:"search.recentMenuItemDetail.inPage.subtitle",description:"Shown as part of the subtitle if the recent search involved searching for content in specific pages. {pages} is the title of the first page that the search was conducted in, with something like '+ 1' or '+ 2' following it, depending on the number of additional pages that were searched.",values:{pages:this.renderListItems(e)}}))}if(n.length>0){const e=this.renderRecentSearchUsers(n);l.push(s.a.createElement(j.FormattedMessage,{defaultMessage:"Created by {people}",id:"search.recentMenuItemDetail.createdBy.subtitle",description:"Shown as part of the subtitle if the recent search involved searching for content created by specific people. {people} is the name of the first person, with something like '+ 1' or '+ 2' following it, depending on the number of additional people in the search.",values:{people:this.renderListItems(e)}}))}if(r.length>0){const e=this.renderRecentSearchUsers(r);l.push(s.a.createElement(j.FormattedMessage,{defaultMessage:"Edited by {people}",id:"search.recentMenuItemDetail.editedBy.subtitle",description:"Shown as part of the subtitle if the recent search involved searching for content edited by specific people. {people} is the name of the first person, with something like '+ 1' or '+ 2' following it, depending on the number of additional people in the search.",values:{people:this.renderListItems(e)}}))}if(o.starting||o.ending){const e=this.getCreatedTimeDetail(o);l.push(e)}if(i.starting||i.ending){const e=this.getLastEditedTimeDetail(i);l.push(e)}if(l.length>0)return Object(O.a)(l,()=>" · ")}renderListItems(e){if(0===e.length)return;if(1===e.length)return e;const[t,...a]=e,n=a.length;return s.a.createElement(j.FormattedMessage,{defaultMessage:"{firstPageOrPerson} + {numberRemaining}",id:"search.recentMenuItem.listOfPeopleOrPages.label",values:{firstPageOrPerson:t,numberRemaining:n},description:"This shows the people or pages the recent search item was conducted against. The '+' symbol means 'and'."})}renderRecentSearchAncestors(e){const t=this.styles;return e.map(e=>s.a.createElement(s.a.Fragment,{key:e}," ",s.a.createElement(k.a,{key:e,store:this.createBlockStore(e),style:t.detailEmphasis,shouldWrap:!0})))}renderRecentSearchUsers(e){const t=this.styles;return e.map(e=>{const a=this.getUserValue(e);return s.a.createElement(s.a.Fragment,{key:e}," ",s.a.createElement("span",{style:t.detailEmphasis},Object(F.e)(a)))})}renderEnterIcon(){const{device:e}=this.environment,{focused:t}=this.props,a=this.styles,n=this.getThemeColors();if(e.isMobile)return;const r=B({},a.enterIcon,{},n.enterIcon);return t?m.a.enter(r):void 0}renderIcon(){const{icon:e}=this.props;return s.a.createElement("div",{style:this.styles.iconWrapper},e)}getThemeColors(){return{menuItemMobile:{boxShadow:"0 1px 0 ".concat(this.theme.lightDividerColor)},enterIcon:{fill:this.theme.mediumIconColor}}}}L.contextTypes=b.c;var U=Object(j.injectIntl)(L),_=a("Pl3d"),W=a("CSYU"),N=a("H4VD"),q=a("cYwG"),V=a("ZQ9l"),z=a("VhAz");const H={listStyleType:"none",padding:0,margin:0};D.a.fontWeight.regular;function G(e,t){const a="UIRegular"===t?D.a.fontSize.UIRegular:"UISmall"===t?D.a.fontSize.UISmall:Object(z.e)(t);return e.device.isMobile?a.mobile:a.desktop}function Q(e,t){const a="UIRegular"===t?D.a.lineHeight.UIRegular:"UISmall"===t?D.a.lineHeight.UISmall:Object(z.e)(t);return e.device.isMobile?a.mobile:a.desktop}function Y(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}function Z(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function X(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(a),!0).forEach((function(t){K(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Z(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function K(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class J extends T.a{constructor(){super(...arguments),this.styles={menuItem:X({minHeight:void 0},this.environment.device.isMobile&&{background:void 0,boxShadow:void 0},{paddingTop:32,paddingBottom:32}),text:{textAlign:"center"},title:{margin:0,fontWeight:D.a.fontWeight.medium,fontSize:G(this.environment,"UIRegular"),lineHeight:Q(this.environment,"UIRegular")},caption:{fontSize:G(this.environment,"UIRegular")}}}renderComponent(){const e=this.props,{style:t}=e,a=Y(e,["style"]),n=t?X({},this.styles.menuItem,{},t):this.styles.menuItem;return s.a.createElement(V.a,Object.assign({},a,{title:this.renderTitle(),caption:this.renderCaption(),textWrapperStyle:this.styles.text,style:n}))}renderTitle(){const{title:e}=this.props;if(!e)return;const t=this.styles,a=this.getThemeColors(),n=X({},t.title,{},a.title);return s.a.createElement("h4",{role:"alert",style:n},e)}renderCaption(){const{caption:e}=this.props;if(!e)return;const t=this.styles,a=this.getThemeColors(),n=X({},t.caption,{},a.caption);return s.a.createElement("div",{style:n},e)}getThemeColors(){return{title:{color:this.theme.mediumTextColor},caption:{color:this.theme.lightTextColor}}}}J.contextTypes=X({},b.c);var $=J,ee=a("prF1"),te=a("/ssM"),ae=a("sZEU");function ne(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function re(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ne(Object(a),!0).forEach((function(t){ie(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ne(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function ie(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class se extends T.a{constructor(){super(...arguments),this.handleSendMessageClick=()=>{ae.a({environment:this.environment,from:"quick_find"})},this.styles={menuItem:{marginTop:"auto",marginBottom:"auto"},reportProblemButton:{display:"inline"}}}renderComponent(){return s.a.createElement($,Object.assign({},this.getErrorMessage(),{style:this.styles.menuItem}))}renderNoResults(){const{searchStore:e}=this.props,t=P.l(e.state.query.filters);return{title:se.noResultsTitle,caption:t?s.a.createElement(j.FormattedMessage,{defaultMessage:"Try different search terms or filters",id:"searchErrorMenuItem.errorPrompt.searchTermsAndFilters"}):s.a.createElement(j.FormattedMessage,{defaultMessage:"Try different search terms",id:"searchErrorMenuItem.errorPrompt.searchTerms"})}}renderOffline(){return{title:se.noResultsTitle,caption:s.a.createElement(j.FormattedMessage,{defaultMessage:"Go online for more results.",id:"searchErrorMenuItem.errorPrompt.goOnline"})}}renderRequestFailed(){var e=this;const t=this.styles,a=this.getThemeColors(),n=re({},t.reportProblemButton,{},a.reportProblemButton);return{title:s.a.createElement(j.FormattedMessage,{id:"searchErrorMenuItem.error.genericErrorMessage",defaultMessage:"Something went wrong"}),caption:s.a.createElement(j.FormattedMessage,{id:"searchErrorMenuItem.errorPrompt.refreshOrReport",defaultMessage:"Try refreshing or <reportlink>report a problem</reportlink>.",values:{reportlink:function(){for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return s.a.createElement(ee.a,{onClick:e.handleSendMessageClick,style:n},a)}}})}}getErrorMessage(){const{error:e}=this.props;switch(e.type){case te.d.NoResults.type:return this.renderNoResults();case te.d.Offline.type:return this.renderOffline();case te.d.RequestFailed.type:return this.renderRequestFailed();default:return Object(z.e)(e)}}getThemeColors(){return{reportProblemButton:{color:this.theme.blueColor}}}}se.contextTypes=re({},b.c),se.noResultsTitle=s.a.createElement(j.FormattedMessage,{defaultMessage:"No results",id:"searchErrorMenuItem.error.noResults"});var oe=se,le=a("PQqx"),ce=a("wlCD"),de=a("G8iD"),ue=a("2Y+N"),pe=a("ttM1");function me(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function he(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?me(Object(a),!0).forEach((function(t){ge(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):me(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function ge(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class fe extends T.a{constructor(){super(...arguments),this.renderKeyboardShortcut=(e,t)=>{const a=this.styles,n=this.getThemeColors(),r=he({},a.keyboardShortcut,{},n.keyboardShortcut,{},t);return s.a.createElement("span",{style:r},e)},this.styles={footer:()=>{const{device:e}=this.environment;return{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",fontSize:e.isMobile?D.a.fontSize.UIRegular.mobile:D.a.fontSize.UIRegular.desktop}},footerText:he({fontSize:G(this.environment,"UISmall")},D.a.textOverflowStyle),inlineHint:{display:"inline",marginRight:16},resultCountWrapper:he({display:"flex",alignItems:"center"},D.a.textOverflowStyle),resultCount:{fontWeight:D.a.fontWeight.medium},resultText:{verticalAlign:"middle",marginRight:6},spinner:{display:"inline",width:12,height:12,verticalAlign:"middle"},keyboardShortcut:{marginRight:4,marginBottom:1,fontVariant:"all-small-caps",fontSize:1.1*G(this.environment,"UISmall")},commandGlyph:{fontSize:.75*G(this.environment,"UIRegular")}}}renderComponent(){return this.props.mode===de.c.Mode.Results?this.renderResultState(this.props.results):this.renderSection(this.renderHelpText())}renderResultState(e){const t=this.styles,a=this.getThemeColors(),n=he({},t.resultCount,{},a.resultCount),{count:r,isLowerBound:i}=this.getResultCount(e),o=s.a.createElement("span",{style:t.resultText},i?this.props.intl.formatMessage({id:"searchFooter.helpText.resultCountApproximate",description:"Approximate number of results displayed in footer of search modal.",defaultMessage:"{resultCount, plural, other {<resultwrapper>{resultCount}+</resultwrapper> results}}"},{resultCount:r,resultwrapper:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return s.a.createElement("span",{style:n},t)}}):this.props.intl.formatMessage({id:"searchFooter.helpText.resultCount",description:"Exact number of results displayed in footer of search modal.",defaultMessage:"{resultCount, plural, one {<resultwrapper>{resultCount}</resultwrapper> result} other {<resultwrapper>{resultCount}</resultwrapper> results}}"},{resultCount:r,resultwrapper:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return s.a.createElement("span",{style:n},t)}})),l=s.a.createElement("div",{style:t.resultCountWrapper},o,this.props.mode===de.a.Results&&this.renderSpinner(this.props.showSpinner));return this.renderSection(l)}renderSpinner(e){const t=this.styles;return s.a.createElement(pe.a,{show:e,showDelay:500,showHold:200,render:e=>e&&s.a.createElement(ce.a,{style:t.spinner})})}renderSection(e){const t=this.styles,a=this.getThemeColors(),n=he({},t.footerText,{},a.footerText);return s.a.createElement(ue.a,{topBorder:!0,style:t.footer(),disableDesktopPadding:!0},s.a.createElement(V.a,{title:e,style:n}))}renderHelpText(){const e=this.styles,t=this.getThemeColors(),a=he({},H,{},e.footerText,{},t.footerText),n=he({},e.commandGlyph,{},t.keyboardShortcut),{command:r}=le.a(this.environment),{device:i}=this.environment;return s.a.createElement("ul",{style:a},s.a.createElement("li",{style:e.inlineHint},this.renderKeyboardShortcut("↑↓"),this.props.intl.formatMessage({id:"searchFooter.helpText.selectHint",defaultMessage:"Select"})),s.a.createElement("li",{style:e.inlineHint},this.renderKeyboardShortcut("Enter"),this.props.intl.formatMessage({id:"searchFooter.helpText.openHint",defaultMessage:"Open"})),s.a.createElement("li",{style:e.inlineHint},s.a.createElement("span",{style:n},r),this.renderKeyboardShortcut("+Enter"),i.isElectron?this.props.intl.formatMessage({id:"searchFooter.helpText.openNewWindow",defaultMessage:"Open in a new window"}):this.props.intl.formatMessage({id:"searchFooter.helpText.openNewTab",defaultMessage:"Open in a new tab"})))}getResultCount(e){const t=e.server?e.server.total:e.local.total;return{count:t,isLowerBound:Boolean(e.server&&e.local&&t<de.b)}}getThemeColors(){return{footerText:{color:this.theme.lightTextColor},resultCount:{color:this.theme.mediumTextColor},keyboardShortcut:{color:this.theme.mediumTextColor}}}}var be=Object(j.injectIntl)(fe),ye=a("d9nj"),Se=a("i3uR"),ve=a("g4rC"),Ee=a("D2XV"),Me=a("zmp8"),Ce=a("LEzx");const we="Invalid date",Oe="Invalid range";class ke extends Ce.a{getInitialState(){return{edited:!1,temporary:"",error:void 0}}}var Pe=ke,Te=a("yNyh"),De=a("dXb3"),Ie=a("awNq"),Fe=a("LeVO");function je(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function xe(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?je(Object(a),!0).forEach((function(t){Be(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):je(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Be(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ae(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}class Re extends T.a{constructor(){super(...arguments),this.storeTypes={store:Pe},this.renderInput=()=>{const{device:e}=this.environment,t=this.props,{store:a,hideClearButton:n,focused:r}=t,i=Ae(t,["store","hideClearButton","focused"]),o=e.isMobile?"date":"text",l="date"===o?Te.b.Format.Transparent:Te.b.Format.Large,c=e.isMobile?void 0:r;return s.a.createElement(De.a,Object.assign({},i,{type:o,format:l,left:this.renderMobilePlaceholder(o),showClearButton:this.showClearButton(),focus:c,onFocus:this.handleFocus,onClearButtonClick:this.handleClear,onChange:this.handleChange,onSubmit:this.handleSubmit,onBlur:this.handleBlur,value:this.getInputValue()},this.getInputStyles()))},this.handleFocus=e=>{const{onFocus:t}=this.props,{store:a}=this.stores;a.setState(xe({},a.state,{edited:!1})),t&&t(e)},this.handleClear=()=>{const{onClear:e,onUpdate:t}=this.props,{store:a}=this.stores;a.setState(xe({},a.state,{edited:!0,temporary:"",error:void 0}));const n=this.validateCurrent();n&&t(n),a.setState(xe({},a.state,{edited:!1})),e&&e()},this.handleChange=e=>{const{device:t}=this.environment,{store:a}=this.stores;a.setState(xe({},a.state,{edited:!0,temporary:e.target.value||""})),t.isAndroid&&this.handleBlur()},this.handleSubmit=e=>{const{onUpdate:t,onSubmit:a}=this.props,{store:n}=this.stores,r=this.validateCurrent();r&&(t(r),r.error?n.setState(xe({},n.state,{edited:!1,error:r.error})):n.reset()),a&&a(e,r)},this.handleBlur=e=>{const{onUpdate:t,onBlur:a}=this.props,{store:n}=this.stores,r=this.validateCurrent();r?(t(r),r.error?n.setState(xe({},n.state,{edited:!1,error:r.error})):n.reset()):n.setState(xe({},n.state,{edited:!1})),e&&a&&a(e)},this.styles={menuItem:{marginBottom:this.environment.device.isMobile?1:12},inputWrapper:{borderRadius:3,height:28,paddingRight:this.showClearButton()?6:0,position:"relative"},inputEditRegion:{width:this.showClearButton()?"calc(100% - 14px)":"100%"},inputEditRegionMobile:{padding:"2px 6px",position:"relative"},placeholder:{position:"absolute",left:6,top:"50%",transform:"translateY(-50%)"},tooltipOriginGap:-8}}didUpdate(e){const{store:t}=this.stores;r.a.isEqual(e.value,this.props.value)||t.reset()}renderComponent(){const e=this.styles,t=this.getError();return t?s.a.createElement(Fe.a,{renderTooltip:()=>t,forceVisibleState:!0,placement:Fe.a.Placement.Left,render:this.renderInput,originGap:e.tooltipOriginGap}):this.renderInput()}renderMobilePlaceholder(e){const{placeholder:t,value:a}=this.props,n=this.styles,r=this.getThemeColors();if("date"===e&&!a)return s.a.createElement("div",{style:xe({},n.placeholder,{},r.placeholder)},t)}getInputValue(){const{device:e}=this.environment,{value:t,dateFormat:a,intl:n}=this.props,{store:r}=this.stores;return e.isMobile?t?P.c(t,n,"YYYY-MM-DD"):"":r.state.temporary?r.state.temporary:r.state.edited?r.state.temporary:t?P.c(t,n,a):""}getError(){const{store:e}=this.stores,{intl:t}=this.props;if(e.state.error)switch(e.state.error){case we:return t.formatMessage({id:"dateInputError.invalidDateError.tooltip",defaultMessage:"Invalid date"});case Oe:return t.formatMessage({id:"dateInputError.invalidDateRangeError.tooltip",defaultMessage:"Invalid range"});default:return Object(z.e)(e.state.error)}}validateCurrent(){const{validate:e}=this.props,t=this.parseCurrentValue();if(t)return e?e(t):t}parseCurrentValue(){const{store:e}=this.stores;if(!e.state.edited)return;if(!e.state.temporary)return{value:void 0};const t=Object(Ie.a)(e.state.temporary,this.props.intl);return t?{value:{type:"date",start_date:t}}:{error:we}}showClearButton(){const{device:e}=this.environment,{hideClearButton:t}=this.props;return!!e.isMobile||!t}getInputStyles(){const{device:e}=this.environment,{inputStyle:t,inputOuterStyle:a,style:n}=this.props,r=this.styles;return{style:xe({},r.menuItem,{},n),inputOuterStyle:xe({},this.getInputBorders(),{},r.inputWrapper,{},a),inputStyle:xe({},r.inputEditRegion,{},e.isMobile&&r.inputEditRegionMobile,{},t)}}getInputBorders(){const{disabled:e,focused:t}=this.props,a=this.getThemeColors(),n=this.getError();if(!e)return n?a.inputError:t?a.inputFocused:a.inputDefault}getThemeColors(){return{inputDefault:{background:this.theme.inputBackground,boxShadow:this.theme.inputBoxShadow},inputFocused:{background:Me.f.blueWithAlpha(.15),boxShadow:"inset 0 0 0 2px ".concat(Me.f.blue)},inputError:{background:Me.f.redWithAlpha(.15),boxShadow:"inset 0 0 0 2px ".concat(Me.f.red)},placeholder:{color:this.theme.lightTextColor}}}}var Le=Object(j.injectIntl)(Re),Ue=a("BFWj"),_e=a.n(Ue),We=a("lCCU"),Ne=a("mKX5"),qe=a("HTHG"),Ve=a("T8dS"),ze=a("QgQJ");function He(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ge(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?He(Object(a),!0).forEach((function(t){Qe(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):He(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Qe(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Ye extends T.a{constructor(){super(...arguments),this.renderMonthControl=e=>{const{device:t}=this.environment,a=this.styles;return s.a.createElement("div",{style:a.monthControl},s.a.createElement(We.a,{mobileFeedback:t.isMobile,icon:m.a.chevronLeft,onClick:()=>e.onPreviousClick()}),s.a.createElement(We.a,{mobileFeedback:t.isMobile,icon:m.a.chevronRight,onClick:()=>e.onNextClick()}))},this.handleDayClick=e=>{const{disabled:t,store:a,value:n,validate:r,onUpdate:i}=this.props,s=a.getFocus(),o=Ee.i.toPersistedDate(e);if(t)return;const l="starting"===s?"ending":"starting",c=n[l];if(c&&o.start_date===c.start_date)a.setState(Ge({},a.state,{focus:l}));else{const e=r(s,{value:o});if(i(e.error?e:{value:{[s]:e.value[s]}}),a.setState(Ge({},a.state,{hovered:void 0})),e.error)return;"starting"!==s||n.ending||a.setState(Ge({},a.state,{focus:"ending"}))}},this.handleDayMouseEnter=e=>{const{disabled:t,store:a,value:n}=this.props,r=a.getFocus(),i=Ee.i.toMoment(e);if(!t)if("starting"===r&&n.ending&&!n.starting){Ee.i.toMoment(n.ending).isSameOrAfter(i)&&a.setState(Ge({},a.state,{hovered:e}))}else if("ending"===r&&n.starting&&!n.ending){Ee.i.toMoment(n.starting).isSameOrBefore(i)&&a.setState(Ge({},a.state,{hovered:e}))}},this.handleMonthChange=e=>{const{store:t}=this.props;t.setState(Ge({},t.state,{displayMonth:Object(Ne.a)(e)}))},this.styles={dayPickerWrapper:{display:"block"},monthControl:{position:"absolute",top:0,right:0,display:"flex"},selectedRange:{backgroundColor:Me.f.blueWithAlpha(.15)},active:{backgroundColor:Me.f.blue,color:Me.f.white},inactive:{backgroundColor:Me.f.blueWithAlpha(.5)},disabled:{pointerEvents:"none"},today:{fontWeight:D.a.fontWeight.regular}}}renderComponent(){const e=this.styles,t=this.getDisplayMonth();return s.a.createElement(_e.a,{className:"notion-calendar-picker",containerProps:{style:e.dayPickerWrapper},initialMonth:t,month:t,numberOfMonths:1,firstDayOfWeek:this.getFirstDayOfWeek(),locale:Ve.a,localeUtils:ze.a,showOutsideDays:!0,fixedWeeks:!0,navbarElement:this.renderMonthControl,onDayClick:this.handleDayClick,onDayMouseEnter:this.handleDayMouseEnter,onMonthChange:this.handleMonthChange,modifiers:this.getModifiers(),modifiersStyles:this.getModifiersStyles()})}getCurrentDate(){if(!this.currentDate){const e=Ee.nb(Ee.m);this.currentDate=Ee.i.toNative(e)}return this.currentDate}getDisplayMonth(){const{value:e,store:t}=this.props;if(t.state.displayMonth)return t.state.displayMonth.toDate();if("starting"===t.getFocus()){if(e.starting)return Ee.i.toNative(e.starting);if(e.ending)return Ee.i.toNative(e.ending)}if("ending"===t.getFocus()){if(e.ending)return Ee.i.toNative(e.ending);if(e.starting)return Ee.i.toNative(e.starting)}return this.getCurrentDate()}getFirstDayOfWeek(){return qe.q.state}getModifiers(){const{store:e,disabled:t,value:a}=this.props,n=this.getDisabledModifier(),{hovered:r}=e.state;if(t)return{disabled:n};if(a.starting&&a.ending){const e=Ee.i.toNative(a.starting),t=Ee.i.toNative(a.ending);return{range:{from:e,to:t},start:e,end:t,disabled:n}}if(a.starting){const e=Ee.i.toNative(a.starting);return{range:r&&{from:e,to:r},start:e,end:r,disabled:n,selected:[e,r]}}if(a.ending){const e=Ee.i.toNative(a.ending);return{range:r&&{from:r,to:e},start:r,end:e,disabled:n,selected:[e,r]}}}getDisabledModifier(){const{value:e,disabled:t,store:a}=this.props;if(t)return e=>!0;const n=e=>"ending"===a.getFocus()?{before:e}:void 0,r=e=>"starting"===a.getFocus()?{after:e}:void 0;if(e.starting&&e.ending){const t=Ee.i.toNative(e.starting),a=Ee.i.toNative(e.ending);return n(t)||r(a)}if(e.starting){return n(Ee.i.toNative(e.starting))}if(e.ending){return r(Ee.i.toNative(e.ending))}}getModifiersStyles(){const{store:e}=this.props,t=this.styles,a=this.getThemeColors(),n=e.getFocus(),r=t.selectedRange,i=Ge({},t.disabled,{},a.disabled),s=Ge({},t.today,{},a.today);return{range:r,start:"starting"===n?t.active:t.inactive,end:"ending"===n?t.active:t.inactive,disabled:i,today:s}}getThemeColors(){return{disabled:{color:this.theme.lightTextColor},today:{color:Me.f.white}}}}var Ze=Ye,Xe=a("vl8/"),Ke=a("nPEg");function Je(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function $e(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Je(Object(a),!0).forEach((function(t){et(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Je(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function et(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const tt=Object(j.defineMessages)({startingMessage:{defaultMessage:"Starting",id:"search.dateRangeMenu.startingMessage"},endingMessage:{defaultMessage:"Ending",id:"search.dateRangeMenu.endingMessage"}});class at extends T.a{constructor(){super(...arguments),this.renderInputs=()=>{const{value:e,store:t,disabled:a}=this.props,n=t.getFocus(),r=this.getRangeBounds();return s.a.createElement(s.a.Fragment,null,s.a.createElement(Le,{disabled:a,placeholder:Xe.default.formatMessage(tt.startingMessage),focused:"starting"===n,value:e.starting,validate:this.validateStart,onUpdate:this.handleUpdateStart,onFocus:()=>this.handleFocus("starting"),onSubmit:this.handleStartSubmit,inputElementAttributes:{max:r.latestValidStarting},inputOuterStyle:this.styles.firstDateInput}),s.a.createElement(Le,{disabled:a,placeholder:Xe.default.formatMessage(tt.endingMessage),focused:"ending"===n,value:e.ending,validate:this.validateEnd,onUpdate:this.handleUpdateEnd,onFocus:()=>this.handleFocus("ending"),onSubmit:this.handleEndSubmit,inputElementAttributes:{min:r.earliestValidEnding}}))},this.renderCalendar=()=>{const{device:e}=this.environment,{value:t,store:a,onUpdate:n}=this.props,r=this.styles,i=this.getThemeColors(),o=$e({},r.pickerSection,{},e.isMobile&&r.pickerSectionMobile,{},e.isMobile&&i.pickerSectionMobile);return s.a.createElement(ue.a,null,s.a.createElement("div",{style:o},s.a.createElement(Ze,{value:t,store:a,onUpdate:n,validate:this.validateField})))},this.handleFocus=e=>{const{store:t}=this.props;t.setState($e({},t.state,{focus:e}))},this.handleUpdateStart=e=>{const{onUpdate:t}=this.props;e.error||t({value:{starting:e.value}})},this.handleUpdateEnd=e=>{const{onUpdate:t}=this.props;e.error||t({value:{ending:e.value}})},this.handleStartSubmit=(e,t)=>{const{store:a}=this.props;t&&t.error||a.setState($e({},a.state,{focus:"ending"}))},this.handleEndSubmit=(e,t)=>{const{onDismiss:a}=this.props;t&&t.error||a&&a(e)},this.validateStart=e=>{const t=this.validateField("starting",e);return t.error?t:{value:t.value.starting}},this.validateEnd=e=>{const t=this.validateField("ending",e);return t.error?t:{value:t.value.ending}},this.validateField=(e,t)=>{const{value:a}=this.props;return t.error?t:this.validateRange($e({},a,{[e]:t.value}))},this.validateRange=e=>{if(e.starting&&e.ending){const t=Ee.i.toMoment(e.starting);return Ee.i.toMoment(e.ending).isSameOrAfter(t)?{value:e}:{error:Oe}}return{value:e}},this.getMenuProps=()=>{const{device:e}=this.environment,{onDismiss:t,title:a}=this.props;if(e.isMobile){return{menuType:b.b.MenuType.Modal,title:a,right:s.a.createElement(Ke.DoneMenuText,null),onClickRight:t,header:this.renderInputs()}}return{menuType:b.b.MenuType.Popup,onClickOutside:t}},this.styles={pickerSection:{paddingLeft:16,paddingRight:16},pickerSectionMobile:{paddingTop:16,paddingBottom:8},firstDateInput:{marginTop:2}}}renderComponent(){const{device:e}=this.environment;return s.a.createElement(b.b,Object.assign({},this.getMenuProps()),!e.isMobile&&this.renderInputs(),this.renderCalendar())}getRangeBounds(){const{value:e,intl:t}=this.props;return{earliestValidEnding:e.starting&&P.c(e.starting,t,Ee.ib),latestValidStarting:e.ending&&P.c(e.ending,t,Ee.ib)}}getThemeColors(){return{pickerSectionMobile:{background:this.theme.popoverBackground,boxShadow:"0 1px 0 ".concat(this.theme.regularDividerColor),marginBottom:1}}}}var nt=Object(j.injectIntl)(at),rt=a("VyA+");function it(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function st(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class ot extends T.a{constructor(){super(...arguments),this.styles={removeFilterButton:{height:void 0,width:void 0},removeFilterButtonMobile:{marginRight:-12,marginTop:-12,marginBottom:-12,paddingRight:12,paddingTop:12,paddingBottom:12}}}renderComponent(){const{onClick:e,disabled:t}=this.props,a=this.styles,{device:n}=this.environment,r=n.isMobile?function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?it(Object(a),!0).forEach((function(t){st(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):it(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},a.removeFilterButton,{},a.removeFilterButtonMobile):a.removeFilterButton;return s.a.createElement(We.a,{icon:m.a.clearInput,onClick:e,disabled:t,disableBackground:!0,style:r})}}var lt=ot,ct=a("wXH4");class dt extends Ce.a{getInitialState(){return{isOpen:!1,focus:"starting",temporary:{},displayMonth:void 0,hovered:void 0}}getFocus(){return this.state.focus}}var ut=dt,pt=a("lEhh");function mt(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}class ht extends T.a{constructor(){super(...arguments),this.styles={menuItem:{background:void 0,minHeight:void 0,fontSize:this.environment.device.isMobile?D.a.fontSize.UISmall.mobile:D.a.fontSize.UIRegular.desktop,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},labeledMenuItemTitle:{display:"inline-flex",alignItems:"center"},menuItemLabel:{marginTop:0},rightWrapper:{display:"flex",alignItems:"center",marginTop:"-50%",marginBottom:"-50%",height:44}}}renderComponent(){const e=this.props,{disabled:t,label:a,title:n,onClick:r,isToggle:i}=e,o=mt(e,["disabled","label","title","onClick","isToggle"]),l=this.getThemeColors(),c=this.styles,d=s.a.createElement("span",{style:l.menuItemLabel},a);return s.a.createElement(w.a,Object.assign({focused:!1},o,{inline:i,disabled:t,icon:d,title:n,right:this.renderRight(),onClick:r,dontShrinkIcon:!0,dontShrinkRight:!0,shouldWrapTitle:!0,style:c.menuItem,desktopIconStyle:c.menuItemLabel}))}renderRight(){const{disabled:e}=this.props,t=this.styles.rightWrapper;return this.props.isToggle?s.a.createElement("div",{style:t},s.a.createElement(pt.a,{on:this.props.isToggleActive,onClick:this.props.onClick})):s.a.createElement(lt,{disabled:e,onClick:this.props.onClickClear})}getThemeColors(){return{menuItemLabel:{color:this.theme.lightTextColor}}}}var gt,ft=ht,bt=a("kIZi"),yt=a("Mht8"),St=a("W3at"),vt=a("zb5D");function Et(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Mt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}!function(e){e.Token="token",e.Text="text"}(gt||(gt={}));class Ct extends T.a{constructor(){super(...arguments),this.storeTypes={requestStore:W.a,menuListStore:S.a},this.renderRequest=(e,t,a)=>{const{labelText:n,value:r}=this.props,{menuListStore:i}=this.stores,o=e=>s.a.createElement(ue.a,Object.assign({},e,{title:n.resultSectionTitle,loading:!a}));if(e)return yt.log({level:"error",from:n.componentDebugName,type:"requestFailed",error:Object(vt.a)(e),data:{miscDataToConvertToString:{query:r}}}),s.a.createElement(o,null,s.a.createElement(f.a,{title:s.a.createElement(j.FormattedMessage,{defaultMessage:"Something went wrong.",id:"search.inputMenu.errorMessage"})}));if(!t)return s.a.createElement(o,null,s.a.createElement(f.a,{title:s.a.createElement(j.FormattedMessage,{defaultMessage:"Loading…",id:"search.inputMenu.loading.message"})}));if(t&&0===t.length)return s.a.createElement(o,null,s.a.createElement(f.a,{title:s.a.createElement(j.FormattedMessage,{defaultMessage:"No results found.",id:"search.inputMenu.noResults.message"})}));const l={key:"results",items:t.map(this.getResultMenuItem),render:o};return s.a.createElement(y.a,{type:y.a.Type.Vertical,store:i,initialFocus:0,sections:[l]})},this.handleMenuInputRemoveLast=()=>{if(this.props.inputType!==gt.Token)return;const{items:e,onRemove:t}=this.props,a=r.a.last(e);a&&t(a)},this.getResultMenuItem=e=>{const{renderResultMenuItem:t,onConfirm:a}=this.props;return{key:e,action:()=>a(e),render:a=>t(e,a)}},this.styles={input:{borderBottomLeftRadius:0,borderBottomRightRadius:0,boxShadow:this.theme.borderBoxShadow},menu:{width:250,maxHeight:"40vh"}}}renderComponent(){const{value:e,items:t,performRequest:a}=this.props,{requestStore:n}=this.stores,r={query:e,current:t};return s.a.createElement(b.b,Object.assign({},this.getMenuProps()),s.a.createElement(_.a,{debounce:100,requestStore:n,request:r,performRequest:a,render:this.renderRequest}))}renderSearchInput(){return this.props.inputType===gt.Token?this.renderTokenInput(this.props):this.props.inputType===gt.Text?this.renderTextInput(this.props):void Object(z.e)(this.props)}renderTokenInput(e){const{labelText:t,value:a,items:n,disabled:r,onChange:i,renderToken:o,onRemove:l}=e,c=n.map(e=>o(e,{onRemove:()=>l(e)}));return s.a.createElement(St.a,{format:St.a.Format.Group,focus:!this.isMobile()||void 0,focusInitial:this.isMobile(),focusAfterAnimation:!0,placeholder:t.tokenInputPlaceholder,value:a,tokens:c,disabled:Boolean(r),onChange:i,onRemoveLastToken:this.handleMenuInputRemoveLast})}renderTextInput(e){const{labelText:t,value:a,disabled:n,onChange:r,onClear:i}=e,o=this.styles,l=this.isMobile()?De.a:Te.b;return s.a.createElement(l,{format:Te.b.Format.Large,disabled:n,showClearButton:!0,placeholder:t.tokenInputPlaceholder,value:a,onChange:r,onClearButtonClick:i,focus:!this.isMobile()||void 0,focusInitial:this.isMobile(),focusAfterAnimation:!0,style:this.isMobile()?void 0:o.input})}getMenuProps(){const{onDismiss:e,labelText:t}=this.props,a=this.styles;if(this.isMobile()){return{menuType:b.b.MenuType.Modal,title:t.title,right:s.a.createElement(Ke.DoneMenuText,null),onClickRight:e,header:this.renderSearchInput()}}return function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Et(Object(a),!0).forEach((function(t){Mt(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Et(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({menuType:b.b.MenuType.Popup,onClickOutside:e,header:this.renderSearchInput()},a.menu)}isMobile(){const{device:e}=this.environment;return e.isMobile}}Ct.InputType=gt;var wt=Ct;class Ot extends Ce.a{getInitialState(){return{isMenuOpen:!1,inputTemporaryValue:"",indexToReplace:void 0,popupOriginRect:void 0}}}var kt,Pt=Ot;function Tt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Dt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Tt(Object(a),!0).forEach((function(t){It(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Tt(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function It(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}!function(e){e.Button="Button",e.Section="Section"}(kt||(kt={}));class Ft extends T.a{constructor(){super(...arguments),this.origin=s.a.createRef(),this.storeTypes={componentStore:Pt},this.renderMobileFilterSummary=e=>{const{title:t,items:a,renderItemForSummary:n}=this.props,{disableFilters:r}=e,i=this.styles,o=Dt({},H,{},i.summary),l=a.length-1,c=s.a.createElement("ul",{style:o},a.map((e,t)=>s.a.createElement("li",{key:e,style:i.summaryItem},s.a.createElement(s.a.Fragment,null,n(e),t!==l&&","," "))));return s.a.createElement(ft,{disabled:r,onClick:this.handleMenuOpenMobile,onClickClear:this.clearItems,label:t,title:c})},this.renderMenu=()=>{const{renderToken:e}=this.props,{componentStore:{state:t}}=this.stores,a={inputType:wt.InputType.Token,onRemove:this.handleFilterRemove,renderToken:e},n={inputType:wt.InputType.Text},r=this.getMenuType()===wt.InputType.Token?a:n;return s.a.createElement(wt,Object.assign({},this.props,{value:t.inputTemporaryValue,onChange:this.handleMenuInputChange,onDismiss:this.handleMenuClose,onConfirm:this.handleItemConfirm,onClear:this.handleClearTemporary},r))},this.handleMenuOpen=e=>{this.scheduleMeasurement(void 0,t=>Dt({},t,{isMenuOpen:!0,indexToReplace:e}))},this.handleMenuOpenMobile=()=>{const{componentStore:e}=this.stores;e.setState(Dt({},e.state,{isMenuOpen:!0}))},this.handleMenuClose=()=>{const{onMenuDismiss:e}=this.props,{componentStore:t}=this.stores;t.setState(Dt({},t.state,{isMenuOpen:!1,indexToReplace:void 0})),e&&e()},this.handleClearTemporary=()=>{const{componentStore:e}=this.stores;e.setState(Dt({},e.state,{inputTemporaryValue:""}))},this.handleItemConfirm=e=>{const{items:t}=this.props,{componentStore:a}=this.stores,{indexToReplace:n}=a.state;"number"==typeof n&&n<t.length?this.replaceItem(n,e):this.addItem(e),this.clearInput(),this.getMenuType()===wt.InputType.Text&&this.handleMenuClose()},this.handleFilterRemove=e=>{this.removeItem(e)},this.handleMenuInputChange=e=>{const{componentStore:t}=this.stores,{target:a}=e;t.setState(Dt({},t.state,{inputTemporaryValue:String(a.value)}))},this.scheduleMeasurement=(e,t)=>{this.animationFrame=requestAnimationFrame(this.measureOriginRect(t))},this.measureOriginRect=e=>t=>{const{componentStore:a}=this.stores;if(!this.origin)return;if(!this.origin.current)return;const n=e?e(a.state):a.state;a.setState(Dt({},n,{popupOriginRect:this.origin.current.getBoundingClientRect()}))},this.isMenuOpen=()=>{const{componentStore:{state:e}}=this.stores;return e.isMenuOpen},this.removeItem=e=>{const{items:t,onChange:a}=this.props;a(t.filter(t=>t!==e))},this.clearItems=()=>{const{onChange:e}=this.props;e([])},this.replaceItem=(e,t)=>{const{items:a,onChange:n}=this.props;n(a.slice(0,e).concat(t,a.slice(e+1)))},this.clearInput=()=>{const{componentStore:e}=this.stores;e.setState(Dt({},e.state,{inputTemporaryValue:"",indexToReplace:void 0}))},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},appendListItemButton:{minHeight:void 0,paddingTop:4,paddingBottom:4,fontSize:G(this.environment,"UIRegular")},icon:{height:14,width:14,fill:"currentColor"},iconSmall:{height:12,width:12},summary:{display:"inline"},summaryItem:{display:"inline"}}}didMount(){window.addEventListener("resize",this.scheduleMeasurement)}willUnmount(){window.removeEventListener("resize",this.scheduleMeasurement),this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=void 0)}didUpdate(e){(e.items.length!==this.props.items.length||e.mode!==this.props.mode)&&this.scheduleMeasurement()}renderComponent(){const{device:e}=this.environment,{mode:t}=this.props;return e.isMobile?this.renderMobile(t):this.renderDesktop(t)}renderDesktop(e){const{title:t,disabled:a}=this.props,{componentStore:{state:n}}=this.stores,r=a||n.isMenuOpen,i=e===Ft.Mode.Section,o=i?t:void 0,l=i?this.renderSectionOrigin():this.renderButtonOrigin();return s.a.createElement(bt.a,{title:o,marginAfter:i},this.renderFilters({disableFilters:r,showLabel:!1}),l,s.a.createElement(ct.c,{popupType:ct.c.PopupType.Popup,placementToOrigin:ct.c.Placement.Bottom,alignmentToOrigin:ct.c.Alignment.Start,open:this.isMenuOpen(),originRect:n.popupOriginRect,render:this.renderMenu,onDismiss:this.handleMenuClose,keepFocus:!0,preventScaleTransition:!0}))}renderButtonOrigin(){const{icon:e,title:t,disabled:a,focused:n}=this.props,r=this.styles,i=this.getThemeColors(),o=Dt({},r.menuItem,{},i.buttonMenuItem);return s.a.createElement("div",{ref:this.origin},s.a.createElement(w.a,{disabled:a||this.isMenuOpen(),icon:e(r.icon),title:t,focused:n,onClick:e=>this.handleMenuOpen(),style:o}))}renderSectionOrigin(){const{addItemLabel:e,disabled:t}=this.props,a=this.styles,n=this.getThemeColors();return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{ref:this.origin}),s.a.createElement(w.a,{disabled:t||this.isMenuOpen(),icon:m.a.plus(a.iconSmall),title:e,focused:!1,onClick:e=>this.handleMenuOpen(),style:Dt({},a.appendListItemButton,{},n.appendListItemButton)}))}renderMobile(e){const{disabled:t}=this.props,a=t||this.isMenuOpen(),n=e===Ft.Mode.Section?this.renderMobileFilterSummary({disableFilters:a}):this.renderMobileButtonOrigin({disableFilters:a});return s.a.createElement(ct.c,{popupType:ct.c.PopupType.SlideUp,open:this.isMenuOpen(),origin:n,render:this.renderMenu,onDismiss:this.handleMenuClose,keepFocus:!0})}renderMobileButtonOrigin(e){const{icon:t,title:a}=this.props,n=this.styles;return s.a.createElement(w.a,{disabled:e.disableFilters,focused:!1,icon:t(n.icon),title:a,onClick:e=>this.handleMenuOpenMobile()})}renderFilters(e){const{items:t,renderFilter:a}=this.props,{device:n}=this.environment,r=t.map((t,r)=>s.a.createElement("li",{key:"".concat(t,"_").concat(r)},a(t,{disabled:e.disableFilters,onRemove:()=>this.handleFilterRemove(t),onClick:()=>n.isMobile?this.handleMenuOpenMobile():this.handleMenuOpen(r)})));return s.a.createElement("ul",{style:H},r)}getMenuType(){const{device:e}=this.environment;return e.isMobile?wt.InputType.Token:wt.InputType.Text}addItem(e){const{items:t,onChange:a}=this.props,n=t.concat(e);a(r.a.uniq(n))}getThemeColors(){return{buttonMenuItem:{color:this.theme.mediumTextColor},appendListItemButton:{color:this.theme.lightTextColor}}}}Ft.Mode=kt;var jt=Ft;function xt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Bt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?xt(Object(a),!0).forEach((function(t){At(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):xt(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function At(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Rt extends T.a{constructor(){super(...arguments),this.storeTypes={store:ut},this.renderActiveButtonOrigin=()=>{const{value:e,dateFormat:t,disabled:a,focused:n,intl:r}=this.props,i=this.styles,o=this.getThemeColors(),l=Bt({},i.menuItem,{},o.activeMenuItem),c=P.d(e,r,t),d=s.a.createElement(lt,{onClick:this.handleClear,disabled:a});return s.a.createElement(w.a,{focused:n,disabled:a,icon:m.a.calendar(i.iconActiveDesktop),title:c,right:d,isTokenTitle:!0,alignIconTop:!0,onClick:this.handleOriginActivate,desktopTitleStyle:i.menuItemTitleDesktop,desktopIconStyle:i.iconActiveDesktopWrapper,style:l})},this.renderInactiveButtonOrigin=()=>{const{title:e,icon:t,disabled:a,focused:n}=this.props,r=this.styles,i=this.getThemeColors(),o=Bt({},r.menuItem,{},i.buttonMenuItem);return s.a.createElement(w.a,{focused:n,disabled:a,icon:t(r.icon),title:e,onClick:this.handleOriginActivate,style:o})},this.renderPopupContents=()=>{const{title:e}=this.props,{store:t}=this.stores;return s.a.createElement(nt,{title:e,value:this.getCurrentValue(),onUpdate:this.updateTemporary,store:t,onDismiss:this.handleMenuClose})},this.handleOriginActivate=()=>{const{disabled:e}=this.props,{store:t}=this.stores;e||t.setState(Bt({},t.state,{isOpen:!0,focus:"starting"}))},this.handleMenuClose=e=>{const{onChange:t,onMenuDismiss:a}=this.props,{store:n}=this.stores,{temporary:r}=n.state;P.a(e)||(t(r),n.setState(Bt({},n.state,{isOpen:!1,temporary:{}})),a&&a())},this.handleClear=()=>{const{onChange:e}=this.props;e({starting:void 0,ending:void 0})},this.handleMenuListKey=e=>{e.preventDefault&&e.preventDefault()},this.updateTemporary=e=>{const{store:t}=this.stores;if(!e.error)return t.setState(Bt({},t.state,{temporary:Bt({},t.state.temporary,{},e.value)}))},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},icon:{height:14,width:14,fill:"currentColor"},iconActiveDesktop:{height:14,width:14,fill:"currentColor",alignSelf:"flex-start",marginTop:2,marginRight:2},iconActiveDesktopWrapper:{marginTop:0},iconActiveMobile:{height:14,width:14,fill:"currentColor",marginTop:1,marginRight:6},popup:{paddingTop:12,paddingBottom:8},menuItemTitleDesktop:{width:"100%"},summary:{display:"inline-flex"}}}renderComponent(){const{device:e}=this.environment,{mode:t}=this.props;return e.isMobile?this.renderMobile(t):this.renderDesktop(t)}renderDesktop(e){const{title:t}=this.props,{store:a}=this.stores,n=this.styles,r=e===kt.Section,i=r?t:void 0,o=r?this.renderActiveButtonOrigin():this.renderInactiveButtonOrigin();return s.a.createElement(bt.a,{title:i,marginAfter:r},s.a.createElement(rt.a,{capture:a.state.isOpen,onUp:this.handleMenuListKey,onDown:this.handleMenuListKey,onEnter:this.handleMenuListKey},s.a.createElement(ct.c,{popupType:this.getPopupType(),open:a.state.isOpen,origin:o,render:this.renderPopupContents,onDismiss:this.handleMenuClose,placementToOrigin:ct.c.Placement.Bottom,alignmentToOrigin:ct.c.Alignment.Start,keepFocus:!0,style:n.popup})))}renderMobile(e){const{store:t}=this.stores,a=e===kt.Section?this.renderMobileFilterSummary():this.renderMobileButtonOrigin();return s.a.createElement(ct.c,{popupType:ct.c.PopupType.SlideUp,open:t.state.isOpen,origin:a,render:this.renderPopupContents,onDismiss:this.handleMenuClose,preventScaleTransition:!0})}renderMobileButtonOrigin(){const{icon:e,title:t,disabled:a}=this.props,n=this.styles;return s.a.createElement(w.a,{disabled:a,focused:!1,icon:e(n.icon),title:t,onClick:this.handleOriginActivate})}renderMobileFilterSummary(){const{title:e,value:t,dateFormat:a,disabled:n,intl:r}=this.props,i=this.styles,o=s.a.createElement("div",{style:i.summary},m.a.calendar(i.iconActiveMobile),P.d(t,r,a));return s.a.createElement(ft,{disabled:n,onClick:this.handleOriginActivate,onClickClear:this.handleClear,label:e,title:o})}getCurrentValue(){const{value:e}=this.props,{store:t}=this.stores,{temporary:a}=t.state;return Bt({},e,{},a)}getPopupType(){const{device:e}=this.environment;return e.isMobile?Se.a.PopupType.SlideUp:Se.a.PopupType.Popup}getThemeColors(){return{buttonMenuItem:{color:this.theme.mediumTextColor},activeMenuItem:{color:this.theme.regularTextColor}}}}var Lt,Ut=Object(j.injectIntl)(Rt),_t=a("MeYt");function Wt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Nt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Wt(Object(a),!0).forEach((function(t){qt(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Wt(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function qt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}!function(e){e[e.Button=0]="Button",e[e.MenuItem=1]="MenuItem"}(Lt||(Lt={}));class Vt extends T.a{constructor(){super(...arguments),this.handleFilterClick=e=>{const{onMenuDismiss:t}=this.props;this.applyFilter(e),this.openSidebar(),t&&t()},this.applyFilter=e=>{const{searchStore:t}=this.props;t.updateFilters(e)},this.openSidebar=()=>{const{searchStore:e}=this.props;e.isSidebarOpen()||e.setState(Nt({},e.state,{isSidebarOpen:!0}))},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},buttonFilter:{padding:"4px 8px",display:"flex",alignItems:"center",overflow:"hidden"},buttonText:Nt({},D.a.textOverflowStyle),icon:{display:"inline-block",height:14,width:14,fill:"currentColor"},buttonIcon:{marginRight:6}}}renderComponent(){const{mode:e}=this.props;return e===Lt.Button?this.renderAsButton():e===Lt.MenuItem?this.renderAsMenuItem():void Object(z.e)(e)}renderAsButton(){const{icon:e,title:t,filter:a}=this.props,n=this.styles,r=this.getThemeColors();return s.a.createElement(_t.a,{style:Nt({},n.buttonFilter,{},r.buttonFilter),onClick:()=>this.handleFilterClick(a)},e&&e(Nt({},n.icon,{},n.buttonIcon)),s.a.createElement("span",{style:n.buttonText},t))}renderAsMenuItem(){const{icon:e,title:t,filter:a,focused:n}=this.props,r=this.styles,i=this.getThemeColors(),o=Nt({},r.menuItem,{},i.menuItem);return s.a.createElement(w.a,{icon:e&&e(r.icon),focused:n,title:t,onClick:()=>this.handleFilterClick(a),style:o})}getThemeColors(){const{device:e}=this.environment;return{menuItem:Nt({color:e.isDesktop?this.theme.mediumTextColor:void 0},this.props.isLastInSection&&{boxShadow:void 0}),buttonFilter:{color:this.theme.mediumTextColor}}}}Vt.Mode=Lt;class zt extends T.a{renderComponent(){const e=zt.getCurrentPageFilter();if(e)return s.a.createElement(Vt,Object.assign({icon:m.a.searchInPage,title:s.a.createElement(j.FormattedMessage,{id:"search.filterMenu.quickFilters.inCurrentPage",defaultMessage:"In current page"}),filter:e},this.props))}static isActive(e){const t=zt.getCurrentPageFilter();if(!t)return!1;if(!t.ancestors)return!1;const a=t.ancestors[0];return-1!==e.ancestors.indexOf(a)}}zt.getCurrentPageFilter=()=>{const{currentBlockStore:e}=c.default.state;if(e&&e.id)return{ancestors:[e.id]}};class Ht extends T.a{renderComponent(){const e=Ht.getCurrentUserFilter(this.environment);if(e)return s.a.createElement(Vt,Object.assign({icon:m.a.person,title:s.a.createElement(j.FormattedMessage,{id:"search.filterMenu.quickFilters.createdByMe",defaultMessage:"Created by me"}),filter:e},this.props))}static isActive(e,t){const a=Ht.getCurrentUserFilter(e);if(!a)return!1;if(!a.createdBy)return!1;const n=a.createdBy[0];return-1!==t.createdBy.indexOf(n)}}Ht.getCurrentUserFilter=e=>{const{id:t}=e.currentUser;if(t)return{createdBy:[t]}};class Gt extends T.a{renderComponent(){const e=Gt.getPastWeekFilter();if(e)return s.a.createElement(Vt,Object.assign({icon:m.a.calendar,title:s.a.createElement(j.FormattedMessage,{id:"search.filterMenu.quickFilters.editedLastWeek",defaultMessage:"Edited last week"}),filter:e},this.props))}static isActive(e){const{lastEditedTime:t}=Gt.getPastWeekFilter();return r.a.isEqual(t,e.lastEditedTime)}}Gt.getPastWeekFilter=()=>({lastEditedTime:{starting:Ee.bb(Ee.m),ending:Ee.nb(Ee.m)}});var Qt=a("sbdd"),Yt=a("7Q97"),Zt=a("Oy36");const Xt=Object(j.defineMessages)({searchPages:{defaultMessage:"Search pages",id:"searchPageFilter.searchTokenFilter.tokenInput.placeholder"},selectAPage:{defaultMessage:"Select a page",id:"searchPageFilter.searchTokenFilter.resultSection.title"}});class Kt extends T.a{constructor(){super(...arguments),this.renderFilterListItem=(e,t)=>{let{disabled:a,onRemove:n,onClick:r}=t;const i=this.styles,o=this.createBlockStore(e),l=s.a.createElement(lt,{disabled:a,onClick:n});return s.a.createElement(Qt.a,{disabled:a,focused:!1,store:o,right:l,style:i.menuItem,desktopTitleStyle:i.menuItemTitle,onClick:r})},this.renderItemForSummary=e=>s.a.createElement(k.a,{store:this.createBlockStore(e),shouldWrap:!0,maxLength:50}),this.renderToken=(e,t)=>{const{blockIds:a}=this.props,n=this.tokenStyles,r=1===a.length,i=this.createBlockStore(e),o=s.a.createElement("div",{style:n.token},s.a.createElement(Zt.a,{disabled:!0,icon:i.getIcon(),isEmptyPage:!1,size:20,style:n.icon}),s.a.createElement(k.a,{store:i}));return s.a.createElement(Yt.b,{key:e,format:Yt.b.Format.Large,value:o,showRemoveButton:!0,onClickRemove:t.onRemove,isSingle:r,shouldShrink:!0})},this.renderResultMenuItem=(e,t)=>{const a=this.createBlockStore(e);return s.a.createElement(Qt.a,Object.assign({},t,{key:e,store:a}))},this.performRequest=async e=>{let{query:t,current:a}=e;const{currentSpaceStore:n}=c.default.state;if(!n)return[];const{results:r}=await l.f({environment:this.environment,query:t,limit:20,spaceId:n.id,requireEditPermissions:!1,excludeTemplates:!1,source:"quick_find_ancestor_filter"}),i=new Set(a);return r.filter(e=>!i.has(e))},this.createBlockStore=e=>{const{parentStore:t}=this.props;return d.a.createChildStore(t,{table:u.b,id:e})},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},menuItemTitle:{width:"100%"},labeledMenuItemTitle:{display:"inline-flex",alignItems:"center"},menuItemLabel:{marginRight:12},recordIcon:{marginRight:4}},this.tokenStyles={token:{display:"flex",alignItems:"center"},icon:{marginRight:4}}}renderComponent(){const{mode:e,title:t,blockIds:a,onChange:n,disabled:r,focused:i,onMenuDismiss:o}=this.props;return s.a.createElement(jt,{mode:e,title:t,icon:m.a.searchInPage,items:a,onChange:n,focused:i,renderFilter:this.renderFilterListItem,renderToken:this.renderToken,renderItemForSummary:this.renderItemForSummary,addItemLabel:s.a.createElement(j.FormattedMessage,{defaultMessage:"Add a page",id:"searchPageFilter.searchTokenFilter.addAPage.button"}),labelText:{title:t,tokenInputPlaceholder:Xe.default.formatMessage(Xt.searchPages),resultSectionTitle:Xe.default.formatMessage(Xt.selectAPage),componentDebugName:"SearchPageFilter"},performRequest:this.performRequest,renderResultMenuItem:this.renderResultMenuItem,disabled:r,onMenuDismiss:o})}}var Jt=Kt,$t=a("JMnu"),ea=a("f0kS"),ta=a("V1wX");class aa extends T.a{constructor(){super(...arguments),this.renderFilterListItem=(e,t)=>{let{disabled:a,onRemove:n,onClick:r}=t;const i=this.styles,o=this.getUserValue(e),l=s.a.createElement(lt,{disabled:a,onClick:n});return s.a.createElement(ea.a,{key:e,disabled:a,focused:!1,user:o,right:l,style:i.menuItem,desktopTitleStyle:i.menuItemTitle,onClick:r})},this.renderItemForSummary=e=>Object(F.e)(this.getUserValue(e)),this.renderToken=(e,t)=>{const{userIds:a}=this.props,n=1===a.length,r=this.getUserValue(e);if(r)return s.a.createElement($t.c,{key:e,format:$t.c.Format.Large,showRemoveButton:!0,isSingle:n,onClickRemove:t.onRemove,actor:Object(ta.i)(r)})},this.renderResultMenuItem=(e,t)=>{const a=this.getUserValue(e);return s.a.createElement(ea.a,Object.assign({},t,{key:e,user:a}))},this.performRequest=async e=>{let{query:t,current:a}=e;const n=new Set(a);return(await l.l({environment:this.environment,query:t,membersOnly:!1})).filter(e=>!n.has(e.id)).slice(0,20).map(e=>e.id)},this.getUserValue=e=>this.createUserStore(e).getValue(),this.createUserStore=e=>{const{parentStore:t}=this.props;return I.a.createChildStore(t,{table:F.a,id:e})},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},menuItemTitle:{width:"100%"},labeledMenuItemTitle:{display:"inline-flex",alignItems:"center"},menuItemLabel:{marginRight:12},recordIcon:{marginRight:4}}}renderComponent(){const{mode:e,title:t,userIds:a,onChange:n,disabled:r,focused:i,onMenuDismiss:o,intl:l}=this.props;return s.a.createElement(jt,{mode:e,title:t,icon:m.a.person,items:a,onChange:n,disabled:r,focused:i,renderFilter:this.renderFilterListItem,renderToken:this.renderToken,renderItemForSummary:this.renderItemForSummary,addItemLabel:s.a.createElement(j.FormattedMessage,{defaultMessage:"Add a person",id:"search.filterMenu.addAPersonButton.label"}),labelText:{title:t,tokenInputPlaceholder:l.formatMessage({defaultMessage:"Search people",id:"search.filterMenu.searchPeople.placeholder"}),resultSectionTitle:l.formatMessage({defaultMessage:"Select a person",id:"search.filterMenu.searchPeople.resultsTitle"}),componentDebugName:"SearchPersonFilter"},performRequest:this.performRequest,renderResultMenuItem:this.renderResultMenuItem,onMenuDismiss:o})}}var na=Object(j.injectIntl)(aa);function ra(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ia(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class sa extends T.a{renderComponent(){return s.a.createElement(V.a,Object.assign({},this.props,{right:s.a.createElement(pt.a,Object.assign({},this.props)),dontShrinkRight:!0}))}}sa.contextTypes=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ra(Object(a),!0).forEach((function(t){ia(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ra(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},b.c);var oa=sa;function la(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ca(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function da(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}class ua extends T.a{constructor(){super(...arguments),this.handleToggle=()=>{const{value:e,onChange:t}=this.props;t(!e)},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},icon:{height:14,width:14,fill:"currentColor"}}}renderComponent(){const{device:e}=this.environment,{mode:t}=this.props;return e.isMobile?this.renderMobile(t):this.renderDesktop(t)}renderDesktop(e){const t=e===kt.Section;return s.a.createElement(bt.a,{marginAfter:t},this.renderSwitcherMenuItem())}renderMobile(e){const{title:t,value:a,disabled:n}=this.props;return e===kt.Button?this.renderSwitcherMenuItem():s.a.createElement(ft,{disabled:n,onClick:this.handleToggle,label:t,isToggle:!0,isToggleActive:a})}renderSwitcherMenuItem(){const e=this.props,{title:t,icon:a,value:n,style:r}=e,i=da(e,["title","icon","value","style"]),o=this.styles,l=this.getThemeColors(),c=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?la(Object(a),!0).forEach((function(t){ca(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):la(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},o.menuItem,{},l.menuItem,{},r);return s.a.createElement(oa,Object.assign({title:t,icon:a(o.icon),on:n,onClick:this.handleToggle,style:c},i))}getThemeColors(){return{menuItem:{color:this.theme.mediumTextColor}}}}ua.Mode=kt;var pa,ma=ua;function ha(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ga(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ha(Object(a),!0).forEach((function(t){fa(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ha(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function fa(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}!function(e){e.Button="Button",e.Section="Section"}(pa||(pa={}));class ba extends T.a{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:ve.a},this.renderAddFilterOrigin=e=>{const t=this.styles;return s.a.createElement(ye.a,Object.assign({},e,{style:t.addFilterButtonMobile,icon:m.a.filterCircled,isBlue:!0}),s.a.createElement(j.FormattedMessage,{defaultMessage:"Add filter",id:"search.addFilter.button.label"}))},this.renderAddFilterMenu=()=>s.a.createElement(b.b,{menuType:b.b.MenuType.ActionSheet},this.renderSuggestedFilters(),s.a.createElement(bt.a,{title:this.renderMoreFiltersTitle()},this.renderCreatedByFilter(jt.Mode.Button),this.renderCreatedTimeFilter(jt.Mode.Button),this.renderLastEditedTimeFilter(jt.Mode.Button),this.renderAncestorFilter(jt.Mode.Button))),this.closeAddFilterMenu=()=>{const{buttonPopupStore:e}=this.stores;e.setState(ga({},e.state,{open:!1}))},this.styles={sidebar:{paddingTop:12,paddingBottom:24,overflowY:"auto",overflowX:"hidden",flex:"0 0 220px",minHeight:400},sidebarHidden:{display:"none"},addFilterButtonMobile:{fontSize:this.props.isMobile?D.a.fontSize.UISmall.mobile:D.a.fontSize.UISmall.desktop,fontWeight:D.a.fontWeight.medium,marginRight:-8}}}renderComponent(){return this.props.isMobile?this.props.mode===pa.Button?this.renderAddButtonMobile():this.props.mode===pa.Section?this.renderActiveFiltersMobile():void Object(z.e)(this.props.mode):this.renderSidebar()}renderActiveFiltersMobile(){const{searchStore:{state:e}}=this.props,t=P.e(e.query.filters);return s.a.createElement(ue.a,{disableMobilePadding:!0,disableMobileBorders:!0},this.renderTitlesOnlyFilter(kt.Section),this.renderActiveFilters(t,jt.Mode.Section))}renderAddButtonMobile(){const{buttonPopupStore:e}=this.stores;return s.a.createElement(Se.a,{popupType:Se.a.PopupType.SlideUp,buttonPopupStore:e,renderOrigin:this.renderAddFilterOrigin,render:this.renderAddFilterMenu})}renderSidebar(){const{searchStore:e,searchStore:{state:t}}=this.props,a=this.styles,n=this.getThemeColors(),r=P.e(t.query.filters),i=ga({},a.sidebar,{},n.sidebar,{},!e.isSidebarOpen()&&a.sidebarHidden);return s.a.createElement("aside",{style:i},this.renderTitlesOnlyFilter(kt.Section),this.renderActiveFilters(r,jt.Mode.Section),this.renderSuggestedFilters(),this.renderInactiveFilters(r))}renderActiveFilters(e,t){return s.a.createElement(s.a.Fragment,null,e.createdBy&&this.renderCreatedByFilter(t),e.createdTime&&this.renderCreatedTimeFilter(t),e.lastEditedTime&&this.renderLastEditedTimeFilter(t),e.ancestors&&this.renderAncestorFilter(t))}renderInactiveFilters(e){if(!(e.ancestors&&e.createdBy&&e.createdTime&&e.lastEditedTime))return s.a.createElement(bt.a,{title:this.renderMoreFiltersTitle(),marginAfter:!0},!e.ancestors&&this.renderAncestorFilter(jt.Mode.Button),!e.createdBy&&this.renderCreatedByFilter(jt.Mode.Button),!e.createdTime&&this.renderCreatedTimeFilter(kt.Button),!e.lastEditedTime&&this.renderLastEditedTimeFilter(kt.Button))}renderSuggestedFilters(){const{searchStore:e}=this.props,{filters:t}=e.state.query,a=Ht.isActive(this.environment,t),n=Gt.isActive(t),r=zt.isActive(t);if(!(a&&n&&r))return s.a.createElement(bt.a,{title:s.a.createElement(j.FormattedMessage,{id:"search.filterMenu.quickFiltersSection.title",defaultMessage:"Quick filters"}),marginAfter:!0},!a&&s.a.createElement(Ht,{mode:Lt.MenuItem,searchStore:e,focused:!1,onMenuDismiss:this.closeAddFilterMenu}),!n&&s.a.createElement(Gt,{mode:Lt.MenuItem,searchStore:e,focused:!1,onMenuDismiss:this.closeAddFilterMenu}),!r&&s.a.createElement(zt,{mode:Lt.MenuItem,searchStore:e,focused:!1,onMenuDismiss:this.closeAddFilterMenu,isLastInSection:!0}))}renderTitlesOnlyFilter(e){const{searchStore:t}=this.props,{filters:a}=t.state.query;return s.a.createElement(ma,{mode:e,focused:!1,title:s.a.createElement(j.FormattedMessage,{id:"search.filterMenu.onlyMatchTitlesToggle.label",defaultMessage:"Only match titles",description:"Label for only match titles toggle in search modal"}),icon:m.a.typesTitle,value:a.isNavigableOnly,onChange:this.createUpdateFunction("isNavigableOnly")})}renderMoreFiltersTitle(){return s.a.createElement(j.FormattedMessage,{id:"search.filterMenu.moreFiltersSection.title",defaultMessage:"More filters"})}renderAncestorFilter(e){const{searchStore:t,parentStore:a}=this.props,{filters:n}=t.state.query;return s.a.createElement(Jt,{mode:e,focused:!1,title:s.a.createElement(j.FormattedMessage,{id:"search.filterMenu.moreFilters.inPage",defaultMessage:"In page"}),parentStore:a,blockIds:n.ancestors,onMenuDismiss:this.closeAddFilterMenu,onChange:this.createUpdateFunction("ancestors")})}renderCreatedByFilter(e){const{searchStore:t,parentStore:a}=this.props,{filters:n}=t.state.query;return s.a.createElement(na,{mode:e,focused:!1,title:s.a.createElement(j.FormattedMessage,{id:"search.filterMenu.moreFilters.createdBy",defaultMessage:"Created by"}),parentStore:a,userIds:n.createdBy,onMenuDismiss:this.closeAddFilterMenu,onChange:this.createUpdateFunction("createdBy")})}renderCreatedTimeFilter(e){const{searchStore:t}=this.props,{filters:a}=t.state.query;return s.a.createElement(Ut,{mode:e,focused:!1,title:s.a.createElement(j.FormattedMessage,{id:"search.filterMenu.moreFilters.created",defaultMessage:"Created"}),icon:m.a.calendar,value:a.createdTime,onMenuDismiss:this.closeAddFilterMenu,onChange:this.createUpdateFunction("createdTime")})}renderLastEditedTimeFilter(e){const{searchStore:t}=this.props,{filters:a}=t.state.query;return s.a.createElement(Ut,{mode:e,focused:!1,title:s.a.createElement(j.FormattedMessage,{id:"search.filterMenu.moreFilters.lastEdited",defaultMessage:"Last edited"}),icon:m.a.calendar,value:a.lastEditedTime,onMenuDismiss:this.closeAddFilterMenu,onChange:this.createUpdateFunction("lastEditedTime")})}createUpdateFunction(e){const{searchStore:t}=this.props;return a=>t.updateFilters({[e]:a})}getThemeColors(){return{sidebar:{backgroundColor:this.theme.sidebarSecondaryBackground,borderLeft:"1px solid ".concat(this.theme.regularDividerColor)}}}}var ya=ba,Sa=a("Ytfc");function va(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ea(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?va(Object(a),!0).forEach((function(t){Ma(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):va(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Ma(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Ca extends T.a{constructor(){super(...arguments),this.openSidebar=()=>{const{searchStore:e}=this.props;e.setState(Ea({},e.state,{isSidebarOpen:!0}))},this.styles={menuItem:{minHeight:0},menuItemMobile:{paddingBottom:8},titleWrapper:{flex:void 0},showSidebarButton:()=>{const{device:e}=this.environment;return{padding:"0 4px",fontSize:e.isMobile?D.a.fontSize.UISmall.mobile:D.a.fontSize.UISmall.desktop,fontWeight:D.a.fontWeight.medium,borderRadius:3,height:20,lineHeight:"20px"}}}}renderComponent(){const{device:e}=this.environment,t=this.styles,a=Ea({},t.menuItem,{},e.isMobile&&t.menuItemMobile),n=this.shouldAllowFilters()&&this.renderAddFilterButton();return s.a.createElement(V.a,{title:this.renderSortMenu(),right:n,textWrapperStyle:t.titleWrapper,style:a})}renderSortMenu(){const{searchStore:e}=this.props;return s.a.createElement(Sa.a,{currentSortBy:e.state.query.sort,setSortBy:t=>{e.state.mode===de.c.Mode.Default?e.setState(Ea({},e.state,{query:Ea({},e.state.query,{sort:t})})):e.state.mode===de.c.Mode.Results&&e.setState(Ea({},e.state,{query:Ea({},e.state.query,{sort:t})}))},sortOptions:this.sortOptions})}renderAddFilterButton(){const{device:e}=this.environment,{parentStore:t,searchStore:a}=this.props,n=this.styles;return e.isMobile?s.a.createElement(ya,{parentStore:t,searchStore:a,isMobile:!0,mode:pa.Button}):a.isSidebarOpen()?void 0:s.a.createElement(ye.a,{icon:m.a.filterCircled,onClick:this.openSidebar,style:n.showSidebarButton(),isBlue:!0},s.a.createElement(j.FormattedMessage,{defaultMessage:"Add filter",id:"search.header.addFilter.button.label"}))}shouldAllowFilters(){const{isPublicPageSearch:e}=this.props;return!e}get sortOptions(){return[{key:"Relevance",formattedName:s.a.createElement(j.FormattedMessage,{id:"search.sort.sortOrder.bestMatches",defaultMessage:"Best matches"})},{key:"LastEditedNewest",formattedName:s.a.createElement(j.FormattedMessage,{id:"search.sort.sortOrder.lastEdited.newestFirst",defaultMessage:"Last edited: Newest first"})},{key:"LastEditedOldest",formattedName:s.a.createElement(j.FormattedMessage,{id:"search.sort.sortOrder.lastEdited.oldestFirst",defaultMessage:"Last edited: Oldest first"})},{key:"CreatedNewest",formattedName:s.a.createElement(j.FormattedMessage,{id:"search.sort.sortOrder.created.newestFirst",defaultMessage:"Created: Newest first"})},{key:"CreatedOldest",formattedName:s.a.createElement(j.FormattedMessage,{id:"search.sort.sortOrder.created.oldestFirst",defaultMessage:"Created: Oldest first"})}]}}var wa=Ca,Oa=a("X3py"),ka=a("cBa6"),Pa=a("qX+M");function Ta(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Da(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ta(Object(a),!0).forEach((function(t){Ia(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ta(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Ia(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Fa extends T.a{constructor(){super(...arguments),this.renderSpinner=()=>{const{showSpinner:e}=this.props,t=this.styles,a=Da({},this.getThemeColors().searchIcon,{},t.searchIcon());return s.a.createElement(pe.a,{show:e,showDelay:500,showHold:200,render:e=>e?s.a.createElement(ce.a,{style:a}):m.a.searchThick(a)})},this.handleQueryChange=e=>{const{searchStore:t,resultListStore:a}=this.props;this.handleTyping();const n=String(e.target.value);""===n?t.resetQuery({resetFilters:!1}):t.setState(Da({},t.state,{mode:de.c.Mode.Results,query:Da({},t.state.query,{text:n}),limit:de.b,allResultsLoaded:!1})),a.setState(Da({},a.state,{focus:{section:0,indexLocal:0,indexGlobal:0}}))},this.handleClearButtonClick=()=>{const{searchStore:e}=this.props;e.resetQuery({resetFilters:!0}),e.setState(Da({},e.state,{isSidebarOpen:!1}))},this.handleFocus=()=>{const{isFocusedStore:e}=this.props;e.get()||e.set(!0)},this.handleBlur=()=>{const{isFocusedStore:e}=this.props,{device:t}=this.environment;e.get()&&(e.set(!1),t.isReactNative&&Oa.b.updateKeyboardPhase(Oa.a.willHide))},this.setTypingStart=()=>{const{isTypingStore:e}=this.props;e.get()||e.set(!0)},this.setTypingEnd=()=>{const{isTypingStore:e}=this.props;e.set(!1)},this.styles={inputDesktop:{fontSize:18,height:Fa.DESKTOP_INPUT_HEIGHT,paddingLeft:16,paddingRight:16,flexGrow:0,flexShrink:0,zIndex:1},inputMobile:{fontSize:16,border:"none",boxShadow:"none",borderRadius:7,lineHeight:"1.2",padding:"6px 8px"},searchIcon:()=>{const{device:e}=this.environment;return{width:e.isMobile?16:18,height:e.isMobile?16:18,marginRight:e.isMobile?12:10,flexGrow:0,flexShrink:0}},input:Da({minWidth:0},D.a.textOverflowStyle),clearButton:{marginLeft:8}}}willUnmount(){this.typingTimer&&(clearTimeout(this.typingTimer),this.typingTimer=void 0)}renderComponent(){const{device:e}=this.environment,{isOpen:t,searchStore:{state:a}}=this.props,n=this.styles,r=this.getThemeColors(),i=e.isMobile?Te.b.Format.ExtraLarge:Te.b.Format.Transparent,o=e.isMobile?Da({},n.inputMobile,{},r.inputMobile):Da({},n.inputDesktop,{},r.inputDesktop);return s.a.createElement(Te.b,{format:i,placeholder:this.getPlaceholderText(),left:this.renderSpinner(),value:a.query.text,focus:e.isMobile?void 0:t,focusInitial:e.isMobile,focusAfterAnimation:!0,showClearButton:!0,selectAll:!0,onChange:this.handleQueryChange,onClearButtonClick:this.handleClearButtonClick,onFocus:this.handleFocus,onBlur:this.handleBlur,style:o,inputStyle:n.input,clearButtonStyle:n.clearButton})}handleTyping(){this.typingTimer&&window.clearTimeout(this.typingTimer),this.setTypingStart(),this.typingTimer=window.setTimeout(this.setTypingEnd,Fa.TYPING_DEBOUNCE_MS)}getPlaceholderText(){const{currentSpaceStore:e,currentBlockStore:t}=c.default.state,a=e&&Object(Pa.getSpaceName)(this.environment,e);if(a)return this.props.intl.formatMessage({id:"searchInputMenuItem.placeholder.namedSpace",defaultMessage:"Search {spaceName}…"},{spaceName:a});if(t){const e=ka.cb(t.getTitleValue()).slice(0,Fa.MAX_PLACEHOLDER_TITLE_LENGTH);return this.props.intl.formatMessage({id:"searchInputMenuItem.placeholder.namedPage",defaultMessage:"Search in {pageTitle}…"},{pageTitle:e})}return this.props.intl.formatMessage({id:"searchInputMenuItem.placeholder.unnamedPage",defaultMessage:"Search in page…"})}getThemeColors(){return{inputDesktop:{boxShadow:"0 1px 0 ".concat(this.theme.regularDividerColor)},inputMobile:{background:this.theme.inputBackground},searchIcon:{fill:this.theme.mediumIconColor}}}}Fa.TYPING_DEBOUNCE_MS=300,Fa.DESKTOP_INPUT_HEIGHT=52,Fa.MAX_PLACEHOLDER_TITLE_LENGTH=100;var ja=Object(j.injectIntl)(Fa),xa=a("dNiu"),Ba=a("aw/t"),Aa=a("LFt7");function Ra(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function La(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ra(Object(a),!0).forEach((function(t){Ua(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ra(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Ua(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class _a extends T.a{constructor(){super(...arguments),this.styles={title:{fontWeight:D.a.fontWeight.medium,lineHeight:"20px"},menuItem:{minHeight:36,paddingTop:this.environment.device.isMobile?12:8,paddingBottom:this.environment.device.isMobile?12:8},textWrapper:{marginLeft:8,alignItems:void 0,flex:void 0},inlineTextWrapper:{alignItems:"baseline"},highlight:{fontWeight:D.a.fontWeight.medium},enterIcon:{height:14,width:14},caption:{marginTop:1}}}renderComponent(){const{focused:e,isLastInSection:t,isBeforeFocused:a,inline:n}=this.props,r=this.styles,i=this.getThemeColors(),o=La({},r.menuItem,{},!n&&!t&&!a&&!e&&i.menuItemBorder),l=La({},r.caption,{},i.caption),c=La({},r.textWrapper,{},this.props.inline&&r.inlineTextWrapper);return s.a.createElement(w.a,Object.assign({},this.props,{title:this.renderTitle(),icon:this.renderIcon(),caption:this.renderCaption(),body:this.renderPreview(),right:this.renderEnterIcon(),disableTransition:!0,dontShrinkRight:!0,ignoreLocalHoverState:!0,captionStyle:l,style:o,textWrapperStyle:c,className:"notranslate"}))}renderTitle(){const{store:e,result:t,placeholder:a}=this.props,n=this.styles,r=this.getThemeColors(),i=La({},n.title,{},this.hasAnyHighlight()&&r.highlightedTitle),o=this.getHighlightedWordsFromText(t&&t.highlight&&t.highlight.pathText);t&&t.isNavigable&&o.push(...this.getHighlightedWordsFromText(t&&t.highlight&&t.highlight.text));const l=this.getWordHighlighter(o);return s.a.createElement(k.a,{style:i,store:e,placeholder:a,highlighter:l})}renderIcon(){const{store:e}=this.props;return s.a.createElement(Zt.a,{disabled:!0,icon:e.getIcon(),isEmptyPage:e.isEmptyPage(),size:19})}renderCaption(){const{store:e,result:t,inline:a}=this.props;if(!this.hasPath())return;const n=this.getWordHighlighter(this.getHighlightedWordsFromText(t&&t.highlight&&t.highlight.pathText)),{device:r}=this.environment,i=a||r.isMobile?0:2;return s.a.createElement(Ba.a,{store:e,extraLength:i,showFullPathInTooltip:!0,highlighter:n})}renderPreview(){const{result:e}=this.props;if(!e)return;if(!e.highlight)return;if(e.isNavigable)return;if(!e.highlight.text)return;const t=this.styles,a=this.getThemeColors(),n=e.highlight.text;return s.a.createElement(Aa.a,{text:n,highlighter:{tokenize:e=>Object(xa.a)(Object(xa.b)(e)),style:La({},t.highlight,{},a.highlight)}})}getHighlightedWordsFromText(e){if(!e)return[];let t=Object(xa.b)(e);return t.some(e=>Object(xa.e)(e)&&1===Object(xa.c)(e).length)&&(t=Object(xa.a)(t)),r()(t).filter(xa.e).map(xa.c).uniq().value()}getWordHighlighter(e){if(0===e.length)return;const t=this.styles,a=this.getThemeColors();return{tokenize:t=>Object(xa.d)(t,e),style:La({},t.highlight,{},a.highlight)}}renderEnterIcon(){const{device:e}=this.environment,{focused:t}=this.props,a=this.styles,n=this.getThemeColors();if(e.isMobile)return;const r=La({},a.enterIcon,{},n.enterIcon,{opacity:t?1:0});return m.a.enter(r)}hasPath(){const{hidePath:e,store:t}=this.props;return!e&&Object(Ba.b)(t)}hasAnyHighlight(){const{result:e}=this.props;if(!e)return!1;const{highlight:t}=e;return!!t&&Boolean(t.text||t.pathText)}getThemeColors(){return{highlightedTitle:{color:this.theme.mediumTextColor},menuItemBorder:{boxShadow:"0 1px 0 ".concat(this.theme.lightDividerColor)},highlight:{color:this.theme.regularTextColor},enterIcon:{fill:this.theme.mediumIconColor},caption:{color:this.theme.mediumTextColor}}}}_a.contextTypes=b.c;var Wa=_a,Na=a("5qTp"),qa=a("FcJC"),Va=a("HSWF"),za=a("nFzZ"),Ha=a("hU3F"),Ga=a("vJXr"),Qa=a("+NSf");function Ya(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Za(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ya(Object(a),!0).forEach((function(t){Xa(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ya(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Xa(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Ka extends T.a{constructor(){var e;super(...arguments),e=this,this.isOpen=!1,this.storeTypes={searchStore:de.c,resultListStore:S.a,serverRequestStore:W.a,localRequestStore:W.a,localCacheRequestStore:W.a,isTypingStore:Ha.a.of(!1),isInputFocusedStore:Ha.a.of(!1),numQueriesIssued:Ha.a.of(0),selectedQueryResult:Ha.a.of(!1)},this.renderBody=e=>{const{device:t}=this.environment,{searchStore:{state:a}}=this.stores,n=this.layoutStyles,{currentSpaceStore:r}=c.default.state;return s.a.createElement(b.b,Object.assign({},this.getMenuProps(e),{className:p.nb}),s.a.createElement("div",{style:n.body},!t.isMobile&&this.renderInput(),s.a.createElement(_.a,{requestStore:this.stores.localCacheRequestStore,request:r&&r.id,performRequest:this.performLocalCacheRequest,render:a.mode===de.c.Mode.Results?this.renderResults:this.renderDefaultBody})),this.shouldShowSidebar()&&this.renderFilterMenu())},this.renderDefaultBody=()=>{const{device:e}=this.environment,{resultListStore:t}=this.stores,a=this.defaultViewStyles;if(!this.recentPageStores.state)return;const n=this.getInitialFocus(),i={mode:de.c.Mode.Default,isMobile:e.isMobile,recentSearches:this.recentSearches.state,recentPages:this.recentPageStores.state};return s.a.createElement(s.a.Fragment,null,s.a.createElement("main",{style:a.wrapper},s.a.createElement(y.a,{type:y.a.Type.Vertical,store:t,initialFocus:n,disableKeyboardArrowWrap:!0,sections:r.a.compact([this.getRecentPagesSection(),this.getRecentSearchesSection()])})),this.shouldShowFooter(i)&&this.renderFooter())},this.renderResults=()=>{const{device:t}=this.environment,{searchStore:a,serverRequestStore:n,localRequestStore:r}=this.stores,i={query:a.state.query,limit:a.state.limit};return s.a.createElement(_.a,{debounce:l.b,requestStore:n,request:i,performRequest:this.performServerRequest,render:(a,n)=>s.a.createElement(_.a,{debounce:l.a,requestStore:r,request:i,performRequest:function(){return Promise.resolve(e.performLocalRequest(...arguments))},render:(e,a)=>s.a.createElement(s.a.Fragment,null,t.isMobile&&this.renderFilterMenu(),this.renderRequestResults({localResponse:a,serverResponse:n}))})})},this.renderRequestResults=e=>{const{device:t}=this.environment,{serverResponse:a,localResponse:n}=e,{serverRequestStore:r}=this.stores;if(!a&&!n)return;const i=P.f({localResponse:n,serverResponse:a,serverRequestStore:r});this.incrementNumQueriesIssued();const o={mode:de.c.Mode.Results,isMobile:t.isMobile,errorState:i};return s.a.createElement(s.a.Fragment,null,this.shouldShowHeaderDesktop(o)&&this.renderHeader(),this.renderResultsSection({errorState:i,localResponse:n,serverResponse:a}),this.shouldShowFooter(o)&&this.renderFooter({localResponse:n,serverResponse:a}))},this.renderSearchResult=(e,t)=>{const{store:a}=e,n=a.isNavigableBlock()?a:a.getNavigableBlockStore();if(n)return{key:"".concat(a.id,":").concat(t),action:e=>this.handleSelectResult(a,e,"query_results"),render:a=>s.a.createElement(Wa,Object.assign({},a,{isFirstInSection:0===t,store:n,hidePath:!1,result:e}))}},this.handleComponentOpenClose=()=>{this.isOpen!==Na.default.state.open&&(this.isOpen=Na.default.state.open,Na.default.state.open?clearTimeout(this.inactiveTimer):this.addRecentSearch())},this.handleComponentClose=()=>{const{device:e}=this.environment,{searchStore:t,numQueriesIssued:a,selectedQueryResult:n}=this.stores,r=n.get(),i=a.get(),{query:s}=t.state;C.a(),i>0&&!r&&o.d(this.environment,{numQueriesIssued:i}),""===s.text.trim()?t.reset():P.l(s.filters)||t.setState(Za({},t.state,{isSidebarOpen:!1})),this.inactiveTimer=window.setTimeout(this.resetState,2*za.d),e.isMobile&&qa.close()},this.handleRecentSearch=(e,t)=>{const{searchStore:a}=this.stores;a.setState(Za({},a.state,{query:e,mode:de.c.Mode.Results,isSidebarOpen:!0}))},this.handleSelectResult=(e,t,a)=>{const{searchStore:n,numQueriesIssued:r,selectedQueryResult:i}=this.stores,{event:s}=t,l=s.metaKey||s.ctrlKey;"query_results"===a&&i.set(!0);const{query:c}=n.state;o.ee(this.environment,{context:a,queryStringLength:c.text.trim().length,hasFilters:P.l(c.filters),selectedItemIndex:t.index,isNavigable:e.isNavigableBlock(),numQueriesIssued:r.get()}),N.navigateToPage(e,l,this.environment),l||this.handleComponentClose()},this.handleScrollOffsetChange=e=>{const{searchStore:t,searchStore:{state:a},serverRequestStore:{state:n}}=this.stores;!(e<=Ka.LOAD_MORE_RESULTS_SCROLL_OFFSET_PX)||n.loading||a.allResultsLoaded||t.setState(Za({},a,{limit:a.limit+de.b}))},this.handleScrollResults=()=>{this.stores.isInputFocusedStore.get()&&this.blurInputDebounced()},this.handleSpaceChange=()=>{const e=c.default.state.currentSpaceStore&&c.default.state.currentSpaceStore.id;this.spaceId!==e&&(this.spaceId=e,this.resetState())},this.performLocalCacheRequest=async()=>{const{currentSpaceStore:e,currentSpaceViewStore:t}=c.default.state;if(!this.getPublicAccessPermissionForPage()&&e)return P.h({environment:this.environment,currentSpaceStore:e,currentSpaceViewStore:t})},this.performLocalRequest=e=>{const{query:t}=e,{localCacheRequestStore:a}=this.stores,n=a.state.result;if(!n)return;if(!t.text.trim())return;if(this.getPublicAccessPermissionForPage())return;const r=Qa.default.createMetric("rum.local_quick_search_query"),i=P.g({input:e,cache:n});if(!i)return;if(0===i.results.length)return{error:te.d.NoResults};const s=P.n({sort:t.sort,unsorted:i.results,batchSize:de.b,currentUserId:this.environment.currentUser.id}).results.map(e=>Za({},e,{store:this.createBlockStore(e.id)})),o=this.isOnline()?P.m(this.environment,s):s,l=this.isOnline()?o.length:i.total;if(0===l)return{error:te.d.NoResults};const c={value:{total:l,results:o}};return Qa.default.emit(this.environment,r),c},this.performServerRequest=async e=>{const{searchStore:t}=this.stores,{currentSpaceStore:a}=c.default.state,{query:n,limit:r}=e;if(!n.text.trim()&&!P.l(n.filters))return;if(!this.isOnline())return{error:te.d.Offline};const i=Qa.default.createMetric("rum.server_quick_search_query"),s=await P.k({environment:this.environment,input:e,currentSpaceStore:a,publicAccessPermission:this.getPublicAccessPermissionForPage()});if(!s)return;if("failed"===s.type)return s.offline?{error:te.d.Offline}:{error:te.d.RequestFailed};if(0===s.data.results.length)return{error:te.d.NoResults};const{results:o,total:l}=P.n({sort:n.sort,unsorted:s.data.results,batchSize:de.b,currentUserId:this.environment.currentUser.id});return t.setState(Za({},t.state,{allResultsLoaded:l<r})),Qa.default.emit(this.environment,i),{value:{results:o.map(e=>Za({},e,{store:this.createBlockStore(e.id)})),total:s.data.total}}},this.recentPageStores=this.createComputedStore(()=>{const{currentSpaceStore:e}=c.default.state,t=(e?Va.t({currentUserId:this.environment.currentUser.id,spaceId:e.id}).slice(0,this.getMaxRecentPages()):[]).map(this.createBlockStore),a=t.map(E.m);return r.a.every(a)&&t.filter(e=>e.pathIsAlive())}),this.clearRecentlyVisitedPages=()=>{const{currentSpaceStore:e}=c.default.state;e&&(Va.i({currentUserId:this.environment.currentUser.id,spaceId:e.id}),this.recentPageStores.recompute())},this.recentSearches=this.createComputedStore(()=>{const{currentSpaceStore:e}=c.default.state;return e?Va.s({currentUserId:this.environment.currentUser.id,spaceId:e.id}).slice(0,Ka.MAX_RECENT_SEARCHES):[]}),this.clearRecentSearches=()=>{const{currentSpaceStore:e}=c.default.state;e&&(Va.h({currentUserId:this.environment.currentUser.id,spaceId:e.id}),this.recentSearches.recompute())},this.addRecentSearch=()=>{const{searchStore:e,serverRequestStore:t,localRequestStore:a}=this.stores,{currentSpaceStore:n}=c.default.state;if(!n)return;const{query:r}=e.state;if(!r.text.trim())return;const i=this.getCurrentResults(),s=i.local&&!a.state.loading,o=i.server&&!t.state.loading;(s||o)&&Va.c({currentUserId:this.environment.currentUser.id,spaceId:n.id,query:r})},this.createBlockStore=e=>{const{parentStore:t}=this.props;return d.a.createChildStore(t,{table:u.b,id:e})},this.shouldDismissKeyboardOnScroll=()=>{const{device:e}=this.environment;return!!e.isMobile&&(!e.isIOS||e.isReactNative)},this.blurInput=()=>{const{activeElement:e}=document;e instanceof HTMLInputElement&&e.blur()},this.blurInputDebounced=r.a.debounce(this.blurInput,500,{leading:!0}),this.resetState=()=>{const{searchStore:e,resultListStore:t,serverRequestStore:a,localRequestStore:n,localCacheRequestStore:r}=this.stores;e.reset(),t.reset(),a.reset(),n.reset(),r.reset(),Na.default.reset()},this.incrementNumQueriesIssued=r.a.debounce(()=>this.stores.numQueriesIssued.update(e=>e+1),500),this.searchIcon=()=>m.a.searchThick({height:14,width:14,marginLeft:2,marginRight:6,flexGrow:0,flexShrink:0,fill:this.theme.mediumIconColor}),this.layoutStyles={modal:{width:"75%",maxWidth:600,minHeight:Ka.MIN_MENU_HEIGHT,maxHeight:Ka.MAX_MENU_HEIGHT},modalWithSidebar:{maxWidth:820},body:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column"},scroller:{display:"flex",flexDirection:"row",flexWrap:"nowrap",justifyContent:"space-between",maxHeight:Ka.MAX_MENU_HEIGHT},footer:{flexShrink:0}},this.modalMenuStyles={topbar:{height:void 0},topbarLeftInput:{marginLeft:10,marginTop:10,marginBottom:10},topbarRightButtonWrapper:{flex:void 0},topbarButton:{fontWeight:void 0}},this.defaultViewStyles={wrapper:{width:"100%",height:"100%",overflowX:"hidden",overflowY:"auto"},recentSection:{paddingTop:0,paddingBottom:8},recentTitle:{margin:0,padding:"0 14px",height:32,alignItems:"center",paddingTop:2},clearButton:{fontWeight:D.a.fontWeight.medium,padding:0,background:"none",fontSize:12,height:void 0},clearButtonDesktop:{textTransform:"none",letterSpacing:"normal",padding:"0 4px",fontSize:D.a.fontSize.UISmall.desktop,height:20,lineHeight:"20px",borderRadius:3}},this.resultStyles={results:{flex:1,display:"flex",flexDirection:"column",overflow:"auto",height:"100%"},messageMenuItem:Za({},this.environment.device.isMobile&&{background:void 0,boxShadow:void 0})}}getMaxRecentPages(){const{device:e}=this.environment;return e.isMobile?5:7}didMount(){Na.default.addListener(this.handleComponentOpenClose),c.default.addListener(this.handleSpaceChange),this.recentPageStores.addListener(r.a.noop)}willUnmount(){Na.default.removeListener(this.handleComponentOpenClose),c.default.removeListener(this.handleSpaceChange),this.recentPageStores.removeListener(r.a.noop),this.inactiveTimer&&(clearTimeout(this.inactiveTimer),this.inactiveTimer=void 0)}renderComponent(){const{device:e}=this.environment,t=this.layoutStyles,a=Boolean(Na.default.state.open),n=Za({},t.modal,{},this.shouldShowSidebar()&&t.modalWithSidebar);return s.a.createElement(v.a,{open:a,onDismiss:this.handleComponentClose,modalStyle:n,disableAnimation:!e.isMobile,renderContent:()=>s.a.createElement(g.a,{capture:!0,ignoreBlockSelection:!0,focusOffscreenInput:!1,restoreSelection:!e.isMobile,render:()=>s.a.createElement(h.a,{capture:!0,allowMenuList:!0,render:this.renderBody})})})}getMenuProps(e){const{device:t}=this.environment,{searchStore:a}=this.stores,n=this.modalMenuStyles,r=this.getThemeColors();if(t.isMobile){const{mode:t}=a.state,i=Za({},n.topbarButton,{},r.topbarButton);return Za({menuType:b.a.Modal,left:this.renderInput(),shouldRenderLeftDirectly:!0,leftOuterStyle:n.topbarLeftInput,right:s.a.createElement(Ke.CancelMenuText,null),onClickRight:this.handleComponentClose,rightOuterStyle:n.topbarRightButtonWrapper,header:this.shouldShowHeaderMobile({mode:t})&&this.renderHeader(),disableHeaderShadow:!0,topbarStyle:n.topbar,leftRightButtonStyle:i,onScroll:this.shouldDismissKeyboardOnScroll()?this.handleScrollResults:void 0},e)}return Za({menuType:b.a.Popup,maxHeight:Ka.MAX_MENU_HEIGHT,minHeight:Ka.MIN_MENU_HEIGHT,disableScroller:!0,scrollerStyle:this.layoutStyles.scroller},e)}renderHeader(){const{parentStore:e}=this.props,{searchStore:t}=this.stores,a=Boolean(this.getPublicAccessPermissionForPage());return s.a.createElement(wa,{parentStore:e,searchStore:t,isPublicPageSearch:a})}renderInput(){const{searchStore:e,resultListStore:t,isTypingStore:a,isInputFocusedStore:n}=this.stores;return s.a.createElement(ja,{isOpen:Boolean(Na.default.state.open),searchStore:e,resultListStore:t,isTypingStore:a,isFocusedStore:n,showSpinner:this.showSpinner()})}getRecentPagesSection(){const{device:e}=this.environment,t=this.defaultViewStyles,a=this.recentPageStores.state;if(a&&0!==a.length)return{key:"recentlyVisitedPages",items:a.map((t,a)=>({key:"".concat(t.id,":").concat(a),action:e=>this.handleSelectResult(t,e,"recent_pages"),render:n=>s.a.createElement(Wa,Object.assign({},n,{isFirstInSection:0===a,inline:!e.isMobile,store:t,hidePath:!1}))})),render:a=>s.a.createElement(bt.a,{key:a.key,title:s.a.createElement(j.FormattedMessage,{id:"search.recentlyVisitedPages.title",defaultMessage:"Recent pages",description:"Title text for recently visited pages"}),desktopTitleStyle:t.recentTitle,desktopStyle:t.recentSection,right:(void 0!==a.focusedIndex||e.isMobile)&&this.renderClearRecentsButton(this.clearRecentlyVisitedPages)},s.a.createElement("ul",{style:H},a.children))}}getRecentSearchesSection(){const{device:e}=this.environment,{parentStore:t}=this.props,a=this.defaultViewStyles,n=this.recentSearches.state;if(0!==n.length)return{key:"recentSearches",items:n.slice(0,Ka.MAX_RECENT_SEARCHES).map((e,a)=>({key:a,action:t=>this.handleRecentSearch(e,t),render:n=>s.a.createElement("li",{key:n.key},s.a.createElement(U,Object.assign({},n,{isFirstInSection:0===a,parentStore:t,query:e,icon:this.searchIcon()})))})),render:t=>s.a.createElement(bt.a,{key:t.key,title:s.a.createElement(j.FormattedMessage,{id:"search.recentSearches.title",defaultMessage:"Recent searches",description:"Title text for recent searches"}),desktopTitleStyle:a.recentTitle,desktopStyle:a.recentSection,right:(void 0!==t.focusedIndex||e.isMobile)&&this.renderClearRecentsButton(this.clearRecentSearches)},s.a.createElement("ul",{style:H},t.children))}}getInitialFocus(){if(this.stores.searchStore.state.query.text.trim())return;const e=this.recentPageStores.state;return e&&e.length>0?1:0}renderFooter(e){const{searchStore:t}=this.stores,a=this.layoutStyles,{mode:n}=t.state;if(n===de.c.Mode.Default)return s.a.createElement("footer",{style:a.footer},s.a.createElement(be,{mode:n}));const r=this.getCurrentResultsWithCount(e);return r?s.a.createElement("footer",{style:a.footer},s.a.createElement(be,{mode:n,results:r,showSpinner:this.showSpinner()})):void 0}renderClearRecentsButton(e){const{device:t}=this.environment,a=this.defaultViewStyles,n=this.getThemeColors(),r=Za({},a.clearButton,{},n.clearButton,{},!t.isMobile&&a.clearButtonDesktop);return s.a.createElement(ye.a,{onClick:e,style:r},s.a.createElement(j.FormattedMessage,{id:"search.clearRecentsButton.text",defaultMessage:"Clear",description:"Button text for clearing recent searches and pages"}))}renderResultsSection(e){const{localResponse:t,serverResponse:a,errorState:n}=e,{resultListStore:i}=this.stores,o=this.resultStyles,l=P.b({environment:this.environment,results:this.getCurrentResults({localResponse:t,serverResponse:a}),isOnline:this.isOnline()}),c=l&&{key:"results",render:e=>s.a.createElement(ue.a,Object.assign({},e,{shouldShowBottomDivider:!1,disableDesktopPadding:!0,disableMobilePadding:!0,disableMobileBorders:!0})),items:r.a.compact(l.map(this.renderSearchResult))};return s.a.createElement("section",{style:o.results},c&&s.a.createElement(y.a,{type:y.a.Type.Vertical,initialFocus:0,store:i,disableKeyboardArrowWrap:!0,sections:[c]}),this.renderError(n)||s.a.createElement(q.a,{onChange:this.handleScrollOffsetChange}))}renderError(e){const{searchStore:t}=this.stores;if(!e.isLoading)return e.showMajorError?s.a.createElement(oe,{error:e.serverError,searchStore:t}):e.serverError&&e.serverError!==te.d.NoResults?this.renderMessage(e.serverError.message):void 0}renderFilterMenu(){const{device:e}=this.environment,{parentStore:t}=this.props,{searchStore:a}=this.stores,n=e.isMobile?{isMobile:!0,mode:pa.Section}:void 0;return s.a.createElement(ya,Object.assign({parentStore:t,searchStore:a},n))}renderMessage(e){const t=this.resultStyles;return s.a.createElement(ue.a,{disableMobilePadding:!0,disableMobileBorders:!0},s.a.createElement(f.a,{title:e,style:t.messageMenuItem}))}getCurrentResults(e){const{serverRequestStore:t,localRequestStore:a}=this.stores,n=e&&e.localResponse||a.state.result,r=e&&e.serverResponse||t.state.result;return{local:P.i(n),server:P.i(r)}}getCurrentResultsWithCount(e){const{serverRequestStore:t,localRequestStore:a}=this.stores,n=e&&e.localResponse||a.state.result,r=e&&e.serverResponse||t.state.result,i=P.j(n),s=P.j(r);return s&&i?{server:s,local:i}:s?{server:s,local:void 0}:i?{server:void 0,local:i}:void 0}getPublicAccessPermissionForPage(){const{currentBlockStore:e}=c.default.state;return e&&M.g(this.environment,e)}isOnline(){return Boolean(Ga.a.state.online)}shouldShowSidebar(){const{device:e}=this.environment,{searchStore:t}=this.stores;if(!this.getPublicAccessPermissionForPage()&&!e.isMobile)return t.isSidebarOpen()}shouldShowHeaderDesktop(e){const{errorState:t,mode:a,isMobile:n}=e;if(n)return!1;if(a===de.c.Mode.Default)return!1;if(t.isLoading){const e=this.getCurrentResults();return Boolean(e.local||e.server)}return!t.showMajorError}shouldShowHeaderMobile(e){const{mode:t}=e;return t===de.c.Mode.Results}shouldShowFooter(e){const{isMobile:t}=e;if(t)return!1;if(e.mode===de.c.Mode.Default){const t=e.recentSearches.length>0,a=e.recentPages.length>0;return Boolean(t||a)}if(e.errorState.isLoading){const e=this.getCurrentResults();return Boolean(e.local||e.server)}return!e.errorState.showMajorError}showSpinner(){const{searchStore:e,serverRequestStore:t,isTypingStore:a}=this.stores;return this.isOnline()&&e.state.mode===de.c.Mode.Results&&!t.state.ready&&!a.get()}getThemeColors(){return{topbarButton:{color:this.theme.mediumTextColor},clearButton:{color:this.theme.lightTextColor}}}}Ka.MAX_RECENT_SEARCHES=5,Ka.LOAD_MORE_RESULTS_SCROLL_OFFSET_PX=200,Ka.MIN_MENU_HEIGHT=50,Ka.MAX_MENU_HEIGHT="80vh";t.default=Ka},miBo:function(e,t,a){"use strict";var n=a("g4rC");t.a=new n.a},smsn:function(e,t,a){"use strict";a.r(t);a("ioFf"),a("rGqo");var n,r=a("LvDl"),i=a.n(r),s=a("q1tI"),o=a.n(s),l=a("z22Z"),c=a("aZ00"),d=a("mF3+"),u=a("Mr7a"),p=a("hbKx"),m=a("wpmu"),h=a("/YYm"),g=a("tvfY"),f=a("wldR"),b=a("g4rC"),y=a("IdSf"),S=a("yisX"),v=a("OxuQ"),E=a("y6Dp"),M=a("lEhh"),C=a("LeVO"),w=a("MeYt"),O=a("5Nka"),k=a("Pqcg"),P=a("aEEb"),T=a("J9+s"),D=a("IULH"),I=a("yNyh"),F=a("hU3F"),j=a("d9nj"),x=a("Cycz"),B=a("PEWV"),A=a("HRSx");function R(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function L(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?R(Object(a),!0).forEach((function(t){U(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):R(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function U(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}!function(e){e[e.Web=0]="Web",e[e.Workspace=1]="Workspace",e[e.User=2]="User"}(n||(n={}));class _ extends f.a{constructor(){super(...arguments),this.copiedLink=new F.a(!1),this.showLinkOptions=new F.a(!1),this.storeTypes={buttonPopupStore:b.a},this.renderLinkOptionsButton=()=>o.a.createElement(j.a,{onClick:this.handleShowLinkOptionsClick,style:L({},this.getPublicAccessOptionStyle())},o.a.createElement(P.a,{isSmall:!0},o.a.createElement(T.FormattedMessage,{defaultMessage:"Show link options",id:"pagePermissionItem.showLinkOptions.label"}),d.a.chevronDown({width:9,height:9,marginLeft:4,display:"inline"}))),this.renderAllowEditsTooltip=()=>o.a.createElement(k.a,{caption:o.a.createElement(T.FormattedMessage,{defaultMessage:"Any logged in Notion user can edit this page. Share the secret link with people you trust.",id:"pagePermissionItem.allowEdits.tooltip"}),imageHeight:120,imageWidth:240,imageURL:O.a.images.tooltips.share.allowEditingPng}),this.renderAllowCommentsTooltip=()=>o.a.createElement(k.a,{caption:o.a.createElement(T.FormattedMessage,{defaultMessage:"Any logged in Notion user can comment on this page.",id:"pagePermissionItem.allowComments.tooltip"}),imageHeight:120,imageWidth:240,imageURL:O.a.images.tooltips.share.allowCommentsPng}),this.renderAllowSearchEngineTooltip=()=>o.a.createElement(k.a,{caption:o.a.createElement(T.FormattedMessage,{defaultMessage:"If allowed, your public page may appear in search engines such as Google, but only if you or someone else links to it elsewhere on the web.",id:"pagePermissionItem.allowSearchEngine.tooltip"}),imageHeight:120,imageWidth:240,imageURL:O.a.images.tooltips.share.allowSearchEnginesPng}),this.renderAllowSearchEngineUpgradeTooltip=()=>o.a.createElement(k.a,{imageURL:O.a.images.tooltips.upsells.searchEngineIndexingPng,imageWidth:240,imageHeight:100,title:o.a.createElement(T.FormattedMessage,{defaultMessage:"Upgrade for search engine indexing",id:"pagePermissionItem.searchEngineUpgradeTooltip.title"}),caption:o.a.createElement(T.FormattedMessage,{defaultMessage:"Have your page appear in search engine results.",id:"pagePermissionItem.searchEngineUpgradeTooltip.caption"})}),this.renderAllowDuplicateTooltip=()=>o.a.createElement(k.a,{caption:o.a.createElement(T.FormattedMessage,{defaultMessage:"If allowed, this will allow other people to duplicate your public page to their workspace.",id:"pagePermissionItem.allowDuplicateTemplate.tooltip"}),imageHeight:120,imageWidth:240,imageURL:O.a.images.tooltips.share.allowDuplicatePng}),this.handleCopy=()=>{const e=Object(h.a)({store:this.props.currentBlockStore});c.c({environment:this.environment,stringValue:e}),clearTimeout(this.copiedLinkTimeout),this.copiedLink.set(!0),this.copiedLinkTimeout=window.setTimeout(()=>{this.copiedLink.set(!1)},1e3)},this.handleShowLinkOptionsClick=()=>{this.showLinkOptions.set(!0)},this.handleToggleAllowEdits=()=>{const{permissionItem:e}=this.props;"public_permission"===e.type&&this.props.onChange(L({},e,{role:"read_and_write"===e.role?"comment_only":"read_and_write"}))},this.handleToggleAllowComments=()=>{const{permissionItem:e}=this.props;"public_permission"===e.type&&this.props.onChange(L({},e,{role:"comment_only"===e.role||"read_and_write"===e.role?"reader":"comment_only"}))},this.handleToggleSearchEngine=()=>{const{permissionItem:e}=this.props;if("public_permission"===e.type){const t=e,a=Boolean(t.allow_search_engine_indexing),n=i.a.clone(t),r=!a;n.allow_search_engine_indexing=r,this.props.onChange(n),E.Qe(this.environment,{allow_search_engine_indexing:r})}},this.handleToggleDuplicate=()=>{const{permissionItem:e}=this.props;if("public_permission"===e.type){const t=e,a=void 0===t.allow_duplicate||!0===t.allow_duplicate,n=i.a.clone(t),r=!a;n.allow_duplicate=r,this.props.onChange(n),E.Pe(this.environment,{allow_duplicate:r})}},this.handleRoleSelect=e=>{const t=i.a.clone(this.props.permissionItem);t.role=e,this.props.onChange(t)},this.handleSwitcherButtonClick=()=>{"none"===this.role?this.handleRoleSelect(this.props.switcherRole||"editor"):this.handleRoleSelect("none")},this.handleUserItemClick=()=>{this.stores.buttonPopupStore.setState(L({},this.stores.buttonPopupStore.state,{open:!0}))}}willMount(e){super.willMount(e),l.n(e.permissionItem)&&"none"===e.permissionItem.role&&this.showLinkOptions.set(!0)}renderComponent(){const{device:e}=this.environment,{tooltip:t}=this.props,a=this.isUserItem()||!this.isPublicPermissionItem?this.handleUserItemClick:this.handleSwitcherButtonClick;return t?o.a.createElement(s.Fragment,null,o.a.createElement(C.a,{delayThreshold:0,renderTooltip:()=>t,render:t=>o.a.createElement(w.a,Object.assign({disabled:this.props.disabled,mobileFeedback:e.isMobile,style:L({},this.props.disabled?{cursor:"not-allowed"}:{}),onClick:a},t),this.renderMenuItem()),placement:C.a.Placement.Left}),this.renderPublicPermissionSettings()):o.a.createElement(s.Fragment,null,o.a.createElement(w.a,{disabled:this.props.disabled,style:L({},this.props.disabled?{cursor:"not-allowed"}:{}),onClick:a},this.renderMenuItem()),this.renderPublicPermissionSettings())}renderMenuItem(){const{device:e}=this.environment,{isInherited:t,permissionItem:a}=this.props,n=this.isUserItem(),r=this.isBotPermissionItem(),i=!n&&!r,s=l.p(a)||l.i(a),c=!(this.isPublicPermissionItem||s&&"none"===this.role);return o.a.createElement("div",{className:"notranslate",style:this.getMenuItemStyle(n)},o.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:32,height:32,marginRight:e.isMobile?12:10}},this.props.icon),o.a.createElement("div",{style:{marginRight:"auto",minWidth:0}},o.a.createElement(P.a,{style:L({},!n&&{fontWeight:400})},this.props.title),this.props.subtitle&&o.a.createElement(P.a,{isSmall:!0},this.props.subtitle),t&&this.renderInheritedRecordTitle()),o.a.createElement("div",{style:{display:"flex",alignItems:"center",flexShrink:0,marginLeft:8}},this.isPublicPermissionItem?o.a.createElement(o.a.Fragment,null,c&&!s&&o.a.createElement(S.a,{role:this.role,table:A.b,type:a.type,disabled:this.props.disabled,isSubscribed:this.props.isSubscribed,isUserPermission:this.permissionItemIsUserItem(a),onChange:this.handleRoleSelect,onUpgradeButtonClick:this.props.onUpgradeButtonClick,upgradeButtonName:this.props.upgradeButtonName,buttonPopupStore:this.stores.buttonPopupStore,buttonStyle:{marginRight:e.isMobile||n||r?-6:8,color:this.theme.mediumTextColor,fontSize:e.isMobile?14:12}}),i&&o.a.createElement(M.a,{on:"none"!==this.role,onClick:this.handleSwitcherButtonClick,disabled:this.props.disabled,isAndroid:e.isAndroid})):o.a.createElement(S.a,{role:this.role,table:A.b,type:a.type,disabled:this.props.disabled,isSubscribed:this.props.isSubscribed,isUserPermission:this.permissionItemIsUserItem(a),onChange:this.handleRoleSelect,onUpgradeButtonClick:this.props.onUpgradeButtonClick,upgradeButtonName:this.props.upgradeButtonName,buttonPopupStore:this.stores.buttonPopupStore,buttonStyle:{marginRight:-6,color:this.theme.mediumTextColor,fontSize:e.isMobile?14:12},showPermissionOverrideWarning:this.props.isInherited})))}getPublicPermissionSettingsHeight(e){const{device:t}=this.environment;return e?0:t.isMobile?this.showLinkOptions.get()?214:94:this.showLinkOptions.get()?184:88}renderPublicPermissionSettings(){const{device:e}=this.environment,{permissionItem:t}=this.props;if(l.n(t)){const a="none"===this.role;return o.a.createElement("div",{style:{maxHeight:this.getPublicPermissionSettingsHeight(a),transition:"max-height ease 200ms, padding-bottom ease 200ms",overflow:"hidden",paddingBottom:a?0:this.showLinkOptions.get()?12:8}},!e.isMobile&&this.renderPageLinkButton(),this.showLinkOptions.get()?o.a.createElement(o.a.Fragment,null,o.a.createElement(o.a.Fragment,null,o.a.createElement(C.a,{placement:C.a.Placement.Left,renderTooltip:this.renderAllowEditsTooltip,render:a=>o.a.createElement(w.a,Object.assign({onClick:this.handleToggleAllowEdits,style:this.getPublicAccessOptionStyle(),disabled:this.props.disabled},a),o.a.createElement(P.a,{style:this.getPublicAccessOptionLabelStyle(this.props.disabled)},o.a.createElement(T.FormattedMessage,{defaultMessage:"Allow editing",id:"pagePermissionItem.allowEdits.setting"})),o.a.createElement(M.a,{on:"read_and_write"===t.role,onClick:this.handleToggleAllowEdits,disabled:this.props.disabled,isAndroid:e.isAndroid}))}),o.a.createElement(C.a,{placement:C.a.Placement.Left,renderTooltip:this.renderAllowCommentsTooltip,render:t=>o.a.createElement(w.a,Object.assign({onClick:this.handleToggleAllowComments,style:this.getPublicAccessOptionStyle(),disabled:this.props.disabled},t),o.a.createElement(P.a,{style:this.getPublicAccessOptionLabelStyle(this.props.disabled)},o.a.createElement(T.FormattedMessage,{defaultMessage:"Allow comments",id:"pagePermissionItem.allowComments.setting"})),o.a.createElement(M.a,{on:"comment_only"===this.role||"read_and_write"===this.role,onClick:this.handleToggleAllowComments,disabled:this.props.disabled,isAndroid:e.isAndroid}))})),o.a.createElement(C.a,{placement:C.a.Placement.Left,renderTooltip:this.renderAllowDuplicateTooltip,render:a=>o.a.createElement(w.a,Object.assign({onClick:this.handleToggleDuplicate,disabled:this.props.disabled,style:this.getPublicAccessOptionStyle()},a),o.a.createElement(P.a,{style:this.getPublicAccessOptionLabelStyle(this.props.disabled)},o.a.createElement(T.FormattedMessage,{defaultMessage:"Allow duplicate as template",id:"pagePermissionItem.allowDuplicateTemplate.setting"})),o.a.createElement(M.a,{on:!1!==t.allow_duplicate,onClick:this.handleToggleDuplicate,disabled:this.props.disabled,isAndroid:e.isAndroid}))}),o.a.createElement(B.a,{requireUpgradeToTier:!Object(x.M)(this.environment)&&Object(x.k)(this.environment),alwaysAllowClick:t.allow_search_engine_indexing,analyticsName:"allow_search_engine_indexing",onClick:this.handleToggleSearchEngine,onUpgradeClick:this.props.onUpgradeButtonClick,tooltipPlacement:C.a.Placement.Left,renderTooltip:this.renderAllowSearchEngineTooltip,renderUpgradeTooltip:this.renderAllowSearchEngineUpgradeTooltip,render:(a,n)=>o.a.createElement(w.a,Object.assign({style:this.getPublicAccessOptionStyle(),disabled:this.props.disabled},a),o.a.createElement(P.a,{style:this.getPublicAccessOptionLabelStyle(this.props.disabled)},o.a.createElement(T.FormattedMessage,{defaultMessage:"Search engine indexing",id:"pagePermissionItem.allowSearchEngines.setting"})," ",n),o.a.createElement(M.a,{on:Boolean(t.allow_search_engine_indexing),onClick:this.handleToggleSearchEngine,disabled:this.props.disabled||Boolean(n),isAndroid:e.isAndroid}))})):this.renderLinkOptionsButton())}}renderPageLinkButton(){const e=Object(h.a)({store:this.props.currentBlockStore});return o.a.createElement("div",{style:L({},this.getPublicAccessOptionStyle(),{height:"auto"})},o.a.createElement("div",{style:{flex:1}},o.a.createElement("div",{style:{display:"flex",padding:"1px 0"}},o.a.createElement(I.b,{value:e,disabled:!0,style:{flex:1,borderTopRightRadius:0,borderBottomRightRadius:0,paddingRight:0}}),o.a.createElement(D.a,{onClick:this.handleCopy,style:{height:28,borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",minWidth:88}},this.copiedLink.get()?o.a.createElement(T.FormattedMessage,{id:"pageShareMenu.copiedLinkButton.label",defaultMessage:"✓ Copied"}):o.a.createElement(T.FormattedMessage,{id:"pageShareMenu.copyLinkButton.label",defaultMessage:"Copy link"})))))}renderInheritedRecordTitle(){const e=this.props.store,t=Object(h.a)({store:e,fullyQualified:!1});return o.a.createElement(P.a,{isSmall:!0,style:{lineHeight:1.4}},o.a.createElement(T.FormattedMessage,{defaultMessage:"Based on {linkBoxWithPageTitle}",description:"This text tells the user that this permission setting for the page is inherited from the parent page. ",id:"pagePermissionItem.inheritedRecordPermissions.setting",values:{linkBoxWithPageTitle:o.a.createElement(y.a,{underline:!0,inline:!0,href:t},o.a.createElement(v.a,{store:e,style:{display:"inline"}}))}}))}permissionItemIsUserItem(e){const t=this.environment.currentUser.id;return"user_permission"===e.type&&e.user_id===t}isUserItem(){return this.props.format===n.User}get role(){return this.props.permissionItem.role}get isPublicPermissionItem(){return l.n(this.props.permissionItem)}isBotPermissionItem(){return l.g(this.props.permissionItem)}getMenuItemStyle(e){const{WindowSizeStore:t}=this.environment;return{display:"flex",alignItems:"center",minHeight:52,paddingTop:8,paddingBottom:8,paddingLeft:t.getSafePaddingLeftCSS(14),paddingRight:t.getSafePaddingRightCSS(14)}}getPublicAccessOptionStyle(){const{device:e,WindowSizeStore:t}=this.environment;let a;return a=e.isMobile?36:30,{display:"flex",alignItems:"center",width:"100%",height:a,paddingTop:5,paddingBottom:5,paddingLeft:t.getSafePaddingLeftCSS(14),paddingRight:t.getSafePaddingRightCSS(14)}}getPublicAccessOptionLabelStyle(e){return{marginRight:"auto",opacity:e?.6:1}}}_.Format=n,_.iconSize=32;var W=_,N=a("8fuX"),q=a("gbGO"),V=a("2HDO"),z=a("MBf9"),H=a("Oy36"),G=a("Sb6f"),Q=a("5/h/"),Y=a("D8Ld"),Z=a("8f5p"),X=a("Fv2F"),K=a("QcDD"),J=a("vJXr"),$=a("r8MX"),ee=a("A9TN"),te=a("7M94"),ae=a("AXh+"),ne=a("xL2i"),re=a("bPtJ"),ie=a("G+Ai"),se=a("58VE"),oe=a("VBxf"),le=a("HTHG"),ce=a("nPEg"),de=a("7KuZ"),ue=a("0CAA"),pe=a("qX+M"),me=a("i8hZ"),he=a("prF1");class ge extends f.a{renderComponent(){const{device:e,WindowSizeStore:t}=this.environment;return o.a.createElement(he.a,{href:Object(ue.a)("guides.sharing"),onClick:()=>E.C(this.environment,{from:"sharing"}),style:{width:e.isMobile?"100%":void 0},external:!0},o.a.createElement(j.a,{mobileFeedback:e.isMobile,isSmall:!0,style:{display:"flex",alignItems:"center",width:e.isMobile?"100%":void 0,height:e.isMobile?44:24,paddingTop:e.isMobile?12:4,paddingBottom:e.isMobile?12:4,paddingLeft:t.getSafePaddingLeftCSS(8),paddingRight:t.getSafePaddingRightCSS(12)}},o.a.createElement("div",{style:{marginLeft:e.isMobile?2:0,marginRight:e.isMobile?8:6}},d.a.help({width:e.isMobile?16:14,height:e.isMobile?16:14,fill:e.isMobile?this.theme.mediumIconColor:this.theme.lightIconColor})),o.a.createElement(P.a,{isSmall:!0,isMobile:e.isMobile,isSecondaryColor:!e.isMobile},o.a.createElement(T.FormattedMessage,{defaultMessage:"Learn about sharing",id:"blockPermissionsSettings.learnMore.prompt"}))))}}var fe=ge,be=a("GojS"),ye=a("XfKI"),Se=a("pqiZ"),ve=a("kdGy"),Ee=a("gHFd");function Me(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ce(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Me(Object(a),!0).forEach((function(t){we(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Me(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function we(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Oe extends f.a{constructor(){super(...arguments),this.sidebarState=this.createComputedStore(()=>Object(le.i)(this.environment)),this.storeTypes={restrictConfirmationModalStore:F.a.of({open:!1,onClose:void 0})},this.renderBotPermissionTooltip=()=>o.a.createElement(k.a,{imageWidth:240,caption:o.a.createElement(T.FormattedMessage,{defaultMessage:"This is a bot inside your workspace.",id:"blockPermissionsSettings.botPermission.tooltip"})}),this.renderPublicPermissionTooltip=()=>o.a.createElement(k.a,{imageURL:O.a.images.tooltips.share.publicPagePng,imageWidth:240,imageHeight:120,caption:o.a.createElement(T.FormattedMessage,{defaultMessage:"Anybody with the link can access the page.",id:"blockPermissionsSettings.publicPermission.tooltip"})}),this.renderSpacePermissionTooltip=()=>o.a.createElement(k.a,{imageURL:O.a.images.tooltips.share.workspacePng,imageWidth:240,imageHeight:180,caption:o.a.createElement(T.FormattedMessage,{defaultMessage:"For all members in your workspace, this page will show up in the <boldtext>Workspace</boldtext> section in their sidebar.",values:{boldtext:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return o.a.createElement("span",{style:{fontWeight:G.a.fontWeight.bold}},t)}},id:"blockPermissionsSettings.spacePermission.tooltip"})}),this.renderGroupPermissionTooltip=e=>{const{currentSpaceStore:t}=K.default.state,{countRemainingUsers:a,limitedUserValues:n}=Z.b({group:e,spaceStore:t,limit:15});if(n.length>0)return o.a.createElement("div",{style:{marginBottom:4}},n.map(e=>o.a.createElement("div",{key:e.id,style:{display:"flex",alignContent:"flex-end",minWidth:140,width:"100%",marginTop:4}},o.a.createElement(be.a,{style:{flexGrow:1},userValue:e,avatarSize:18}))),a>0&&o.a.createElement("div",{style:{marginLeft:2,marginTop:2,color:this.theme.mediumInvertedTextColor}},o.a.createElement(T.FormattedMessage,{id:"blockPermissionsSettings.groupPermissionUsers.tooltip",defaultMessage:"{countRemainingUsers} more…",values:{countRemainingUsers:a}})));const r=Object(Z.a)({intl:this.props.intl,group:e});return o.a.createElement(k.a,{imageURL:O.a.images.tooltips.share.sharedPng,imageWidth:240,imageHeight:120,caption:o.a.createElement(T.FormattedMessage,{defaultMessage:"For all members of the {groupName} group, this page will show up in the <boldtext>Shared</boldtext> section in their sidebar.",values:{boldtext:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return o.a.createElement("span",{style:{fontWeight:G.a.fontWeight.bold}},t)},groupName:r},id:"blockPermissionsSettings.groupPermission.tooltip"})})},this.renderUserPermissionItem=e=>{const{store:t}=this.props,a=m.a.createChildStore(t,{table:A.b,id:e.blockId}),n=g.a.createChildStore(t,{table:Q.a,id:e.permissionItem.user_id}).getValue(),r=a.id!==t.id,i=e=>o.a.createElement("div",{style:Ce({},e.style,{background:this.theme.lightDividerColor})}),s=n?o.a.createElement(se.a,{userValue:n,size:W.iconSize}):o.a.createElement(i,{style:{height:W.iconSize,width:W.iconSize,borderRadius:20}}),{data:c}=$.default.state,u=(c?x.w(c):[]).find(t=>t.userId===e.permissionItem.user_id),p=Boolean(u&&!l.a(u.role)&&!l.c(u.role)),h=n&&n.email?p?o.a.createElement("div",{style:G.a.textOverflowStyle},d.a.globe2({width:14,fill:"#CF8807",display:"inline",verticalAlign:"middle"})," ",o.a.createElement("span",{style:{color:"#CF8807",fontWeight:500}},o.a.createElement(T.FormattedMessage,{defaultMessage:"Guest",id:"blockPermissionsSettings.permissionsForUserGuest.label"}))," • ",n.email):n.email:void 0;return o.a.createElement("div",{key:e.permissionItem.user_id},o.a.createElement(W,{format:W.Format.User,currentBlockStore:t,store:a,permissionItem:e.permissionItem,disabled:!this.canEdit(),icon:s,title:n?Object(Q.e)(n)||o.a.createElement(T.FormattedMessage,{defaultMessage:"Invitation sent",id:"blockPermissionsSettings.sentInvitation.message"}):o.a.createElement(i,{style:{height:8,width:81,borderRadius:3}}),subtitle:n?h:o.a.createElement(i,{style:{height:8,width:139,borderRadius:3,marginTop:10}}),isSubscribed:this.isSubscribed(),isInherited:r,tooltip:r?this.renderInheritedPermissionTooltip(a):void 0,upgradeButtonName:"user_permission_item",onUpgradeButtonClick:this.props.onUpgradeButtonClick,onChange:async t=>{await this.handlePermissionItemChange({isInherited:r,oldPermissionItem:e.permissionItem,newPermissionItem:t})}}))},this.renderBotPermissionItem=e=>{const{store:t}=this.props,a=m.a.createChildStore(t,{table:A.b,id:e.blockId}),n=Object(re.c)(t,{table:ie.a,id:e.permissionItem.bot_id}),r=n.getValue(),i=a.id!==t.id,s=r&&r.name||o.a.createElement(T.FormattedMessage,{id:"blockPermissionsSetings.untitledBotPlaceholder",defaultMessage:"Untitled Bot"}),l=o.a.createElement("div",{style:G.a.textOverflowStyle},d.a.bot({width:12,display:"inline",verticalAlign:"middle"})," ",o.a.createElement(T.FormattedMessage,{defaultMessage:"Bot",id:"blockPermissionsSettings.permissionsForBot.label",description:"Inform user that this page is shared with a bot."})),c=o.a.createElement(ve.a,{botValue:r,size:W.iconSize});return o.a.createElement("div",{key:n.id,style:this.getPermissionItemWrapStyle()},o.a.createElement(W,{format:W.Format.Workspace,currentBlockStore:t,store:a,permissionItem:e.permissionItem,disabled:!this.canEdit(),icon:c,title:s,tooltip:i?this.renderInheritedPermissionTooltip(a):this.renderBotPermissionTooltip(),subtitle:l,isSubscribed:this.isSubscribed(),isInherited:i,upgradeButtonName:"bot_permission_item",onUpgradeButtonClick:this.props.onUpgradeButtonClick,onChange:async t=>{await this.handlePermissionItemChange({isInherited:i,oldPermissionItem:e.permissionItem,newPermissionItem:t})}}))},this.handleCopy=()=>{const e=Object(h.a)({store:this.props.store});c.c({environment:this.environment,stringValue:e}),this.props.buttonPopupStore.setState({open:!1})},this.handleReactNativeShareClick=()=>{const{reactNative:e}=this.environment,t=X.b({schemeUrl:window.location.href,baseUrl:ee.default.baseURL});e&&e.share(t)},this.handleCloseRestrictConfirmationModal=()=>{this.stores.restrictConfirmationModalStore.setState({open:!1,onClose:void 0})},this.handlePermissionItemChange=async e=>{const{isInherited:t,oldPermissionItem:a,newPermissionItem:n}=e;if(!Object(ne.m)(a,n))throw new Error("Permission type mismatch.");const r=Object(ne.e)(a.role,n.role);if(t&&r!==n.role)return void this.handleRestrictPermission(n);const i=this.props.store.isTopLevel();if(i&&l.p(n)){const{data:e}=$.default.state,t=e?x.v(e):1;if(l.d(a.role)&&!l.d(n.role)&&t>1){if(!(await oe.confirmUserAction({message:o.a.createElement("span",null,o.a.createElement(T.FormattedMessage,{defaultMessage:"Are you sure you want to make this page private? <semibold>Only you will be able to access it.</semibold>",values:{semibold:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return o.a.createElement("span",{style:{fontWeight:G.a.fontWeight.semibold}},t)}},id:"blockPermissionsSettings.confirmationDialog.private.message"})),acceptLabel:o.a.createElement(T.FormattedMessage,{defaultMessage:"Move to Private",id:"blockPermissionsSettings.confirmationDialog.privateButton.label"})})))return}else if(i&&!l.d(a.role)&&l.d(n.role)){if(!(await oe.confirmUserAction({message:o.a.createElement("span",null,o.a.createElement(T.FormattedMessage,{defaultMessage:"Are you sure you want to share this page with the workspace? <semibold>It will be accessible by all {memberCount} members.</semibold>",id:"blockPermissionsSettings.confirmationDialog.workspace.message",values:{semibold:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return o.a.createElement("span",{style:{fontWeight:G.a.fontWeight.semibold}},t)},memberCount:t}})),acceptLabel:o.a.createElement(T.FormattedMessage,{defaultMessage:"Move to workspace",id:"blockPermissionsSettings.confirmationDialog.workspaceButton.label"})})))return}}!i&&a.role!==n.role&&r!==a.role&&E.ff(this.environment),z.createAndCommit(this.environment,e=>{u.f({environment:this.environment,store:this.props.store,permissionItems:[n],transaction:e})})},this.handleRestrictPermission=e=>{const t=()=>{z.createAndCommit(this.environment,async t=>{await u.e({environment:this.environment,store:this.props.store,permissionItem:e,transaction:t})})};"none"===e.role?this.stores.restrictConfirmationModalStore.setState({open:!0,onClose:this.handleCloseRestrictConfirmationModal,type:"remove",permissionItem:e,onAccept:t}):this.stores.restrictConfirmationModalStore.setState({open:!0,onClose:this.handleCloseRestrictConfirmationModal,type:"restrict",onAccept:t})}}renderComponent(){const{device:e}=this.environment;let t;return t=e.isMobile?{menuType:q.b.MenuType.Modal,title:o.a.createElement(T.FormattedMessage,{defaultMessage:"Share",id:"blockPermissionsSettings.mobileShareMenu.title"}),left:this.renderMobileHelpButton(),right:o.a.createElement(ce.DoneMenuText,null),onClickRight:this.props.onClose}:{menuType:q.b.MenuType.Popup},o.a.createElement(o.a.Fragment,null,o.a.createElement(me.a,Object.assign({},this.stores.restrictConfirmationModalStore.state)),o.a.createElement(q.b,Object.assign({},t,{className:te.ub}),o.a.createElement(Y.a,{capture:!0,allowEsc:!0},o.a.createElement(V.a,{capture:!0,ignoreBlockSelection:!0,restoreSelection:!1,focusOffscreenInput:!1,render:()=>J.a.state.online?this.renderPermissions():this.renderOfflineMessage()}))))}renderMobileHelpButton(){return o.a.createElement(de.a,{href:Object(ue.a)("guides.sharing"),analyticsFrom:"sharing"})}renderOfflineMessage(){const{device:e}=this.environment;return o.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:160}},o.a.createElement(P.a,{isMobile:e.isMobile,isSecondaryColor:!0,isMultiline:!0,style:{textAlign:"center"}},o.a.createElement(T.FormattedMessage,{defaultMessage:"Please go online to publish & share.",id:"blockPermissionsSettings.offline.prompt"})))}renderPermissions(){const{device:e,WindowSizeStore:t}=this.environment,{currentSpaceStore:a}=K.default.state,{store:n}=this.props,r=Object(ae.b)(n);let c=[];if(a){const e=a.getValue();e&&e.permission_groups&&(c=e.permission_groups)}let u={permissionItem:{type:"public_permission",role:"none"},blockId:n.id},p={permissionItem:{type:"space_permission",role:"none"},blockId:n.id};for(const i of r)if(l.n(i.permissionItem)){u=i}else if(l.p(i.permissionItem)){p=i}let m=r.filter(e=>{let{permissionItem:t}=e;return l.i(t)});m=i.a.sortBy(m,e=>{if(a){const t=a.getValue();if(t&&t.permission_groups)return t.permission_groups.findIndex(t=>t.id===e.permissionItem.group_id)}return e.permissionItem.group_id});const h=r.filter(e=>{let{permissionItem:t}=e;return l.q(t)}),g=r.filter(e=>{let{permissionItem:t}=e;return l.g(t)}),f={};let b=N.a.Y;e.isMobile?(f.backgroundColor=this.theme.contentBackground,b=N.a.None):f.maxHeight="calc(70vh - 80px)";const y=a&&!a.getDisablePublicAccess(),S=this.sidebarState.state,v=S&&S.showWorkspaceSection||a&&"team"===a.getPlanType(),E=v||h.length>1||h.length&&!l.a(h[0].permissionItem.role)||m.length||l.d(p.permissionItem.role),M=r.some(e=>l.o(e.permissionItem)&&e.blockId===n.id);return o.a.createElement("div",{style:{flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column"}},e.isMobile&&o.a.createElement(s.Fragment,null,M&&this.renderRestrictedPermissionBanner(),o.a.createElement("div",{style:{display:"flex",paddingTop:10,paddingBottom:10,paddingRight:t.getSafePaddingRightCSS(14),background:this.theme.sidebarBackground}},this.renderPageLinkButton()),o.a.createElement("div",{style:{borderBottom:"1px solid ".concat(this.theme.regularDividerColor)}})),o.a.createElement(N.b,{style:f,type:b},!e.isMobile&&M&&this.renderRestrictedPermissionBanner(),y&&this.renderPublicPermissionItem(u),this.renderAddGuests(),v&&this.renderSpacePermissionItem(p),o.a.createElement("div",{style:this.getPermissionItemWrapStyle()},this.renderGroupPermissions({spacePermissionGroups:c,mostPermissiveGroupPermissions:m}),E&&o.a.createElement("div",{style:{paddingBottom:h.length>0?8:void 0}},h.map(this.renderUserPermissionItem))),g.map(this.renderBotPermissionItem)),o.a.createElement("div",{style:Ce({display:"flex",alignItems:e.isMobile?"flex-start":"center",boxShadow:"0 -1px 0 ".concat(this.theme.regularDividerColor),paddingLeft:t.getSafePaddingRightCSS(8),paddingRight:t.getSafePaddingRightCSS(8),flexDirection:"column-reverse"},!e.isMobile&&{flexDirection:"row",justifyContent:"space-between",padding:"4px 4px"})},!e.isMobile&&o.a.createElement(s.Fragment,null,o.a.createElement(fe,null),o.a.createElement(C.a,{delayThreshold:0,placement:C.a.Placement.Bottom,renderTooltip:()=>this.getPageLinkInfoTooltip(),render:t=>o.a.createElement(j.a,Object.assign({isSmall:!0,onClick:e.isReactNative?this.handleReactNativeShareClick:this.handleCopy,mobileFeedback:e.isMobile,style:{height:e.isMobile?44:24,width:e.isMobile?"100%":void 0,paddingLeft:8,paddingRight:8,color:this.theme.regularTextColor}},t),d.a.link({width:e.isMobile?16:14,height:e.isMobile?16:14,fill:this.theme.regularIconColor,marginLeft:e.isMobile?2:0,marginRight:e.isMobile?8:6}),o.a.createElement(P.a,{isSmall:!0,isMobile:e.isMobile,style:{color:this.theme.regularTextColor}},o.a.createElement(T.FormattedMessage,{id:"blockPermissionsSettings.copyLinkButton.label",defaultMessage:"Copy link"})))}))))}renderInviteButton(){const{currentSpaceStore:e}=K.default.state,{device:t}=this.environment,{store:a}=this.props;return o.a.createElement(Ee.LazyPermissionsInvite,{store:a,disabled:!this.canEdit(),membersOnly:Boolean(e&&e.getDisableGuests()),isSubscribed:this.isSubscribed(),onUpgradeButtonClick:this.props.onUpgradeButtonClick,upgradeButtonName:"invite_permission_block",shouldGrow:!0,buttonStyle:{height:t.isMobile?36:28}})}renderPageLinkButton(){const{device:e}=this.environment;return o.a.createElement(C.a,{delayThreshold:0,placement:C.a.Placement.Bottom,renderTooltip:()=>this.getPageLinkInfoTooltip(),render:t=>o.a.createElement(D.a,Object.assign({isLarge:!0,onClick:e.isReactNative?this.handleReactNativeShareClick:this.handleCopy,style:{marginLeft:12,flex:1,height:this.environment.device.isMobile?36:void 0,background:this.theme.contentBackground}},t),e.isReactNative?o.a.createElement(T.FormattedMessage,{id:"pageShareMenu.sharePageLinkButton.label",defaultMessage:"Share page link"}):o.a.createElement(T.FormattedMessage,{id:"pageShareMenu.copyPageLinkButton.label",defaultMessage:"Copy page link"}))})}renderRestrictedPermissionBanner(){const{device:e}=this.environment,{store:t}=this.props,a=p.c(t,1),n=ye.Fb([ye.l,ye.b([ye.Ab,ye.Eb(ye.l)])])({environment:this.environment,blocks:[t]});if(a&&a.canRead())return o.a.createElement("div",null,o.a.createElement("div",{style:Ce({},this.getPermissionItemWrapStyle(),{},this.getMenuItemStyle(),{backgroundColor:e.isMobile?this.theme.darkBannerBackground:this.theme.sidebarSecondaryBackground,flexDirection:e.isMobile?"column":"row",alignItems:e.isMobile?"flex-start":"center",paddingTop:e.isMobile?14:10})},o.a.createElement("div",{style:{display:"flex",alignItems:"flex-start",marginRight:e.isMobile?void 0:6}},d.a.eyeHide({width:e.isMobile?20:16,marginTop:e.isMobile?3:2,marginRight:e.isMobile?10:8,marginLeft:e.isMobile?2:0,fill:this.theme.regularIconColor}),o.a.createElement(P.a,{isMultiline:!0,isMobile:e.isMobile,isSmall:!0,style:{color:this.theme.regularTextColor}},o.a.createElement(T.FormattedMessage,{id:"pageShareMenu.restrictedAccessBanner.label",defaultMessage:"Access restricted. May not be shared with everyone from {linkBoxWithPageTitle}.",description:"This text tells the user that this permission setting for the page is NOT inherited from the parent page.",values:{linkBoxWithPageTitle:o.a.createElement(y.a,{style:{color:this.theme.mediumTextColor},underline:!0,inline:!0,href:Object(h.a)({store:a,fullyQualified:!1})},o.a.createElement(v.a,{shouldWrap:!0,maxLength:30,store:a,style:{display:"inline"}}))}}))),n&&o.a.createElement(j.a,{isSmall:!e.isMobile||void 0,style:{fontSize:e.isMobile?14:12,marginTop:e.isMobile?2:void 0,marginLeft:e.isMobile?24:void 0,fontWeight:e.isMobile?G.a.fontWeight.medium:void 0},onClick:()=>{const e=t.getPermissionItems(),a=p.f(t),n=a?Object(ne.c)(p.h(a)):[],r=Object(ne.g)(e,n);this.stores.restrictConfirmationModalStore.setState({open:!0,onClose:this.handleCloseRestrictConfirmationModal,type:"restore",permissionChanges:r,onAccept:()=>{t.getPermissionsStore().canAdmin()?z.createAndCommit(this.environment,async e=>{await u.d({environment:this.environment,store:t,transaction:e})}):u.a({environment:this.environment,store:t})}})}},o.a.createElement(T.FormattedMessage,{id:"pageShareMenu.restrictedAccessBanner.restore",defaultMessage:"Restore",description:"Action for when user wants to remove restricted access to a page."}))),e.isMobile?o.a.createElement(Se.a,{size:1,style:{opacity:"75%"}}):void 0)}renderPublicPermissionItem(e){const{store:t}=this.props,a=m.a.createChildStore(t,{table:A.b,id:e.blockId}),n=a.id!==t.id;return o.a.createElement("div",{style:this.getPermissionItemWrapStyle(),className:te.g},o.a.createElement(W,{format:W.Format.Web,currentBlockStore:t,store:a,permissionItem:e.permissionItem,disabled:!this.canEdit(),icon:d.a.globe({width:26,height:26,fill:this.theme.lightIconColor}),title:o.a.createElement(T.FormattedMessage,{defaultMessage:"Share to web",id:"blockPermissionsSettings.permissionItem.linkSharing"}),subtitle:l.c(e.permissionItem.role)?o.a.createElement(T.FormattedMessage,{defaultMessage:"Anyone with the link can edit and comment",id:"blockPermissionsSettings.publicPermission.canEdit"}):l.b(e.permissionItem.role)?o.a.createElement(T.FormattedMessage,{defaultMessage:"Anyone with the link can comment",id:"blockPermissionsSettings.publicPermission.canComment"}):l.d(e.permissionItem.role)?o.a.createElement(T.FormattedMessage,{defaultMessage:"Anyone with the link can view",id:"blockPermissionsSettings.publicPermission.canRead"}):o.a.createElement(T.FormattedMessage,{defaultMessage:"Publish and share link with anyone",id:"blockPermissionsSettings.publicPermission.none"}),tooltip:n?this.renderInheritedPermissionTooltip(a):this.renderPublicPermissionTooltip(),isSubscribed:this.isSubscribed(),isInherited:n,upgradeButtonName:"public_permission_item",onUpgradeButtonClick:this.props.onUpgradeButtonClick,switcherRole:"reader",onChange:async t=>{await this.handlePermissionItemChange({isInherited:n,oldPermissionItem:e.permissionItem,newPermissionItem:t})}}))}renderSpacePermissionItem(e){const{store:t}=this.props,a=m.a.createChildStore(t,{table:A.b,id:e.blockId}),n=p.i(t)||K.default.state.currentSpaceStore;if(!n||!n.getValue())return;const r=Object(pe.getSpacePermissionItems)(n).filter(e=>l.c(l.f(e))),i=a.id!==t.id;return o.a.createElement("div",{style:{width:"100%"},className:te.h},o.a.createElement(W,{format:W.Format.Workspace,currentBlockStore:t,store:a,permissionItem:e.permissionItem,disabled:!this.canEdit(),icon:this.renderSpaceIcon(),title:o.a.createElement(T.FormattedMessage,{defaultMessage:"Everyone at {workspaceName}",id:"blockPermissionsSettings.permissionItem.workspaceAccessNew",values:{workspaceName:Object(pe.getSpaceName)(this.environment,n)}}),tooltip:i?this.renderInheritedPermissionTooltip(a):this.renderSpacePermissionTooltip(),subtitle:o.a.createElement(T.FormattedMessage,{defaultMessage:"{numberOfWorkspaceMembers, plural, one {{numberOfWorkspaceMembers} workspace member} other {{numberOfWorkspaceMembers} workspace members}}",id:"blockPermissionsSettings.spacePermission.none",values:{numberOfWorkspaceMembers:r.length}}),isSubscribed:this.isSubscribed(),isInherited:i,upgradeButtonName:"space_permission_item",onUpgradeButtonClick:this.props.onUpgradeButtonClick,onChange:async t=>{await this.handlePermissionItemChange({isInherited:i,oldPermissionItem:e.permissionItem,newPermissionItem:t})}}))}renderInheritedPermissionTooltip(e){const t=e.getIcon();return o.a.createElement("div",{style:{whiteSpace:"normal",width:180}},o.a.createElement(T.FormattedMessage,{defaultMessage:"This access is based on {inlineIconAndName}. Changing this access will restrict permissions of this page.",id:"blockPermissionsSettings.restrictedPermissions.tooltip",values:{inlineIconAndName:o.a.createElement("span",{style:{whiteSpace:"nowrap",fontWeight:G.a.fontWeight.bold}},t&&o.a.createElement(H.a,{disabled:!0,icon:t,isEmptyPage:!1,size:12,style:{marginRight:4,display:"inline-block"}}),o.a.createElement(v.a,{store:e,style:{display:"inline"}}))}}))}renderSpaceIcon(){const{currentSpaceStore:e}=K.default.state;return e?o.a.createElement(H.a,{disabled:!0,title:Object(pe.getSpaceName)(this.environment,e),icon:Object(pe.getSpaceIcon)(this.environment,e),isEmptyPage:!1,size:W.iconSize}):d.a.team()}renderGroupPermissions(e){const{currentSpaceStore:t}=K.default.state,{spacePermissionGroups:a,mostPermissiveGroupPermissions:n}=e;return n.map(e=>{const n=e.permissionItem.group_id,r=a.find(e=>e.id===n);if(r&&t)return this.renderGroupPermissionItem(e,r,t.id)})}renderGroupPermissionItem(e,t,a){const{store:n,intl:r}=this.props,i=m.a.createChildStore(n,{table:A.b,id:e.blockId}),s=t.user_ids||[],l=Object(Z.a)({intl:r,group:t}),c=i.id!==n.id,d=o.a.createElement(H.a,{disabled:!0,title:l,icon:t.icon?{table:"space",id:a,icon:t.icon}:void 0,isEmptyPage:!1,size:W.iconSize});return o.a.createElement("div",{key:t.id,style:{fontWeight:400},className:te.f},o.a.createElement(W,{format:W.Format.Workspace,currentBlockStore:n,store:i,permissionItem:e.permissionItem,disabled:!this.canEdit(),icon:d,title:l,tooltip:c?this.renderInheritedPermissionTooltip(i):this.renderGroupPermissionTooltip(t),subtitle:o.a.createElement(T.FormattedMessage,{defaultMessage:"{numberOfGroupMembers, plural, one {{numberOfGroupMembers} group member} other {{numberOfGroupMembers} group members}}",id:"blockPermissionsSettings.groupPermission.none",values:{numberOfGroupMembers:s.length}}),isSubscribed:this.isSubscribed(),isInherited:c,upgradeButtonName:"group_permission_item",onUpgradeButtonClick:this.props.onUpgradeButtonClick,onChange:async t=>{await this.handlePermissionItemChange({isInherited:c,oldPermissionItem:e.permissionItem,newPermissionItem:t})}}))}renderAddGuests(){const{device:e}=this.environment,{WindowSizeStore:t}=this.environment;return o.a.createElement(w.a,{mobileFeedback:e.isMobile,disabled:!0},o.a.createElement("div",{style:Ce({},this.getMenuItemStyle(),{paddingTop:e.isMobile?12:10,paddingBottom:e.isMobile?12:10,paddingLeft:t.getSafePaddingLeftCSS(14),paddingRight:t.getSafePaddingRightCSS(14)})},o.a.createElement("div",{style:{width:"100%"}},this.renderInviteButton())))}getPermissionItemWrapStyle(){return{boxShadow:"0 1px 0 ".concat(this.theme.regularDividerColor),width:"100%"}}getMenuItemStyle(){const{WindowSizeStore:e}=this.environment;return{display:"flex",alignItems:"center",minHeight:52,paddingTop:10,paddingBottom:10,paddingLeft:e.getSafePaddingLeftCSS(16),paddingRight:e.getSafePaddingRightCSS(12)}}isSubscribed(){const{data:e}=$.default.state;return Boolean(e&&x.E(e))}canEdit(){return l.a(this.props.store.getRole()||"editor")}getPageLinkInfoTooltip(){const e=Object(ae.b)(this.props.store).map(e=>{let{permissionItem:t}=e;return t}),t=e.find(e=>"public_permission"===e.type),a=e.find(e=>"space_permission"===e.type),n=e.filter(e=>"user_permission"===e.type);return t?o.a.createElement("div",null,o.a.createElement(T.FormattedMessage,{defaultMessage:"This page has public link access, so anyone{br}with the link will be able to view the page.",id:"blockPermissionsSettings.publicLinkInfo.tooltip",values:{br:o.a.createElement("br",null)}})):a?o.a.createElement("div",null,o.a.createElement(T.FormattedMessage,{defaultMessage:"This page has workspace access, so anyone{br}in the workspace will be able to view the link.",id:"blockPermissionsSettings.workspacePermissions.tooltip",values:{br:o.a.createElement("br",null)}})):n.length>1?o.a.createElement("div",null,o.a.createElement(T.FormattedMessage,{defaultMessage:"Only you and other invited members{br}and guests will be able to view the link.",id:"blockPermissionsSettings.userPermissions.tooltip",values:{br:o.a.createElement("br",null)}})):o.a.createElement("div",null,o.a.createElement(T.FormattedMessage,{defaultMessage:"Only you can access this page,{br}so the link will only work for you.",id:"blockPermissionsSettings.privatePermissions.tooltip",values:{br:o.a.createElement("br",null)}}))}}t.default=Object(T.injectIntl)(Oe)},xRf7:function(e,t,a){"use strict";a("ioFf"),a("rGqo");var n=a("q1tI"),r=a.n(n),i=a("wldR"),s=a("/6eU"),o=a("wXH4"),l=a("AjLL");function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function d(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class u extends i.a{renderComponent(){const{device:e}=this.environment;return e.isMobile?r.a.createElement(o.c,{popupType:e.isMobile?o.c.PopupType.SlideUp:o.c.PopupType.Popup,open:this.props.open,render:this.props.renderContent,onDismiss:this.props.onDismiss,origin:this.props.origin}):r.a.createElement(s.a,{open:this.props.open,preventHideChildrenWhileOpening:!0,style:{alignItems:"flex-start"},innerStyle:this.getModalStyle(),onDismiss:this.props.onDismiss,render:this.props.renderContent,origin:this.props.origin,disableAnimation:this.props.disableAnimation})}getTopbarHeight(){const{device:e}=this.environment;return e.isElectronMac?l.a.desktopMacHeight:l.a.defaultHeight}getModalStyle(){const{modalStyle:e}=this.props;return function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){d(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({top:2*this.getTopbarHeight(),borderRadius:3,overflow:"hidden",boxShadow:this.theme.largeBoxShadow,background:this.theme.contentBackground},e)}}t.a=u}}]);